 Hello everyone, my name is Matthias and I am a data visualization designer here in my design office HIGSCH.com in Germany. When I do data visualizations, these pieces of creative work need to be translated in multiple languages. This is often the case and therefore you can first of all use a front-end framework to design your interactive visualization together with an internationalization library. Today I want to show you how you can use Swell.js as your front-end framework together with a custom internationalization library that we now write in just like 10 minutes or so. And this is obviously cool to not only have an internationalization library in the end, but also to learn a little bit about the inner workings of Svelte and especially Svelte stores. So I want to take you with me to my screen and I already have the terminal open here. And what I want to do first, I want to start a new Svelte project. Therefore you could use the npxdgit command with the SwellGIS template GitHub repository and let's just name this thing app and then we get this installed in our folder. So let's just move to that folder and do an npm install to get all the dependencies installed. It's working nice. And when this is done we have our Svelte app here and I directly want to take you into my code editor to have a look how the directory looks like that we got now. Let's make this a little bit bigger. So what you see here is this is our folder structure. We got a source folder where we have the app.swell starting component in there and this is already opened here. So you see that this is like the hello world example. And that's basically it. There is of course a lot around there but nothing really important for now. So let just start this thing up and let have a look what it doing So we can in the terminal just run npm run left and then this whole thing runs on localhost So let's go to the browser and see what's happening here and this is exactly the hello world example that we got. So I have the code editor now on the left and our browser here on the right. So we see we have a hello world example where world is actually a variable that we got get from the outside. So let's just kill this for a moment because this is not what we need right now. So let's make this just a static hello world and that's it and for reasons of simplification I also want to delete this extra subtitle here that we just got a hello world. The task that I have now for us is that I want to show this hello world in various different languages depending on which language is set. So what we actually can do is what we want to have basically in the end is something like this. Just copy that. So we want here some JavaScript inserted. Let's say we have a translate function and this translate function that we don't have programmed yet takes something like this is a title and the title there is something hello world and And this looks this key up in a dictionary and then knows to put okay hello world here depending on the language which is actually sent. So this is what we want to have. Let's just mark this as a comment for now. So what we want to have is like a function t that makes this translation. But obviously we need also a dictionary for that. So let us just create a dictionary and in that case we just do this as an extra file. Let's say this is called translations.js and translations.js just exports an object where my top level keys are different languages for example English, EN and there I have another object where I have a title property and within the title property I have the hello world message which is for the English translation just hello world exclamation mark And this I want to have in other languages too. This is like just a minimal example. So let's say we want to have a German version where hello world should translate to hallowelt and let's maybe also do a French version. And there I know some French but I would guess it's maybe Salimonde. I have no idea what the programmers in France call their hello world so maybe if you're coming from France let me know. So this is our simple dictionary and we just take now this dictionary to our main app. So we say import translations from translations.js. So there are all of our translations. So these translations should be known to our whole app and therefore it would be perfect to have a store where this translational dictionary is stored. And therefore let's create another file which we call internationalization.js. So this will be our library. The first thing we do is we import a store factory function which is called writable and this one is in SwellStore. And so we want to have now the dictionary stored in a SwellStore and this works like that. We say okay Xbox Cons dict for our dictionary and this should be a writable store and that's basically it. So what we can do now is we can import this dict in our app. So we just say import dict from internationalization and then we can say the think oops from set because it a store it has set method and we can set our translations object and if the translations are subject to changes maybe you load them dynamically from somewhere we can also do the following and make this a reactive statement with the dollar sign as well so that every time translations changes the dictionary is newly set. So that's basically it. Then for the user in our case now we want to have like a simple drop-down menu where the user can select language maybe. So we need to know which languages we have in our dictionary so we can make another reactive statement and just say okay which languages do we have. We have all the languages which are in the translations file in the top level properties and this is just object.keys from translations and if I show you again our translations file these are the top level properties of this object. So this should just give us ENDEFR so the languages or the languages basically. So we get here these languages and now we want to provide the user with a selection menu where she or he can actually select a language in which the page should be shown. So what we just do here is we do a select sorry for looking here to the left but i prepared this stuff we do here the select object we get a basic drop down and let's do it like that and this select object or select element can have different options and here another cool thing which as well comes we can loop now over our languages and just dynamically put the different language options in there. So what we do for each languages as lang, we do this option element and an option element can have a value. The value is the language and of course the option has the entry itself, which is shown to the user and is just showing

 be the language too. So if we store that we get here our little drop down and it's my Apple mouse is not really well working with that. You see here now it's going you see here we have English, German, French and we can select. So now nothing is happening when I select anything here. What I can do is here I can just find the selected value and let's say I store this to a variable which I call locale or locale. Sorry, I have no idea how this is pronounced in proper English. So, sorry, yeah, locale. And this locale is actually the language which was selected. And I had the idea that this locale also should be known to the whole app, not only to our top-level component and so we can make this also a store. So let's go to our internationalization store and say okay we want to have another store which we call locale and this is also a writable store and it should start with English if nothing is selected because that should be our standard language setting and then we can also import the locale from our internationalization store and now I get an error here because Okale is a store so I cannot access directly the value of it. Then I need to do in this case I have to put the dollar sign in front and then I can get access to this store value directly. Okay great so now we can select and the value of our store. I hope this will work at some point. So, well, good. In another episode I maybe will show you how to build your own drop-down menu which works with an Apple mouse. Fine. So now the user can select the language. Cool. Now what we need is this translate function and for that I want to start the other way So what we have now is we have in our store a dictionary and you remember that the dictionary holds all the different languages and their distinct translations And we have the locale the locale So I have 20 different ways how to pronounce that now. I would say locale. Here we have the locale, which is initially set to EN English, but can be switched by this little drop-down menu. And by switching this or by setting a new dictionary, I want to have a new localized dictionary which just holds translations of the currently selected language. And this is basically, we can call this a localized dict. And the localized dict could be a derived store because it is dependent on the dict and the locale store. and you write this in this way so we put in the dict and our local store as this array and then we have a function which gets the values of this store and just for let's make this a little bit bigger for now and just to to make it consistent with this dollar syntax from the main component When we get the values of the store, we can also write we get here the value of dict and we get the value of locale. And we now use this value in a function call. So first of all, we want to know if the dictionary or the locale is set. So if the dictionary is not set or the locale is not set. Then just return without anything so that we cannot select a valid dictionary here. In all other cases we can just take the dictionary and select the property of the currently set locale and we can just return this so that we get like a sub-object from our dictionary which is just a currently selected language. So this is just a little helper function if you like Okay and then we can definitely start to build our function t which should be the translate function. And this is of course also a derived store because it's dependent on which localized dict I currently have and also yeah it's just based on the localized dict. So which selection of language was done and how does the localized dictionary look like. So I could just say okay this one is dependent on localized dict and it gets me the value of localized dict here in this callback function and what I want to have is something like give me now based on the localized dict selection a message yeah message formatter factory function or something like that let's call that create message formatter or translator or something let's call it like that with the currently localized dict and this great message formatter is then creating a function which is customized to the selected language. So let's just define that. Cons create message formatter. And this one takes the localized dict. And let's see. What I want to have is it should return another function. So it should return a function which takes the ID and with the ID I mean this title dot hello world which says what should be translated this is our ID so it takes just the ID and with that ID it should give me back the correct message so there should be like a function which takes the ID and gets back message so what I could do is is I could just create a function getMessageFromLocalizedDict and there I pass in the ID as the localizedDict. And this function is recreated every time the dict changes So now I need this function here This function takes the ID and the localized dict. Right now here. Now what is it doing now? So it should just pull out the correct translation. So if you remember what we wanted to do here is and I'll just take that here, let it highlight it again. What we want to do is we want to go to title and then we want to go to hello world. So we just need to separate now our id by the dot and the period here and first go for the property title in our dictionary and then go for the property hello world in our dictionary. first go for the title then for hello world that is the important thing and we can achieve this by creating first split ID where we take our ID and split it by the period and this should give us like an array with title and hello world entries and then we just loop over our dictionary to go to the to the most low level property that we have to get our translation. So what we do is we now better make a copy of our dictionary to not be messing up. So we say message is a a nice copy of our localized dict. So I just copied that now in the message variable and then I go to the split id array and for each for each entry in that array which I call now for each entry or let's say for each partial ID and for title and for hello world I want to do the following I want to reassign the message go to message partial ID so this will first my entry split it in title so this will just go to our copy dictionary, go to the title property and reassign that to message and then it goes to hello world.

 pulls out the hello world property and that message will exactly be hello world for the case that we selected English as the current language. And exactly that message we want to return. And that basically should do the trick. So the only thing in our app we need to do now is we need to import also our t translate function and then we get no error. And now let's go to our browser. At the moment there is something not working so let's just take a look if we get an error. And here we say it says derived is not defined. That's totally true because I use here the derived function without ever importing it. Also here in our store package and now we don't have a look now we get our page now it says English hello world so let's switch that to German yes it says hello world now and if I switch to France it says Salimont and this is completely reactive on the changing of the selected language here and our internationalization library now has around 24 lines of code and missing a semicolon And that basically it how it is working So just let us go to the beginning what we did We did here this select element just to select the locale and the currently selected language. Right? If that is changed in the browser by clicking and selecting a different language Then also our locale store gets updated. Then we have a second store which is the dict store. The dict store is just filled up with a translations object. Translations object we just imported here. We would also load that from a server or from a public service or something else. It consists of like here this English, French properties and then it has a common structure. We say okay there's a title and there's a message hello world and that's the translation and of course you could say okay maybe here in your main part of the app you have something else something else and so on. So if the user now selects another locale what will happen. It will update here our heading and this uses just the t function which is a translate function. We need to use a dollar sign here because t is also store. It's a so-called derived store because it is dependent on the dictionary and it is dependent on the currently selected language And we pass in an id which we have here in this like object notation title world So this id is taken here to our t function which is a derived store and this derived store just stores a function and this function is created by the create message formatter function. This function is duly created whenever our localized dict changes. So what was the localized dict again? The localized dict was just a part of our dictionary which just holds the selected language. When that changes, also this function is duly created. And the createMessageFormatter, what that does is just building up the function, getMessageFromLocalizedDict, taking the ID and the localized dict. and so I have just pulled out that logic to pass the ID to a new function. So what happens here the ID is split by the period so that we get like an array of title in hello world. Then we copy the localized dict to a new variable which I call message and then I loop over the split ID array. Get my partial IDs first the title so I will go to the title and then I will go to the hello world sub message and get the translation into message which is returned and this is exactly returned into that h1 element here and output it and this is basically how we design this app and if my Apple mouse so let me just take my trackpad we can select here the different languages everything adapts and you can imagine this is now just happening for the hello world message but of course you can do this for your whole app you can also use Persian or Arabic characters and change the direction with the document.dir possibility or property so that everything is turned from left to right to right to left and so on so everything is possible and I hope you have just now seen how easy it is to work with the swell stores and how to use them. The cool thing is you can just change the locale and select the language at one point in your app and as a store is publicly available across your whole app, everything gets updated because the translate function gets updated. Thank you very much. If you want to see more projects, also projects where I use this in production, just go to my website hicksh.com. Check out the projects there and if you have any questions, best is to ping me on Twitter write me a mail. Thank you very much and bye.