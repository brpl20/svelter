 We'll be right back. Hi, welcome to my talk about moving an app of mine, macOS web from React to Svelte. So what exactly is Mac OS Feb? It's basically a project I made for fun. I started one and a half year ago, kept iterating on it, kept adding features until here I am today, giving a talk about it at this awesome conference with some really cool people. So who am I? My name is Puru Vijay and I am from Jaipur, India. I am currently a BTEC student but by the evening I put on my hacker hoodie and get to work on stack blitz and open source stuff and those of you who know me from discord know me as this black and white sideways turn disc rental cat so with that intro out of the way let's get to the whole song and dance of the mac os web early days react initially the app was built with react and the styling solution was done using material ui's styles this was only the case in version 4 and it was depicted in version 5. And finally if you see the dock animation on the bottom that was done with frame on motion. Features of this are really cool animated dock with a really cool animation and a static toolbar completely non-interactive. For only two features and such little interactivity the size should not be big right it was 146 kilobytes minified and broadly and that's only the JavaScript so yeah I was quite frustrated but even then even then the size was not the biggest issue network requests were as As you can see we have a giant list of requests. This is the nature of Snowpack by default. Snowpack even in prod ships separate files as ESM. Which is not great with these many files as even with HTTP2 these many requests are simply not as fast as one single minified request or file. And finally the doc animation was janky. Doc animation works by changing the width of the individual images. So changing widths of 7 images at once, listening to the mouse hover event and then the actual width change causing the re-layout makes it drop a lot of frames. Hello Veet. Around February of last year I found out about this fun little thing you might have heard of. Veet. Veet is an all-in-one bundler slash dev server slash build tool combined into one little delightful package. wheat is very similar to snowpack but much more polished and bundles everything into file into a single file in production do you see where I'm going with this just moving to wheat reduce the bundle size was 16 kilobytes and the network requests finally were just two if you think about it just changing the bundler bundler reduce so much which is just which is just mind-blowing to And one of the bonus things because of how wheat handles assets It is possible to use the image by a path relative to public folder directly with that feature the code went from this To this and Because I followed the convention of storing the icons as the same name as key in the config object I got rid of even the icon property This is the final thing So the code finally is simply this and the usage is as follows. As you can see, just using VIT made quite a big difference. Era of Priyag. In React ecosystem, the most recommended method to increase perf is to move to Priyag. So that's what I did. And all it took was changing one single file. Which is the VIT.config.ts. all I had to do was install the pre-act.js slash preset dash white plugin from npm and replace the react refresh with the preact imported from add pre slash preset dash fight and it done this plugin automatically did the proper aliasing of react and react dom to preact slash compact so i did not even have to change the imports or anything it just worked a huge shout out to preacting for making it so damn easy and the best part bundle size went down by 37 kilobytes and that brought it to 110 kilobyte Of course, earlier the size was around 130 kilobytes, so the math does not exactly work out. The explanation, I had added a few more features which resulted in a bigger bundle size. But it's still a huge difference. Goodbye style components. So initially, as I said, the application was written with Material UI's style solution. writing styles as JS objects is not fun not at all so after I moved the app to preact I also migrated the styles to style components so I could write some sane looking CSS folks CSS as JS objects is just overrated and bonus it looks much better like it literally looks like some plain CSS which is really it It feels like home. It feels like home. It feels very comfortable But it had its issues So the issues Style components is just CSS in JS. So it was not really a great experience Something about writing CSS inside that types of files just feels wrong uncanny Another thing it requires a VS code extension Remember the code snippet you saw before or style components? Notice the CSS in it was not syntax highlighted. This is true for VS code as well. You need style components extension to get the highlight, intelligence, all the things that make CSS support great. And finally, the performance is just not great. By performance, I mean the runtime performance. Because style components create the styles using JS, it is always slower than just providing the plain CSS on demand. Of course, this point is not very important for this project as I never saw style components has a runtime of bottleneck, but the issue was still there. And finally, it's bundle size was 12 kilobyte, which is not really big, but it's still nagged at me. And one of the things is that it does not minify. So what you are seeing is the final index.js bundle of the app. As you can see there is a lot of minified JS and then you have the raw CSS written inside the JavaScript. Frankly, it looks ugly and makes the bundle size bigger for no reason. Finally, I got rid of style components and replaced it with plain SCSS modules. And the results were good. The size went down from 110 KB to just 85 KB. But more than that, it also made it easier for the browser too. All that was needed now for the browser was just to parse the CSS and background and be prepared. The JS had no more control over the CSS, hence it was overall more performant than before. Finally, I was at a point where I could not make the app smaller by removing the smaller dependencies anymore. Those dependencies were just way too essential for the app to work. So finally, I resorted to code splitting the app away using React Suspense. Up until now, all the apps are loaded on the initial load only, which was not needed if you don't even open the apps. This here is the app Nexus component. Why the name Nexus? Nexus in science fiction and fantasy is a world between worlds, a room with doors in it to lead to other worlds. This is what app Nexus does. This component is responsible for loading the writer when it is requested. This move brought down the bundle size down immensely. Now it was just 62 kilobytes on first load, which is just really, really good. It's literally 2.5 times smaller than the initial version, which was at 146 kilobytes. So summarizing, these are all the tricks I applied to reduce bundle sizes. Move to Preact, style components to CSS modules, code splitting, and most important, get rid of dependencies. And here's the dependencies until now. These are the lowest this project has ever had. Now this is Svelte Summit and I still have not gotten around to Svelte. So here it is. The golden age of Svelte. Finally we are on Svelte. Let's talk about it now. On 12th of August I started migrating the app from React to Svelte. I started with copying the plain JS files first and then the react ones as dot swelled files. I would paste the content of the react file and start removing the JSX specific code from it file by file. And by the night of 13th, I was fully done with the refactor. Everything done in just two days This is a giant benefit of the modern web development We all argue how one framework is better than others But in in the grand scheme of things all are similar enough and it is a boon For people like me who like to migrate things over all the time. So how exactly was the process? It was hard It was very very hard. It was a super grueling process very time and I won't do it ever again again. Just kidding. It was a very very smooth process. Unbelievably smooth. I was really surprised when the whole process got over in just two days which is just mind-blowing. This move brought the bundle size down to just 28.5 kilobytes. This is literally less than half of before and that is just from moving to Svelte and the runtime performance increased drastically drastically earlier there was still slight junk in how fast the menus opened up how the dock animation worked but now it was all gone everything was super smooth now let's talk a little bit about the process overall moving to Svelte was a very smooth process so let's talk about some of the few things local state this This became this. Already the boilerplate reduction begins at the most basic concept of modern web development, local state. And what about the global state? Earlier, I was using Jyoti in the Preact version. The reason for choosing Jyoti was how minimalistic it feels. It feels very, very close to swell stores compared to anything else in the React ecosystem. This is the Jyoti syntax. Of course, it does not look anything like Svelte stores or state state. It actually looks closer to the use state hook from react, but compared to what you get in the react ecosystem, like with Redux or context API, this is really great. This is just, this is a heavenly almost. And this is a global state in Svelte, not a lot of difference, but if you repeat it over and over in different places, it actually makes the code much smaller. Just import the store and use. it. No need to declare theme and set theme variables. Now, what about the styles? Styles are already plain dot scss files. So all it took was inlining them into the components directly by copy pasting. And that's it. Finally, let's talk about my observations. What all I learned from this process? Svelte code is much simpler. Svelte being an extension of HTML rather than JavaScript already made it much simpler than the previous code base in JSX all indentation was reduced by two levels automatically Plus the constructs in it like the each blog the await blog etc. All made it even more clean looking Heck I even tweeted it out as you can see the code on right looks much larger That's because of how little code swells requires compared to JSX There's also lesser number of dependencies on the code on the right No ternaries no CLSX for dynamic classes just use swells features and get instantaneously beautiful code and to top it off some components got smaller to some by as much as 50% and at least three components were not even needed at the end they were just merged into bigger components directly and overall code stayed if simple enough only it was an absolute win-win Svelte motion is on fire macOS is an operating system and no operating system is complete without animations this is where swells built-in motion stores and transitions come in so else motion stores are extremely lightweight and extremely powerful they power the dock animation when you hover on it the window closed and open animations dialogue open and close animations and using them is extremely easy previously I was using framer motion framer motion is a great library and I go to think for animations in react but there's just one little issue with it it's not exactly small frame and motion version 4 stands at 32 kilobytes up for comparison this is nearly as much as the whole app after moving to Svelte but of course this is not a shade at frame or motion frame or motion can do a thousand things under the sun its size is indicative of its capabilities there's no such thing as a good tool or a bad tool there's only such thing as a right tool for the job Framer motion was way too overqualified for my use cases I did not need layout animations or staggered animations or any of that thing all I needed were very simple animation primitives like entry and exit animations spring into in animations that's it nothing to fancy and swelled just provides this out of the box. Let's have a look at an example. When you click on any of the app icons on the dock, the icon bounces up and down. Let's compare the code for this in Framer Motion and with Svelte Motion On the left you have the code in Framer Motion and on the right it the Svelte Motion code Clearly Framer Motion one looks much smaller but let read both of them once here we have an object animate of obj that contains the css properties to be manipulated hence we have translate y as an array here the array contains the keyframes right now it's all zero to indicate to not animate initially next up we have an event listener on the span so whenever you click or tap on it it will trigger the animation the keyframe becomes zero percent initially then it reaches minus 39.2 percent and then returns to zero percent again this makes the app i can bounce next up don't let the animation run on component mount pass the animate obj to the motion components to let it know what to animate in this case it's only the translate by property next up defining the animation type i want this to be a spring animation and this should go on for 700 milliseconds easy and finally transform template to make sure the transform 3d is not applied which is what frame and motion does by default first up defining a twinned store because i want to control the duration of the animation it's a twinned and not a spring However, to give it a natural feel, it uses a sign in out easing. Next up we have got the button which on click will trigger the animation. This is a span that will actually be animated and transformed. You can see the transform style applied to it. And coming back to the actual animation implementation, the open app function. is what actually handles the and this is what actually handles the bounce animation and if you see the bounce animation technically it's just two lines line number 11 we tell it to change the value to minus 39.2 notice the await keyword we are waiting for the animation to finish before we move on and when the animation to go above is finished we move on to the next part which is bringing it down and that is simply setting it to zero notice how intuitive this version is is it legit reads like this go up to minus 39.2 and when you are done with that come back down as simple as that it's easy to scan and make sense of frame and motion one is a smaller but if I wanted to make the animation more bouncy or extreme I would have to search a lot of frame and motion dogs to figure out how to do whereas in Svelte one I would be confident changing it. Transitions in Svelte are basically animations to be run when some DOM is created or destroyed. This is nearly impossible to do in Preact without relying on external libraries like Framer Motion. But hey, in Svelte, this is built in and extremely easy to do. So of course, I put transitions in everywhere I could. Earlier when you opened slash closed any app, there was no transition. Now when you close the window, it collapsed into itself while closing, an awesome transition this little piece of code allows the window to close with a transition i added this animation when i moved to swell version because the react version with frame of motion just felt too complex so i did not even bother with it and this is what you get looks good for just 30 lines of code right and remember i showed you the package.json that the react version had this is a preact version and this is the latest one with swelled this is 2.75 times smaller but let me blow your mind even more that dependence you see at the bottom i created it a month before i did the transition from react to swelled i created it as a fun exercise because swelled ecosystem did not have a tiny dragable library with the features i I wanted and it is just two kilobytes in size. So because it's a home cooked library and very small, I'm just going to remove it from the comparison. And that implies that the number of dependencies is now actually 3.67 times smaller only and no this isn't because I repurpose the app logic to not use the dependencies. It is that most of this stuff is already built into Svelte. I didn't do a lot of work. It just happened. So, in the end, this brings us down to the final bundle size comparison. From 146 KB to 28.5 KB, this led to a reduction of more than 5 times in bundle size. But hey, that's not even the most important part. Initially, bundle size and performance were the things I always gave the highest priority. Not anymore. Now it's the readability and simplicity aspect that I value the most. Svelte gives me a lot of confidence. If I ever want to add something to it, I'll be able to do so very confidently. The code is very readable and simple. Final words. Really, moving to Svelte made me realize how extremely powerful it is. A lot of React developers treat Svelte as a toy and I can't blame them. I was one of them once. But really, it isn't a toy. In fact, I'd say it's more powerful than React. Yes, less control over everything than react, but it is a better choice for 95% of developers than react in my opinion. Thank you.