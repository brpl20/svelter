 Yo friends, what's up? In a previous video, I showed you how you can take an existing Svelte store and turn it into a rune store. And what does this actually mean? It sounds like a crazy ride, but basically, we just took this twin store from Svelte slash motion, which is used to animate values over time, right? And we basically just wrapped this in runes or signals so we can use the new reactivity system in Svelte 5. As you can see, in this example, we're just using this to create this camera circle text so we can animate this SVG, because otherwise this wouldn't be possible using regular css right so we just have this svg i'm just using this view box here and let's see how this looks like in practice how beautiful is this friends but yeah basically today i actually thought it would be really fun to go through this together and implement this tween store from scratch and it's actually not going to be a store but we're going to use runes this is going to be a lot of fun because we're going to learn how to animate values over time so we're going to learn about linear interpolation we're going to learn how easings work we're going to learn how to return a promise and await it so we can chain our animations and etc and it's going to be really fun all right but before we get started here's a message from our sponsor i'd like to thank this video sponsor you the viewer you can support the channel through patreon or a youtube channel membership members get early access to videos help shape the content in a special discord role you can find all of the links in the description thank you for your support all right let's take a step back and i'm going to drop some svelte lore on you so in svelte 4 and previous versions we have this concept of stores and stores are really just objects that uses the publish subscribe pattern so you can subscribe to some value we can observe it changing and then we can notify the subscribers right in this example i have this progress which is a writable and i can go from 0 to 100 you can see it's really boring but maybe we want to animate this value over time so we can actually use the tween store from svelte and we we also have a spring store if you want to use spring physics and etc but in this case where does actually twinned come from well that's actually just a term from animation animating between keyframes right that's where that word comes from so here instead of using writable we can actually import twinned from svelte motion and the only thing we have to do is replace writable with twinned that's it now we're going to see this value is going to smoothly animate over time as you can see it already looks a lot better because it looks more natural but instead of using a store today we're going to recreate this from scratch using signals and that's basically it so this is going to be our final result we're going to create this progress here so it's going to be a new twin we can pass in a regular number or an object and we can just animate these values over time easy peasy lemon squeezy friends all right but first i'm going to remove everything so we can start from scratch all right so first i'm going to create a script tag and inside of it i'm going to create a twin class of course you don't have to use a class you can use a regular function whatever so we can actually define a field which is going to be value and when we declare it using a rune is going to create a getter and setter under the hood so we're going to say constructor value let's just assign value to value and the only other thing i'm going to create a two method is going to accept a target so now the first thing in our animation we have to know when it started so we So we can, for example, say const start, and then we're going to use performance.now, which is going to give us a high resolution timestamp. And this is basically when this code ran when you open the page, right? And you can even hard code some values. For example, let's say duration. We're going to have two seconds and you can even specify delay if you want. So if you want to include the delay, you can just say plus delay. This is basically all you have to do. But in this case, I actually don't care about delay. Let's just remove all of this. And as homework later, of course, you can pass options instead of hard coding it like this all right so we're going to use request animation frame and what does it accept a frame right okay so let's actually just create a callback function and I'm going to name this frame and we're going to actually call this so we're going to say request animation frame we're going to pass in a frame and this automatically gets passed now a timestamp right like this but you run into some weird problems it starts with a negative number then you have to put a check so whatever we don't need this actually let's just say frame and instead of passing now here we're going to do the same trick as we did before we can actually say const now we can say performance stop now that it easy peasy lemon squeezy all right so now we need to calculate the elapsed time which is going to be the newest time subtracted by the starting time Cool And now we just need a conditional So we can say if elapsed is higher than the duration, then we're going to just reassign this to the latest value. So we're going to say target. Otherwise, we're just going to run this loop forever. And we're just going to pass this frame like that. Okay, beautiful. And the reason we do this because you can get into some weird situations so for example if you're animating from 1 to 10 you're going to have some weird things like it's going to go 1 2 and etc and then you're going to end at 9.8 or whatever so basically we're just seeing if this is over in that case we're just going to set it to the target just to be safe and of course we can just return here so for example let's say return true that this is over for example and of course we can just assign this value but this is the interesting part so what are we going to assign here and this is the part where we learn about linear interpolation all right so how are we going to animate these values over time and we can actually use a lerp function and lerp just stands for linear interpolation and that is what games use all the time and etc you might have heard of it but let me actually show you how simple this is concept and it's really a simple beautiful and elegant formula to remember so for example we can say function lerp we're going to accept an a a b and then in this example we're just going to calculate the delta so we're going to say the delta is b minus a and then we're going to actually return this function which accepts t which is a value that goes from 0 to 1 right so what we're going to do we're just going to say t times delta right and we're going to add a so for example let's say that we want to learn between 0 and 100 and we have some animation going on for example 0 to 2 seconds really not important we're going to actually pass a t so for example if we pass in 0 here we're going to get the initial value if we're halfway through the animation so it doesn't matter what the time is because we just care about t so this is going to give us 50 and if we pass in 1 is going to give us the target value which is 100 and it's really that simple so let's actually just take this function right here and i'm going to go to our class just put it down here and let me just instead of lerp say interpolator because we're going to have more interpolators here we're interpolating a numbers but later we're also going to interpolate an object all right so for example if i save this easy peasy lemon squeezy so now we're going to create an interpolator here let me just say const interpolator now i can say this interpolator so we're going to pass in this value the target and that's basically it so now we're going to get this function back so now we just have to calculate this t somehow based on our animation right this is really awesome all right so the thing we have to do here and something weird happened here because i saved this i guess okay let me just remove this all right so now that you have this interpolator we can just say interpolator but okay how do we now calculate this t value and it's really so simple so we can just take elapsed and we can divide it by the duration boom that is going to give us t and actually if we did everything right now our animation should just work so let's go here and i'm going to say const progress new twin let's pass in zero let's create a button and we're just going to say progress dot value and let's say on click progress to 100. All right. So let's see if everything works. I'm going to clear this. Let me just refresh for good measure. And you're going to see it works. Of course, it looks crazy because we can just say to fixed. And now we're going to see it animates beautifully. Now that you understand how most animation libraries work, unless they're using the web animations API, but most older animation libraries like gset for example use this exact same method so here we have this simple animation and go from 0 to 100 in a linear fashion but that's actually the problem this is really boring because it's linear right and this is where easings come in easings are just some math that makes t more interesting so we can actually get the definition from easings if you go to easings so easing functions specify the rate of change of a parameter over time as you can see you can pick any of these easing right so this can give character to animation if our animation for example overshoots we going to get this elastic animation right so we can see how beautiful is this friends right and we can actually go to this side we can just yoink any function that you want and here is this useful visualizer from swell so for example let's say that we maybe want to slow down the count at the we can for example maybe go to quad and then we can for example say ease out as you're going to see it's going to go faster and then it's going to go slower at the end this is basically what easing is and it's really simple we can either import some easing function from cell let's actually just go to this site and we're actually going to steal a function so let's add some character to our animation so let's just use ease out quad we can go here and we can just copy the code here if we want that's basically it let me just copy this over going back to our example and that's basically it let me just remove the types it's underneath this cool so we have ease our quote as you can see it's just some math that's going to change the value of t so now when we have this elapsed duration so we can just say ease out quad and now we can take this t value let me save everything and you're going to notice it immediately so you're going to go fast and it's going to slow down and this is even more pronounced if we increase the animation duration to four seconds for example it starts out fast and then when it nears the end is going to get slower and slower so this is going to give more character to our animation but yeah that's how easings work and of course you can pass easing as an option later i'm just going to revert the changes so we can talk about more interesting things right let me just save this and remove this at the top all Alright, so let's see how we can promissify our animations. So something like this currently doesn't work. Let's create an animate function. Let's say, for example, that we want to await progress. First, we want to go to 100. Then when we're done, we want to go to 0. And let's actually use it. So we can say animate. And even if we refresh for good measure, it's not going to work because it's going to use the latest value, right? Alright, so how can we actually do this? And it's actually very simple. Instead of doing this animation loop here, we're going to pass frame as a callback to a loop function which is going to return a promise so we're going to have something like this we're going to have a task and we're going to say loop and this is going to be the callback our frame right so we can take something like this let me just cut it and i'm going to remove all of this and now we can even remove this so it's just going to have a condition if it's done we're going to return true otherwise we're going to return false all right awesome so now inside of here we can just say return test.promise and we can have other things on these objects in the swell source code for example they have an abort method etc because they do some other fancy things like preventing you from clicking 10 times on a button and doing weird things with animations but in our case we don't need to think about this all right so for example i'm going to have a loop here is going to accept the frame which is the callback right and in the past you had to use this new promise constructor which would give you resolve and etc and this is really ugly but thankfully a newer api that is stable in every browser now i think so we can use promise with resolvers boom and this gives you everything that you dreamed of you get the promise you get the resolver you get the error handler and etc and let's just make this constant for good measure and this is it so now the only thing that you have to do is return this promise and of course we can have other things on here like abort and etc if you want to be more fancy but yeah that's basically it okay so now what are we going to do well first i'm going to create a callback run which is going to accept now and now remember here we have our callback which is this frame that you're going to run 60 times per second right so we can just say check if this is done because we're going to invoke it constantly and then we're going to say hey if this thing is done okay let's just resolve this otherwise we're going to say request animation frame and we're going to pass it this callback right that's basically how this works all right cool so now that i saved let me refresh for good measure so now you're going to see that it doesn't work because of course silly me so we can just run this for example but in this case let's use request animation frame since you passing now we can just invoke this function refresh for good measure Cool now it going to go to 100 and you going to see it going to go back And that basically it How easy peasy lemon squeezy that is friends Let me also share one more tip. So for example, here we're using this request animation frame, which comes from window, right? But if you run this in the server context, you're going to run into some problems. So you can do something like this instead of having checks everywhere. Hey, if this is in the browser context, you can just create something like this. So we can, for example, say, wrap request animation frame. We can actually check if type of window. I think it's undefined like this. And then if it's undefined, we can just return a noop or no operation, or we can actually just return request animation frame. And boom, now instead of typing each time request animation frame, you can type out this shorter variable name. But yeah, that's basically it. All right, so the last thing you have to do is interpolate between objects. But if you don't want to do this, you can, of course, always use something like d3 these nuts so you can go to d3 interpolate you can install this package and you can use this method dot interpolate and this interpolates between numbers objects arrays and strings so you can interpolate colors everything that you want if you don't want to implement this yourself but i actually think it's really interesting and the first thing we have to do in our interpolator let's for example check if a equals b so if they're the same value or if a doesn't equal a so this is some other thing that is not the same object or array in this case we can just return this function or a itself right we don't have to do any extra work all right so now inside of here we can just check if type of a is a number then we're going to return this and we're going to actually do the same thing if it's an object but of course this is naive this can also be an array so you can do a better check here but i don't care but actually let me explain what our goal is So if I make this comment, our goal is actually how we're returning this t here, which is a single value, we actually now want to return an object, right? So this is what we basically want to return. We want to return this object. Let's say that we have x0 and we have y0. And we just want this to be a function. Interpolate a, b, same thing here. Interpolate a, b, boom. That's how easy peasy, lemon squeezy that is. And let me actually show you how we can achieve our goal. well we can just go here and i stole this directly from the swell source code you in mind now sue me so we can say for example const interpolators and we just want the keys from our target right just so we can loop over it so we have the key right now the keys of the mansion and now we can just say interpolators based on that key we're going to say this interpolator and now we just need to pass the a key and the b key boom and now the only remaining thing we have to do is return this object all right so inside of here i'm going to again return t but in this example we're going to return an object from this function and we can just say const result again and we're just going to again say object keys b for each key and now we're going to say result based on that key so based on that key we're looping over we actually want to run its interpolate function so we can say interpolators based on that key let's just invoke this function what we have to pass to an interpolator that's right we pass in t boom easy peasy lemon squeezy like that friends and also let's not forget to return the actual object right that's the entire point of this all right so let's go back to our example so now let's see if we can interpolate between object let's create x and y zero i'm going to remove this so in our example here let's just say x progress value dot x and we can also say progress value dot y and by the way if you want to learn how to make this a nicer user experience so instead of saying progress dot value dot x and just saying progress dot x you can watch my previous video where i explained that but yeah in this example let me just go progress 2 and we can animate x 200 and let's animate y 200. all right so the moment of true let's refresh for good measure how easy peasy lemon squeezy is this friends all right friends that's basically it if you like what you've seen don't forget to like and subscribe thank you for watching and i'll catch you in the next one peace