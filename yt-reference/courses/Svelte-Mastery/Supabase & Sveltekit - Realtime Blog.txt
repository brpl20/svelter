 Okay, hi there. So in this video, we're going to take a look at real-time subscriptions. So here in the docs, we can come, Supabase docs, references, we're going to be looking at this part right here, real-time. So basically, when any data is inserted or updated or deleted from a certain table, then this will alert you of the change, and then you can immediately make it visible on the UI. So a good use for this would be something like a chat app, or maybe in our case it's going to be a blog where the comments and posts are updated automatically. So for example here, like if I have new post for real, so you see there's just new post down there, blah, blah, blah, add post, now it's down there. And it's also been added to the database here in our post table, new post for real. Okay, but let's start over. We're going to delete this table and delete the comments. Oh, other objects depend on it. So then we have comments, basically that are, you can comment on a post. So let me delete the comments and then I can delete the posts. Okay, yeah, remove that. And I've kind of given up on CSS, I just kind of get too obsessed with it and then I don't make progress on these videos. So this is what it looks like. Okay, so I have just a basic setup. Basically I installed at supabase slash supabase dash JS and then I have the supabase file. Create client like this, import.meta.env vt supabase URL, which come from, these both come from .env right here. And note that they have to start with vt like this for vt to actually pick up on them. So anyway, okay so this is the code. So basically it's just an index and a post, and I just have those there in case I forget it, I can copy paste. Okay, so let's get started. I don't know why this still has something on it. It should be blank. There we go. Okay, so first thing we need to do is make a new table. We're going to call it posts. Description? Nah. Okay, add columns. So a post can have a title. It's going to be text and some content. So content is going to be text. Save. Okay, cool. And then we're going to have comments like this. And we're going to, it's just going to be, I'll call it content, keep it consistent. And it's going to be text. And then we'll also have a foreign key, which you do with the link. And the foreign key is post here. And it'll be based off the ID. Sure. Okay, save. Okay, that should be good. Error for input at columns. Oh, I need to give a name, which is post. Okay. There we go. Okay, so now we have our posts and our comments. So let's start something here with index. So we're gonna have script. We're going to import Supabase from lib slash Supabase. And we're going to, so another thing is that I'm not gonna have any users log in. So basically anyone has access to any of this data and can do anything with it. Okay, so not ideal, but just for example purposes, that's what we're gonna do. So we don't need to log anyone in. Basically what we need up here is, let's have a main tag, and then in that we're gonna have our h1, so welcome to my, well, our blog, because anyone can use it. And here we'll have two parts. We're gonna have a make a post, And then we'll also have a see your posts. Like that. Okay, so here under make posts, let's have a form. So form, we'll have an input. Now let's do this quickly, kind of sloppily. Placeholder equals title and the name equals title. Should be good. And then a text area. Oh, that's my dog. maybe okay I've moved into a hopefully quieter place let's see if this works better okay so anyway text area nine equals content okay so this is our form and we just gonna get a little button here at the end make post okay and then when we submit this form on submit okay not that submit prevent default It going to be add post Okay so let make that function here And actually, I'll just copy paste it from here. So I have to type that all out. Okay, so add post, what it does is it takes the form data, which will be right here. Name equals title, name equals content. So whatever's in those, it's going to pass here to form data. And then form data.get title, form data.get content. So await super base.from posts, insert that. Okay, and that is going to make a post for us. So now we just need to do the part where we can actually see the post on the screen. It does that weird thing sometimes. Okay, and let me add to the main, some of these styles right here just so it's in the middle hope still looks weird how did I form I just used a beer okay I'll just quick and dirty like that okay there we go so now we have make a post so I can say title first post very good post. I make a post and it doesn't show up there but it should show up in our database right there. Very good post. Okay cool. So let's do the subscription thing now. Okay so how I'm gonna do it is with a readable store in Svelte. So import readable and we're also gonna need the get from Svelte slash store and and we'll start it right up here. So const posts equals this readable store. So I'm going to start out with null. And then here in the second part, this is going to be the function that when it gets subscribed to, it'll set the function. And well, sorry, when it goes from zero to one, basically, this will set the initial value, we're going to set it in this function. And then we're going to also have something, we're going to add another subscription from Supabase that will update the value from within, basically. Okay, so the first thing is to actually go and fetch the data of the posts. So this initial value. So initial value is null, but right after that, it's going to be calling the post and it'll get all the posts. And then from there, there'll be the subscription. Okay, let me just show you. So here we go. We are going to want to set a value. Oh, how do I even get started? Okay, I'm just gonna have to rely on this again. Okay, so readable set right here. So we can't make this an async function, unfortunately, because we need to return this value here from this function. We can't return a promise. So we're gonna have to do it like this from select then so we're gonna from posts get everything and then set the data basically set the value of the store to whatever data we get back okay so that's gonna set the initial value so that's all we would do if we wanted to um so if i refresh oh wait i need to show it on screen this is what we do if we don't want it to be real time if we just want on page load, we want to show the posts. So down here, let's actually show the posts. So each dollar sign posts as title content. We'll have an H three, which will be title and then a little P tag for the contents. Okay, that should be good. What did I do wrong? yeah okay so we need to say since it starts out as null we want to say if posts then actually show them else they loading Else loading Oops Okay Oops Oh boy I like hunched over here on the desk with this mini desk in another room So okay Anyway so now we can see when we load it load and it show us But if I made it another one second post then I need to okay so I submitted it I have to refresh and now it there Okay but we want it to immediately appear right after we hit make post. So that's where the subscription part comes in. So here, from this thing, we're supposed to return like an unsubscribe function. So in Supabase to unsubscribe, to be honest I don't 100% understand when you need to unsubscribe I haven't ever really done that but either you're always supposed to or I don't know please leave in the comments if you know when you're supposed to unsubscribe but anyway this is probably best practice okay so right here we just need to say add subscription to super base logic okay and again I think I'll copy paste because that's quicker so this is what we're going to have right here so call this subscription which is what gets unsubscribed from down there so basically superbase.from posts on so on uh any change so this could be like insert or it could be um update or it can be all like this so payload is going to have basically three things we care about is payload.event type which is going going to be insert, delete, update, upsert. There's going to be payload.new and payload.old, which would be used for an update. So we're only going to look at insert in this video, so we only care about new, like the inserted thing. But if you're doing an update, then you would be looking at old, delete. I'm not sure what you would be looking at. Okay, so basically, whenever anything changes, we're going to say if the payload.event type is insert, then we're going to get the posts that already exist in the store and then we are going to add pilot put we're gonna add the newest post at the top or at the end of the post okay so it's gonna set the new store value okay so this is should work let's see now okay oh boy someone's got a motorcycle okay real time post make post and we don't see it let me see if I got an error no aha okay so the thing I forgot to mention which you need to know is that if you actually want to use real time is that you need to go to the store so here we are at posts and we need to enable something what is it we need to enable where do we find that though. Storage authentication. It's some kind of... okay, let me just look at the docs. We need to note managing replications. Go to database, click on replication, database replication okay here it is and then click here on zero tables so basically we want to turn on posts hopefully that should work now so refresh there's a real time post really real time post okay there we go now it's working and let's also put the comments too Okay, so that is how you do it. I guess, I mean, that could be the end of the video because you can now do a real-time thing. One way we might change this if we're only doing inserts is we might just do insert, and then we wouldn't have to actually check if it's insert because we already know it is. Like that. But I'm going to add in the comments as well, which will have a bit different of logic, and it might be useful if you want to make some type of blog thing as well. Okay, so we have a post. Maybe I'll just do this quick. I'm not actually going to type it all out. So we got a post. Let me give you this one. This is an empty one I was going to type into. Oops. We're going to have a post. And basically it's very similar. It takes in the ID, title, and content. And it's similar in that it has an ad comment right there. And it has this readable store, which is the subscription logic. And it's just, you know, comments. If there's no comments, don show them and here just an add comment thing okay but basically here the logic is a bit different is because we are passing in the So let me put that in here Post So title content. So I could pass in title content individually. Well, sure, I'll do that. And ID. And then pass those in. So it takes title content ID. let me import that post okay oops why did it okay so now I got a post let's see cool first very good post closing tag down here post okay hopefully that's working now cool so no comments yet for any of these so you'll see when I very good post actually very bad post I comment oh okay people are gonna say bad video because it's not working so I clicked add comment but we see it didn't show up let me make sure last time I clicked on one of these and then it didn't actually save it okay but it did save it this time so I just messed something up so let's go back to the table editor and look at our comments okay I didn't even add the didn't even add those there so let's come here to post add comment what's going on comments for me to get comment post dot equal ID update post content I see okay so basically before when I made this I didn't call it content I called it comment big mistake so I just need to we just need to call this content and hopefully it'll work from there this should be comment content okay so basically when we insert it we just need to pass to the post ID along with it okay so the ID is automatically created when you create a post. And remember, I have a post, like an ID. So you're basically just putting in the ID of the post, which is just a number. One, two, three, four. Okay, so basically passing that ID down into the post. So this post knows which ID it has. And then whenever we create a comment, we just want to make sure we put a reference to that post right here so post is that ID and the content goes there get comment is that okay that should be fine okay let's see if it works now so let me refresh no comments yet bad bad bad comment there we go so that adds the comment I can keep adding it if I want and then here I can say good comment you'll see it's there And then another thing is if I open another window here and I put this to the side. Hopefully I don't accidentally show anything bad. Okay, here we go. And then I say here, this person really likes the post. So I say good, good, good. I add comment and it'll show up on both of them. Okay, so that is how you can make this little blog thing with real-time subscriptions. So the other thing you'd want to do is, in reality, basically anyone can do anything with any of this data. So that's bad, probably. So what you would want to do is come here to row-level security. So create some kind of policy where enable insert access for authenticated users only. That's a start. So you can only create something if, so you can use this template and save policy if you wanted to. So you have to log in first. You'd have to create the login and everything. And then you could display the username next to them or something. That's one thing you could do. And then you'd have to make a policy like when they delete that they would need to be the creator of the post actually delete it. Okay, but I'll get into role level policy a different time. I'll try to put this up on GitHub so you can take a look. And that is all for this video. Have a wonderful day.