 Hi there. So in this video, we are going to make a tiny little web app that lets you upload files and then retrieve them back with some pagination. So I went ahead and got the subscription, the yearly subscription, so now I can add multiple apps. So I'm going to add one called Pagination and we're going to grab this ID, which we will use in a moment. So over here, I've set up some boilerplate. This is everything we need to do. And I've created two things just so you don't have to watch me type this boilerplate code. Basically, this is a cell. I got that that name from Redwood, which uses a concept of cell. It's basically this await error syntax. Um, and then I have an image here that just creates an image from a file. Okay. And then here in index.html, I've added the user base. Um, what's this called? The SDK. Uh, so this will put user base on the window object. Okay. So let's get started. So first thing here, user base, what we want to do is, well, first of all, I usually have user, this is the user. And then I grab user base off of window. And then just in case some hacker wants to come in and mess around with stuff, I'm just going to set the window user base to null. Just so a user can't access window base just by typing in user base here. Or sorry, user base. Yeah. Okay. So that is user base and then DB stuff. So we're going to have database name is going to just be called files. And what other stuff do we need to do? We have our file items, which will just be a list like that. And then we're also going to have a change handler, which we'll use in a second, which is going to pass in these items. And we're just going to set file items to these items. Okay. So we'll use all this stuff in a bit. We're going to init now. So we're going to have an auth promise so we can show like a spinner while it's loading. uh, auth promise, oops, equals user base dot init. And now we can pass in that app ID right there. Okay. So that'll initialize it and then it's going to give us this session. And from there we can say user equals session dot user. And then this is what I'm going to do just so we don't have to go through a whole signup form. I'm just going to say, so if there is not a user already logged in, then I'm going to userbase.signupsomebody, and I'm just going to give them username yummy, or no, I meant to do dummy, but this works. And password is also going to be yummy. So it's just going to automatically sign us up, basically. So if you want to learn how to do authentication, you can look at my other Sunstack video. Okay. Right. And then once they have logged in, just going to be, just going to set user to whatever this passes us. Okay, cool. And then we're also, so after we have our user, we're going to open our database. So userbase.open database, the database name, and the change handler that we created before. Okay. If that's confusing to you, you can look at my other video about this. So, and we're also going to need to await these. Okay, we don't want this auth promise to resolve until the database is open. So just make this async. Okay, cool. So that is our initialization. And down here in script, let us use one of the cells. So this cell just takes a promise, auth promise, and then it'll handle the loading state and an error state for us. And we can just put in the resolve state right here. And for cells, I'm using this spinner thing. You can npm install svelte spinner and then just import the spinner. And it'll give you, oops, I'm not using, oops, this spinner here. Okay, cool. Okay, so next thing is to handle upload. Great. Okay, so this is after they're logged in. We're going to say, hi comma user dot username, like that. And we're going to put an input, which is a file input, and on change equals upload file. So when someone uploads something to it, then we're going to grab that and upload it to our database. And I'm also going to wrap this in a cell. I'll do that in a second. So here for handle upload, so function upload file, and that's going to get an event, and we're just going to grab the file off of this event. So to get the file, we're going to do target.files zero. So this will be the file that they upload. Okay. So this is a bit tricky. Uh, I mean, not too tricky, but basically you have to create an item and then we attach a file to that item. So I'm going to do it. This is a bit overkill, but I'm just going to do this, um, cause this will apply to more cases So for example um let say someone uploads a file and this database is shared or something So someone else might be uploading files to this database And so we want to have a ID attached to this item Okay. That's kind of confusing. Let me just show you what I mean. So math.random.toString.substr would work or substring two. Okay. So, you know, usually you get math.random will do this. So the substring two is just removing that zero dot at the beginning. Okay, so we have a random ID. Um, we're going to say userbase.insert item, the database name, which is files, which we defined above, and then the item is going to be this random ID. So we don't actually care about the item. We're just using the item to upload a file. So we're going to give it this random ID and that'll become clear in a bit. why we need to do that. Well, we don't actually, we don't need to do that in this case, but so when, after we insert this item, it's not going to pass us the item that was just created, unfortunately. Um, but what happens is that change handler is run before this promise resolves. So, um, in this dot then code block, we can just grab this new item off of file items, um, cause this will run before it resolves. So to get this newly created item that we just made, we're going to say new item equals, um, uh, file. So it's called file items dot filter. So this file item. And so when you create an item, it's basically an item ID and an item, which in our case is this random ID. So let's grab item ID and item. Okay, so we want to say if this item ID, sorry, if this item equals our random ID, then it's the item that we just uploaded. Okay. Hope that makes sense. So find it where random ID equals item. And sorry, we don't actually need item ID. I was going to say file ID. This is getting a bit confusing without any background, but I want to say there's no file ID. Okay. So basically what this is saying is, okay, this is the item we just inserted. And also there's no, um, there's no file attached to it yet. So in the crazy case, we had like millions of photos and this random ID has already been used. Then this is saying, get the one with this random ID that doesn't have a file yet. So, I mean, it's a lot of, you could probably just pick the last item and file items and that's going to work in 99% of the cases, but this whole random ID stuff and not file ID is just, just in case there's like a bunch of files being uploaded at once or something. Okay. Anyway, so this is going to get our new item. So the filter returns a list and we just get that zero. Oops, get that one item in the list. Okay. So now that we have our new item, we can upload a file to it. So to do that, it's going to be user base dot upload file. Again, we need the database name, which we already defined. And then we want to pass in the item ID. So the item ID is going to be, so let's just grab item ID from here. Just destructure it out. And then after that, we need to upload the file. So we have the file up here on line 20. So we just pass in that file. Cool. So that will upload the file for us and it'll attach it to this item. Okay, so that should be everything for upload file. We're just going to add a upload file promise that this will set. Upload file promise just so we can hide this while that is Okay, and the promise is upload file promise. Okay, so next thing we need to do is get all of the files right here, get the file. So how do we do that? So we're going to do each file items as, and we're going to take the file ID and we're going to take the file name. Okay, so this is a bit confusing because you haven't actually seen what an item is. looks like, the actual object, when it is, has a file attached to it. So actually I'm just going to call this item and then we're going to do the JSON. Stringify this item. So you can kind of see what it looks like. I'll make a break right here. Okay, I'll make it look nice. Null two. And then we have to wrap this in a pre. Don't know if this is worth it, but hopefully it is. Okay. So I'm going to save that. Okay. Something wonky is happening here. It looks like we all good Cool Hi yummy So it just signed us up automatically So choose file I just downloaded a bunch of kitty images so you can see what else I uploaded Okay, so you'll see for a second you only saw these two. So this is a random ID that we created. And then once you upload a file to it, it'll have the file name on it, the file size, and the file ID. And using this file ID, we can then go and fetch the actual file. So this is the item, but then we have to go and fetch the file with the file ID. Let me upload another one just so you can see. Right there, okay, you see it was just those two and then that. Cool, so we have two things uploaded. So now we're going to get the files. So each file item says file. So I'm going to take off of this item, I want file ID so I can fetch the actual file. And I want the file name that I'll use just as an alt. It's not a very good alt, but the best we have right now. Okay, file ID. So we want file ID and file name. Okay so with this file ID, so we're going to create our function to go and fetch that file. So get file given a file ID. Okay, so let's see, userbase.getFile, got our database name, and then it should just be file ID, and that'll go and fetch the file for you. So this will then, okay, I'm going to make this async. This will then return a response which has a file in it. Okay, so we're going to destructure out this file. Okay, so that'll get us the file. And then what I'm gonna do is have this files cache. So I don't know if you would need this files cache, but you know you don't want to be fetching the same file over and over again. That doesn't make any sense. So we're just gonna put a file, after we fetched it, we're gonna put a file, put this file into the files cache. At file ID equals file. Okay, and then we're going to return this file back. So what we've done is we fetch the file right here and then we put it in our cache and then we're returning the file. Okay, so here we don't need this anymore. I want to see the actual image. Okay. So what do I do for that? So first of all, I'm going to say if files cache has this ID already or has the file already, then all we need to do is use that file. So we'll have an else down there. So right now I have it. So the image takes a file and it takes an alt. And we're just going to make the alt be the file name. Okay, and let me show you what I'm doing in image. So image is taking a file, so this is an actual file object, and it's doing url.createObjectUrl on that file for the source. And their height 400, width 400. So that's how I'm taking the file and putting it into a source to the image there. Okay, so here we have our image, great. So if it is not cached, we have to actually go and fetch it. So I'm going to have a promise equals get file, file ID, and here in cell, now let me show you cell, so here I have this promise and then I have this then response. So, and then I have a slot right here. So the response of this promise, when it's resolved, I want to pass it back up to the parent. So we do that by passing a prop into the slot. And when I do that, I can then come here and say let response, and I'll have access to this response. And the response is this file here. So let response cell. So we want our image, our file equals this response, and our alt is going to be this file name. Okay, and then we can close off the if statement. Okay, let's see if that works. Fingers crossed. Okay, that's our little spinner. Oh, there's one image and uncaught and promised reference error file is not defined. Okay, I'm going to pause the video and figure out, oh wait, maybe I don't need to. I just need to say file equals files cache at file ID because we never define file Okay So sorry you had to see that Okay So it loading Cool Now we have our two images So if I upload another one choose a random one, this one, and now it's down there. Cool. So now we have this puppy. Okay. So finally we're going to do pagination. So let's say I've uploaded all my secret images and I have like a thousand and I don't want to load them all so I want to have some pagination. So how will we do that? How indeed? Okay so we need a boolean which is going to tell us if we've hit the bottom of the page. So we're going to start that off as false and we're also going to have a tracker show X let's see I'll call it images to show equals. So initially we're just going to load two images. Okay. And then what we're going to do is have this svelte window. I'm going to say on scroll. So whenever we scroll, hopefully I can get this right. We want to check if we're at the bottom of the page. So at bottom equals the following statement. Let me just close this. Okay. Window dot, uh, inner height. Okay. You're gonna have to look these up. Um, I don't remember. Wait, maybe I do. Window dot, uh, page y offset. So inner height is how tall is the window and then how far down the the page have we scrolled, and then we want to see if this is greater than or equal to, or maybe just equal to, the document.documentElement.scrollHeight. Okay, so if it goes, if your page goes on and on and on, this is capturing that whole length of the entire document. Okay, so that'll set at bottom. So if we're at the bottom, it'll be true. So now we want to say if at bottom and I don't know if this is necessary, but it seems like it was, and images or it could just be good practice. Images to show is less than fileItems.length, then imagesToShow plus equals one. I'll put this on the next line. Okay, so once we've hit the bottom, we're going to increase the images to show, and then down here in fileItems, we're going to do a slice call. So rather than showing all the file items, we're going to just go from zero to images to show. Okay, so at first it's just going going to be two images. So I'm going to save that and let's see if this works. Okay, we've got two. Okay, check, okay, look at my, okay, so there's only two images right now. If I hit the bottom, you can see it starts loading and then we get our next one. Cool. So if I do another file and I add another one, okay, so let's see. Okay, so I only have three, but if I hit the bottom, Now I have four. Okay, so this isn't perfect. This works. This is the best way I could figure out how to do it. If you have better ideas, which there must be better ideas to how, for how to do this, please leave it in the comments. One issue I think here is if I refresh and then I kind of just quickly slide down, it sort of, it loaded two there. So it, there's some inertia there and it like loads more. The other issue is if I only, let's say I only have one image here. So for our play app, you know, it's in a real app, this shouldn't be an issue because you'll have like a nav and a footer. And you know, here it's like, basically I can't scroll because this is the full page. There's nothing to scroll up or down to. So this never gets triggered. Okay. So there must be a better way to do that. So for now I've just had it. So I'm loading two and they're big enough that it takes up the full screen. Okay. So those are some caveats. I don't know how long this took. I wanted it to be less than 50. It doesn't really matter, but I just want to be able to do this in less than 50 lines. So if we take out all the comments, then this should be less than 50 lines. I don't know what you call this, an image album library. Actually, I'm kind of cheating because I have sell an image, image, but really this would be, even if I didn't use this silent image, I could still fit them on just one line like these. Okay, so it's less than 50 lines and we've got this thing with user base and Svelte and then you can upload it to Netlify and we've got our wonderful Pagination album, photo album, Sunstack app. Okay, and that is all for this video. Let me know if you have any questions or comments and see you in the next one. And please like and subscribe. Thank you. Bye.