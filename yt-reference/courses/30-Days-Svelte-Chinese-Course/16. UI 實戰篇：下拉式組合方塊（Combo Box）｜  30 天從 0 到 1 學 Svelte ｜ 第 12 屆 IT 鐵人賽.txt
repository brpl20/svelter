哈囉大家好,我是凱開歡迎收看凱開寫程式今天是IT鐵人賽的第16天啦今天一樣是UI實戰篇喔我們今天要挑戰的主題是下拉式組合方塊英文叫做Combo Box看中文的話可能不是很清楚它的使用情形是說今天你有一個很長的清單列表然後你想要使用者從這個清單當中選一個選項的時候你就可以用這個組合式加的方塊那比如說像是當你在選擇地區的時候可能要拉拉拉拉很久然後拉到T的部分然後才發現有一個台灣這樣子那這個時候呢就是如果你讓這樣使用者一直滾動然後一直找就比較麻煩一點了對不對然後可能找很久還找不到那這個時候如果你可以讓使用者去輸入文字然後根據他輸入的文字去做搜尋的話呢使用起來也會比較方便一些所以我們今天就會來介紹這個功能好,那它的功能呢是像這樣子,就是我們可以輸入文字不管是部分文字也好,或者是全文也好做匹配比如說呢,我在這邊輸入一個台灣那他這邊可能就會出現台灣或者是我出現我輸入了T然後他可能會出現Taiwan然後出現Taiwan之類的選項等等然後等我輸入Japan的時候會出現Japan所以呢他可以幫你做一個文字的匹配然後出現對應的選項然後呢你可以用點擊點擊的方式點擊下拉選單的選項來改變你的輸入值這樣子好那我們現在就馬上來試做看看吧那這邊呢我是用這個台灣的鄉鎮區域列表那這個使用情境比較奇怪一點就是通常是比如說我選台北市然後再來是選區而不是這樣全台的全部掃一遍那不過呢這邊今天範例的關係我們就用這個臺灣的鄉鎮區列表來試試看好,那我們就開始吧首先,我們先我們先定一個container然後這邊我們給一個inputtype等於texttype等於text然後呢先加上沒關係先不要加好了然後再來我們加一個UL這邊我們把我們的選項放進來DLID這樣子就出現了選項對不對我們接下來幫他做一些style的調整首先是UL的部分我們必須會給他block然後呢給他定位我們是給elastic roots這樣等一下比較好定位一點然後把container的position改成relative同時把ul的padding部分拿掉list style的部分也拿掉然後給他一個boulder3px我們用一個全黑的邊框那會變得很顯眼然後呢你可能會想要給一些空白不過呢我想要把我的空白寫在li裡面這邊上下給5px左右的話給10px這樣子然後呢我們把寬度撐開來讓它跟輸入框一樣寬跟輸入框跟輸入框一樣寬輸入框所以我們把它的長度弄短一點好了250px然後這邊的width就等於100%好那我們這邊給一個這個box-sizing等於boulder-box這樣子比較好做定位好怎麼最近鍵盤怪怪的然後呢當我的那我把padding寫在li不寫在ul的原因是因為我等一下想要做個hoverhover過來這樣子你看喔他才會把這個hover的區域延伸出去如果我寫在ul裡面的話你就會發現這邊右半邊怎麼凸一塊右半邊這邊這邊怎麼凸一塊這樣子好,那我們繼續喔再來我們把這個padding拿回來好我們接下來要做功能了首先呢當我的當我的我先寫一個變數叫status剛開始是blur它這個目的是說它這個目的是說當我在焦點在input的時候我們再去把這個選項清單給顯示出來所以這邊我們給 status 等於 focus然後 blurohblurstatus 等於 blurok然後呢這邊我們就if status 等於focus好 這樣等我點擊它它才會跑出來OK好 接下來呢我想要做的事情是嗯當我輸入文字的時候幫我去這個篩選我的清單我們可以這樣做直接去bindinput value所以可以這樣寫input然後bindvalue你這個value可以省略啦因為兩個是同一個名稱所以可以省略好然後呢在這邊data.filter那我們去看是不是有include嗯 value當然不對不對來寫什麼d.include好這樣就完成了不過你會發現當我欸當我剛開始的時候再給大家看一次你會發現剛開始的時候什麼東西都沒有那這是因為fail剛開始會是一個undefined那這邊剛好過濾出來include undefined就會造成它有錯誤這邊給他一個空置串好,這樣子就好很多了嘛然後假設大就會有很多大ok,接下來呢我不想要讓我的這個高度太高然後還要讓他滾動所以我們這邊給一個最大高度max-height等於假設300px好了假設300px好了300px好像還是有點高300px好像還是有點高那我們給250px然後呢因為你有給max-height嘛所以你要記得加上overflow 讓它才可以做滾動這樣子ok 好那按下去之後啊我想要去把我的值一起做改變嘛對不對所以呢我们可以按click然后呢把我们的value改成d

按下去但你會發現為什麼按下去沒有用這邊呢跟這個事件觸發順序有關係我們來稍微講解一下當我們如果有一個input的element在的話然後我這邊有一個選項對不對很多選項1 2 3 4那当我假设我现在focus在我的input当中的时候那当我按下去的话是不是blur就被触发了对不对然后才去触发click所以呢我们再回到这边当我的blur被触发的时候我的这边的选项当然就不见了那既然不见了我的这个监听器当然就被销毁了所以按下去所以事实上这个onclick的监听是没有被执行到的那要改变这个要怎么做呢首先在blur發生之前mouse down會先被觸發然後blur,然後click也就是說我們可以透過這個mouse down的event來讓我們要的行為在blur發生之前被執行所以我們這邊可以改成Mouse Down不過改成Mouse Down有另外一個缺點就是說當我今天使用者按住了這裡按住囉,已經按住囉所以Mouse Down被觸發了嘛對不對但是當他這樣子把Mouse移走了他現在在按住的狀態,他移到這裡來再放開的話那他是不是他的意圖就不是要按這個選項那這部分的話就會比較麻煩一點我們在這邊不會再多多講解會把這個額外的說明放在簡報跟說明當中好,所以我們這邊呢不應該用onclick,而是用mouse down來做所以我們來試試看我們把這個改成mouse down然後呢再來試試看你會發現欸這樣就成功了好這樣子一個最簡單的最基本的功能我們就修好了我們就已經弄好了好再來我們這邊加一些required他是必須的假設啦假設他是必須的然後你有可能會想要根據你的使用需求不同可能他會是一個需要必填的選項或者是當使用者亂打了之後你可能要跳出一些錯誤等等那這時候就就交給大家的判斷然後在這邊我想要再放一個是說如果他這邊filter出來啊如果長度是0的話,那我這個其實也不要顯示或者是你可以在這邊顯示一個不然這樣好了,我們用relative assignment然後把這個邏輯拆出來這樣大家看得比較清楚假設叫filter好,那我們把這個放到這裡而且當我現在是focus的狀態而且filter的長度大於0的話就把它放在這裡然後呢我們再做一個else if的判斷else if什麼呢如果filter的長度是0的話那我們就沒有選項這邊的文案就是交給大家去做判斷隨便打它就會跟你說沒有選項喔好接下來呢這樣子大致上功能就完成了對不對好那我們再回到我們的簡報當中再來就是要做一些進階的功能第一個使用者可以用鍵盤操作選項你看現在我們的實作你只能用點但相信如果有在看這一系列的影片你會發現說Spilts本身還有我在實作的時候都會比較注重Accessibility也就是A11y的部分所以我們今天呢也會繼續來做這個Accessibility的支援然後再來就是當使用者沒有假設他的滑鼠不好或者是他不靈活的時候呢我們可能會想要用鍵盤在這邊然後我按下的時候我可能會希望我可以操作所以呢我們現在就要來做一下這個功能好的那首先呢嗯點開來然後我希望它第一個顯示的文字會在這邊嘛對不對好那這時候我們可以怎麼寫我們先放一個selected好了還沒有選然後再放一個current index也是-1你還沒有選好然後呢當我的這個li也就是當我在focus在input的時候我可以去監聽一個keydown的事件所以我們這邊出叫一個handleKeyDone好然後我們這邊用這個switch來看switch.key然後呢case等於上arrowUp的時候我們要做什麼事情我們先看arrow我們先看arrow down好了當我按下的時候我也是要把我的index往下就是把我選項往下加一個所以在這邊你可以這樣寫我們在這邊加一個class然後selectedselected等於等於什麼呢等於selected然后我们可能会需要这个index来做补数i 这样子好 那我们这边先break掉我们先使用 arrow down所以arrow down就是selected加1加等于1这样子对加等于1好那我们来试试看把KeyDown的部分的HandleKeyDown按按看 欸沒有反應然後這邊要break好這樣子我們來確認一下喔首先呢現在只要一點下去它就不見了所以我們先把class name加進來selectedbackground-colour我們就跟hoffer的顏色是一樣selected這樣子好好,可以發現,可以成功控制了下的部分然後呢,這邊的話就是-1就是上的部分好,這樣子就可以啦,耶欸,但是你會發現說假設我現在在第一個好了第0個,如果以這個array的index來說在定了一個的時候我再按了上它的index就變成-1了對不對所以我們在這邊呢要做一個調整就是說如果我現在在第一個的話然後我又按上幫我跳到最後一個然後如果我現在在最後一個的話我按下幫我跳到第一個所以我們現在就要來做這件事情首先我們先看一下它是不是-1selected等於-1不等於嗯等一下喔對If selected 不等於-1的話

我們就把它加等於1然後呢我們在這邊可以用這個selected等於selected加1然後把filter的長度做餘數這樣意思就是說當我如果加加加加到最後一個的時候他就會再幫我跳回來然後呢elseelse比如说就是刚开始的话那这边可能看大家的需求就是你也可以把预设刚开始按下来的时候就在0也OK那我在这边是说我第一次按下来的时候再把这个index跳过去第一个这样子所以elsereturn0OK这样子我這邊重新整理一下else 不是returning 是selected.link這樣就是說我這邊進來 然後按一下之後再跳過來按上也一樣按上的邏輯就是反過來所以我們把這個複製起來然後-1elselected等於 filter.length-1把它調到最後一個好,那假設我今天打一個中3你看喔,當我的持續改變的時候當我的選項改變了之後,我的長度也改變了所以我們要記得說當我的值改變的時候,我要記得把這邊重新設定一下那這邊的話要怎麼做呢?你可以這樣寫我們來看一下怎麼寫我們來看一下怎麼寫應該說寫法會有很多種就是看大家喜歡什麼樣的寫法以及什麼樣的寫法寫起來會比較順一點那我在這邊看一下喔我們可以做的事情是說欸 我們去監聽unchange的事件然後呢 當這個值被改變的時候我們就重新設定或者是說 當這個filter.length改變的時候 我們就去重新再去跑一次这个Event好那这边的话要怎么做呢首先你可以用这个RelativeAssignment然后我们这边先宣告一个previousLength等于data.length在这边我们去设定它我们先看一下跟filter.length这样子然后松所以你可以发现这个previous length是357然后filter length是9所以代表说我们可以在这边去侦测到这个长度上的改变所以如果我们有侦测到长度上的改变的时候呢我們就去把selected變成-1不等於啦好所以我們來試試看我們現在移到了這個我先把這個拿掉現在移到了萬華區中你看我就可以再重新選喔當我選到中然後假設我在我把它變成填中好了填你會發現我的index就被重改了好我們再試一次假設我現在選大然後我現在看一下看到大理但其實我在第二個就是大安了對不對然後想要再把它變成大安我的index就可以順利的去改掉了好所以這邊做的效果就是說當我的這個長度改變的時候度改變的時候就去幫我Reset我的Selected好那再來我們想要做的事情是Blur掉的時候也是一樣像這邊我覺得是看需求就是比如說假設我Blur當我Unfocus然後再進來的時候我要把我的selected index重新設設一遍的話你可以這樣寫就是在這邊去寫 或者是你也可以去再加一個assignment是說if status等於focus的話等於blur的話等於blur 而且呢又不等於-1不等於-1的話我們就把它變成-1所以也就是說當我這邊選選選選選選然後重來然後再進來的時候我就重新要再選一遍那當然有些需求是說請幫我記住嘛對不對當我現在在這個松山區的時候再回來還是要給我松山區的話那這實作又會不一樣但我們這邊就是當你拿掉然後再重新進來的時候就是你要再重新選一次這樣子OK好再來我們要繼續解決我們的小問題喔你有沒有看到我現在在大暗區再往下再往下再往下欸?沒了怎麼會這樣因為我們現在是把整個的這個box整個的選單呢是變成一個overflow然後是固定高度對不對因為我們並不想要讓整個畫面變得太長那既然如此你就要在比如說當你在大按去然後再按下的時候你就會想要幫使用者自動的去調整你的scroll對不對所以在這邊就要做一些操作啦那既然要操作他的這個scroll的話我們勢必要把這個bind拿進來我想一下要怎麼做會比較好把... 放在這裡好了list等於list那我們把list拿進來好那我們要做的事情是說當使用者選到這裡的時候然後他再按選到大暗區 然後再按發現沒有空間了我們要自動去幫他調整一下這個空間那實際上可以怎麼做呢首先是比如說我可以在arrow dwn裡面寫好,那我們就直接在arrowDown裡面寫好了如果有list在的話然後呢我們先看一下Active的部分然後怎麼選呢我們可以這樣選QuerySelector然後Selected不過這樣寫應該是錯的對不對因為你現在是選不到它的那原因是因為所以這個selected已經被svelte本身給compile過了所以如果你要選它的話第一個你可以用這個selected就是再加一個小小的data attribute來讓來讓這個svelte去幫你來讓我們可以去選到這個元素所以我們這邊加一個data selected然後一樣selected等於i所以在這邊我們就去找這個data selected等於true好那如果有的話我們就要做一些判斷了我們在這邊要調整這個list的score top那什麼時候需要調整呢當我的大暗區這個item的我們在這邊寫一下好了哇 可能沒辦法寫寫一下offset top然後這邊是client height當我的大暗區上面的部分,也就是offset top的部分呢它比score top還大的話,代表說已經看不到,所以請你幫我做調整所以我們在這邊可以這樣寫

active.offsetTop然后呢offsetTop大于list.scrollTop问号offsetTop然后再加上active.clientHeight大于scrollTop如果大於的話請你幫我去offset top然後減我們先看一下它的效果好了然後如果沒有的話就一樣就是如果它沒有去超過的話就不用幫它設這樣子欸?等一下我現在是error down所以我們先看一下這個有沒有順利的懸到你會發現這邊的list沒有跑進來他说list is not fairly binding我是不是写错了对我写错了value is not fairly bindingbuy list对这样子OK好那我们把这边看一下no no nook有了有了好我们这边稍微看一下这边呢我们先判断说如果active offset top然后加active client height大于这个score top然后呢再加上list打offset height的话呢代表说现在已经超出这个可见的范围了那我這邊就做什麼呢我們這邊就用offset top然後再加上client heights剪ffsetHeight應該基本上都是一樣的然後再剪掉它的高度的一半這樣子欸...怪怪的好,那我們接下來看一下這邊的條件是首先呢,我們是想說比如說他現在如果offset top的部分然後再加上他的height也就是說他變成完全看不到的時候也就是大於score top加上這個他的offsetlist的offset height也就是他的高度的時候我們就讓這邊呃我們就讓他的score top會等於呃active offset top加上Active Offset Height剪掉其實就是這樣的意思感覺直接剪掉高度應該也可以這樣子感覺不錯好這樣子設定起來當然要做更細部的調整就是看大家的需求我自己是覺得這樣子應該就算不錯然後再來是往上的部分上的話也是一樣我們這段就整個copy過去不過這邊的判斷就是要做調整現在往上的話就是說往上的話就是說 Offset Top等一下我們看一下 Offset Top如果 Active Offset Top比 Score Top 小的話那麼我們就把設定設成 Offset Top好 這樣子可以然後呢 這樣子試試看往上往下往下往上往上往上欸 可能要加一個可能要再減掉 active.clientheight這樣子不然我們這個拿掉好了這樣子如果active offset top小於list score top的話我們就讓offset top在這裡最上面對啊這樣子應該沒錯喔 filterOK嗯感覺我這邊的score top的部分沒有寫得很好小於score top的話我們就讓active offset top等於score top 沒錯啊啊在這邊的時候我們可能要呼叫tick來等到畫面去更新了這樣子類似這樣子的做法可能會比較好但我不確定這樣子會不會造成效能上的問題我先試試看import tick from spells好好再试试看看一下喔嗯对看来是碰到这个更新的问题在这边呢这个sleted改变值过后其实我的画面还没有做更新所以呢我这边取到的值会是画面上旧的值所以呢如果要改掉这个问题的话就是我們可能要去呼叫tick也就是說等到這個spells下一圈的時候我們再去做更新那這邊應該也是一樣所以我可能只是好巧不巧湊對的而已所以呢我們也要把awaits加進去這邊那感覺應該是會有更好的寫法就是有更好的時機點時間點去做可能你去呼叫after update然後再去裡面去看這個那我們這邊就偷懶直接寫在handle key down的這個事件監聽器裡面好這個先拿掉然後再看一下這樣感覺好多了對不對那往上也一樣有一個地方要注意的是,當我的index變成0的時候,我這邊的條件是就不太適用所以假設,如果selected等於,我現在是往下,所以它有可能會變成0等於0的時候score top就挪到0吧然後這邊就不要再做了那一樣這個條件是拿回來這邊拿回來upif selected等於等於什麼等於filter.length-1的話selected 等於 filter-length-1 的話我們就把 scroll-top 變成這個 一到最下面一到最下面的話可以怎麼做呢你可以這樣寫fset-top這樣子 OK好 這樣子就完成了耶 好這樣選起來就比較方便一點了希望是比較方便一點好 再來呢我們要做的事情是當我按下Enter的時候我們要做什麼呢我們要把這個按鈕按下去也就是我要選這個我要的值嘛所以我們就把Value等於这边可能比较麻烦一点第一个是你可以用一个变数来判断你要保存的值是什么比如说现在是多少这样子所以我们直接去

這邊就直接用 filter然後select it這樣子試試看按下 enter 變成信義區了那你可能按下 enter 之後你就不想要你的這個繼續出現了有可能啦,有可能你不想要讓它繼續出現這個時候呢你可以把 input 打 blur這樣它就會去觸發我還沒有去Bind還沒有BindBind Listing InputLet Input這樣就可以去Access input的部分按下Enter的時候把這個Blur拿掉然後再回來這樣子嗯 這樣子感覺應該就好多了好那一樣我們再加上一個按下esc的時候esc是escape一樣去做input.blur但是我們不要去指派任何的值所以按下esc的時候就拿掉ok好或者是你也可以直接把這個但這樣的話你可能為了要重新打開它你就要再重新這樣子按一次所以一樣是見仁見智啊 所以我們這邊用的方式是這樣子input.blurok好 那麼接下來就是關於accessibility的部分了在這邊你可以加上Rule等於ComboBox來表示它說這個是一個ComboBox然後呢ARA Controls我們這邊就直接把ID寫死了List Box 1那在實際持座上的部分你可能會想要讓它是一個動態的就是確保你的ID不會跟其他的ID撞同時這邊的Rule我們要給它這個listbox再來我們給它一個tabindex等於-1回到這邊來我們看一下可以用arim auto completelistbox同時呢我們這邊給一個expandedexpanded 來代表說它現在是不是有這個框框跳出來所以我們這邊的判斷是說status 是不是等於 focus好 再來呢我們這邊要再做一件事情是我們要用這個descendants欸他好貼心喔 他會幫我拿給descendant來代表說 我現在選到的這個列表是什麼那它對應的方式是你要去做一個ID的判斷所以 list box e optionoption i那我們把這個複製過去list怎麼寫會比較方便這樣子list one option i那就是selected那這邊可能要做一個判斷式就是說如果不等於-1的話我們才做然後如果它等於-1的話我們這邊就給none好然後呢再來我們要再做一個比較精細的部分是說這邊呢我們要去做aria然後set insetSize代表說總共的選項有多少再來呢ariapositionInSets等於要加1喔這邊他意思是說當ScreenReader在讀取你的選項的時候呢你可以透過這個方式來告訴你的ScreenReader說我現在總共的選項有多少現在這邊大概有300多個然後當我變的時候要變成幾個123456789然後這邊的position inside就是說我現在選到的是第幾個選項好大致上就到這邊了所以你會發現儘管它只是一個簡單的combo box也有很多的細節是可以考量可以實作的好那在這邊還有一個小問題就留給大家就是說當我輸入注音的時候它的那個就直接出現沒有選項所以你可能會想要是它是說當我輸入完字的時候再去幫我做判斷所以它這邊的Binding可能是因為畢竟一般都是以英文為主就是直接Type直接輸入這樣子所以你可能這邊你可能想要做一個調整好那這邊的話如果要修正的話就交給大家去做判斷了那麼以上呢就是今天的這個ComboBox的教學好那我們做什麼事情呢第一個我們可以用鍵盤來操作這個可愛的ComboBox然後呢你可以去輸入中中和區等等的或是箱箱這樣子三億箱等等好同時呢當然你也可以用按的好那麼以上呢就是今天的這個combo box的相關教學了如果喜欢的话呢记得帮我按个赞如果想要看到更多有相有关于城市教学影片的话呢记得订阅我的频道我是凯凯我们下次再见咯拜拜