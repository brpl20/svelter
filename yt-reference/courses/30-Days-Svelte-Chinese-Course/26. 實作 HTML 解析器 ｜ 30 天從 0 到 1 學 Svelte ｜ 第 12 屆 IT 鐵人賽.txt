哈囉大家好,我是凱凱歡迎收看凱凱寫詮釋今天是IT天然賽亞第26天了那麼今天終於來到這個我們要自己動手實作一個非常簡易非常小型的一個Svelte那首先第一步呢就是我們要實作一個HTML的解析器然後呢再慢慢讓它進化成一個可以解析Svelte相關語法像是if blockawake,awake可能沒辦法解析啦if block或者是binding等等之类的语法首先第一步我们就是会先使用一个简易版的HTML解析器好身为一位工程师我们都会想要知道一个框架的背后它们运作的原理是什么所以我们今天就是要透过动手实作的方式来了解所以我们目标也会相对的是我们也会把重点放在这个解析器要做什么而不是把它非常完整的实作出来所以第一个最重要的目标当然就是它可以输入一个HTML内容自传然后它会产生一个语法术然后再来呢我们不会考虑像是注解的部分还有script跟style tag的处理我们就只专注在HTML本身然后呢我们也不会考虑太复杂的错误处理然后也不会考虑大小写的转换跟冗错就是比如说当你的li标签我们昨天有提到当你的li标签可能忘记关起来的时候你的浏览器还是要可以正确的去处理那在这边我们不会做这些东西然后最后我们不会去考虑string或者是byte上面的转换也就是说这个解析器这个poster它可以接收的东西就只有自串而已好那首先第一步呢我们先来实作一下node那Node裡頭要放什麼內容呢?第一個我們會有star跟and那star跟and就是分別定義這個star跟and的位置像比如說我們現在有一個我們現在有一個li標籤然後假設這邊有兩個文字那我们就会想要把这边定义成star然后呢012345678910然后我们想把这边定义成end那start的部分就是0然后end的地方就是10所以呢有这样的资讯呢第一个你的程式可能有bug的时候你可以比较好做一些提示比如说出错的地方在哪里是哪一个tag然后这个tag在哪一个这个在程式码的哪一个位置好然后呢再来是标签名称比如说diff的话就是diff然后li的话就是li这样子那type的话呢我们只会有三个第一个是elementelement就是有这个被包起来的有被大于小于符号包起来的东西我们都把它叫做element然后text的话就是一般的textflametext那fragment的话呢我们把它定义成是一整個文件當中所涵蓋的東西比如說我們可能會有一個 li那當然上面還會有一個 ul然後 p 吧吧吧這樣子然後可能這邊還有一個 video這樣子那我們會把這個東西呢叫做 element這個也是一個element然後這個也是一個element然後呢這全部總和起來它會是一個fragment那這大概就是他們的關係那當然這邊的關係你想要怎麼處理都可以那在這邊的話我們就是這樣子定義好然後再來呢是datadata 的話呢就是如果這個 type 是 text 的話我們可能會放他的 text 的資料比如說hello world 那我們就把 hello world 放進去這樣子然後再來是 addtrsaddtrs 就是我們昨天有講過的這個標籤裡頭的 attribute 的部分假設我這邊有個 div 嘛那我這邊可能放一個 datatoggle等於blah blah blah然後這樣子的話呢那你可能就會想要把這個dataTargon放到attrs裡面然後value等於XXX這樣子好那再來是children那children的話就是任何被包在這個標籤底下我們就會把它叫做children比如說這樣子那這是一個element嘛對不對然後呢這裡頭的東西呢就會是一個children那trojan它會是一個陣列那陣列裡頭會放的就會是可能是element有可能是text有可能是fragment但我們在這邊應該是不會然後再來是我們放一個標籤一個變數來保存它是否為self-closing什麼是self-closing呢就是比如說像video這種的馬上就關起來的這種Self-quelsing好那我们就先来实作一下这个Node本身那我这边已经写了一个这个架构出来然后你可以跑这个Text在里面好那我们先定义一下Node好那现在还没有要写Text所以我们先把它关掉好我们把它叫做class然后note然后我们这些很简单的就只是先我们就把东西放进去就好所以list.star等于0然后list.end等于0list.type等于还没有东西然后list.name也还没有东西再还有什么list.self.closing等於false然後list.data等於還是一個字串然後list.attrs等於object好 應該這樣就可以了都有放進來好 再來呢我們就可以來實作一下我們的parser那在這邊我們要實作parser呢它有幾個功能第一個它可以去不斷的去消費這個資源好那同时呢我们还想要提供一些好用的function第一个是current那这个current代表说我现在正在消費或者是獲取當前的這個資源是什麼然後再來是一個skipskip就是說像我們在為了這個格式上的方便我們可能會這樣寫我們可能這邊會跳一行然後跳一行再寫那這時候我們就可以用skip把這個跳過的這一行把它做省略或者是在這邊這邊你可能會打一個Enter那也可以把它省略這樣子所以呢我們skip就是省略像這種為了做排版用的空白字元然後呢我們可能會有個Next那Next是說呢我去判斷說我的現在的這個pulsar在什麼狀態然後我期待下一個應該要是什麼樣的狀態比如說我現在這個我現在這邊打一些文字,然後我遇到這個了代表我要進入一個tag star的狀態對不對,那我們就可以用next string我們就可以像這樣子,比如說next然後如果遇到了這個的話呢,我們就進入到tagstar這樣子好那這是他大概的概念那我們就直接來實作吧好那首先我們先因為這個功能比較複雜一點所以我這邊有加上一個test好那我們就先新增一個pulsar然後呢module.exports等於pulsar然後在test這邊在test這邊tester 這邊我們也是一樣先把這個parser 給引入進來好,然後呢,我們先寫一下parser裡面的功能有哪一些第一個我們要先去判斷說next 這個功能喔,等一下it should match string

Next 的功能,那我們這邊就先放一個 Pulser然後裡面我可能會想要放 Hello World這邊可以是一個任意的東西但實際上,就是在實務上就我們等一下實作的時候,它這邊要接受的是一個 HTML 的字串那 Hello World 也是一個 HTML 字串它可以是一個 HTML 的字串好,那這個時候呢我希望parser.nexthelloworld也就是next-h因為我現在還沒有開始所以我會預期它下一個字源是不是h如果是的話呢就幫我return true那如果同時呢我們還要看它的index是不是有增加喔所以有沒有變成1那我們就開始run我們的test那當然會失敗啦 因為我們東西都沒有開始寫好 所以我們先把東西開始寫開始寫囉首先我們先會有一個constructorconstructor裡頭呢 我們會放一個string也就是這個文件的內容 或者是這個程式碼的內容那我們就把它保存在row這個變數當中同時呢 我們會有一個indexindex剛開始都是0嘛對不對然後呢還有一個應該暫時先這樣就好好那next這邊呢我們想要做的事情是我們去匹配說現在的這個目前的內容是不是有跟現在我們想要的字串做有匹配那如果有匹配的話就return true那如果沒有的話就return false所以呢我們這邊做一個這樣的判斷我们把它做slice然后呢看一下list.indexindex加string.length如果如果刚好有匹配的话我们就return true那同时我们也把我们的pulsor移动一下位置加等于string.length好然后呢不然的话就return false那這樣子的話我的test case應該會過所以呢我們可以正確以正確的匹配說他匹配了這個所以他跳到下一個資源去了我們的字串呢我們這個方法是符合可以設計成這個他可以接受長度不只為1他可以是1到無限多個這樣子那當然這邊我們沒有做那個邊界上的處理就是如果假設今天你要匹配這個字串特別長的話呢他有可能就超出整個文件範圍然後就return false那沒關係我們就不再另外做處理好所以呢我們一樣我們直接把它copy過來因為這是測試所以最主要的這個目的是讓他比較好懂一點然後 expect parser hello to be true因為我現在這邊裡面有hello嘛對不對所以這邊應該會是true然後呢嗯to be我算一下0 1 2 3 4 5應該是5才對還是6喔 沒錯 好這樣我們next大致上的功能就完成了然後我們要有一個currentcurrent就是說 欸 迴傳現在的字元是什麼我們可能有時候在外面 外頭等一下要實作的時候可能會用到所以我們這邊就這樣寫好 returnok 接下來我們寫一下測試to return current character那這邊我們一樣就一直copy過來好那我們這邊expect我們首先先expect它會跑嘛對不對比如說hello等於true同時呢我們要expectparser.current等於會等於什麼呢我們這邊已經消費掉了h跟e嘛對不對所以他應該下一個字源會是L但這邊也有一個L所以我們把它有兩個L所以保險起就我們把它變成X然後to be L好欸有錯喔我們看一下欸他說inndex因為我們這邊沒有加list好 這樣子應該就沒問題了好 這樣子 OK好 再來我們實作一下skip那skip就是說skip就是說我們要省略掉這個空白啊enter啊 tab啊等等之類的可能只是為了幫你做format這個功能好我們來實作一下while list.current小於等於然後list.index加加加等於1嗯好這樣子應該沒問題ok我們來試試看should skip space or所以我們一樣再建一個parser然後這邊的parser我們比較特別一點我們給一個template string然後我們可能給他一個div然後div這樣子那我希望我的parser做什麼呢?skip完之後,希望他就幫我跳這些空白資源都跳掉,然後直接到這邊來直接到這個地方所以呢,我們先呼叫一次skip然後expect browser.parse.next我們會找得到這個小魚符號看一下是不是這樣是這樣沒錯的太讚了然後呢我們看一下index有沒有正確的對0 1 2 3 4 5 6 7是7嗎還是8反正不是7又是8了好8這樣就沒問題了OK好,這樣skip功能也完成了所以我們可能還會想要再一個是一個功能是read untilread until 我想要做到事情是說我會不斷的去讀取字源直到我遇到了某一個要匹配的東西我才去脫離這個狀態比如說當我在我們來看一下這個tag當我遇到這個開頭的時候呢我就不斷的去讀取然後直到遇到這個大於符號的時候我再跳掉 然後把DIV return出來所以我們如果有這個function的話應該會蠻好用的好 我們來試試看可能會有一些小bug不過我們就試著死做看看好 所以首先呢我們先宣告一個str我們把等下的結果放進去用的再宣告一个character当作等一下可以存放变数等于什么等于list.current然后呢list.当ch不等于string的时候我们就把str加进去ch当中然后同时我们要记得加加indexok那這邊的話我們一樣寫一個測試我們這邊一樣用這個parserdiv我們這邊就不要再幫它加空白了這樣子好,那我expect我們去等一下我們先讓他跳到我們先讓他跳到div當中然後呢我們要記得把這個匹配的stream就是匹配到的資料回傳回來然後呢,parser.readUntilUntil 什麼? Until 這個我期待它會是一個DIV好,看起來這樣是沒有什麼大問題

很多大問題就是邊界的判斷可能會有出錯不過這樣子應該就看用好有了這個簡單的pulsar然後測試也都通過之後我們終於可以來實作我們要的這個index好那這邊呢我們一樣再新增一個這個檔案測試的檔案我們就把它叫做index好了OK然後我們一樣把我們的indexpars要叫什麼好了pars htmlfrom index好那 喔唷喔唷這邊呢 首先 一樣我們要做一些簡單的 我們先從最簡單的開始齁就是 純純的HTML那 我希望它可以我希望它回傳的東西會是等下用toB還是toEqual應該用toB等一下我們再看那我希望它會長得像是這樣子第一個因為最外面是fragma對不對然後呢這個children等於type等於element然後name等於divdata 的話沒東西因為它裡面沒東西然後 attrs也沒東西然後呢先大致上讓它長得像這樣子就ok了好然後他說因為我這邊不能用 require好那我们先想办法让它测试通过就好OK好那這邊我們就可以把我們剛剛寫好的parser給引入進來之後我們這邊先寫一個parseHTML的function好了然後,為了方便所以我們先不要這樣寫好了因為等一下PostHTL可能會是遞回的呼叫所以這邊先拿掉然後module.exportPostHTL這樣子然後在這裡面呢首先我們先去new一個poster出來等下我們再慢慢做重構假設就長這樣子div,div好,PostHTML裡頭我們要做的事情是首先一樣我還是先宣告在最外層就是我們先宣告一個root node所以我們一樣把node引入進來nodenew node然后呢,node.root.等一下我没有把它等于nodeok所以,root.star等于parser.index然后root.type等于fragment还有什么root.children它还没有children,对不对這樣就可以開始爬了首先呢我們先確認這個我們先做這個tag nametag name然後在這邊如果如果parser.next等於小於符號代表我們要進入這個tag name的狀態好 所以我們就進入我希望這個tag name會回傳一個nodereturn node5node好,所以我這邊可能會想要先新增一個node然後呢我現在next在這裡了對不對所以呢我會開始去讀取,讀取到什麼?讀取我的這個標籤的名稱所以我可能會先希望這樣子做然后parser html 这边我们会传一个root然后root.end 我们也把parser的index放进去所以上面這邊把所有的解析邏輯ok最後我們要的結果就是一個root就是最上面的那個節點那我們首先再回到tech name當中所以呢這邊我們可以寫一個tech name等於我們剛有寫一個嘛好用的functionreadUntil什麼readUntil遇到空白或者是tap所以這個研究比較麻煩一點那我們先假設遇到空白就停止可是這邊要考慮兩個情況一個情況是遇到空白遇到空白的情況就是說像這樣子plus等於所以這樣就要停止或者是遇到這個所以我們的readuntil可能在這邊就不是那麼適用好所以我們稍微改一下我們的readuntil可能叫pattern好了所以呢我們這邊可能要做一個比較麻煩的處理好這樣就有點麻煩了好那我們不然這樣好了我們就這邊就直接寫死了然後我們再做一個另外一個function這個寫法可能不好沒關係 我們這邊就加一個pp的意思就是說pattern那這個pattern它一定會是一個珍貴表達式所以呢,我們在這邊呢去做pattern.test ch好,所以我們可能稍微寫一下測試這邊,parser然後issueReadUntil等一下喔ReadUntilPatternNash那我這邊想要做的事情是這樣子假設我今天的字串是長這樣子className等於Name然後PatternUntil然後呢 我要匹配的東西是什麼然後匹配的東西可能是一個空白或者是或者是這個好 看一下有沒有過 欸? 難道有過嗎?沒有 他說 對 他真的沒有過好 我們來看一下我們等一下 我們再重新看一下這個我們的實作我們這邊要改成這樣子改成反向喔 對 要改成反向然後這樣就對了所以我沒有寫錯不用反斜線反斜線 加反斜線有關係嗎沒有關係那這樣看得比較清楚好所以呢這樣子我們就可以同時匹配這個空白跟這個這個大禹符號那這樣子寫起來就比較方便OK等一下喔我不確定因為我不太確定這個parser.current是不是正確的我們先看一下我們先偷懶先打錯然後看一下是多少等於空白

我會希望他從這邊開始所以我會希望他的index來幫我加1所以在這邊我們可以做的事情是這邊再加一次然後就變成C了好,沒錯,這樣就OK這樣是我們想要的c好 我們終於寫完我們的parser然後回來 我們index當中tech name等於read until p然後 我們把剛剛的正規表示塞進來等於空白或者是這個寫線 好 這樣我們就有tech name了那有tech name之後呢首先我們第一個要把node.start等於parser.index然後有tag name之後呢啊!不對喔我們不應該加1的為什麼你知道嗎?因為因為加1的話位置就錯了好,那在這邊我們還不需要給end因為這個標籤還沒有全部讀完到底要不要加1啊?好,沒關係我們還是加1好了這邊tag name那我們有tag name之後呢我們要做什麼事情第一個有可能發生的事情是我就要開始讀取標籤了嘛對不對或者是這個遇到這個大於符號我們才開始跳脫那沒關係我們這邊先不去做這個判斷我們先確認這邊的tag name會是我們確定tag name被正確讀取就好所以我們在這邊先看一下這個tag name本身它是不是div因為我們回傳是一個node所以這邊我們把該給的東西給一給dynamic等於typeName,然後type等於elementok好,那這樣子就沒問題了那接下來呢,如果我們又出來了對不對,我們現在出來了else if我們可能想要先判斷說它是不是關起來的為什麼?因為單看這個你並不知道它現在是開的還是關的那看到斜線我們就知道它一定是關的所以我們先判斷這個那這邊的邏輯我們大家再寫然後再判斷說它是不是這個然後這邊就會是一個Node對不對好,然後呢這邊的話我們就做關起來的邏輯然后else ifposer.next等于tagname end好那我们写到这边这个posed html就可以正确的去读取tag name好那到这边我们再检查一次逻辑因为现在是live coding所以确定我们写对首先呢 這邊我們遇到關起來的話我們就 to dotag name close這邊的話這邊我想一下 我們可能要把它搬到tag name 裡頭去做處理好 然後這邊的話我後來想一想 可能還是不要加一會比較好原因是因為我們先確認一下test原因是因為我希望它就是繼續保有這樣子的功能就是它可以保有現在的資源是什麼這樣我才可以去比較好做判斷比如說如果pulsar.next等於空白的話那可能在這個地方我就要去pause attr那這邊我還沒有去做pause aetr like然後呢else if那還有第二種情況是parse.next等於這樣子喔不對,等於這樣子那這個意思代表說它是一個這個self.cosima好,那在這之前我還要判斷一個就是parser.next如果它是這個的話它是一個大語的話代表欸? 等一下我打錯了嗯?等一下喔這邊少一個好那如果它是這個大於符號代表我這個node已經處理好了所以我們就直接return然後呢我們把它沒有end喔所以我們就直接return就好好現在就有一個tag同時我們把它放到root.children.pushtag name好然後在這邊我們想要去不斷地去迭代它所以我們這邊可以這樣寫whilewhile this parser.currentwhile chch 等於 parser.current然後呢 ch 不等於等一下喔我想一下結束的條件是什麼就有还有CH的就还有办法得到CH值的时候我们就会不断的去迭代它然后呢我们为要讓它可以做到可以遞魂所以我們可能會需要一個stack來確保說 欸 現在目前進入到的節點是什麼那我在這邊簡單的說明一下比如說我們現在有一個div然後裡面有一個p然後我有一個state那當我讀取到div的時候我就把div放進去然後我下一個可能讀取到的就會讀取到p所以p也放進去然後呢我p裡頭可能又有更多東西可能有一個li那可能再放一個li那這樣子我在li裡面的時候我就知道說我上一個我的parent會是p然後在p的時候我就會知道我的parent是div所以呢我們可以透過這樣的方式來知道我們現在的stake是什麼好那麼我們就這樣寫在這邊我們放一個current nodecurrent node等於stack.slice取到副義的時候就可以拿到最後一個節點所以就是我們現在要處理的current node然後呢等一下喔我們不要這樣寫好了等於node然後呢if如果現在stack沒有值的話那麼current node就會等於rootelsecurrentNode會等於stack.slice-1好,這樣子然後這邊我們就直接寫一個currentNode.children.pushtag.nen,這樣子

ok然後呢喔 他說 push of undefined所以 children 是 undefined current note等一下我們確認一下 current note 長怎樣好了current note欸真的欸 children沒有 children啊 我們在這邊忘記宣告 children 了好ok把它拿回來好的,那我們接下來要做的事情是我們要處理這邊的close的部分所以我們在這邊宣告一個function然後tag name close好,那在close這邊呢tag name close然後我想要讓它繼續這個我想要讓它遞回了去做所以在這邊呢,我們可以呼叫 parse.skip那在結束後也一樣等一下,這邊應該放在最外面好所以我们现在就可以来写tag name close的逻辑然后同时在这边啊这个stack我们可能要放更上面一点我们要在什么时候把它把我们的children放进来是在这里就是在這邊吧對,在這邊的時候因為當我們讀取到這個之後我們就要把我們的node放進去所以我們在這邊可以打skid.bush.node然後什麼時候要pop出來呢pop出來的話是在close的部分好所以我們可能會這樣寫pulsar.next等於我們剛剛在下面已經有做Pay了嘛遇到這個欸?不對喔不對喔喔對阿對不好意思對,小雨沒錯所以我們在這邊可以其實可以直接開始這樣子 這樣子寫parser.readuntilpreaduntil就好readuntil這個大於符號這樣我們就可以拿到techname本身那一樣呢我們在開始之前先新增一個不用新增note喔所以techname close這邊要把Node當作參數傳進來會比較方便currentNode好,然後呢Node.start等於parser.index然後我們拿到tag name之後呢就可以,就可以怎樣就可以結束了然後return nodereturn node還是不用return node這邊可以不用另外return node所以同時我們要再把stack.pop把它拿出來我們現在已經要close了嘛所以這樣寫是不對的這個star已經在tech name這邊已經先決定了所以這樣寫是錯的好 然後tech name本身也是ok然後這邊我們不需要再另外傳Node進來原因是因為我們可以從Stake裡面去拿取所以這邊也不需要我們在這邊放成CurrentNode然後呢 CurrentNode.end等於等於什麼?等於Pulsar.index好那這邊你還可以做一個小判斷是說就是說如果currentNode的Name不等於tagName的話代表說你現在兩個是沒有match到的所以可以shrugnew arrow tag name means match之類的好那這樣子你應該就可以完成一個喔沒辦法完成了你有沒有看到這邊已經跳到無窮圍圈了代表我現在這邊這樣寫是有錯誤的首先我們先從這邊開始做判斷我們看一下tech name有沒有值其實這邊就不用再跑測試啦因為剛剛測試我們只有寫puzzle的部分你會發現它連這邊的console.log都沒有跑出來所以這邊有一個小bug是說我這邊的readuntil看一下時序readuntil這邊它會讀取到到這裡為止所以我們這邊可能要另外再做一件事情我們要讓puzzle去做next判斷他下一個字源應該就會是一個大於符號我猜啦這樣他才不會進到無窮迴圈嗯 好 看來是沒錯這樣他才不會進到無窮迴圈然後呢我們來看一下output會長怎樣我們這邊就不要這樣寫to b我們這邊就直接寫這個to match snapshot這樣嗎這邊少一個好看來snapshot本身是沒問題的那我們來看一下snapshot的內容他長得像這個樣子這邊我們應該不需要再我們看一下snapshot的內容首先最外層是一個fragment然後裡頭有一個div然後它的star是1star是1嗎?應該是0吧因為我這邊用next嘛對不對所以我這邊的star可能都要記得-1這樣應該會比較好-1然後update我們的snapshot看一下這邊的star是0end是10我們來確定一下是不是這樣子01 2 3 4 5 6 7 8 9 10對 沒錯不過這邊的end是11所以在這邊我們可能也會想要做一個-1的動作這邊,root的end等於parser的index-1这样子应该看起来比较好一点好了那接下来这样子一来我们的parser就可以应该就可以爬一个就是完全都只有html的部分诶 等下我还写什么这边这边这边puzzleppp我們看一下snapshotsnapshot首先這邊是一個欸等一下喔這邊好像感覺錯了欸沒有沒有沒有最外層是fragmentfragment的children是div mapdiv mapDIV 沒錯然後DIV裡頭的的the children會是P 沒錯好 然後straw跟and感覺應該也沒問題0 1 2 3 4 5嗯對 沒有問題 好那我們稍微改寫一下讓我們的parser可以接受一個字串所以呃這個Pause抱歉沒有什麼命名填份然後content然後我們在這邊把我們的變數都塞進去這樣子然後呢把這一坨這邊的Path怎麼會這樣引入進來OK我們把我們剛剛的東西全部塞到這裡來好,然後這邊的話我們就可以放content所以在最後這邊呢,我們會去呼叫一個parseHTML

這邊呢,push是parse然後這邊一樣是假設就叫push好了好,這樣子就沒問題了所以它的確是有印出來沒錯好,那我們繼續寫我們的puzzler我們已經完成了tag name close的部分接下來我們要去par text那 text 的部分呢是什麼時候我們會需要去par text當我們離開了這個大於符號的狀態的時候我們就有可能會需要par text對不對所以呢你可以在這邊的話你在這邊可以這樣寫else直接這樣 else然後我們就可以去par texttext 部分一樣會在這邊會新增一個 node同時我們把 node.start 等於 parser.index再來我們會去 read untiluntil 什麼呢? until 我們遇到標籤開始所以這邊我們就把 data 等於 read until這個只有當這個情況下我們才要停止讀取這時候我們就可以把node.data等於data或者是你要寫清楚一點text這樣也可以然後其實就可以結束了node.end等於parser.index然後我們要做什麼呢然後我們要把type把它變成text然後return在這邊的話我們就一樣current-note.children.push textOK這樣我們就可以繼續寫我們的tests太好了太好了Hello World好 我們繼續看一下喔Hello World 欸 等一下 Hello World 不見了完全消失了好 所以這邊有問題 我們來看一下喔 沒有 因為我這邊沒有寫我在幹嘛好 我們來看一下我們這邊要記得更新他這邊跳出錯誤Read until is not defined對 這是正常的因為我應該要寫Posture.Read until這樣子OK然後按Uupdate一下我們的Snapshot我覺得可能要把Snapshot分開來寫應該會比較好這樣才不會看得那麼辛苦好,Hello World的部分的話我們先看一下最外層是Fragment然後裡頭有一個P欸?裡頭有一個DIV沒錯,然後DIV裡面有一個P然後p裡頭有個hello world有個text node好 這樣子就沒問題啦這樣我們就完成了text的部分好 再來等一下喔 我剛好加一個console.log把它刪掉所以text的部分也ok了然後接下來我們要來開始爬這個標籤的部分有沒有辦法讓他放在其他的檔案好那關於JS的部分我們等一下再研究好了我們先讓他都放在同一個檔案雖然看起來比較辛苦一點class等於class然後我們這邊這樣寫好了好那這邊應該會發生錯誤吧如果沒有的話就蠻厲害的對發生錯誤了那這很正常因為我們沒有處理它所以我們回去我們的parser當中去處理attribute,那attribute的部分會在哪邊做呢?在tag name的部分做,這邊我們標記了一個to do嘛對不對好,所以這邊呢,attrs我還沒有宣告這個function所以我們一樣寫在那這邊我們都還沒有做所謂的程式碼整理主要的部分是在於我想讓大家可以一目了然從這個檔案當中好,然後attrs我們期待的會是什麼如果是空白的話代表我們要這個開始爬嘛,對不對開始爬首先我們先一樣我們可能會需要一個key那這個key的話就是attr.net所以這樣寫可能比較清楚attr.net等於parter.readUntilUntil我們遇到這個那實際上你可以用比如說你可以這樣寫你可以這樣寫你也可以這樣寫那在這邊為了保持簡潔所以我們就這樣寫欸遇到等於才對遇到等於對T然後呢遇到等於說遇到等於代表說欸我們下一個要開始準備做的事情是我們要去讀它的 value所以我們這邊可能會做的事情是我們可能會需要把Node傳進去這樣比較方便然後這邊Nodenode然後呢 可能還要再做一個function叫attrvalue然後這邊的話我們可能要做一件事情是如果我們發現現在的current已經是這個的話就是我們已經爬到最後面的話我們就直接這個回傳然後這邊的話我們這邊會放一個Node然後這邊就可以開始做處理所以在這邊我們可以寫parser.next等下attr valueNode進來這樣子寫比較好好這樣子之後我們要去跑它的value嘛對不對這邊的話我們讓value就直接回傳一個我们让value 回传一个 value,然后nametype 会等于 attribute name这样子写好了OK,这样子写的话,这边可能就我想一下喔我們直接把node我們直接把node然後attrs.push這樣子好了這樣寫比較順好那value這邊我想要做的事情是parser.nextparse.next然后我们在这里就可以parvalueparse.redoctile下一个双引号出现这样就会有value了好,然后returnvalue还有什么typeattribute

那在這邊我們可能會想要做的事情是在svelte當中你也可以第一個你可以加冒號代表binding或者是你可以加這個代表expression那這邊我們可能就沒辦法做處理然後因為我們可能不只會有一個那個嘛我們可能不只會有一個 attribute有可能會有很多個 attribute所以在這邊我們可能會想要這樣子寫 whilewhile 什麼parser.current不等於這個或者是什麼and parser.current不等於我們就不斷地去呼叫遞回的呼叫 attrsnode.attrs.push is not the function首先我們先看一下我們node有沒有定義正確這邊應該要是一個正列才對更新一下我們的snapshot好 然後它這邊有一個失敗的tab它說 cannot read attrs of undefined所以這邊的Node我們沒有傳進來沒有嗎有啊 這邊有傳進來啊 這邊啊我們遞回了去呼叫他所以我們這邊要放Node喔 超過了所以可能這邊的條件是沒有寫好卡住了啊 停停停 停停嗯 好 停不下來了好直接把它刪掉 OK所以 應該是在下面這邊我們有我猜是這邊有問題read until 等於好 我們先看一下 value 的部分他读這個quotes之後,它就會return然後parser.next這樣子好這樣子應該是這樣感覺是沒問題了然后我觉得这边有点怕怕的好,所以,应该是value这边有问题next等于嗯,这边应该会是next等于,没错但是我们这边还要再做一个parser.next然後這樣子 我們才可以進入這裡然後我猜這個應該會是true才對然後再跑一次 test好所以这边的确是true没错所以我可能这边的条件有写错这边啊这边我觉得这边应该是有问题的就是我们不能这样判断因为刚刚在这边我们已经有呼叫skip所以這邊的空白應該會吃不到嗯...我想一下喔我們這邊就不要做判斷了我們這邊就直接讓他去parpar我們就直接讓他去par然後喔!這樣就沒問題了好喔那剛剛那邊判斷會出錯的問題是在於說因為我這邊呼叫skip我在上面的attribute 這邊呼叫skip所以當我再回到這裡的時候那邊的空白已經被吃掉了好那我們來看一下有沒有正確的寫進去欸有欸啊但為什麼只有value那key呢key怎麼不見了嗯?為什麼只有value那key呢?key怎麼不見了為什麼只有value然後沒有type啊 不是啦type value or key因為被覆蓋掉了這樣子才是對的好按下u更新一下我們的snapshot這樣這邊就會有個key好了 耶這樣子呢我們的HTML就可以接收ADTR然後可以接收TRIAL也可以接收各式各樣的字串好我們再寫一個這個我們還有一個東西沒做叫self-closing那self-closing的话我们可以这样写在哪里我们刚刚有做一个to do嘛对不对to do to do这边不对不对tech net tech net这边self-closing等于true然后呢同时我们要把context我们要把stake拔掉然後這個拿掉然後這邊我們一樣再做一個假設我今天寫了一個video self closingself closingFail歐歐為什麼我那邊會寫成這樣谢谢大家ok,然後我們看一下snapshot是不是對的嗯?啊,self-closing在這裡self-closing應該要是true,沒錯,然後video,沒錯欸等一下,但是我star跟end好像都是錯的耶為什麼呢?啊!這邊pop掉之前我們要記得給它一個end等於pulsar.index欸?one snapshot fail喔有了有了有改了有改了OK好這樣一來呢我們就完成整個HTML解析器的功能了怎麼樣是不是發學要寫一個完整的解析器並不是那麼容易的事情那這已經是盡量簡化很多的版本了已經是盡量不去考慮各種各式各樣的這個error case啊處理啊等等像比如說這邊舉一個最簡單的例子比如說我今天如果在這邊加上一個我再多加一個class nameblablabla的話呢這時候身為一個優良的編譯器應該去告訴使用者說你有兩個重複的 attribute但我們這邊就為了簡潔 所以就不做了好 那這就是一個非常簡易版本的HTML的實作過程然後在這邊有非常非常多的小bug然後寫了很久好 那明天開始我們就會利用這個解析器產生出來的語法術來開始生成程式嘛好 那還請大家敬請期待囉我是凱凱 我們下次再見掰掰