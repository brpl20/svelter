哈囉大家好 我是凱凱歡迎收看凱凱寫程式今天呢是IT天塞第29天啊那麼今天呢我們會來正式的去解析JavaScript的語法不過這邊所謂的解析指的是我們會去爬這個哎呦等一下我們會去爬Script當中的的程式然後解析JavaScript的部分我們並不會從頭自己再做一個解析器因為JavaScript的語法遠比HTML來的負擔很多所以我們會使用Library來解析那這邊會使用的Library叫做我不確定有沒有拚對agron吧不確定好但我們會用的是這個這個是一個開源的JavaScript的解析器好所以呢在script tag裡面當中啊我們想要用這個解析器來做解析然後呢解析完之後就會生成一個JavaScript的語法數好那解析完之後會有一個JavaScript的語法數所以這樣一來我們就有第一個我們有一個JavaScript的語法數跟第二個這個一個HTNL或者是呃加上可以解析Svelte的一個語法數嘛對不對好那有了這兩個東西之後我們就可以把它全部組裝起來變成一個component好那我們今天要做的事情呢比較簡單一些我們只要想辦法把Jarswhip的語法術生出來就好然後明天呢最後一天我們再正式的去把這些東西全部都組裝起來好那我們就馬上開始吧好首先呢 我們先到我們的程式碼當中那一樣 再跑一下測試喔 等一下啦 等一下啦我們昨天有去做更新啦 所以還沒有更新到Test對 我們這邊把它改掉 所以應該只有這邊有變好 那我們就直接讓它去這樣哦不對不對npmrongtest讓它去更新一下snapshot好更新了然後我們開始做我們今天要做的事情第一個我們想要讓我們的parser可以去解析html呃JavaScript對不對所以我們在這邊可能要做一點處理那一般來說你可能會想要把它分開來那我們這邊為了方便起見我們就直接把它寫在同一個 function 裡面所以這個 function 變得有點大不過沒關係在這邊呢,我們去寫一個pause.js好,然後我在這邊放一個js的變數好那我們在這邊要做的事情是parser.skip去省略到空白然後我們去如果parser.next等於script的話遇到了script tag的話我們就開始去爬裡頭的內容好,那要怎麼爬呢我們可以用parser.readUntilReadouttil遇到這個就再次遇到要關起來的那這邊的話我們就不再做這個錯誤處理的部分了我們就假定他都一定會好好這樣關起來好所以呢這邊我們就可以這樣寫Js加等於Readouttil好那這樣子一來呢這個現在parser就已經讀完了然後我們再讓 parser 爬出去打 next script好那我們跳回來這樣子應該就沒問題了 還蠻簡單的我們看一下確認一下然後在這邊呼叫一下 functionpars this好 沒關係因為我們有寫測試嘛 幸好有寫測試我們就知道到底有沒有過了好 都有過好 接下來我們測試裡面再補齊JavaScript的程式的測試sure parse好等一下我們調一下然後呢這邊的js 我們就只把它變成變數而已所以我們可能會想要把它放到這裡來對那這邊的話你可以這樣寫我們把它變成一個object好了然後html跟js等於js好 那這樣子應該測試就會有錯了應該都會錯很慘你看他這邊說什麼4H for not default這邊是walk的部分所以我們先慢慢一個一個修walk的部分哎這邊現在現在這個ast已經會變成這樣子HTML跟JS所以這邊要變成不要好了 我們統一在這邊改好了改在測試的部分這邊我們都改成HTML然後這邊一樣,加html喔還有,還有哪裡欸,就這樣,就這樣再跑一次好,walk的部分沒問題,接下來我們看一下,generategenerate的部分也要改一下generate的部分的話一樣這邊的walk那這個generate它是我們昨天為了這個測試用為了當範例用而產生出來的HTNL程式嘛那實際上我們實際實作的時候會用另外一種方法也就是用整個語法術而不是直接這樣子直接寫死成一個string這樣子不過這部分的內容我們明天會再多解釋啊好那沒關係我們這邊就一樣把盡量把測試改到好一樣這邊ast打不要好了,這邊放在這,html好,generate的部分也沒問題了接下來是這個snacksharp的部分你看這邊snacksharp都做出一個js所以我們在index的部分我們一樣把全部的parse後面都加上打html這邊這邊這邊這邊這邊哇我們不知不覺寫很多測試啊這是好事OKOK好,這樣子應該就沒問題了我們先把既有的測試修好修好之後我們就可以加上我們現在要做的測試我們現在要做的測試是說 parsescript 裡頭的內容to be好然後我這邊改成這樣好了打js它應該會打一個console.log所以應該是沒錯的OK好那接下來我們要做的事情是因為我們parse完是希望它可以變成一個語法數嘛對不對所以我們也希望這邊的這邊它給我不是一個字傳而是一個JavaScript的語法術那我們剛剛有提到我們使用了這個呃也不是我們啦就是在spell當中他是用acron這個library當作一個JavaScript的解析器那我們這邊也一樣來使用它好然後在這邊爬完了之後這邊我們呼叫acron.欸?等一下ACORNACRACORN要怎麼翻然後它裡面呢會有一個Parse然後裡面Input等於String所以我們裡面放String好這樣子這樣子它應該就會是一個對它這邊就會是一個完整的與法術了 好所以一樣我們這邊也就偷懶直接match snapshot就好OK 然後這樣子好這樣就沒問題了 然後我們檢查一下我們的snapshot嗯 有了好 那麼我們現在已經有了這個html的語法術跟這個JavaScript的語法術對不對那我們接下來我們之後可以做的事情就是我們可以把這兩個結合起來然後生出一個這個felt的component好那這部分呢因為要花的時間比較長所以我想要把它放到最後一天然後做一個大同這樣子那麼今天的內容呢算是一個前置啊所以呢會比較少一點那大家如果有興趣的話可以試著玩玩看這個ACROR然後呢我們之後呢會開始講解我們之後呢會開始講解關於AST的部分所以呢我們可能之後明天啊,也只剩明天,我們明天可能會用這些我們明天可能會用這個AST Explorer來練習語法術到底長什麼樣子好嗯好,那麼今天內容比較短一點就到這邊為止喔我是凱凱,我們下次再見掰掰