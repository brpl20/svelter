哈囉大家好,我是凱凱歡迎收看凱凱寫程式今天是IT天然賽的第21天UI實戰篇也算是告一個段落了今天我們要來講一個比較不一樣的東西不過在前端也是很常見的應用就是資料視覺化資料視覺化涵蓋的範圍跟主題很廣所以我們今天就挑一個最簡單的就是長條圖这个教学我们会透过D3打JS这个韩式固能来实作一个简单的长条图那Svelte我觉得Svelte跟D3可以做很好的搭配原因是在于第一个Svelte可以很容易的就可以和原生的洞做互动比如说你想要获取这个节点的话你只要用By.List然后它就可以帮你绑定don't know的节点到你的变数上面或者是呢你可以用reactive的语法前号所以呢当你的变数或者是资料更新的时候可能你的D3的部分有一些函式想要重新再执行一遍的话呢你可以很容易的用前号来完成再来就是你可以搭配spells里头内建的transition机制來做到一些還不錯看的轉場效果我們就可以不用用這個D3裡面的內建的Transition而是改用Svelte來統一幫我們做管理好,那我們就直接開始吧這邊我已經準備好資料那這個資料是因為我現在在福岡工作所以這個是官方網站的福岡疫情資料列表然後我這邊寫了一個簡單的函數等一下會用到就是它可以把資料根據不同的key根據你指定的key把它做一個整合那我們就直接來實作吧首先我們先把資料給引入進來然後我們稍微看一下資料長什麼樣子喔 他有1000個這列表還蠻長的 1000然後他這邊就是這個患者的資料比如說每一個這個就是一個個案這樣子 所以對啊 福岡已經超過1000了這個資料其實還不是最新的就是7月份的 所以7月份的時候就已經有1000了 所以有點可怕喔好然後這是他住的地方然後在哪裡 幾歲 然後性別這樣子好 那在這邊我們只想要統計比如說 2月20號總共有幾個人嘛所以呢 我們可以用 group by 來幫我們做到這件事情首先我們先呼叫先宣告一個變數同時把goodbye這個函數引入進來這邊直接去呼叫他線一直卡到goodbye data key的話我們用publish at也就是說我們根據它的key來做排序卡住了資料太大了我們根據它這個publish也就是發布的時間來當作key所以我們再來看一下排序過後的資料會長怎樣你可以看到它现在就变成用这个日期当做这个key然后里面是有同样的publish at就会被分归类到一组所以我们从这边就可以很轻易的知道说2月20号总共有两个3月17号一个然后这样子一次类推比如说4月1号五个这样子好 那有了這些資料之後呢我們就可以開始做一些東西啦首先呢我們宣告一個 barCharts.svelte然後呢我們裡面可能等一下會用到我們要用的資料然後xtixxtix是說我的x軸總共要有多少個長條那在這邊呢 我們想要x軸就當作這個日期然後y軸的部分的話就是今天總共有幾個案例所以Equestra的ticks我想要他是日期所以我想要把這些日期全部都copy下來那當然我們等一下會用程式來做這件事情再來還有Yticks那Yticks的部分的話呢我們就從0然後最高的部分就是這裡面當中最高的案例是75嘛對不對來做到這件事情好那有了這些東西之後呢我們就可以來寫這個表格的部分好 那我們這邊呢首先先給一點padding好了來避免那個圖表裡面有抄出來的部分lab10 我們全部都給10好了然後等下再看那個長得怎樣我們再來做調整OK好然后呢在这边呢我们引入这个importscale我们从第三的scale引入一个scale linear那这个scale linear是说它可以根据你定义的参数呢去建立一个比例池也就是说我想要把我的比例尺假设我现在是从0好了然后涨到100然后它可以帮你去判断说那你这边对应的这个在洞上面的range要是多少比如说我想要从在洞上面我想要从这个100开始好了然后到我的宽度400當你在呼叫xScale 50的時候它就會幫你去計算說50在中間嘛對不對那他對應到的寬度長度應該在洞當中的哪一個位置應該是200吧沒關係這數字不重要就是啊應該是150欸200好沒關係反正數字不重要重要的是說他會幫你去計算說欸這一個對應到的資料要出現在哪一個位置所以我們就來實際寫一下吧那它寫起來的方式是這樣子首先我們用前號是因為xtick可能會因為你資料的不同而有改變那我們可以很方便的用前號來讓它去重新做計算好,那我們這邊宣告一個 xscale等於 scale-linearDomainDomain 的話我想要它從0跳到不是從0啦,X的部分是從第一天跳到最後一天嘛,對不對,所以我們這邊就直接把它定義成這個從外部來的 Xticks,那我們等一下會去定義它然後 range,欸不對從這邊定義過來的話它會是一個這個字串所以它沒辦法去做計算它這邊應該要是數字才對所以呢你可以這樣寫我們就從0跳到xTicks的長度假設我現在假設我現在傳入一個長度為10的陣列那它這邊的Tick就會幫我跳10次那Range的部分的話呢x都在這裡嘛對不對這一條是AX走所以呢我想要讓他從padding.left的部分開始跳到哪裡呢跳到我的整個寬度那這邊我們寬度就直接先寫死假設2000好了因為資料還蠻多的所以我們直接先給20002000減掉padding.right這樣子這樣子我們就有這個xs座標的比例尺再來呢我們定一下y座標那y座標的部分的話呢我們一樣domain是從0跳到

從0跳到y的最大值所以你可以這樣寫Math.max y的最大值然後呢,range的部分的話我們希望它是從最高跳到最低這個原因是因為動的走向都是從左上角這邊開始所以假設我這邊的長度是100好了那這邊的座標點就會是0然後100然後呢如果假設我的座標點在這裡好了中間的話呢那假設這邊的高度是10好了那這邊的長度先把它擦掉這邊的座標點的位置就會是1050那這跟我們認知的一般的座標不同我們一般認知的座標是原點是在中心點所以呢在這邊做計算的時候我們是想要讓它從這邊開始也就是我們假定這邊是0那這邊的話就是高所以呢我們會想要讓它從height開始好那等一下如果我做错的话我们再重新看一遍所以我们这边就给height那因为这边height还没有决定所以我们也先把height写死成350好了那当然你也可以去动态的去做计算比如说你可以去绑定你要的节点啊或者是从外部传进来都可以那我们这边为了简单操作所以我们先把高度跟宽度都先写死然后呢减掉padding.top到0喔不對,到pading.button這樣子,ok好,接下來我們就宣告一個svg然後呢,因為現在寬度會比較大一點喔所以我這邊用一個div把它包起來等於100vw然後overflow x我們等下auto然後svg的部分width給他2000pxheight等於350px好這樣子這樣子應該可以看得到這邊有一個SVG才對因為我還沒有把它引入進來所以我們先把我們的BorderChart給引入進來BorderChartOK打svelte好那現在還沒有東西嘛他現在應該只有欸等一下好沒關係因為我們該傳的東西都還沒有傳所以我們等一下再一起解決喔然後呢這邊我們就可以開始做我們要的這個x座標我們先把x座標跟y座標給弄出來所以呢each x ticks as tick然後我們這邊用一個g把它包起來那g的部分的話你可以在這邊做一個transform然後呢 translatecaddy.left我想讓他跳X 座標是在這裡然後我想讓他往右偏移然後Y 的部分的話我們應該是要給定個這個想一下喔算是有點不好height的部分因為要記住喔這個我們剛剛提到嘛座標是從上面開始所以從height剪掉padding打buttonbutton好這樣子然後要給pixel好這樣子然後裡面的話我們就一樣是放g嗯想一下喔嗯對好然後裡面呢一樣給一個transform那這邊的話呢我們給一個xscaletick嗯?xstill tick等一下這邊的tick如果照我上面的傳會是一個日期不要不要不要我們用index來傳xstill對,因為我們現在傳進來是一個長度嘛,對不對0到假設我有10,所以它就會有10個刻度所以我們用index來表示然後呢,加上padding.left我們剛剛在這邊已經做偏移了,所以這邊就不用再另外做一次偏移然後y的部分的話Y的部分的話我們這邊也已經做過偏移了所以我們這邊就不用再做偏移了然後呢裡面就可以放我要的text然後假設我們先寫死好了我們先看一下這邊會有什麼事情然後他這邊說length of not defined原因是因為我還沒有傳xticks跟yticks那我們先決定一下xticksxticks的部分的話我想要它是這個裡面都會是這個日期,所以我想要傳入日期那如果要傳入日期的話我可以這樣寫object.values.group.keys.group這樣裡面都會是publish at嗯 對好然後他現在說Y ticks is not iterate對 因為我們還沒有給一個Y tickY的話我們這邊就直接寫死好了010 15好像太大了 50 1520 25可是這樣好像又太小好 我們用10為一個單位好了6070 80剛剛看好像最高就到80好所以我們接下來就可以來看一下這個東西有沒有跑出來有然後這邊的transform好像怪怪的好所以呢接下來我們就要來debug首先在這邊SB就好像是不用加pixel了嗎還是要看一下確定一下然後這邊也一樣拿掉喔對對SPG的話是不用加pixel的所以不要犯我剛剛的錯好這樣的話我們的X 座標感覺是正確的再來我們一樣不是突發煉鋼異曲同工就是複製貼上然後這邊的部分的話一樣把它改成是Y座標對不對所以Y座標的部分的話我想一下喔X的偏移我們就用0那Y的偏移量的話我們就給呃Y scaleY scale然後要給裡面要給什麼呢?喔不對不對 這邊是外面外層的偏移的話就是偏移這邊然後

應該都是0吧他就在最左邊不對 我們這邊應該給他一個 padding.left想一下要不要應該不用我們就先給0看看好了如果有錯我們再調整然後y的部分也一樣然後這邊我們改成 yticksx as ticki然後這邊的話偏移量我們一樣給0然後這邊的話我們給y scaley scale裡面的話這邊的話就要給tick要給一個真正的數字然後呢這邊的話我們的text就可以給tick好你會發現這邊你看喔,它現在跟那個什麼跟XS軸是一樣的位置那你可能會想要你的Y軸比XS軸再高一點點所以你可以在這邊去剪掉padding.button這樣感覺比較好一點然後我覺得text都太大了那其實實際上就是用100%來看是會小比較多啦不過因為要讓他看比較清楚所以我現在都用150%那我們這邊就把這個text把它放小一點14px看看12px12px差不多了對不對好然後這邊a的部分我們就把它變成tick好那你可以發現這個字全部都糊在一起了那有一個做法是你可以用rotatetransformrotate 90度讓它不要跟其他人卡在一起或者是你改變文字的等一下為什麼沒有轉把這邊打錯了transform還是沒有轉好這樣我們又要再debug一次了嗎等一下先看一下它有沒有作用上去有好那我們再來debug吧欸等一下喔該不會又不用加單位了吧嗯好沒錯是不用加單位你把它轉成90度之後它就已經超出SPG的範圍了那我們這邊就偷偷作弊一下我們把SPG直接變高好那這邊是做一個不好的示範就是一般來說你可能想要彈性一點不想把這些東西都寫死不過呢如果不寫死的話等於說你要做蠻多判斷比如說當使用者重新拉的時候resize的時候你可能要重新調整一次寬度高度啊等等那這些東西因為我們今天的目的是為了講解圖表所以就沒辦法講這麼多好,所以呢如果有興趣的話請大家自己去研究一下那我們這邊就示範怎麼做出一個圖表出來好,那麼X軸跟Y軸都好了接下來就是處理這個長條圖的部分長條圖的部分一樣喔,我們這邊用 eachdata.sd他說什麼?這邊沒有關起來然後這邊我們給一個 rect那rect的話呢有一個x那x的部分我們就用xscale然後d一個然後加上padding.left不要好了我們直接在這邊同一做一次轉換這樣比較方便一點就不用一直在每個地方都要轉來轉去在這邊直接加上一個padding.left打left這樣我們就不用在這邊做了再轉一次然後y的話呢就打yscaledatadou我們看一下喔我們傳進來的喔 還沒有傳data 等於我們要傳的資料呢是這個google 資料不過呢這個已經被包起來的資料它其實是一個物件所以我們要把它變成陣列object.values然後data好 那在這邊我想要再做一個功能是說我想要傳入一個這個function那這個function是說我的y要怎麼去存取所以我們這邊給一個assessor等於d.d.d.land現在傳進去它會是一個這個陣列 然後裡面每一個東西都會是陣列然後正列的長度就是我們要的資料所以我們這邊就打d.length然後呢我們在這邊assessor當然可能會有更好的命名方式或者是屬性的命名不過我們這邊就偷來就這樣assessor然後把d傳進去好這樣就x座標跟y座標啦然後with的話這邊呢也是一樣看大家的需求那我們這邊直接寫死假設給是10然後hide的部分大家一定要記得hide的部分它都是從上面開始做計算所以我們有從hide剪掉padding.button剪掉yscaleassessor然後d好這樣子應該就有形狀出來了才對好那我們看一下呃看起來他的看一下喔喔heights都是 undefinedok 所以這邊有問題accessor 的部分有問題好accessor 的部分有問題看一下喔所以我們這個回傳過來的東西會是 undefinedupject.valuesheight部分是nan所以第一個我們看一下height有沒有選高 有然後padding.button有沒有選高 有然後再來是YscaleAssessor D有沒有宣告Assessor的部分我想是有傳進來還是我打錯字了AssessorAssessor對所以也沒有打錯字看來就是這個D有問題了D有問題嗎D有問題的話D如果有問題那麼喔 對 D有問題Accessor或者是 D都有問題啦想一下喔好 那我們就 來看一下這邊的啊不對喔好 沒關係 我們就直接object.values啊 不是 data啦data是陣列 是grouped這樣子才對這樣就有我們這樣就秀出來了耶好然後呢在這邊你可以做一些調整現在感覺長條形跟那個文字連在,感覺很黏嘛黏在一起比如說你可能會想要在x軸這邊再讓他做transform比如說我這邊就偷偷的讓他變成-1之類的喔1對往下移變成2之類的那這邊的話你可以也可以把它拆成一個額外的設定比如說margin可能要變多少之類的這邊就看他的看大家的巧思那這邊的Color 黑黑的感覺不好看那你這邊也可以把它當作一個屬性Expose 出去我們這邊調成一個藍色呃 綠色 綠綠的感覺

也可以或者是紅紅的感覺比較有那種警告的意味就是說 欸這是患者喔 要小心喔這樣子哇 你可以發現這邊到了75好 那再來是這邊的Y軸我想要有一個基準線嘛 對不對那你可以這樣寫這邊加一個line是叫line嗎?好像是叫line100%line的部分給它stroke讓它灰灰的然後,現在這樣看感覺一條線好像怪怪的所以我們給一個stroke-array讓它是虛線的感覺然後你可能會想要讓這個線不要跟這邊的這個數字重疊你可以做的事情是你可以幫它做一些偏移比如說x1的部分你就做一些便宜,比如说1013151515感觉差不多20那这边也是一样就是大家可以把它当成一个参数去做调整这样子OK这样子的话就有一个等一下这边有一个小bug你看因为我这边凸起来了所以我这边的y可能要调回来看一下喔這邊呢,減button可能要調回來0這樣子好然後這邊的text的部分你可能會想要再做一點點偏移喔,比如說y等於10喔y等於10太多了y等於5y等於13好 3差不多啦好了 這樣子你就有一個這個簡單的長條圖好 那麼這個呢就是Spelt搭配D3做一個簡單資料視覺化的應用那麼今天的教學就到這邊結束囉我是凱凱 我們下次再見掰掰