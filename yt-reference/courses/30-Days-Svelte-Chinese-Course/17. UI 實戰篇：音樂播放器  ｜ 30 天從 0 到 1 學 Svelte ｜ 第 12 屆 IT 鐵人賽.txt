哈囉大家好 我是凱凱歡迎收看凱凱寫生室今天是IT天人賽的第17天了那麼今天也是一樣是我們的UI實戰篇今天的主題是音樂播放器音樂播放器在前端當中應該也是一個蠻常見的場景像是比如說KKBOX、Spotify、YouTube等等我們都會需要使用音樂播放器來播放我們的音樂今天我想要讓整個主題變得比較輕鬆一點所以這個實作會變得比較簡單好那麼我們今天要做什麼呢我們今天要透過Svelte來客製化我們音樂的播放器因為原生的UI能做的控制或者是能做的UI調整比較少一點所以我們就透過Svelte來實作看看吧主要的功能,這次也比較簡單一些第一個,提供播放跟暫停再來就是調整音量,調整進度條然後顯示現在的時間跟音樂的總時間最後我們會提供一些快捷鍵,可以方便操作比如說按下空白鍵的時候可以播放暫停音樂,或者是按下P假設按下P的時候是暫停按下N的時候是靜音等等那我們就一起來試試看吧好那這邊呢我已經先把這個音樂上傳了那麼因為現在的設定所以大家可能聽不到現在這個我不知道為什麼Mac的部分好像沒辦法在OBS接收到音樂不過沒關係我會用這個音響放出來所以等一下把它調大聲一點這樣大家都聽得到OK 那我們就開始吧首先我們先用Audio來看一下這是什麼效果然後就直接把SRC放進去Song.src所以你會看到這個瀏覽器會直接幫我去做相對應的讀取好 那我們來聽聽看那這是我很久以前彈的一個鋼琴演奏曲叫Just be friend有興趣的話可以聽聽看好那大概就講這樣啦會有一個播放暫停按鈕然後會有一個現在的這個播放時間跟總播放時間還有一個可以調整 進度調跟調整音量的部分好那在這邊我們可能沒辦法做得像就是整個UI那麼細緻喔 不過會盡量把一些要點講解給大家聽好 那我們就開始吧這先拿掉然後呢首先我們先放一個PlayerContainerPlayerContainer然後我想要把它放在最下面好像現在很多的這個音樂播放器的UI都是這樣做然後button給0width我們給100%同時我們也先把這個box-sizing的部分變成boulder-box這樣等一下比較好做定位然後left給0,right也給0那height的部分我們給65px好了再高一點好了,75px然後boulder-top我們給1px好像有點高欸沒關係背光Corder我們給好這樣子的感覺好像還不錯那我們這個給好啦就這樣不用做得太細緻Display我們給Flux然後Justify Content我們給Space Between最後的align-items我們給center好然後padding的部分我們給5px這樣子然後呢在裡面我想要先用一個class name song information那我們就用info來表示那我想要先把這個image放上去song.coverurl這樣子喔 有了現在它是滿版所以我們在SONGINFO這邊想要做一點設定第一個是display一樣給flux我們等一下還要塞其他東西justify counter我們一樣給space between然後再來image的部分呢我把它的width調到30px30px有點小405050不錯然後呢我們這邊把這個歌曲名稱放進來歌曲名稱叫Song.net呃他應該是被H4本身的margin給吃掉了所以我們把margin歸零然後呢image跟那個標題靠太近了所以我們給他一點margin 8px然後這個標題有點太黑了而且是粗體777好像看不太清楚是是是 然後方位給normal然後呢我們這邊再加一個p不要包起來好了不然它會變成flux排版需要讓他在下面這樣子然後這邊送到 author這樣子還是會被拉開齁所以我們這邊一樣 p 也一樣嗯 靠得有點近不過就稍微調一下好了這個顏色我們再給淺一點然後margin top的部分5px,4px,5px,5px好了然後呢,方size可以調小一點好,這樣子,歌曲名稱就顯示在這裡然後這個是封面資訊因為找不到什麼照片,我們就直接貼我的照片吧好,再來呢嗯 嗯中間的部分 我們想要放這個操作的按鈕喔 操作的按鈕所以DIVButtons首先是這個上一首然後再來是播放再來是下一首喔 他一直抱怨說這個image要lt所以我們給他一個lt封面song.name的專輯封面好 然後最後的部分呢我們想要他是一個這個failure可以調整音量的部分好那这样子一个最简单的UI就出来啦不过呢这边今天因为时间的关系所以上一手跟下一手的功能我们可能没办法实作然后这边因为在找图片可能有点麻烦所以我们这边直接用文字做取代不过在实作上你可以在这边加上你自己设计的或者是这个网络上拿过来的资源把它变成那个播放按钮然后上一手下一首也是一樣像這樣子跳過去像這樣子這邊這邊就交給大家創意去做發揮了好,那麼我們回到這個介面接下來就可以來實作啦首先這個音量的部分我們可以用我們之前使用過的slider來直接替代slider欸他說slider is not defined所以我們把它引入進來那這個slider就是我們之前寫的那個slider只是這邊為了方便就把它先引入進來然後呢我們要把這個相關的屬性都給一下max是1這個failure的部分啊browser延伸的話呢是這個browser延伸的部分的話是從0到1這樣子所以我們可以這樣寫max是1然後

min是0current的部分就给failure我们等一下会定义它或者是0.5给在中间的值然后呢我们还要再加上什么onChange1.detail.value等于failure啊 翻了failure等於1.detail.failure好 然後他現在說failure is not defined所以我們先宣告一下OK然後我這邊還要再宣告一個stepstep的話我們給他0.01OK可是因為我之後有稍微修改一下slider所以這邊呢,failure的部分你可能要給它一個寬度所以我們這樣寫100px100px有點...嗯?啊!現在這個background部分跟它灰色的部分是一樣的好,為了避免這個問題我們把顏色調一下好了我們調成再淺一點再淺一點會看不出來不然我們就直接用白色吧直接用白色好了這樣就看得比較清楚這樣子之後呢這樣就可以了再來就是這邊這個播放跟暫停的邏輯好接下來我們就可以把引路進來不過呢我們現在不要用Audio原生的UI所以第一個Controls先拿掉然後為了怕我們就給它一個Opacity 0讓Audio看不到不過同時呢我們可以利用Spells裡頭的Bind的功能來綁定我們需要的東西FindDuration那FindDuration就是它會幫你自動綁定duration然後Find current time還有Find past暫停還要Find 什麼呢failurefailurefailurefailure之後先這樣好綁定好之後變數還沒有宣告相關的變數也都先宣告一下let duration我們預設給他0,這邊給他0.5還有什麼?Post等於FalseTrue好了,剛開始是暫停的狀態好接下來我們把播放的部分註冊,UnclickUnclick,這邊我們Posts 等於 Posts然後如果現在是 Posts 的話我們給播放然後如果現在是 aPosts的話我們給暫停這樣子好這樣子我們就可以按下去了好 你可以聽到有音源喔然後再OK接下來我們想要把整個進度條也就是歌曲的顯示部分放出來所以我們一樣可以用我們之前寫的slider這邊我就偷懶直接把它寫在這裡了slider你有看到這邊有個slider然後max的部分我們放duration然後呢我們為了怕這個錯誤所以我們只在duration已經被綁定的時候我們再把slider秀出來然後min的話是0那step的部分我們就給duration除以150好了 不然除以200好了這樣子 step然後current的部分我們給current timeok然後一樣 onChange的時候呢我們會去改變current time的值current time等於1.detail.value好這樣子 所以我們來試試看OKOK 所以這個功能是有效的好 那我們再來看一下這個fallen的部分是不是有效欸 這裡不過這邊有一個小BUG就是當我移到最旁邊的時候它會再幫我跳到0.5好我們先把音樂暫停那這是因為呢我在這邊有寫一個所以0的話會被當成False所以我們這邊呢就不要不要不要這樣寫好了我們直接把valent寫在這裡所以它這邊的預設值就是0.5所以到這邊一定會有值OK好,這樣就可以了好,這樣好,再來是我們想要把這個現在的時間跟樂曲的總時間給放出來所以我們先定一個小函數好了叫formats打js那這個函數要做的事情是我會接收一個number先給大家看一下duration它在被綁定的時候它的格式呢是秒是以秒為單位durationcurrenttime它會是以秒為單位你可以看到357 而且它會有小數所以在這邊我們要做的事情是第一個 minutesminutes 的部分就是除以60因為它有小數嘛對不對所以我們這邊再給一個 floor然後 second 的部分的話一樣flor, number, 取數60然後這邊呢,我們會想要它是分然後秒分,然後記得要幫它補0,這樣會比較好看這邊也是一樣seconds toString然後一樣幫它補0OK 然後記得要export出去OK 再來我們回來我們的app裡面這先拿掉那我們也一樣就直接偷懶了不做UI的美化 我們就寫在這邊formats current time然後呢formats duration他說formats not defined所以我們還沒有把引路進來formats 這樣子OK 這樣就有這個秒數的部分了 然後按一下所以你可以發現喔這個透過svelte bind的語法我們可以節省掉蠻多程式嘛因為一般來說你可能要去監聽這個Audio相關的事件然後去改變對應的詞比如說Current Time你可能要監聽事件然後Pulse也一樣Failure也一樣Duration也一樣所以透過Bind的語法真的還蠻方便的而且重點是你可以做雙向綁定所以當你的比如說我透過Slider來改變詞的時候它又會一起改變這樣子好 這樣一個最基本的播放器UI就完成了當然這邊有很多沒有做美化的部分比如說這個定位要放在哪然後這個UI的樣式等等不過我相信大家看完這個影片之後應該有能力自己去做更多客製化的調整好 再來我們想要做的一件事情是我想要加入這個keyboard的導航功能那這個導航功能是說啊比如說在我呃懶得用滑鼠的時候我可以按空白鍵就可以

切換播放暫停或者是我可以按左右鍵來切換比如說前進5秒後退5秒等等所以我們現在就要來做這個功能好那麼我想要實作的方式是呢我讓Tab Player Container這個洞可以被Focus所以我先給0然後當我的Focus在這裡的時候我就可以去操作我的Keyboard好 那在這邊要跟大家介紹之前沒有講到的一個spells功能叫做hook這邊在spell當中你可以用這個語法use這個directive來宣告一個action那這個action會做什麼事呢它可以接受一個函數那第一個是note然後第二個是parameter那parameter就是你從這邊傳進去的然後呢它裡面會需要回傳兩個東西一個是update 一個是destroy那這兩個都是可選的那update就是說當你的參數更新的時候你要做什麼事那destroy的時候就是說當原件被消毀的時候要做什麼事情好 所以透過這個東西呢我們可以拆解一些比較共用的邏輯到另外一個函數當中所以我們就來試試看吧好 那這邊呢我就把它叫做 keyboard.js然後根據這個spells描述第一個的參數是node第二個的參數是premiere那我們參數設置成premiere.shortcuts好了那你只要傳入shortcuts我的想法是當你傳入一個shortcuts的一個物件的時候呢它會去做一個Mapping比如說你可以這樣寫ArrowUp當我按下上的時候你可以去定義一個函數然後呢所以它就會去偵測說當我按上的時候我去執行這個函數當然你也可以寫成Array也可以所以呢我們就想要做這件事情好所以我们在这边就去做node addEventListener然後keydown所以我們在外面宣告一個函數叫做handleKeyDown好然後在這邊我想要做的事情是我去看一下每一個每一個Premier.ShowCards裡面的key那我對每個key做什麼事情呢這邊叫key好了第一個我去看如果e.code等於key的話就是說當我找得到這個ShowCard裡面的東西arrow up當我剛好按的也是arrow up的話我就去做這裡面回圈的東西那我要做的事情就是parents.shortcuts.key那我先判斷它是 array 還是單純的 functionarray.isArray這樣子如果它是的話呢我們就把shortcuts.key.foreach把全部的函数都执行一次然后函数里面呢给它传入1的阐述那如果不是的话呢就直接做执行这样子OK那在这边呢就直接打handlekey down然后returndestroy这样子那这边就是node.referral removeEventListenerkeydown handleKeyDown這樣子好那再回到我們的app當中我們就可以來使用這個action了那要使用的話就是useDirective然後它的名字叫什麼名字叫什麼你可以自己決定比如說我叫 keyboardkeyboard所以 usekeyboard我要傳入我的參數我的參數寫在原件好了這样看起来比较清楚首先我要做的事情是什么呢当我按下上的时候先看左边右当我按左边的时候我要把current time减5秒然后呢error write的时候呢我要把current time加5秒然后呢上的时候呢我要做的事情是我要调整我的音量failure加等于0.05好了0.05然后下的时候我要减掉0.05好然后再来是按下空白键的时候按下空白键的时候要做什么呢呃我的pause要做转换然后按P的时候key P哦是叫key P吗对对应该叫key P我们就直接让音乐暂停然后呢當我按下end的時候end的話我們好像沒有綁定muted對不對 沒有所以我們再綁定一個muted等於false剛才有一個false然後我們去綁定它綁定到這邊bind muted等於muted按下end的時候呢muted等於muted好這樣的話我們就有這些功能了按上跟下可以調整音量左跟右可以調整目前的進度按space可以調整暫停播放按p呢可以變成暫停按n可以變成靜音好我們馬上來試試看首先呢我們先把焦點弄到這裡按播放好沒有任何事情因為我還沒有還沒有把參數放進去show cut然后show cut这样子诶 他说unexpected token等一下喔 所以我应该有有地方写错了看到了 这边没有写好好 然后这边把它export default出来 之后呢我們就可以來試試看有沒有效果了欸?還是沒有效果好,所以呢我們現在就可以來debug了啊這個我們剛剛幫他拿走了,所以我們再把它拿回來keyboard,然後show cut這樣子好然後他一直在,喔因為這邊一直更新這個拿掉好 再按一次一次好 你可以發現我現在可以按下空白鍵來操作然後呢 我也可以按左右鍵然後我也可以按上下鍵欸 下的部分好像不能按欸等一下而且突然壞掉了等一下喔好,沒問題沒問題這樣子然後呢,再按P就變成暫停,然後按End的話就是整個靜音那靜音的部分你可能會想要同時把Failure的部分調成0那這部分的話,我這邊就不再另外試做了好,再按一次好那么以上呢就是关于这个播放器UI的实作以及透过Svelte我们可以怎么去实作它好那么今天的内容就到这边结束了我是凯凯我们下次再见了拜拜

 감사합니다.