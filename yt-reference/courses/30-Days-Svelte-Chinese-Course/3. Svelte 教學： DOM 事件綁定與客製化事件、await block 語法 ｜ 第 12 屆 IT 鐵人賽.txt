哈囉大家好,我是凱凱歡迎收看凱凱寫程式今天是IT鐵人賽的第三天昨天我們提到Svelte的原件宣告方式Svelte的基本安裝還有基本語法等等今天我們來講一些比較進階的東西今天我們要講什麼呢第一個我們會講動事件的綁定還有原件和原件之間的事件客製化事件還有Await 這個 block 語法的應用那我們就開始吧首先我們一樣打開我們的 REPL那麼通常在前端框架當中我們都會有一些處理事件的方式那麼在Sfield 裡面你也可以有類似的方式來監聽事件那使用的方式是呢我們使用on這個directed然後呢後面加上冒號再加上事件的名稱比如說想要監聽點擊事件的話就用click然後呢後面加上大瓜糊大瓜糊後面呢可以是任意的表達式比如說像這樣子那我們來看一下可以發現這邊就被點擊了或者是呢你也可以把它宣告成函數那麼它的效果會是一樣的你看那麼透過這種方式來幫你監聽Spilt會來幫你監聽事件同時呢Spilt也會去幫你管理說這個事件應該在什麼時候被註冊跟在什麼時候被銷毀等等來節省掉我們自己手動管理這些事件的麻煩那除了Click之外當然可以有其他Effect名稱比如說Key Down或者是Mouse Down等等那麼除了一般的監聽事件之外呢Spellz裡面也提供了一個功能叫做Modify來幫助你減少一些比如說你在事件當中有一些常見的行為比如說我只想要跑一次這個事件處理器或者是我想要取消預設行為等等那這些呢一般來說我們都會直接寫在程式碼裡頭不過呢,Sphils提供了一個Modifier的功能來幫助你減少這些程式碼那使用的方式是我們這邊加上Gun然後比如說我只想要這個事件處理器跑一次的話呢我們就加上 once這樣子的話這個事件處理器就只會跑一次你看不管我不管我再怎麼點他都只會跑一次而已或者是說呢你想要他跑一次同時呢取消他的預設行為也可以這樣寫那不過因為h1本身他沒有一個預設點擊沒有預設的行為所以可能在這邊看我們出來它的效用那麼一般我們寫程式的時候可能會怎麼寫呢?我們可能會把邏輯直接寫在這個函數裡面比如說假設啦我用一個比較爛的寫法來模擬這個一次這個只讓事件處理器跑一次的行為比如說我這邊跑一次之後呢我就把1等於True1是等於True然後呢呃等一下這樣子寫那同時我還希望它是prevent default對不對所以如果我把modifier我不用modifier這個功能然後我直接用韓式來寫的話可能會寫的像是這樣子那當然這跟實作有點不同就是在sphere 當中呢它是會直接幫你取消這個減停器而不是用這種方式用變數來控制好所以呢你可以發現我們用modifier的話可以來簡化我們的程式可能就不用寫了這種複雜只要寫我們的核心邏輯像這樣子就可以了好那我們這邊用另外一個範例來看好了我們用atag通常Airtag的行為是我們想要到另外一個連結另外一個網站去嘛 對不對那麼我這邊如果加上onClick然後一樣是handleClick這個函數的話呢那我不想要它跑出預設行為的話可以這樣寫你可以發現我點擊了這個連結之後呢它都不會有任何跳出超連結的動作如果把它拿掉的話會發生什麼事呢?你看它會跳到一個新的連結那麼我如果加上Once同時取消它的預設行為的話會發生什麼事呢?我們點了一次之後你會發現這個事件處理器跳出來了然後我再點一次的時候你會發現它的預設行為還是產生了那從這邊就可以看得出來它的once 是spells 裡面的modifier這個once 的功能是事件處理器跑一次之後就會幫你自動這個卸載自動銷毀這個事件處理器然後銷毀之後呢因為prevent default就沒了嘛對不對所以這個alink又回到這個預設的行為也就是跳出一個新的連結好那除了這些modifier之外啊Spils還有其他modifier其他modifier有哪些呢?我會把這些modifier都放在簡報當中這邊就不一一做介紹再來Spils也提供了客製化事件的功能那這個客製化事件的功能呢由Spils裡面提供然後呢他的實現呢其實就是DispatchEvent還有CustomEvent的封裝好那我們就來看一下要怎麼使用吧假設今天我們想要讓假設今天我們想要讓這個假設我們有一個新的元件叫做Event然後呢這個Event當中有一個按鈕Click啊不要好了就什麼都沒有但是呢過了三秒鐘之後我想要讓他過了三秒鐘之後呢會發出一個Completed的事件然後讓我的app這個元件也可以監聽這個事件那實際上要怎麼做呢第一個當你呼叫CreateEvent Dispatcher的時候呢這個Svels會回傳一個Dispatch的方法然後 Dispatch第一個參數是事件的名稱那我想要它叫做Completed第二個則是它的參數那我想要它裡面放的是我們經過的時間假設是3秒鐘好了3秒鐘那麼這個的意思是說呢呃過了3秒鐘之後請送出一個completed的事件然後呢參數是elapsed time是3000好那我們來看一下App這邊要怎麼實作首先呢我們將Event這個元件引入進來那同時我們設定一個參數叫做Completed等於False好了然後呢我們一樣可以用on來監聽這個事件然後名字叫做Completed所以在這個事件觸發的時候呢我們想要讓Completed這個變數變成True然後呢如果Completed是True的話就顯示結束了這個字哦,等一下哦我這邊打錯了 dispatcher好,你可以發現說過了三秒鐘之後啊這邊出現一個結束的字樣所以我們可以知道說在三秒鐘之後這個Completed時間是有被觸發然後同時我們可以正確的監聽到這個事件的發生好那麼這個大概就是嗯客製化事件的用法那在後面就是在呃我們之後呢會講到怎麼用Sphilts來做出一些前端常見的UI互動等等那到那個時候呢我們會來講更多這個客製化事件的應用比如說你可能想要在searchinput 裡頭來觸發一個on search的事件然後給其他的元件做監聽等等那這個時候呢這個客製化事件可能就還蠻有用的對不對同時你也可以直接用這個on這個 directive 在元件或者是在原生的html tag當中使用好那麼以上呢就是failed事件綁定跟客製化事件設定的教學接下來我們來看一下await block語法的應用好的,接下來我們來講解一下spell當中的await block的語法這個語法是什麼?他又想解決什麼樣的問題呢?通常在前端的應用當中我們都會呼叫API嘛對不對那麼在呼叫API的時候啊我們可能想要做到以下幾件事情第一個在API還沒有載入完成的時候我們首先想要顯示載入中的畫面然後在API被載入完成之後呢我們想要把回傳的資料呢顯示到我們的畫面當中還有呼叫API如果呼叫失敗的話呢我們可能也想要把錯誤的訊息或者是提示訊息等等也渲染到我們的畫面當中那麼通常這些邏輯呢都會寫在程式碼裡對不對比如說錯誤處理的判斷還有Error的判斷等等然後呢我們可能再用其他的變數來告訴Fill或者是告訴React說資料已經被載入完成了然後讓React那邊觸發更新之後再把資料顯示出來不過在Spill當中他提供了一個語法叫做await來簡化這些操作實際上的使用方式看起來就會像紅色框框這邊這樣第一個我們在await語法後面呢會放一個promise這個promise如果他也在pending當中的話呢他會自動執行下面這個語法或者是component在這邊呢是會顯示loading然後三個點點的文字嘛對不對然後呢在promise被resolved的時候呢它會執行lan後面的fragment也就是response,顯示response這個資料然後呢在這個promise被rejected的時候呢呃會顯示error後面這邊的資料好那我們現在就來實境使用看看吧這邊呢我們就使用github的API來當作範例首先呢呃我先定一個promise那我們就直接用內建的thetch然後呢我們打GitHub的API好不過呢GitHub的API如果打太多次會被限制所以我們先不要一直call先把它註解起來不要一直呼叫好,那我們直接在這邊寫我們要的邏輯首先第一個如果API沒有載入完成的話呢我們就直接顯示Loading然後如果API載入完成了然後我們把他的Response的這個資料呢用Response這個變數來表達那首先我們可以顯示名稱Response.name還有什麼Response.bio還有照片Response.alphatar.url好然後呢如果有錯誤的話幫我把錯誤顯示出來最後呢用斜線和位置把它抱起來那它現在這邊說API is not defined 對不對那我們就把這個註解拿掉看一下會發生什麼事情欸 你會發現現在這邊都是 undefined undefined 對不對那我們來看一下發生什麼問題首先第一個這個fetch回傳的是一個promise 對不對不過呢它回傳會是一個叫做Response的promise所以呢我們這邊要再做一個操作就是我們要把Response用Json這個格式表達好那我們再跑一次試試看登登你可以發現這個我們的這個Svelts順利執行的這個以上程式所以你可以發現啊我們這邊只需要做簡單的這個API的呼叫然後把剩下的邏輯交給SvelteAwait的語法處理就可以了這樣子的寫法是不是直覺很多呢當然在一些比較複雜的場景當中這樣的語法不夠用不過呢對於很多這個比較簡單的應用啊這樣子的語法其實還蠻直覺的好那麼以上呢就是今天的這個Svelte的教學我們今天教了什麼呢?第一個我們教了這個事件的使用方式還有原件當中要怎麼監聽事件然後怎麼樣去自己定義我們要的事件還有我們教了這個await的使用方式好的 那麼明天呢我們會再繼續我們的speults教學今天就要這邊結束囉我是凱凱 我們下次再見拜拜字幕志愿者 杨茜茜