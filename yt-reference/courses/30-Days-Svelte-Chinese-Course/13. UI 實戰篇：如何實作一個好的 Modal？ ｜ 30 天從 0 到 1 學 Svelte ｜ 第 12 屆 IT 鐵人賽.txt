哈囉大家好,我是凱開歡迎收看凱開寫程式今天是ID鐵人賽的第13天今天的內容一樣是UI實戰篇我們今天要講的主題是如何盡可能的用Svelte來實作一個好的model首先我們先來看一下model是什麼這個是從Booxtrip的官方網站截取下來的圖片那你可以看到這邊有一個小視窗上面寫著model title那這個呢我們就把它叫做model或者是說對話框等等那通常你想要讓使用者看到某些提示的時候然後讓使用者焦點放在這個對話框的時候你就可以用這種方式那這個呢在前端的應用當中其實還蠻常看到的不過呢如果沒有把它做好的話呢其實它是一個非常不好的使用者體驗那我們來介紹一下Model應該要的功能有哪些第一個它可以開啟跟關閉像是我可以透過按按鈕啊或者是我去呼叫我API然後這個API回傳的資料我想要透過Model來開啟或者是關閉或者是呢或者是呢比如說你想挑一個訊息來警告或者是提示使用者的時候呢你也可以用model來做好那再來第二個model的功能是在畫面後我們通常會加入一個overlay那這個目的是為了讓使用者可以更專注的在我們現在的這個視窗裡頭像你看這邊這邊有一個灰灰的背景嘛對不對好再来呢我们可以使用关闭按钮ESC以及点击offer late来关闭视窗那其实这是这个很多前端工程师在实作model这个UI的时候蛮常忽略的就是他们通常都只会实作比如说我按下这个打XX的这个按钮之后就把model关掉但是呢其实使用者在使用上可能会透过按ESC或者是点击这个overlay点击后面这个灰灰的部分来关掉model所以当你没有去实作这些功能的时候可能使用者使用起来就没有這麼方便比如說我還要花這個很大的心力去移動我的滑鼠到這個小小的關閉按鈕就會顯得比較麻煩一些或者是對一些他們使用滑鼠可能比較沒有那麼順手的人來說可能他們都經常使用鍵盤那你如果沒有提供ESC的話等於是說你要他們怎麼去關閉你的model好 所以我們今天呢就會透過spells來實作這些東西喔好 最後一點是我們要把這個body的滾動來做一個鎖定讓這個body不會在滾動的時候呢 body也不會跟著一起滾動好 所以我們就現在就起來做做看吧首先我們先施作一個model的原件然後在這邊把它引入進來再來我們來這邊施作一下我們的樣式首先我會先有一個wrapper這個wrap的目的就是提供一個overlay所以我在這邊可以這樣寫第一個呢position我們給fixed因為我們想要把它鎖在整個畫面的中間然後width我們給100%跟height我們也給100%讓它佔滿整個視窗再來呢我們把定位全部都先寫成0好,之後呢我們給一個這個灰色的背景0.再黑一點這樣差不多好那這樣子我們就有一個這個overlay的部分了,然後我們在這裡寫我們要的modelmodelmodel好那我們這邊就隨便給一個寬度吧我們這邊的寬度給我們用這個%數來決定好了,55%然後呢因為我們要,比如說當它的寬度比較當這個視窗的寬度比較窄的時候我們就讓寬度是鎖死的狀態假設320px假設320px300px 好了好 這樣子ok然後呢高度的部分呢我們用vh來表示假設都會佔滿75的這個頁面的高度呃整個視窗的高度這邊可以用vh來做表示然後呢margin我們給然後上下都有距離嘛 對不對所以我們可以給一個 假設10%好了然後左右的話我們就給它Auto讓它可以放在中間然後我們再給一個Background Color是白色好 這樣我們就有一個小小的Model在這裡了再來呢 我們加一點Boulder Radius讓整個Model比較圓一點10px好 那我們再加一些box-shadow給它一點陰影假設3px10px感覺可以讓它再白一點這樣是不是看不太出來好像看不太出來如果我再把它變高一點呢有稍微看得出來一點沒關係我們這邊就不要花太多時間去調因為這不是我們今天的目的稍微看得出來就好好那這邊就有一個model了嘛對不對那我們這邊model裡面就可以加我們要的東西啦那因為我剛剛說嘛我们想要让其他的原件也可以去呼叫这个model所以呢我们这边先放一个title好了所以这边放classmodelhead头部的的部分頭部的部分我們就簡單做首先呢我想要放它的 titleh3假設我可以透過 title 傳過來所以我們這邊寫一個 title 的屬性然後 model title這邊發現一個小問題就是我們沒有 padding所以我們加入一些padding讓它看起來有個空白比較好看一點感覺這邊太大了所以我們把title的部分的margin給拿掉好了好這樣感覺上下的部分可以把padding再拉高一點所以我們這邊給25好了然後15px上下是25然後左右是15這樣看起來應該還算不錯還算不錯還算不錯好那我們接下來要做的事情是我們想要加入一個關閉的按鈕關閉關閉X這樣子很醜嘛對不對所以我們可以在這邊搜尋html closeHTML Code這邊我們可以用這個不知道找不找得到HTML Code好,所以我們把HTML Code放上來,這邊就有一個XX好,然後我們把Button的預設樣式颜色样式给拿掉appearancenone然后boulder0再来我们把background-coder也拿掉背景背景-coder背景-coder-transparent背景-coder-transparent然后padding也拿掉padding不要拿掉好了margin我们拿掉好然後呢我想要讓我的這個XX是在右邊然後我的model title在左邊

所以我們可以用flags來做排版所以我們這邊給一個model-head的class然後display我們給flags然後justify-contents我們給space-between它就會分兩邊然後align-items我們給center讓它可以放在中間好好 這樣子感覺起來是可以然后这边也可以按嘛对不对好然后我们这边之后呢加一个type button好这样子头部的部分就好了那这个内容的部分呢我想要让整个model是可以客制化的所以这边内容的部分呢我想要开一个slot我们在之前有讲过可以透过slotslotslot的方式呢用slot來做客製化的內容description這邊的間距有點小所以我們這邊加一點間距margin-portent 20px我不想要它的高度都是這麼高所以我想要修改一下再給 max-height就是最高我就到這個高度所以為了怕它做overflow所以我們要再做一個overflow-y 等於 auto好這樣子我們的model的外型就做好了再來我想要做的一個功能是簡報當中有提到我們要有這個overlay然後將body的滾動做鎖定,所以呢你可能會想要這樣寫我們來確定一下好了我們之前有講過嘛,svelte你可以使用sveltebody來操控但是我不確定它可不可以直接這樣寫就是他的class name是不是可以直接用所以我们来确认一下preference scrollpreference scroll要做的動作是什麼呢我們把overflow y都做hidden然後什麼時候要去做呢欸等一下喔我們不要這樣寫好了這樣寫比較方便preference scroll等於 isOpen如果現在的model是開啟的狀態的話我就讓我的body可以去加入這個class然後加入這個class的效果是它會沒辦法去做scroll好,那假設我們這邊就直接先寫死因為我們要來測試一下是不是可以動isOpen等於true我們來確定看看我們是不是可以在svelte body 裡面加上 class那如果不行的話我們就要用別的方法那從這邊可以看到應該是沒有辦法直接加svelte應該不能直接用 svelte body來做這個綁定所以呢我們要用另外一個方式那另外一個方式是什麼呢在amount這邊去做那不行的為什麼剛剛那個方式不行是因為這個svelte的body應該是沒有支援class這個選項對他應該是只有就是讓你綁定檢定器跟一些這個屬性而已吧我在猜好那我們再回到這邊我們就直接透過amount來做那透過amount要怎麼做呢amount然後這邊放一個function那這個function要做的事情是如果不能用amount對不對因為你不想要它只做一次而已而是在哪一次open改變的時候去做所以呢我們要做的事情是用前號那這邊方便寫 所以我們把它用關號包起來如果 isOpen 是 true 的話呢我們要做的事情是 document.body.classlist.addprefamscore然後呢如果沒有的話呢就拿掉remove好那現在這樣你可以看到哇我們重新整理一次好了好你可以看到它現在這邊就出現了prefamscore不過呢 這不是我想要的嘛因為我們之前有講過svelte是會幫你把class name去做一次這個重新hash過後所以呢 我們可以用global把它包起來來告訴svelte說請你幫我把它變成global的然後我們這邊改成pre-ban score這樣子這樣子你可以發現我的class name的確有順利註冊到這裡來了好,那我們的body應該就是沒辦法滾動的狀態假設我先把body變成1000px你可以發現它是沒辦法滾動的如果拿掉的話呢,它現在是可以滾動的所以我們的確去防止了這個scroll 滾動的狀態好,那我們把這個測試的程式碼拿回來這樣子我們就完成了一個基本的model那接下來我們想要做的事情是我想要透過在其他原件去使用這個model並且呢,我可以透過slots的功能來自行決定我想要的內容是什麼那我們就來試做看看吧那在這邊呢我們透過store來做因為我們想要讓整個model的狀態呢是被其他的元件所共享的好那我們就開始吧model.js那一樣我們用我們的writablefrom spell storeok我们可以把它Explore出来Writeable在Writeable这边我们想要决定一下我们的Model的Store想要用哪一些东西第一个是它现在的状态是什么比如說現在是close還是open我們假設剛開始都是close剛開始應該是不會把model打開這邊會有open跟close這兩個狀態再來呢我們可能想要用name或者是title來決定這邊的title是什麼好 再來呢 我可能想要透過這個componentcomponent 我們等一下會講到就是我在這邊呢想要做的事情是說我可以讓我的model在其他原件裡頭去引入另外的model原件 然後來決定我的model的內容是什麼那在這邊可能講得比較抽象一點所以我們等一下實作的時候應該就會比較清楚然後呢 以防萬一我們加一個Premierence就是可以傳入一些客製化的參數好那 大概就是這樣然後我們這邊呢 再寫一些好動的方法第一個是open 那open的話就是第一個是title 第二個我們傳Premierence最後一個我們傳component然後呢要做的事情是把model去setstatus變成open然後呢title變成titlecomponent變成component然後permins反正就是把它塞進來就對了好然後我這邊再加入一個另外一個方法是close那一樣model.setsense等於closed我們這邊只能用update好了沒關係我們還是用settitle是nullcomponent也是nullpermins也是null好這樣子我們就有我們想要的方法再來呢我們在app這邊我們這邊model就不要直接載入進來我們就是去判斷說他現在的狀態是什麼來決定我們要不要把他載入進來model.js

這邊的js你可以省略好然後呢如果它現在是打開的狀態記得要加前號因為它是一個store如果它的狀態是open的話我們就顯示model所以現在沒有顯示了對不對然後呢我在這邊可能想要傳入的方法會有什麼第一個是title所以我們就把title傳進來model.title再來還有什麼沒了就先這樣子ok然後呢我在這邊可以放我要的客製化的component對不對我們一樣加一個if判斷如果有component的話呢這一個我們就用這個svelte component來把這個原件載入進來好,不知道大家還記不記得我們之前是沒有直接寫程式碼範例所以呢,我們來這邊介紹一下在svelte裡頭的內建element當中你可以用svelte component來動態的去載入一個component好然後呢它使用方式像這樣子OK所以呢list等於model.component那在這邊其實我們也可以不用特別去做判斷式啦因為這個svelte呢這個原件它會自己去判斷說這裡面是不是Node然後呢我們再把如果有參數的話我們把所有的參數給傳進來方便做使用好的接下來呢我們再做一個呃元件好了叫Toggle對不起我現在想不到什麼好的名稱在Toggle我想要做的事情是我去放幾個按鈕按鈕放幾個按鈕欸open好 先這樣 Open然後呢 同時我想要把model不用把model 因為我們有10做一個兩個方法 open 跟 close 所以我們在這邊呼叫open好了 open我們要做的事情是把它打開來click等於open然後呢 title我想要叫這個你好嗯像一個好title 您現在正在進行一個危險的動作然後premiers呢就先不用然後呢,在這邊我可以去實作我想要的model的架構是什麼好,所以呢我在這邊可以把一個,這個引入進來hello,好,假設我們就先這樣寫就好然後一樣我把這個component給引入進來然後第三個參數是傳component對不對所以可以這樣寫好這樣子就寫好了然後我們在這邊欸我們在這邊去引入toggle這樣就有一個open了我們預期按下去會發生什麼事呢我們預期按下去之後它會去呼叫open這個方法然後open這個方法會到model這裡去把這個狀態的status改成open然後呢app這邊發現它是open的時候它就會把model給打開來所以我們就來試試看好 所以的確成功了您現在正在進行一個危險的動作然後Hello this is dangerous operation所以透過這種方式呢第一個你可以自己去宣告一個原件然後去客製化你的model裡頭要的內容那當然裡頭的內容可能有時候常常是重複的所以你可能會想要這個透過比如說Warning假設好了你可能會想要去透過屬性來改變它的值等等類似這種事那這個時候呢因為我們在實作model的時候我在這邊已經有把這個他的appearance給傳進去所以你可以直接這樣寫在這邊,我們第二個參數是appearance所以假設你想要傳warning好,我們這邊就簡單寫一個那這個warning呢他就會被傳到所以我們來測試看看是不是真的會這樣子所以你可以發現這樣子是可以動作的,然後我們可以盡量就是讓這個Mode是比較客製化的然後我們提供一個類似有點像是骨架的感覺好,再來我們想要使用一些東西第一個是,你看現在按下去是沒有用的所以我們想要這個按下去呢它是可以去關閉我們的model的好,所以我們這邊把close這個方法引入進來在這邊按click等於close這樣子好,這樣子它就關閉了OK好,再來我們剛剛有再提到幾個功能第一個是我在按這邊的時候我在按這邊的時候也要關閉了對不對所以你可以這樣子寫click在這邊的時候也要做關閉的動作close不過呢在這邊你可能要注意一點是說因為我們現在model會寫在這個ropper裡面對不對所以就算你按這裡它也會關掉了這顯然不是我們要的行為對不對所以我們要做的一件事情是我們要去判斷如果1.target等於1.current target我们才去关掉那这个意思是什么呢这个意思是说当我点下去的时候我的target跟我的现在的target是一样的时候也就是modelwrapper的时候我才去关掉但是我在点这里的时候我们不要关掉好所以现在這樣子就可以達到這個效果了對不對OK好的這樣子我們就實作了一個簡單的model然後呢要怎麼去呼叫它呢你只要從store裡面呢去呼叫這個open的方法你就可以把一個model打開OK而且呢這個model的控制呢可以共享在其他的原件當中你也可以自己去實作一個原件來去客製化的決定你要的model是什麼那當然model的設計其實常常會因為可能場景的不同或者是產品的需求不同可能會有一些不同的用途或者是不同的用法等等那在這邊呢就是展示一個比較通用的架構給大家看一下好那再來我們這個關閉的功能還少一件事嘛對不對現在我按了esc可是沒有動作那很正常因為我們沒有去試做它所以我們在這邊把這個ESC的功能給加進來我們在amount的時候去監聽一個function叫做handleKeyDown好了這個handleKeyDown要做什麼事情呢當我的這個keycode等於27那27就是ESC嘛的時候呢請你幫我呼叫close就這樣在這邊我們就document.addEventListenerkeydown按sc你可以發現它真的關掉了但我們也要記得把它拿掉把它拿掉remove event listenerkey down然後handdokey down這樣子記得要把事件監聽器給銷毀當這個原件被拿掉的時候好這樣一來我們就做了一個

這個通用的欸 等一下喔removeEventListener好 OK這樣我們就做了一個還算不錯的model至少我們把這個使用者體驗盡量讓他變得好一點好 接下來我們要做一件事情是現在看起來這個model感覺好像就是它就是直接冒出來了對不對那我想要做一點有些變化做一點transition所以呢這時候就是我們的svelte裡頭的transition就可以派上用場啦那這邊最好用的當然就是用fade也就是漸入漸出的效果所以我們來試試看在wrapper這邊呢我們就用一個transition然後fade好然後按下去欸哇 整個質感就變得還不錯嘛對不對好那可能我想要連model也做一點效果好了那假設我們model這邊呢我們就做一個scale那一樣這邊transition給scale然後呢我們讓讓他有一點delay就是當我的overlay還在做fading的時候我們先不要去做動畫而是Delay一下下再去做動畫所以我們Delay 150Duration我們也設短一點150好了好 看一下會是什麼效果好像有點快那我們250好了250好像OK300好像也可以300差不多好 這樣子呢我們就實作了一個這個比較生動活潑的model了或者model當然如果你想要再做更精緻一點你可以把這邊也變成一個參數然後讓可能讓這個使用者在呼叫的時候可以根據不同的需求來做不同的transition但我們這邊呢就只介紹這個固定的transition好的接下來呢我們要來做更進階的功能我們這邊已經實作完了透過Store來管理model還有傳遞參數來讓其他的元件來呼叫Model好再我想要做的一個功能是更貼心的Model第一個呢就是我們只想要控制焦點在Model的內部當中這是什麼意思呢你看喔我這邊把Button加多一點好了這樣大家看得比較清楚你看喔 你看喔嗯假設我這邊有五個按鈕好了然後我把modo打開然後我按tab我現在在按tab你可以發現 有沒有看到 這邊我的焦點竟然跑到後面去了那 這通常會有很多人這通常不會是你想要的事情因為當你在model打開的時候你可能只想要讓使用者的焦點只專注在這個model當中你不想要讓整個焦點給跑出去所以在這邊我們就要做一個另外的處理好的那一樣我們要handle keydown我們在這邊要做幾件事情第一個我們要先去把這個記起來就是現在的焦點在哪裡然後我們想要把它記起來記起來之後呢當user使用者關閉model之後呢它可以回到這個焦點上好 所以我們這邊呢要做一件事情是我們在store加入好了store叫做firstfirst假設我們叫做first focus element好了然後nord然后呢在呼叫这个open这个方法的时候呢我们希望去first focus element我们希望做的事情是把它记录下来这样子把现在的这个焦点元素给记下来那再来我们在这边就可以使用它在model这边我们把model的store引入进来然后呢第一个我们呼叫close之后呢我们要去做的事情是model.focusfirstfocuselement.focus我們這邊要做的事情是當我的model關閉的時候我要把這個焦點控制控制放回來ok好那這個等一下實作完之後應該會變比較清楚一點再來呢我們想要做的事情是keycode tab忘記keycode tab是什麼是9所以如果1.keycode等於9的話也就是user按下tab的時候我們想要做一點不同的操作我們在這邊想要把model裡頭可以控制焦點的元素全部給抓下來那為了做到這件事情我想要我想要讓model我想要得到model這個元素,所以我們用buy list然後model不要不要,model element好了因為model有同名的,所以這樣子model element然後在這邊我們去做curry selector這邊我寫的會寫的比較寬鬆一點就是實際的東西要請大家去實際去找比較正統一點的寫法我這邊在做的事情是我們去把全部可以被focus的元素給抓下來那什麼東西可以被focus呢?第一個是超連結可以被focus再來input,沒有被disable過的input可以抓下來然後button也是一樣沒有被disable的button也可以抓下來然後area也可以focus然後還有什麼呢還有textarea也是一樣沒有被disable的再來還有客製化的tabtab index等於0也可以被抓下來好然後在這邊我們去找first就是第一個會被找到的是什麼那第一個就會是ofocusable有點長我們先抓下來等0第一個嘛對不對那我這邊順便把長度記下來Lang然後呢 last 就會是Lang-1 好那在這邊我想要做一個操作就是說當我按下tab然後呢使用者又剛好在last的話呢我們就直接把他跳到第一個所以呢我們這邊要做的事情是我們就不要做预设的行为了我们要做的事情是我们再先做一个判断如果使用者document.activeElements等于last的话呢就取消预设的行为同时呢我们让first打focus好那假设假设else if不要好了直接再加一个if判断式假设今天shift有被按下的话我們應該要先判斷shift有沒有被按下才對然後如果沒有被按下的話再做tab在這邊的時候我們還不知道user是按tab還是shift tab所以在這邊的時候是shift然後加tab然後在這邊的時候才是tab所以這邊一樣照抄如果activeElement等於first的話呢我們就跳到最後一個last好這樣子就完成了ok接下來呢我們在這邊在amount的時候我們想要做一件事情我們要做的事情是我們想要讓這一個allFocusElements.length的第一個元素可以被抓到不過呢

在這邊就先不要做好了先看一下效果是怎樣我們把button加一些特效好了不然現在大家看不出來首先如果被focus的話我們這邊加一個outline這樣子好那現在這邊只有一個可以被這個焦點的元素所以我們這邊再加多一點元素好了到content這邊然後我們這邊再加兩個button好了3然後4好好,在這邊你有沒有發現我的tab不管怎麼按它都只會圍繞在model當中它不會跳到後面然後呢,當我關閉的時候欸我們這邊要做一件事情是當我關閉的時候我想要把這個First Focus Element給抓起來但是好像沒有做到看一下喔欸有有有有有有你看喔,當我Focus在這裡然後我按ESC的時候呢它的焦點會再跳回來好,那這個就是一個比較細緻一點的操作所以看起來會比較複雜一點不過如果你有把這些功能都實作出來的話我相信使用者應該會蠻感謝你的至少就我自己而言好,再來我們要做的一件事情是加入Accessibility的支援這個是什麼呢?在使用者在我们使用网页的时候我们并不能假设使用者都是四肢健全然后头好壮壮然后也身体良好等等那么这个时候呢我们就想要不止我们以用眼睛看,我們可以用手操作我們也可以用鍵盤或者是用Screen Reader等等的技術來讓使用者去瀏覽網頁這時候,我們就可以做一些比較貼心的操作首先,第一個在model wrapper這邊我們先把indextype index拿掉再來呢,我們在這邊加入一個 rule 等於 dialog當 user 進入到這個元素的時候ScreenReader 就會提示使用者說你現在打開的是一個對話框再來呢,我們想要做的一件事情是在這邊, rule 等於 document來宣告這是另外一個小小的文件所以當使用者進入這個元素的時候他也會唸出來再來我們要加入一個小小的東西小小的功能是說aria-level-by等於這邊的title那這個意思是說當使用者進入到這個元素的時候他會把這個model的title給唸出來這樣user就可以比較清楚的知道說這個對話框是為了什麼目的而存在的好那labelBy這邊我們要加入一個id那為了避免這個id的衝突我們這邊就簡單做一個uuid的小函數那這個uuid非常的實作非常的簡單所以能不能真的使用我是有點擔心啦不過實作的話大概會長這樣子id加等於1然後return uuidid這樣子就是一個非常簡單的實作好 然後在model這邊我們把它引入進來我們要記得把這個function給export出去欸有有有 有export出來所以我們在這邊 uuid 等於 uuid然後在這邊我們就可以呼叫這個我們這邊就宣告一個常數 uuidtitle id 等於 uuid好這邊呢就可以title idtitle id這樣子一來當你的model打開然後使用者進入到這個元素的時候呢他就會唸出類似像是比如說現在打開叫做您現在正在進行一個危險的動作對話框你的screen reader就會幫你唸出類似這樣的文字好還能做什麼呢?我們這邊有一個aria-model的標籤我們就把它給true還有這邊的button你看喔,這個文字其實screenreader是念不出來的所以比較好的做法是你可以在這邊用span把它包起來之後呢我們放一個aria-hidden来跟这个screen reader说这边的东西你就不要念了因为使用者LRA hidden等于true然后在这边我们再加入一个LRA label等于关闭视窗好这样子一来呢使用者进入到这个页面进入到这个进入到这个对话框之后呢他就可以去知道說我現在要做什麼動作好 那我們實際打開我們的設定看一下那在這邊我們現在目前是用英文的版本所以他現在唸出來應該都會是英文的不過沒關係這邊就讓大家看一下大概效果O果我先把聲音關小聲一點而且有點慢我們現在把Open打開來有沒有看到您現在正在進行一個危險的動作Dialog那如果它現在是中文的話它會跟你說您現在正在進行一個危險的動作然後對話框之類的好然後呢當我控制我的這個按下Tab的時候我們的焦點改變了對不對然後它現在就變成您現在正在進行一個危險的動作Dialog關閉視窗Button也就是它會唸出我這邊的Aria Label的文字好然後我們就關閉好所以這就是一個Model我們可以做到的東西那其實仔細看下來還蠻多的嘛對不對所以從這邊你就可以知道說欸透过Svelte我们可以怎么样的去简化我们可以怎样的去实作我们要的UI的功能然后呢你看哦就算只是一个简单的model我们还是有很多的细节是可以考虑的而且其实要再讲更多的话还是可以再讲更多不过呢篇幅的关系我们就把这个时间留在这边吧对那么以上呢就是如何实作如何透過Svelte來實作一個好還不錯的model那麼這個連結呢等下我也會放在田仁賽的文章當中所以如果有興趣的話呢大家也可以來參考看看好的那麼以上的內容呢就到這裡結束囉我是凱凱我們下次再見掰掰