哈囉 大家好 我是凱凱歡迎收看凱凱寫程式今天是IT鐵人賽的第六天昨天我們講了一個比較輕鬆的主題生命週期方法今天我們會講一個比較複雜一點的主題也就是SPELTS裡面當中的CONTEXT以及STORE這兩個概念所以今天的目標就是帶大家一起認識SPELTS當中的STOREStore 還有 Context這兩個不同還有他們的用法那麼Store 是什麼呢?在前端的應用當中有時候我們會想要有一個統一的地方來保存我們的資料,像是在Rea當中我們可以透過 Redux來保存資料然後呢讓這些資料可以在不同的元件當中共用然後有關於比如說資料更新的邏輯啊或者是資料更新之後我的原件也要做一些對應的更新像這些東西比較複雜的時鐘都可以包在這個框架裡面幫我們完成所以呢這個spills當中的store也是類似的概念好那麼什麼時候會用到store呢第一個資料經常更動的時候而且這個更動可能會需要跨組件之間溝通比如说今天我有一个to do的资料,我可能在A原件会想要用到,然后可能在C原件也想要用到,或者是我有一个使用者资料,我想要在,我可能会在B页面用到,C页面用到,或者是在很多很多其他的页面当中都会用到,那这样的资料就可以把它放在store,然后呢,或者是你的store里面,可能有一些资料的处理,会掺杂很多业务逻辑,那你想要把这些的业务逻辑呢额外拆开来在其他地方实作尽量的让原件呢越单纯越好尽量让他只去负责管理这个UI层面上的实作等等如果你想要这样做的时候呢store也是一个很好的方式来拆分你的逻辑那我们等一下会看到就是spill当中的store你不一定要在原件当中才能使用你可以在原件之外也可以使用store好再来最后一个搭配svelte 一個特殊的語法我們也可以透過其他Library比如說最有名的像是 Rxjs來達到 Realtic 的效果這個我們等一下會談到那最後一點可能跟 Store 比較沒有關係不過在這邊跟大家一起提一下好 那麼 Store 有三個API它的功能依照功能可以分成Readable,Writeable,Derive首先最常使用的应该就是WriteableWriteable会提供两个方法一个是Update,一个是Set基本上它的差别就只是在于说Set的话你可以不看之前的Value或者是不看之前的value或者是不看上一個value是什麼而直接傳第一個值進來然後update呢則是提供一個方式比如說我可能想要先看一下上一個值是什麼然後再依照這個上一個值來決定我下一個值要回傳什麼那這個時候呢你就可以用update所以你可以看到這兩個不同就是update裡面的参数呢,Uptel会接受一个函数那这个函数的签名是它会帮你传入一个current value进来然后你可以根据这个current value做操作之后呢再回传一个新的value或者是呢,你可以直接用set就是,我就是要把它只改成一个常数等等我不去看前面的value是什么你就可以直接这样写再来,另外一个是readable那么readable呢,就是它只能从内部来修改Store资料比如说像是聊天室的应用每一次呢假设我在Subscribe的时候呢我去监听这个Chat API然后呢每次有新的聊天进来的话呢我就把它加到我们的List里面那这个时候可能你通常不会额外的去做什么删除或者是你去修改里头当中的资料等等我們都是從API單方面的接收資料那這個時候你可能就不會想要提供update或者是set方法給外部的使用者使用不過大部分狀況大部分的情況下還是會用Writeable居多因為畢竟比較方便再來還有一個比較特別的叫做Derive它可以接收一個到多個的Store也就是我們剛剛看到的什麼Writeable或者是Readable甚至你要用Derive Store然後再接一個Derive也可以那它的作用就是呢它可以幫這個不同來自不同的Store的值做加工比如說今天我有兩個Store一個Store值可能是所有列表然後另外一個Store值是我選中的ID比如說我有一個喜愛列表好了那我可能要從一坨的列表當中只選一個固定的列表當作我的喜好清單那這時候你可能會有兩個Store第一個是全部列表的Store第二個是我喜愛列表的Store的ID那这时候你就可以用这两个做类似selector搭配比如说我只想要从我selected ID当中去选出我的喜爱列表是什么那这个时候呢可能你就可以用derive这个方式来实作好在svelte当中他们所有的store都有subscribe的方法然后呢subscribe呼叫之后呢它會回傳一個unsubscribe的函數好那麼spell當中提供一個比較特別的語法就是你可以在變數的前面加上一個前號來代表說 這是一個可以訂閱的變數 那剛剛我們有提到嗎Store裡面有提供subscribe的語法所以你可以直接這樣寫那左邊這張圖呢是正常svelte前号的用法那它的作用大约等于右边这张图也就是呢它会帮你在svelte原件unmount的时候呢去监听这个变数然后呢在这个原件要被销毁的时候呢去unsubscribe这个store所以呢透过这个左边前号这个语法你可以省掉一些程式码的实作那写起来也比较直觉一点那我们刚刚有提到既然是Felds的前号的作用是帮你做一些subscribe跟unsubscribe的处理这也表示说你可以直接用这个符合这个界面的方式整合到spells里面那是什么意思呢比如说在RXJS当中我们有observable那么observable也提供了这个subscribe跟unsubscribe的语法所以呢我们也可以透过前号來整合RxJS直接到我們的spell當中好 那我們接下來就直接來寫一些程式嘛 看看吧首先呢想要跟大家提到一個概念是這個writable好 我們先把等一下我們先把這個重新整理一下Writeable from Svelte然後Store好然後假設我一個Countdown好了Writeable 10然後我們把它印出來你可以發現這個Store裡面它有一個subscribe的function還有set跟update所以跟我們剛剛講的一樣好 那麼我如果直接這樣寫會發生什麼事呢你會發現它回傳的資料是object那這是正常的嘛 因為它就是一個object所以可以透過這個在前面加上一個前號的方式直接拿到這裡面的值再來你也可以直接比如說你可能想要試試看subscribe我們來看看這個裡面的值會不會是10你會發現這邊的確是10好再來我們看一下readablereadable10然後我們一樣

透過console.log把它印出來看看你會發現它沒有update跟set這兩個語法它只有subscribe這個方法而已好 那麼使用的方式也一樣countdown 它這邊也會顯示10好 再來我們來介紹一下derive這個語法那derive呢我们刚刚有提到它可以接收来自一个或是多个store然后帮你做整合之后然后再回传一个新的值好那假设我这边有一个list然后假设我有三个task第一个叫do homework然后sleep还有然後做什麼呢?Programming寫程式然後呢這邊做一個ID list我們這邊用沒關係我們這邊就先用readable然後ids我們這邊用writable假设我选择了第一个跟第二个ToDoList好那这个时候呢我只想要列印出我选到的的列表的话我要怎么做呢你可以用derive这个方式那首先呢它可以接受一个array接受一个阵列然後我們把這兩個當作參數傳進去之後呢我們透過呼叫set的方式那要怎麼set呢我們要set的是list.filter然后呢我们只想要去选择说在这个ID里面有存在的列表所以我们这邊呢include i這樣子呢就完成了這個list選擇所以等一下印出來的應該只會有0跟1跟2嘛所以就是sleep跟program那我們實際來試試看好那這邊我還沒有給他名稱然後我們叫做selected list然後呢用前號 因為它也是store所以我們用前號表達select list它說readable is not defined所以你會發現這邊印出來之後它會是sleep跟programming也就是說我選擇的ID是1跟2也就是index1跟2那假設我選1跟0呢它就会变成do homework跟sleep或者是我只选一个那就是一的话那就是sleep所以你可以透过这种方式来组合各种就是不同的store然后来变出你想要的字好那这些东西呢就是store呢它可以被写在spell原件的外面好那我们实际来试试看大家还记得我们之前写的这个倒数计时的程式码吗没错它今天在这里还存着还好好那我们为了证明这件事情我们就先看看假设我在这边引入了一个Writeable然后呢Countdown等于Writeable我們來確認一下第一 countdown是不是真的有值第二 我們用countdown.subscribe是不是真的有效果還沒有runapp 所以我們先把它拋起來喔 這個是之前的實作嘛好 那我們來看一下你會發現沒錯它的確有印出來然後也有準確的subscribe那假設呢我把這個store這邊我們先繼續留著然後我把store放在一個另外一個檔案然後把它export出去然後在這邊我們直接去引用countdown同時呢 我們想要確認說在原件當中是不是也有做到同樣的事情好 假設我在app當中哇這邊有同名所以我們把它取另外一個名字叫C好了然後呢一樣我們在這個原件當中呢透過前號把它印出來這樣子試試看看会不会成功好那这边我做的事情是第一个我把store拆到另外一个档案所以比如说你可能要在这边写很多你的业务逻辑的话呢你就可以直接放在这个档案里面写那这边呢都不会碰到任何关于svelte的元件那么svelte的元件呢只会去读取这个值而已他不管业务逻辑是什么他只会读取这个值然后并且在适当的时间呢去更新它去订阅它或者是在原件被銷毀的時候去unsubscribe它好,那我們來看一下沒錯,你看這邊,這邊的確有一個10在這裡嘛,對不對好,然後我們再做一件我們再做另外一件事情是我在 main.js 裡面我去 set timeout然後 set timeout 裡面做什麼事呢我去偷改它的值假設變成 5 好來觀察說是不是真的我可以把Store放在其他地方然後呢我如果在外面去操控Store的話Store操控Store的話Spelt的原件是不是會如期更新呢我們來看一下你會發現喔它的確更新了在過了三秒鐘之後我把CountdownStore值變成5然後這個5呢我們在這邊設定之後這個Store的確去觸發了Fields原件裡頭的更新好,所以從這邊你就可以發現你可以把你想要的業務邏輯放在另外一個檔案當中然後你可以在Svelte原件外面裡頭也好 裡面也好去更新你的Store來觸發更新那我們當然在之後的教學當中就是詩作片當中我們會講更多有關於Store的應用 所以到時候還請大家期待一下好 那把東西拿一拿都拿掉都拿掉好那么假设我今天想要做一件比较疯狂也不是比较疯狂就是给大家看一下这个实际上的应用虽然会变得有点复杂假设呢我想要让我的倒数计时的版本的这个我们原本是实桌在原件当中我们想要让整个实桌是搬到store里面所以呢不管是谁大家都可以去存取到現在的Countdown是什麼當然了這根據使用情形有時候你可能不想要這麼做那今天我們就是這個突發奇想一下好那我不想要讓外面的人存取它嗯不要好了還是讓外面的存取好了那假設一開始我們都設為0然後呢我們用一個setCountdown的方法然後這個方法是給外部的原件使用的這個方法被呼叫的時候他會去直接setvalue好然後再來我想要宣告一個derive store那他會做什麼事情呢countdown叫countdown timer他會負責去接收Countdown的值然後呢我在Countdown裡頭

加value好了我在countdown里头我在countdown里头呢我就直接在这边做计时所以我先宣告一个timer然后timer等于setInterval我要做的事情是什么呢每次都把value-1然后setValue但是呢因为现在判断都是全部在这里面做所以我们要去观察说如果它如果小于0的话小于等于0的话就不要再计数了clear interval好然后每一秒更新一次然后你可以回传一个函数是说在这个没有人去订阅他的时候我就不要去做里面的事情了好这样子也就是说当这个没有人在订阅他之后呢spills会帮你跑这一个function好那这样应该就可以了吧好那我们把countdown这边全部都刪掉全部都刪掉對 全部都刪掉刪掉那我們只留什麼呢?我們只留count我們只留countdown然後我要引入的是countdown timer還有set countdown然後我在amount的時候在amount的時候呢要做什麼事情我在amount的時候呢要去set countdown然後我們原本是從外面傳props進來嘛那我們這邊就不要這麼搞綱了就直接傳一個30秒進來好 然後呢因为countdown这边的这个timer它回传的是我们是用derive store实作嘛对不对所以它回传的也会是一个store既然它是一个store我們就可以直接用前號來存取它裡面的值好這樣應該就會完成了欸 有了有了有了大家可以看到欸 可是你發現它為什麼第一次是undefined嗯 好問題好問題在derive当中啊如果你没有给它初始值的话那它的初始值就是undefined所以我们在这边要给它一个初始值假设给0好了可是这样好像也怪怪的嘛对不对所以呢假设我就直接在这边去setvalueset什么value啊set現在的value然後呢 再讓他開始做計時這樣子會不會比較好 對這樣子你可以發現他這邊就變成30了然後慢慢的數到0好 有點久 請大家稍等一下好 那我們等一下呢 要做另外一件事情就是欸這個store是不是真的可以跟其他軟件一起共用OK 成功了你可以發現它到0之後的確沒有在數了好 然後我再做一個其實也不用再做一個軟件了欸Second Countdown我在這邊打一個Second Countdown好了Second Countdown好,那我在這邊呢也去inu storeCountdownCountdownTimer對吧,應該叫Countdown Timer如果沒有記錯的話對,好,那一樣我們這邊要用前號來看一下 有了所以你可以發現它們兩個的確是共用同一個值 沒錯好 那這邊我們就不等它跑完了好 那假設說我countdown倒數計數到一半想要再讓它重數的話呢是不是可以做到類似的事情假設我們在這裡做一件事情好了setTimeout然後呢 過了兩秒鐘之後呢我想要重新設定我的countdown我不要數30秒 我要從10秒開始數看一下會不會成功好 回來喔 你可以發現它變成10秒了好所以呢嗯这个大致上呢就是在spell当中store的用法你可以发现它的用途其实还蛮方便的而且使用起来然后再搭配这个前号其实使用起来的感觉还蛮直觉的啦我自己觉得比起这个在re-ed当中re-dux的实作或者是use context的实作比起来的确是直觉很多嗯不知道大家有什么看法呢所以如果你有如果你有任何想法的话都欢迎在这个YouTube或者是铁人赛下面的留言好 接下来呢刚刚我们有提到嘛使用前号不一定要搭配spell当中的store这是什么意思呢只要你有类似只要你符合他们的方法也就是你有符合subscribe跟unsubscribe的话呢你就可以使用所以我們就來試試看如果用Rxjs會發生什麼事from 然後我這裡已經裝好了應該裝好了吧 還是我沒有裝有有有有 有裝有裝有裝然後呢 假設我就叫它observable好了from 0所以它會回傳一個observable然後呢這個Observable會有一個subscribe的方法然後呢我如果直接這樣寫我們來看一下會不會有用呃 不要好了叫有意義的文字好了欸好囉好 你可以发现This is from RxJS所以呢的确就算你不用store你也可以直接用这种方式来呼叫他们的你也可以直接用这种方式来显示Observable裡面的值所以如果你有一些比较复杂的API操作啊你就可以搭配这个rxjs然后呢再搭配svelte来做到你想要做的事情好接下来呢我们讲完了Store然後還有Spills當中的前號現在我們來講一下Context好,Context比較特別第一個,Context它不是Relative然後再來是Context呢還有一個是GATSGATS跟前套的語法有點像它會提供一個語法堂說我可以直接幫你把Store裡面的紙抽出來接下來我們來講一下什麼時候用Context第一个在你的资料很少变动或者是几乎不会变动的时候你可以用context比如说使用者资料或者是thing主题类的东西比如说你可能要从原本的明亮主题变成黑暗主题等等然后呢第二个是跨元件沟通的时候可能会需要用到比如说呢假设你现在正在做播放器然后你想要把这个播放器里面的资料给其他原件做使用但是你不会想要给全部的原件使用你可能只想要给相关的child子原件使用的时候你也可以用context来做那么context它只会作用在sphered原件当中而且它只会对应sphered里面的原件数也就是说sphered只会去找离原件最近的context好那我們就來看看吧首先你要實作context的話你可以這樣子set context from svelte

假設我有一個user叫setcontext然後這邊他會要求你設定一個key那可能有時候你會想要用uid的方式來避免衝突那我們這邊就直接寫死這個key的值假設name叫做我的名字叫kele然後age 20好然後呢你可能訓練一個profile當然啦 這個情況下你可能會說 那我不就直接傳傳進去不就好了像這樣子我就直接傳進去不就好了那這邊為了做示範所以我們就直接這樣寫喔然後這邊叫profile然后你要拿context的话你就用getcontext然后呢user.getcontext然后一样这边定义比如说你在这边用user所以你这边也要用一样的key就叫user然后呢我们就把man印出来然後把 edge 印出來好欸你們發現說 profile is not defined沒關係我們就把引入進來剛剛我哪邊沒有打好That's failedSorry副黨員問神樂好所以你可以發現從這邊呢可以順利的拿到calend跟20儘管我沒有直接傳屬性進去好好那麼這大概就是這個context的用法詳細的部分你可以參考這邊的簡報或者是你也可以直接到官方網站搜尋這個相關的API操作等等好那麼今天的內容比較豐富比較雜亂一點所以希望大家看完這部影片之外呢也可以自己去練習一遍在官方網站都有這個很好用的線上版的使用方式所以我相信應該是很簡單就可以上手的好那麼明天呢我們還會再繼續新的FELTS功能的教學那麼還請大家敬請期待囉我是凱凱我們下次再見囉拜拜