Hello 大家好,我是凱凱欢迎收看凯凯写程式今天是IT天然赛的第27天昨天我们已经介绍要怎么透过这个程式码来实作一个简单的HTML的解析器不过呢这个HTML的解析器目前还只能接收一般的HTML语法可是在spell当中我们可能会想要就是透過if block跟each block做控制還有這個這個要怎麼講大括號來放一些變數等等所以呢我們今天就是要把這個10做把它加上去好那麼像await block怎麼辦我們剛剛沒有提到對不對像這種await block或者是spel里头提供一些function比如说什么html啊debug啊等等这些我们都不会实作不过呢在概念上他们的这个实作方式是类似的所以我们这边就只介绍怎么实作if block跟each block那么我们先来观察一下这个if block的语法首先呢你可以发现他在这边用一个这个大瓜虎当作开头然后这边有一个井字号当作这个开头所以任何的block语法的开头都会是长这样的对不对好然后呢这边会有一个表达式所以这边我们把它叫name然后这边叫一个表达式然后包起来當這個block結束的時候,我們會用一個反斜線,代表它是結束所以基本上它的分析邏輯會跟我們昨天提到的標籤相同你看喔,li,這個當作開頭,在fail這邊是用這個當作開頭然後結尾的話是長這樣子,在這邊的話結尾是長這樣子結尾的話是長這樣子,在這邊的話是長這樣子所以我們就可以透過這種方式來做分析了好那么在if block里面的东西要怎么办呢里面的东西我们一样就是用就是继续用递回的方式去解析html的语法比如说我在if block裡面的東西要怎麼辦呢裡面的東西我們一樣就是用就是繼續用递回的方式去解析HTML的語法比如說我在if block裡面再包一個if block我們可以去递回了去解析它或者是一般HTML也可以好再來我們看一下下一個是each block那each block比較特別一點你可以看到它除了這邊的each block name之外這邊有一個放的是一個變數那當然這個變數也可以是一個表達式啦比如說你可能會想要這樣子array然後打filter不過呢這邊我們為了實作方便喔所以我們一定都只能放一個變數那在真正實作上你可能這邊要用一個這個JavaScriptJavaScript的pulsar去解析它那我們這邊就暫時不做不多做說明我們就只是單純的把變數放進去而已然后呢 earth local variable所以这边会有一个 earth我们要另外去做解析然后还有 local variable跟后面的 index那这个 index 是可选的所以我们这边解析的时候也要特别注意好那么还有一个这个放辨数的放 expression 的方式就是用这个大括号包起来可以放任何的expression不過呢因為這邊我們也是一樣為了方便所以我們也是只能接收一個變數名稱所以在真正的實作上它是可以接收任何表達式的比如說你可能會想要用一個string然後去呼叫一個toUpperCase的方法那這邊我們就先還不去實作它它就只能去接受一個變數名稱好好,那我們就趕快來開始實作吧那一樣喔,我們昨天嗯,昨天在這個影片結束之後我再把這個解析器做一些小小的修改來修正一些這個比較奇怪的bug這樣子好 那我们就开始吧首先我们要再加入一個這個警字號然後大刮鬍的語法對不對所以我們這邊可以先這樣子如果Parser去match到這樣子的語法的話呢我們就去做除以不然一般的話現在你如果直接這樣寫就是你如果沒有這個判斷式的話判斷式的話他會進入這邊嘛text他會把它當作一般的text來做解析但我們現在是想要它變成一個特殊的語法好那我們這邊一樣就其實做的邏輯跟昨天差不多跟那個標籤的部分一樣所以這邊呢我們用叫什麼好呢叫blockopen好那我們在上面呢宣告這個函數block open好那這個block open進來之後要做什麼首先我們會先預期它是呃它的type是什麼它有可能是if啊也有可能是each啊也有可能是awaits那awaits我們這邊不實作所以呢我們先放一個keywordsif跟each好然後呢我們就可以開始好了er...block name等於什麼我們用parser.readuntil不過呢這邊有一個地方要特別注意的是er...我們先來看一下if好了ifconditionblah blah blaher...這邊沒有blah blah blah這邊就直接這樣子然後each的部分的話則是favorableName earth所以他們前面的處理邏輯是相同的好 所以我們可以這樣寫Read until 遇到空白好那這邊的話我們就可以判斷說我们可以先新增一个nodenode.store.pulsar.index好然後有了這個之後呢我們就可以定義type然後在這邊我們可以再做一個判斷是說我們先看一下這是不是一個合法的block名稱 所以我們可以這樣子寫ifblock nameif keywords.includes如果不存在的話我們就去丟錯誤throw new arrowblock name is not a valid block好 那我們先來試試看可不可以丟我們現在看一下有沒有辦法跳到這邊來好,测试没问题然后这边index我们这边加一个测试when block name is not valid那我们这边做的事情就是xpad.parse然後我們這邊隨便給一個不合法的名稱叫做什麼?popo為什麼要叫popo?我也不知道然後呢因為我們期待它會丟出arrow嘛對不對所以我們要這樣寫xpad這樣子to throw然後popo is not a validblock name這樣吧好blockblock name感覺加上name會比較好所以它的確有丟出來好這是好事okok這樣就可以了好那在這邊就是它就一定會是if或是each對不對好所以我们接下来就可以判断node.type等于我们先宣告一个block type然后等于什么等于keywords.find

keywords.findindexvalue等於block name好 然後這邊的type我想要把第一個字變成大型所以我可以這樣寫0加上block typeslice1加上block所以它會長這樣子if block 或是 each block這樣看起來比較舒服好那有type之後呢 我們先去做判斷if node.type等於 if block的話呢 我們要做的事情是我們會有一個conditioncondition 然後呢 同時我們去做一個pulse.skip去skip掉這邊的空白然後Post.ReadUntilReadUntil遇到關起來的時候那我們這樣就有一個condition了那為了避免condition裡面有一些空白所以我們可能會把它做修剪的動作那在這邊的話你可以這樣寫Node.Type這邊已經宣告了再來是我們把它放到data裡面好了condition就叫condition.trim然後因為我們現在只能接受自傳不能接受表達式所以我們這樣寫應該就沒有問題然後return先不要return好了我們在這邊做然後我們在這邊做一個parcel.next如果遇到這個的話就return node然後如果不是的話代表它忘記關起來了所以我們要挑一個警告說throw new arrowblock is open missing這個好那我們再寫一個測試來確保它有跳出來那我們直接複製貼上然後Float Arrow when locke is open然後我們直接把它故意沒有關起來然後欸 竟然沒有等一下喔block is not open這樣子然後他說po...對,我們這邊要先打一個正確的這樣子,這樣子就沒問題了好再來這邊的部分是寫好了然後if block的部分我們先看一下想要怎麼寫會比較好我們先觀察一下if block的部分有沒有寫好所以我們這邊先shoot match if block雖然我還沒有寫完但我們先偷偷看一下pause ifcondition然後這邊拿掉這邊拿掉這樣子to match snapshot我們先看一下snapshot長什麼樣子欸他說block is openmissing 欸哪有明明就有所以我前面這邊有寫錯我們來看一下這邊應該是這邊寫錯了因為它跑到else的部分去了好,那我們首先先看一下這邊的node.type有沒有打對忘記把第一個地方把它弄成大寫oktoUppercase好,這樣子就沒問題了然後我們順便看一下snapshot長什麼樣子啊對喔昨天我說要找怎麼讓整個snapshot可以放在不同的file比較好找可是最後我沒有去搜尋如果大家知道的話可以留言在下方好,我们现在看一下喔所以它有到if block它有正确的生出来然后children空的data裡面有一個condition叫condition都放condition可能不太好那我們就要file好了fairable這樣子然後看一下這邊有變成fairable所以ok好那這邊我們等一下會再修改因為實際上它應該是要長這樣子好我們等一下會去修改這邊因為現在這邊關起來的地方它還是被當作text來做處理沒關係 我們慢慢的做接下來是我們要去寫一個if node.type等於 each block的話呢一樣我們要做parser.skip然後呢 我們要讀取 variable 的名稱因為現在不是表達式 它只是一個一般的 variable等於 parser.readUntilreadUntil 空白等下我們先再確認一下一起來看一下長這樣 each然後這邊是Name......對,所以在這邊有一個空白這邊有空白然後ReadUntil空白,嗯對好所以Fairable就然後呢,我們會去期待他說他會變成一個next這邊一樣會打skid然後呢if parser.next等於us的話代表這邊是正確的如果他沒有出現us的話我們要去警告使用者說expect it us那我們再測試一下好,這邊是snapshot錯誤所以我們暫時先不管它我們再寫一個新的測試should throw arrow when s is not added in each block然後expect int 裡面一樣放一個functionParseEach然後打了Feral Grenade但是我忘記打了S了,我直接關起來To throwTo throw我懶得再打一message所以我們直接用copy欸 等一下喔等一下喔喔對 這邊有了所以它有成功的跑出來太好了好那這樣這個test也過了ok然後 Earth裡面的部分的話我們要去放這個local variablelocal variable的部分的話呢一樣嘛 這邊這邊我們也是一樣要做一次skip然後parser.readUntiluntil p為什麼要用p呢?因為有可能他要去做index然後他也有,等一下喔,我想一下然後也有可能遇到這個所以我們看一下如果pulsar.next等於逗號的話代表這個東西有index這個迴圈有加入index,所以我們要把index也抓起來等於什麼pulsar.readUntil在这边的话我们就可以去准备我们的node

node.data我們剛剛在上面是有給data沒有 OK所以我們這邊的data可以這樣寫第一個它是一個each block然後它的fairablefairable name叫做fairable然後呢它有一個localFairable等於localindex如果這邊沒有的話你可以直接returnelse然後這邊就沒有index好,然後接下來我們來檢查一次each block的部分所以我們一樣複製testcase然後貼上to match each block each然後,這樣子, each然後array as itemeach好,那一樣我們再看一下這個snapshotto match each block裡面是each block,然後local有被放進來,variable也有正確的被放進來好,再來我們要做一個,我們還要再做一件事情是測試index的部分好所以我們再加一個test case這邊的話我們加一個i看一下有沒有加進來indexindex有indexi有加進來,可是它這邊你發現它這邊多了一個空白所以這邊應該有寫錯因為我們忘記去做skip好這樣子所以他這邊跟我講有錯誤這邊所以這個部分我們是可以接受的嘛對不對好沒關係那一樣這邊我們一樣先留著好這樣each block的部分也完成了所以ok好,那接下來我們要稍微處理一下tags的部分tags這邊我們原本只會去read這個嘛對不對遇到的這個標籤tag打開的時候才會去做跳出但現在我們遇到這個的時候也要做跳出所以我們要改成p改成pattern遇到這個或者遇到這個或者是這個的話要跳出去喔等一下喔,他現在跑到無窮迴旋了對,因為我在下面沒有做處理我們這邊還要再加一個elseifparser.next這邊的話一樣等一下喔,這邊跑完我想一下喔這個地方你要做處理啦這個是關起來的,所以我們這邊就去做關起來的部分那關起來的部分的話一樣,跟這邊的邏輯會是一樣的所以我們一樣寫 block close然後,pause html那一樣我們就新增一個新的函數叫block closefunction block close那在block close裡面要做的事情是一樣是read until然後在這邊我要把current children pop出來可是我在這邊剛好忘記push了在這邊我們忘記把stack push進去所以我們在這邊記得要把它放進去在這邊block open的地方我們要記得在這邊好了把它塞進去step.push這樣子這樣才能match然後block.close這邊一樣currentNode等於stop.pop然後blockName等於什麼等於renote.type對 type然後呢然後要做什麼事呢在這邊你可以做的事情是比較說欸 你的這個if tag match就是比較一下他們是不是有match那我們這邊做一下好了那我們可以這樣寫是這個字會叫if block或者是each block所以我們要猜一次each 拆出來跟 if 把它拆出來所以我們可以這樣寫to lower a block.replace然後block.to lowercase等於啊 不等於currentNode.type等一下不等於什麼啊 不等於等於pulsar.readUntilreadUntil這個的話呢就要 throw errorblock miss matchOK好 那這樣子應該就不會好 我們先把它寫完先寫完這個function然後再來跑測試不然怕進入無窮回血好然後呢 我們做一個pulsar.next同時呢我們把 current node.end 等於 parser.index好 這樣子應該就不會跑到無窮迴圈了欸 還是在無窮迴圈裡面好那我們看一下哪邊寫錯了嗯等一下我們這邊 text對對對因為我們這個的部分還沒有做處理所以我們這邊先不要這樣寫我們先把它改回來好,這樣應該就沒問題了喔對,這樣就沒問題了然後你看這邊原本它被當作 text 處理了對不對那現在呢它已經欸?已經不見了不見的原因是因為它被當作each block的部分處理了好,那這是好事然後我們這邊要寫一個測試是說如果兩個match不起來的話要跳錯誤假設我先用if好了那它應該會跳錯誤才對等下喔 竟然沒有跳錯誤欸啊 因為他這邊先跳了那我們先把他打好好 這樣子然後 throw arrow when block mismatch然后我们把错误讯息复制贴上

好,那你可以發現這邊的test就是好的了好,然後再來這邊嗯,我們看一下因為我們end已經有做處理嘛所以他end已經有正確的放上來了然後這邊也是一樣然後這邊也是一樣然後這邊因為我們有正確的處理關起來的部分所以他不會被當成text處理了所以,這test也是正確的ok,所以所以全部update好耶这样我们就已经处理好了这个if跟each这两个block的处理逻辑了再来呢我们要处理的最后一个逻辑是一般的大瓜虎比如说像这样子等于那这边今天可能时间的关系我没办法做这个部分不过如果你在标签里头标签外这样子写的话然后name或是任何expression不过我们今天只是做单纯只有自算的部分的话呢它也要可以顺利的去做读取对不对所以我们就来实作一下那首先我们先做一个我们先做一个snapshot起来issuepulseok然后ParseIfToMatchSnapshot好 这样子我们先做一个Snapshot存起来然后呢开始实作它我们这边再加上ElseIf这边比较好的写法是你可能用一个SwitchCase做判断或者是你把它拆成比较小的function這樣看起來可能會比較螢幕雕欄一些不過我們這邊就直接把它寫死next那這邊的話我們要去做parsemost-packed-tab不要好了,tag拿掉好,那我們在這邊新增一個新的函數它這邊要做的事情是什麼呢第一個我們先做parser.gib然後我們這邊可能會想要做一個tagtype的話叫做mostktagstart.parse.indexskipname等於poster.read .till然後return name等於name.trim等一下喔然後一樣我們先poster.nextturn tagn 等於 parser.index好嗯n 的話等於 n.trim這樣子 OK這樣子應該就沒問題了吧好 欸有snesha fail所以他原本是長這樣子等一下喔是甚麼東西都沒有的欸怎麼會這樣我嚇一嚇在這邊這邊我們可能要剛剛忘記做處理了剛剛有把處理拿掉在text function裡面加上一个repeat然后到这个的时候结果它跑到无穷回旋去了好看来是下面的地方可能判断上有些错误我们来看一下进入到parse most tag的时候然後進來然後出來然後return等一下喔return了之後誰要接阿對這邊要加上current-node.children.tush好然後這邊我在想它會跑到無窮回圈的原因是因為我忘記啊,pulsar的部分你看喔,我們昨天有做這個read until如果一直沒有遇到那個我們要的值的話然後又爬到最後的話就停止了對不對所以我們在這邊也要做一樣的處理喔不然會GG這樣子喔!太好了太好了好所以我們來看一下它現在變成一個Object然後有一個Name然後有一個Star有一個TypeMost Takeend是3沒錯好 所以這樣子的話這樣子應該就沒有問題了欸 等一下喔我們看一下 確認一下fragment 嗯好 這樣子就沒有問題了好太好了這樣子一來我們就已經把這個if blockblock跟each block還有變數裡面就是動態的去表達expression的部分也完成了不過這邊有一個比較可惜的地方在於現在沒有辦法說這樣的事情這邊的部分邏輯一樣是類似的就是當我遇到這個tag的時候遇到這個資源的時候呢我去進入到這邊我去進入到這個ParseMostake狀態然後再去做一些判斷等等好那這邊的話我們就不會再另外講解因為他們的實作方式是類似的好那今天我們做完了之後呢我們從明天開始就可以用這些語法樹來生成我們要的這個呃 程式嘛好 所以還請大家敬請期待囉我是凱凱 我們下次再見掰掰