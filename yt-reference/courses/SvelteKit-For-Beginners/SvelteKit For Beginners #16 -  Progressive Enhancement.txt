 Hey, welcome back. In this section, we're going to learn how to use Svelte actions to progressively enhance forms. So far, our page works before JavaScript. That's great, but it feels like the 90s. So let's learn how we can progressively enhance forms. Actions aren't something specific to SvelteKit, but Svelte. So I'm going to give you a speedrun of how actions work. So let me do that briefly. So for example, in the post, I give you an example of GCEP. If you're familiar with GCEP, it's a great animation library that's an industry standard. But the problem with GCEP is it wants to hook into a DOM element. So you have to do query selector and etc. using imperative JavaScript, right? But in Svelte and these JavaScript frameworks, we really don't want to touch the DOM. We can do that, right? But that would get really tedious. So for example, if you look at the docs for action, this is how you use it. So for example, you have a component here. And then you can say use action. And for the action itself, it's just a function, right? so action and then it accepts the node so it knows what the element is and then you can add your event listeners hook into it etc and it also lets you hook into it when it creates and when it gets destroyed so that's really awesome so for example imagine if you're using gsap and you want to write some bounce animation and then for example you can write bounce and then you can implement your logic here and then instead of using imperative javascript in your svelte you can say use bounce and then you can also edit parameters here. That's really awesome way to hook into an existing library. And this is the same technique we're going to use to progressively enhance forms. I really want to make this clear to you how this works. So let's see how we would do this without using actions. So let's pretend actions don't exist. So in your project press control P and then find compose, oh not compose, tweet, compose.svelte where we can see our tweet that we're submitting. So inside of our app, this is this section, right? Where we can compose our tweet. So if we go to this section, so previously how we would do it in any like JavaScript framework, right? We would say on submit, we would prevent default. Swellt also makes this super easy. We can say no handle promise. What happened there, right? That was really something else. Say let's remove this and we can add our function here. so here we can say asic function handle submit we can pass it an event and another hot tip for you javascript nerds let me just comment this out so if we see here the event and let say whatever this is so if you hover over the event is going to tell you what type this is so it's going to say submit event so you don't have to look this up on stack overflow etc just use the power of your editor yeah so we can say handle submit and when we say handle submit like this without using the anonymous function the event gets passed automatically So we get the event here and we can say submit event, which is awesome. And we have to specify for TypeScript that this is a HTML form element. Otherwise, TypeScript gets really mad. It's like, oh, you're doing this weird thing. I don't know what the type is. And then we have to implement this logic ourselves, right? And what we're doing this couple past years, because we forgot how forms work and the browser does everything for us from serializing it, et cetera. So we have to say which endpoint it is, which is home. And then we have to construct it ourselves, right? We have to say method post. And then we have to say for the headers, it should accept application JSON. And for the body, we're really pretending like this is a form. So we have to say new form data. We're creating a new form. And if you hover over this, you can get descriptions in your editor what this is. So this really creates a new form. And then we pass it the form. And this is why we had to define this here as a type. otherwise typefield would be like hmm i don't know what this is right and then for the last part when we submit it we really want to reset the input field so we can say form reset and we get this nice type completion so yeah we can save this and now this should work the same as before but the page isn't going to reload because we're using progressive enhancement using javascript right but let's first add our tweet so we can see what's going on so if i for example say one two three four when I add this it's not going to get instantly updated because Svelte has no idea the UI updated so let's do that and nothing is happening but if we go to the network tab and let's submit another one that's one two three four we can see the fetch has been made in home and everything was successful so what is going on right so let me just close this and if you refresh the page we're going to see it so the problem is that Svelte doesn't know the UI needs to be updated so we really need to move this up to the parent where our tweets are and when this changes then we can say for something like tweets we can say it updated to the new tweets and that really a problem we going to solve in a minute when we use actions And we going to solve another problem because imagine typing this code for every instance where we going to want to use progressive enhancement This will get a chore real quick right? So we're going to explore actions in a second. So yeah, let me just remove that. This is just an example. We can just remove this code. We can go to the form. We can remove this. We're basically going to create the same thing, but thanks to actions is going to be something we can reuse and instead of repeating multiple lines of code we can just use one line of code for everything so inside our lib folder we're going to create form ts so let's go to not static we're going to go to source lib we're going to form ts let's just close this and then we can start writing our actions so we can say export cons we're going to name it enhance but you can name this whatever you want this can be banana or whatever right so enhance and we're writing it like this because we're going to add in a minute types for it so we can say form html form element so now we're going to add an event handler we're going to say for that form we want to add an event listener it's going to listen for submits and it's going to handle submits right and here is the secret sauce inside here we're going to have an asic function handle submit going to have an event of event and we're going to add our logic inside here in a second but since we're hooked in the life cycle of the element right we can go here and we can say when the element gets unmounted it gets destroyed we have to clean it up so we can say form remove event listener submit event that has handle submit so this really isn't that intimidating right and we can just go step by step and learn this and figure it out how it works so this is something we do in other JavaScript frameworks like react because we have to say event prevent default and we're going to do the same thing using fetch but we can just parameterize it now and use our logic again right so you can say const response await fetch and from the form we passed in we can get the action and then we can say method from the same form we passed we can get the method from the headers we're going to specify the same thing again, right? Say application JSON And for the body we doing the same thing Form data right And we passing the form So let do some validation We can say if response isn okay Response okay returns a range of status codes from 200 to 300, I think. So 299, I think. You can look this up. So you can say console error, and we can just get back whatever text is, right? Which is going to be an error message usually so yeah that's it we can save this and if i scroll down here i reiterate here what we did so the form is passed from the action so here is our form that's passed from the action and then we set the event listener right we clean it up here and this is our logic right here so we can update compose well to use the action and you can see how really simple this is when you get it and this is just something you can copy and paste for your other projects right this isn't something you have to do each time. But right now it seems complicated because you're learning about it for the first time. And I hope in the future SwellKit makes it a part of the framework. So this is really easy to do because what I love about Remix is that they give you a really simple way to do this. They give you a lowercase form that's a regular form and then they give you an enhanced form. So you don't have to think about it. And I think SwellKit takes cues already from these other frameworks and we're going to have way simpler methods of doing this in the future, right? Yes, so inside here we can go import. say enhance from root lib form and how do we use it we just use enhance and that's it so we can find our form here and just make space you can say use enhance if you can type of course that's a prerequisite so now if i go here we should see it works so let me just refresh for just to be sure so we can type the same thing again and we're going to have the same problem but it's going to work right so if we submit it we won't see anything and our form isn't resetting because we have an implementing so pay attention going to reset and then we're going to see it here again okay so how do we fix this problem if i go back here we're going to use an invalidate function from swell kit since we know the url that's changed from form action we can use the invalidate property provided by swell kit that reruns the data fetching on the page and updates what change so we can see here how this is going to look like so we're going to import invalidate from app and then here we're going to create a new URL from the form action, then we're going to reset the URL search, the URL hash, and then we're going to invalidate it, and this is going to refresh the page without actually refreshing it manually.

 So it's going to work like a single page application, right? Yes. So we can go to our form TS. So let's just import this. So we know what's going on. We can say invalidate. Not from navigation. Not sure where you picked that up. Are you drunk editor? Right. Sometimes it's funny, right? And then pay attention here where our if block is before our handle submit is done. Let's just make space here. So it's really obvious. and this is going to rerun the load function on the pages and refresh the data so you can say const url new url form action then we can say url search switch like that we're going to reset the hash and then we just need to invalidate the url yeah and that's it so if we end this this should be it so let me just go here and i always refresh so environment so let's just type something else right now we can say test and pay attention the site isn't going to refresh we shouldn't see here darfavik on spinning so just going to update like a single page application using progressive enhancement all right so the moment of truth and this is how we use progressive enhancement so that's awesome but i want to add a couple of more things before we add the action to the other forms i want to reset the form when the user submits a tweet so we're going to pass a result function argument is going to reset the form inside the action and to avoid other pages like profile redirecting to home we're going to use a page store value from Svelkit instead of form action but this is optional i try to make the types more readable compared to the form ts example in the default Svelkit project okay if you don't like TypeScript or you're intimidated by please close your eyes right now and or in your ears and the rest of you you can follow along so if i zoom into this you can see how the types are really uh it's really i i don't know why they did it like this, it's really impossible to read. Even to someone like me that like isn completely competent with Tyscrates I just what is going on here Like I have to spend five minutes decoding what they did here So I tried to make it simple but it's still going to look like a complete nightmare to you that don't understand TypeScript, right? But don't worry. We're going to get to it together. Yeah, so let's see the final version, how it looks like. But before that, let me just... So we're going to use the page from app stores, right? and we're going to subscribe to this value. So we're going to know the page. Let me just ignore the types for now. But before that, so we can create invalidate path, which is going to have the type URL. And then we're going to subscribe to it. So we can say page, subscribe, path. And we're going to update the invalidate path. And we're subscribing because it's a store, but we really can't use stores here with the dollar syntax, right? So we can go here and then instead of using the form action, we can use invalidate path. And then we're going to have the form reset, which we're going to pass a function here in a second. So if the function is passed, this is going to be our object, if result, then we're going to run it. let's see what we do just said result and let me just do this result so we need to pass it here so we have a form that's our parameter here we have form we're going to have a result and then let's just default it to an empty object if something goes wrong and yeah let's see so we can now specify the types. So we can go types parameters. This is going to still look confusing, but less so I hope. Yeah. So basically we just typing out a function to HTML form element and it returns void but let not void void yes let add this yeah this is optional so we can go here we can say the return type destroy is going to be destroy going to return void and we can say type enhance is going to accept a form that's also going to be optional for element so this is our result right here which is also optional is going to be of type parameters which we created and then it's going to return destroy so yeah let me just see what's going on here so now we can give it a type and this is why i use the anonymous arrow functions you can say enhance so we can remove this also this is still complaining and i can see why I think we need to, yeah, we need to remove this. We can save it and that's it. So if I go here in the post, we already did this. We have a result. And then let's change the line in compose.swelt. We're passing an option. So double curly boys. And then we're passing a result, which is going to be the function. Since we have the access to the form, we're just going to get it back. And then we're going to say form reset, right? And this should work and we have our types, everything. So we're passing this to the action. This is right here. Then it goes to this part. Yeah, here it is. So if a result is passed, we're just going to reset the form. And that's it. Yeah, so let me just save it. And then if we go here, let me type test. So now this field should clear. Our page should update with a new value. So we don't have to hard refresh it. It should work like a single page application while being server-side rendered. And everything should work beautifully. Okay, so cross your fingers. and awesome, it works. This is really amazing. So we need to make it work for the other part which is going to be simple We just need to change tweet swelt so press ctrl p tweet swelt and then we can import enhance like i doing here we can say import enhance from root lib form yeah so let me scroll down further so we can go to our actions so here we have the first like action so let me just make this more visible then we can use the same action right and you can see we don't have to repeat the code. We can do this. And I think there's others, right? So let us just find the second form. Here's our second form, delete. Just paste it out like this so it's more understandable. Use enhance. And I think that's it. So really this might have sounded intimidating and hard, but let me just say this and it's going to format. But everything should work now. So we added it for the deletion and we also added it for the likes and we're going to have the animation for the likes let me just see so here's how we achieve the animation for the likes if you didn't know let me first show you in our app so for example here we have our likes and removal and our page shouldn't refresh it should be like a single page application right now so let's look at animation if you for example like this which is awesome and then let's remove it and we get this nice animation we added at the start so this is really amazing and let me show you how we do that animation for liking the tweet so here we have the keys the tweet likes if the tweet likes change this is going to tear the component down and recreate it and that's how we can start the animation up again and how we're achieving the animation where this rises to the top we just have for the count let me look it up we just have overflow hidden there's other ways of doing this but i found this to be the shortest yeah so let me try out this animation so we can see here it looks delightful so that's that user whimsy i'm talking about so yeah that's it see you in the next one