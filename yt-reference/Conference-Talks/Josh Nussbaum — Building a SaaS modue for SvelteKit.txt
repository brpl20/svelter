 Hi everybody and welcome to my talk about building a SaaS module for SvelteKit. it. So first of all about me, my name is Josh Nisbon. I am a developer using Spout in Montreal, Canada. I'm Josh Nisbon on GitHub and Twitter if you want to follow me there. And so the talk today is going to be about this new thing I created called AirVadge. So what is AirVadge? The purpose of AirVadge is to help people start their SaaS. So normally a SaaS takes a lot of work to create. Sometimes you need to do multiple attempts before, because we're developers, we don't really know marketing and sales and all that jazz. So you can take multiple attempts to get going. And so my tool is designed to help people with SvelteKit quickly create their business and start experimenting. So I wanted to talk into three parts. The first part, I'll go into the reasons why I built this project, what it is, like how to use it and then the actual implementation will go into how it was built. Cool. So first, let's start with why. What's the motivation for creating this? So back in 2021, I created this Svelte app. This is actually before SvelteKit called CarrierWay. And it was a SaaS that was for e-commerce companies that wanted to monitor their warehouses to make sure their packages were leaving on time. It had some moderate success. It was the first time I actually made some MRR online, which was really cool. But ultimately, after a couple of years, it kind of like tanked out a bit and ended up, I guess, kind of failing. You know, I was thinking like, you know, a lot of people usually use the term win or lose, but I kind of like to use instead win or learn and try to see like, what can I learn from this project? project. So I was kind of like thinking to like mine it for ideas, you know, like what ideas can I take out of it that would have made it easier to build. One thing that came to mind was that when I launched this SaaS, I skipped creating payments. It might seem weird to you because I have a lot of payment related projects, but I kind of figured like to me payment was like a chore. So like I figured, you know, I could just add it later. or instead let me focus on building features. And I kind of like just had like a verbal agreement with the customer that they would pay me, send them an invoice or whatever. It kind of didn't turn out well doing that because I feel like payment is a very important signal your business needs to get, whether you're not getting payment, which could be a useful signal too, because that means you may need to add some more features or if you're getting payment, right? Like the engine of a SaaS is that it provides a feature for a customer, they pay money, so on and so forth. So if the payment isn't working properly, you're kind of not validating your idea. So that's why I think it's really important. Now, I did look at other options. You know, this isn't the only... What I'm going to present to you isn't the only way of doing things. There are other alternatives. A very common one, of course, is you just do it yourself, right? You just code it. You know, it's a great strike. It's a great authentication. It's not that hard. It maybe takes a week or two. I mean, especially like me, if you're writing, If you want something that's going to be quality and has tests, it's going to take more time. So for me, it's probably a week or two. It's just that when you're starting your project and you're excited about working on it, the last thing you want to do is now start working on this chore. So that's the only reason why I prefer not to do it myself if I didn't have to. Another very common approach is using a starter pack. So these come with everything pre-configured. and they useful they helpful right But the problem is also you end up with this giant code base that designed to help so many people that it has way too many features in there And you know it hard to match the stack You know, let's say you like Svelte. A lot of starters are using Next.js. A lot of starters, maybe you like Tailwind and it's not using Tailwind. So it's hard to like align the stack well. And I think it's important to have a stack you like, right? Because after all, you're going to be in this code day in, day out. Like you really should enjoy. You shouldn't be annoyed that you have to go work with this thing you don't like. There is another alternative, which is obviously we can use a cloud. There's some cloud offerings like Memberful and Outseta that provide services. But if you're going to be successful, you're looking at probably thousands of dollars a month to use these services. So it is kind of expensive. Your money will go flying away. Or you could do my mistake, which what I did, which was basically saying, you know what, I'll do it later. And as we discussed, you do want that signal. You do want to know positive signal or negative signal. Either way, it's a useful thing to know if your thing is working or not. So now let me show you the solution that I came up with. And what it is is it's basically a wrapper around Auth.js. I don't know if you guys are familiar with Auth.js. It's a project from Vercel that provides authentication for SvelteKit. And so this wraps around AuthJS and it adds integration with Stripe. So Stripe will handle the payment and AuthJS will handle the authentication. And you join those two together and then you don't have to really write much code. So it's super fast to set up. So you know, like basically you're removing a week or two of work. It's a library. So unlike a starter, you can, it's easy to update. You know, you can just take the latest version and the fixes will be in there. The fixes will be in there. You don't have to pay for an API or anything like that or worry about doing it yourself, which I think is awesome. And it's open source. So you can open a PR, fork it, change it, read the source. It's all there, which I think is super important if it's something your project is depending on. It's also free. So I do plan to have a paid tier, but my goal is to have something that is designed for experimenters, for people that want to try something this weekend or next week. I don't think we should put a big cost in front of them to do that. It's going to take multiple tries for them to build their SaaS. When they get successful, then there'll be a charge coming in maybe. You end up with a lot less code this way. You don't have to maintain this giant starter pack or anything like that. With just a couple lines of code, you have a SaaS. And you don't need to write all that testing code. So it's a tested library. You know, save a ton of time avoiding doing that. The main goal being to make it easier to experiment, right? So let's look how we would set this up in a SvelteKit project. So in your blank SvelteKit project, you would install the airbadge slash SvelteKit package. Then you would go into your hooks, and you would configure this as your global hooks that runs on every single request. you would use this SvelteKit auth that's provided by the package. And you just need to give it a little bit of configuration. Now, the configuration is quite similar to AuthJS, just a couple of differences which I'll go through. Now, you do have to figure out your database. So AuthJS supports many databases, Prisma, Drizzle, but you do need to adjust your user table and just add some columns. This is just to track the Stripe customer ID, the plan that they're on, and the status of their payment. And then once you do that, you can specify in the Hook server which adapter you're using. Now, in this case, I'm using Prisma, but, like, for example, let's say you use Mongo, you wouldn't even have to do any schema changes because Mongo is schema-less. So the new attributes would be added the first time you use them. you use them. Okay, so now that we have our database set up, we can set up our authentication. Now, this is up to you. Some people want to use Google OAuth, Apple OAuth, GitHub, passwords, password lists. All that is supported by AuthJS This is just using AuthJS so you can use any of their supported versions And then you would go ahead and you would create your pricing So in Stripe you could set up products and pricing And in our case, we want to set up a price for a subscription. So you could use the dashboard. I like to use the CLI just because a lot of times in your SaaS, you'll have like three prices. So it's nice to have a script that could set that up. And here we have the... We'll create a price for a basic plan. We'll say it's $10. That's $0.10, so $10 per month. And then once we do that, we get a price ID. And we could then put that into our config. So here's my config. I would just say plans. And I will specify the ID of that plan and what the price is in Stripe. So this is the code we got in the last step, the ID we got in the last step. And once you do that, you end up with something like this, where you have on the left a UI provided by Auth.js, where a user can log in. Now, the first time they sign up, let's say I click on a Google sign in, I'm going to be redirected to pay. So that will happen on the first sign up. And the user will come back to SvelteKit with the access token. Now, AirBadge also will handle all the Stripe webhooks for you. So you can use the Stripe CLI again, even in development mode. You can forward all the webhooks to your local host. And this way, if somebody changes something, let's say in your Stripe dashboard, you cancel a subscription, it'll fire off a webhook, and that webhook can get forwarded to your local host. So it's a good thing to run this in development mode. And now a very common thing is that you want to have conditions based on the status of their subscription. So the nice thing AirBadge does is it adds some extra data into the session, and you'll see now there's this extra object called subscription. So I can make a conditional here, like, oh, if the session, if the subscription plan is pro, then do something that only pro plan can use. Or if the status is trialing, payment status is trialing, then they're on the trial and we can do something differently. So this makes it really easy to write, to gate areas of your code base. And you see here on the right, the gray stuff, this is basically what is in your session. And the gray stuff is provided by Auth.js. And the purple stuff is what's provided by AirBadge. So the extra plan and status and all that stuff. Cool. So now I'll go a little bit deeper and show you guys how I actually built this thing. Obviously, it's built on top of Verstel's AuthJS. And AuthJS provides a data model that looks something like this. So this is what your database schema looks like. It basically gives you a list of users, and it has a one-to-many with accounts. So I think accounts is more like credentials. So imagine if a user has an Apple ID and a Google ID. It would have two records in the account table, one for Google, one for Apple. So that's how that works. And the database adapter is basically just an interface. You can write your own. They have tons already, Drizzle, Prisma, Mongo. But all it is is basically a bunch of these functions that are either creating, deleting user records from the database. So AirBadge is just reusing these. And then there's also what they call providers. These are like authentication providers, and they support many types, including OAuth, credentials, web auth, and there's tons and tons of options. I think there's almost like 75 or maybe 100 options. So very flexible to use. And AuthJS also provides a bunch of endpoints. They're under slash auth. So these are useful endpoints you can use for authentication. So imagine you want to sign in a user with Google. You could create a link on your site, like it looks like a button. It says sign in with Google, and you could just point the link to this, slash auth, slash sign in, slash Google, and that'll sign them in with Google. Or if you want to create a sign up button, you can just have a link that links to sign out. So these are like handy utilities for authentication. AuthJS also allows you to customize where things go. So for example, you want to change where the sign in page is, or you want to say like when a new user signs up, where to take, maybe you want to have a welcome page. You can change this to say slash welcome. So you can configure it all very configurable And it also lets you hook into the life cycle So it has a thing called callbacks kind of like hooking into different parts where you can say like, oh, when somebody signs in, you know, you can have some logic here, maybe you can check, oh, it's the first time they're signing in, send them a welcome email. So it's quite customizable. Now the other side, so one side is AuthJS. The other side of this is the Stripe integration. So typically a Stripe integration with SvelteKit or with any JS project, you either have two options. You either can use Stripe Checkout, which is kind of like a hosted version where the UI of the payment is all handled on Stripe, on Stripe's domain. Or you can use Elements. Elements are kind of like little widgets, little payment, like a credit card form or things like that that you can embed into your SvelteKit app. And so if you want to try out Elements, I highly recommend checking out this project, out this project, SvelteStripe.com. It's created by me. And it's sponsored by Stripe. Thank you, Stripe. In this case, AirBadge is actually using the hosted checkout. So what that looks like is kind of what you see on the screen here, where you would basically say using the Stripe client, you would create an object. And you would tell it like the currency, maybe USD, the line items, like which products or subscriptions you want to pay for. And then it gives you back a checkout URL. And you can just call SvelteKit's redirect function to send them to that URL. And error badge also adds a bunch of endpoints, similar to how AuthJS had slash off. Error badge adds slash billing. And these are, again, a bunch of utilities related to billing that you can use. For example, if you want to check out on a specific plan, you can just make a link. Like, imagine you have a pricing page. You can say buy now, and the buy now could link to slash checkout plan equals pro. And then that'll sign up to the pro plan. or you can, let's say you want to have a button that says upgrade plan. You could just have a link to slash modify plan equals and a new plan that you want to upgrade to. So these are very easy ways to build utilities, pulling utilities into your app. Now, what about monetization? I did say that I'm hoping for this to be very usable on the free plan, but I'm thinking also there may be like a higher tier, maybe like some paid pro features. The idea being mostly like, I think like I was using a project like this, I would want it to be maintained and well supported. And so that's sort of how we're thinking about it. We're gonna see, it'll probably be a team features or something more like a, for a high-end B2B business. I'm gonna use the BSL license, which means that other people can't sell this. So I have the option to sell a paid version. And after a certain amount of years, it reverts to MIT license. So it just gives me a chance to be able to offer a paid version. And so what's next for this project? Well, you know, in talking to people and getting like initial feedback, one thing I think that would be really cool would be to have a hosted version. So imagine having a subdomain on your domain called auth.whatever your domain is. And this will open it up to a lot more frameworks. So imagine somebody using Next.js, they can still use this or .NET or Python or whatever. They could just host it in a Docker container or deploy it to Vercel and they don't have to know Svelte to get the benefits of it. Another feedback that I got from a lot of people is that sometimes people aren't selling subscriptions, but they're still selling things that are connected to the user. For example, digital content. Like if you wanna sell videos or eBooks, it would be nice to be able to buy them through AirBadge and just have the access token saying what the people have access to. So that's something that is going to be coming as well. All right, so in conclusion, I'm hoping that AirBadge will help people create their business, that it will help them experiment more and faster and even fail faster, because I think failing faster is how we get to success. So hopefully that can help you do that. Thank you very much. I appreciate your time. I'll just share with you guys some links. If you're looking for any help with this project, You can hop onto the Discord. We also have a very good doc site. And, or you can check out the code on GitHub. All right, guys. Cheers.