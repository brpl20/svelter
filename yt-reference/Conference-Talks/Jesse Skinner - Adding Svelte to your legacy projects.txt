 Thank you. Hi, and welcome to Adding Svelte to Your Legacy Projects. I'm Jesse Skinner. I'm a freelance Svelte developer. I'm also a blogger, a YouTuber, and I live code on Twitch occasionally. So you can find out more about that at codingwithjesse.com. And I'm also the creator of the video Svelte course, The Joy of Svelte, which you can find at joyofsvelte.com. So I've been making websites for 25 years. And a lot of things have changed over the years. I started off with some static HTML, later added some JavaScript. And then I started getting into some server side programming. So some PHP. And since then, there have been three major turning points in my career. Three times where I had my mind blown. I was totally amazed and changed everything about how I built websites. So the first time that happened was when I discovered jQuery. So suddenly you could write really short and rather clean code for multiple browsers. It was a lot easier to do web programming in the browser. And the second time that happened was when I discovered React. Suddenly there was a massive paradigm shift. We could define our applications using HTML in the form of JSX. And it was a lot cleaner than using jQuery. And the third major shift is when I discovered Svelte. Suddenly, even my React code seemed a little bloated. And all I wanted to do was use Svelte every day. But at first, that wasn't so easy. Imagine you're a web developer who is working using PHP or React or whatever technologies. And then one day a friend tells you about Spout And you check it out You look at the tutorials and you tinker with the REPL a little bit and you absolutely fall in love with Svelte It is now all you want to use on a daily basis. So you get back to work on Monday and unfortunately you're stuck using some ancient technologies. You're maintaining an old code base and it's full of everything but Svelte. So you feel absolutely defeated. Is there any chance that you'll ever be able to use Svelte at work? Well, is it possible to use Svelte without rewriting your whole application? And that's what we're going to try to answer in today's talk. So let's say your boss asks you to add a new feature to the site. So let's look at an example. Let's say you have an ancient PHP website. It still uses headers and footer, includes the whole thing, barely has any JavaScript, but you're still maintaining it for whatever reason. And your boss asks you to add a new feature. Right now, the list of contacts for the company is very long and they want to be able to click on the column headers here and be able to sort the table. And they'd also like, they have a search feature already that submits to the server with a form, but they'd like to be able to have it filter while you type. So how would you approach this? Is there a chance to use Svelte here even though it's an old PHP site? Or do we have to rewrite the site using SvelteKit? Now you're incredibly excited to use Svelte and you are thinking about it all day every day. So when your boss isn't looking, you take the opportunity to open up the Svelte REPL and you just want to see what would it be like to write this sortable table in the Svelte. And you give it a shot, you bring in your list of names, and you bring in the table, and you try adding some sortable columns. So that's what I've done here. I have a basic table, I have a couple of functions to sort and to search through the table. And so now we can type in here and we get live search, we can also sort based on any of the columns. And it's working pretty well. That doesn't really help us because we are stuck using PHP on our website. Or are we? Suddenly you remember that Svelte compiles to JavaScript And since we need to use some JavaScript on the PHP site anyway is there a way to use that compiled Svelte JavaScript on our PHP site That when you discover a magic button on the REPL So you see here in the top right, there's this little download icon. You can download a zip file. So you click that and you save the zip file to your PHP code base. What we're going to do is we're going to build your Svelte component inside a folder and then link that in to our PHP site. So if we switch over to our PHP website, you'll see some PHP files here. And it's okay if you don't understand PHP for this example. Static HTML would work the same. So would Ruby on Rails or pretty much any other server-side framework. If we open up our contact.php, we'll see that it's loading a JSON file and putting into a server-side variable. If there's a search, it's going to search over it. We have our search form, and then we have a table looping over the list of contacts, putting them into the table. We now have our zip file here for Svelte. So I'm going to drop into the terminal here. I'm going to make a new directory, contact table, and go into there. And then I'm going to unzip the zip file that we received, and it'll go into this subdirectory here. And the reason I'm doing that is to keep it separate from the rest of the PHP site. But now what we can do, we can go, since we're in that folder now, we can run npm install. And that's going to install the dependencies for Svelte. And so it's doing it separate from the site, it's doing it in a subdirectory. And the idea here is that we're able to isolate our Svelte code, isolate the build process. We have our separate node modules in there. We're not converting the entire site to become an NPM package. The whole site's not going to have node modules. We're just going to keep it very localized in this case. And it's a way to discreetly add some Svelte to our PHP site. And now we can run npm run build, and that will hopefully build us our code. Well, in this case, it didn't work because I was importing some contacts from contacts.json. In this case I not going to have the spell code pull in the JSON file I want to have the PHP code still do that and write the data in as props So let go into our contact table example So it going to be under source You get this app.svelte. So let's open that up. I'm just going to change this import that I used in the REPL to be export let contacts. And let's have a default of an empty array. So we're going to be passing that in from the PHP code. And this way I can show you what it would be like if you were pulling those contacts from a MySQL database or anything like that. So now I should be able to run npm run build. And it's going to create us a bundle in public slash build slash bundle. So now what I want to do, I'm going to go back to our contact.php. I'm going to scroll just before the footer here. And I'm going to add a script tag. We're going to pull in the contact table slash public slash build slash bundle dot jas. And the next thing I'm going to do is add another script tag here. We will instantiate our component. Now the question is, how do we wire up our component? How do we pull it in? How do we tell it where to render? And so there's a few things we're going to have to change here. we're going to have to go into the contact table, roll up config, because we're going to have to change the build a little bit. When you download the zip file from the REPL, it's designed to render onto the page. So if we actually look in the main JS, we're given this instantiation code here. We have this app pulled in from app.svelte. The target by default is the body. And so we want to have a little bit more control over this. So what we're going to do is not rely on the main.js file. We want to build the app.svelte directly, and then we want to expose it into the global JavaScript namespace so that we can render it onto the page. Let me show you the changes we need to make. We need to go into the rollup.config.js, scroll down here, and we'll see under the input, there's source slash main.js. So we need to change that to source slash app.svelte. You could also rename app.svelte to be something more appropriate. So I'm actually going to do that. I'm going to call it contact table.svelte. And so that's what I'm going to put into the input. Contact table.svelte. Two more things we need to change. So the format is a iffy. So we're going to change that to be a UMD and that will give us access to it in the browser. And we're going to change the name of it. So with a UMD,

 the name here is going to be the global variable that we have access to. So I'm going to also call that contact table. Now you could change the location of the bundle as well. It's putting in the public folder again, because it's designed to be a single page app the way that this is. So we could change this if we want. I'm going to change it to disk slash bundle. I think that makes more sense. And we can build it again, npm run build. It's going to now put into disk slash bundle. So I'm going to go back to my PHP site. And I'm going to change the location of that this slash bundle. And now we have access to this contact table in the global space. So I'm going to do new contact table. And then in here, we need to set a target of which DOM element we want it to render to. I'd actually like to keep the PHP rendering on the server so that we have some server-side rendering. So what I'm going to do is wrap this table in a main element. I'll give it an ID here, contact. And then I'll put the closing main just after. And what we're going to do is that when the JavaScript loads, we're going to find this main element. We're going to erase the contents and re-render it using Svelte. So if a user doesn't have JavaScript enabled, they will get the old PHP version. And as soon as the JavaScript kicks in, they will get the new version. So let's make a main document.queryselector.contact. And then we will use that as the target main here. And then the thing I'm going to do right before that, I'm just going to set innerHTML to be empty. So I'm just going to wipe out the contents. Now there's one more thing we need. We need to pass the list of contacts to the contact table as props. So I'm going to set a props argument. We're going to say contacts is, and this is where I can use some PHP and just say echo JSON and code contacts. So I'm actually going to write JSON directly into this script block. All right. So now that that's all saved, I'm going to switch back to my browser. And here we have our ancient PHP site. And now if I refresh it, you'll see Actually, there's two search boxes. I need to move the form into the main as well. So I'm just going to move that inside. We want that to be replaced as well with the new form Refresh And now we see that our I used actually buttons for the headers here And what happening is that we don't have the CSS that we need. So in Svelte build, there's often JavaScript and separately CSS. So what we need to do is link those in, but I can just check the functionality. It is sorting. That part's working and I can actually do a live search as well. So switching back, I'm going to now add some CSS. I'm going to add a style block, and then I'm going to do an import URL, and same kind of path that we had with the contact table. So it'd be contact table dist bundle.css in this case. So contact table dist bundle.css. I save that, switch back to the browser, refresh. Now it looks exactly as it should. So as it loads, it's loading the original PHP version, and then it switches out to be my new Svelte version. So to review, what you need to do in the rollup config.js, you need to replace the input, you need to point it at the Svelte component itself rather than the main.js that comes with the zip file. You need to change the format of the output to UMD, and then change the name from app to whatever you want the global variable to be for your component. You can also change the destination of the bundle, but that's not necessary. So that approach works great if you're using PHP or a WordPress site, static HTML, or some other server side technology. But what if you already have a build process? What if you're already using a web framework like React or Vue, Angular or something else? So we can take a similar approach. If we don't want to modify our existing build process for whatever reason, we can keep our Svelte code in a separate folder with its own build process. So it's a great way to get started using a little bit of Svelte without necessarily diving in. And you can keep your code either in a separate folder, or you can even keep it in a separate Git repo and use it as a NPM module. So what we're going to do, instead of using the global namespace that we did in the previous example, we're going to import it into our code. So to be able to do that we need to make a few changes to the package So by default the package comes with name set to spell at So we going to want to change it to something that makes sense for our component We don have to change it But once we install it, we're going to want to import it using the name of our component. So you can call it my spell component or contact table in this example. And the other thing we need to add to the package JSON is a main entry. So we need to point the package and say, when you import this by name, what file does it actually load? So by default, you would do public slash build slash bundle. Or in my case, I'll point it at dist slash bundle. So let's make those changes now. So I'm going to go into package.json here. And I'll just make those two changes. I'm going to call this contact table. And I'm going to set a main. And that'll be set to dist slash bundle.js. But let's say part of our old site is PHP, but we also have some newer part of our site that's running React, specifically a system built with Create React app. Now Create React app, we don't have control over the build process. So we can't exactly add Svelte to a Create React app without making major changes to it. So let's say we wanted to add our contact table to the React part of the site as well. How would we do that? So if I switch over to our editor, inside the blog here, we have a React blog. So I'm going to spin up that server and we're going to open it up in our browser, starting the development server. If we take a look in the browser, we'll see we have this very basic React blog. And let's say we want to add our new Svelte component to the React site. How do we do that? Well, first we need to install our Svelte component into the React site. And you may not know this, but you can install an NPM module from a local folder. So we can actually just do NPM install and then point it at a folder in our code base. We don't necessarily have to install it from a remote location. So let's do that. But you could also, if you wanted to, you can also install from a Git repo or some other remote location like that. You could have a private NPM repository as well, I suppose. So for our purposes, we're just going to install it from the same folder we have here, this contact table folder. So I going to go into my terminal into that project We going to go into the blog and I going to from inside here npm install dot dot slash contact table So I installing the Svelte component from contact table And because we made those changes to our package JSON, we're able to import it into our code base. So now that that's done, I'm going to switch over to our app dot JS. This is our React blog. And inside here, let's say we want to add a new section, contact us. This could be a new page, but I'll just put it lower on the page for an example. So I'm going to take a similar approach. I'm going to make a div here. So if you haven't used React before, this will seem a little bit strange. If you have, it may be very common for you to use this. So I'm going to call in a couple of hooks, use ref and use effect. Now, if you're using a different framework like Vue or Angular or something else, it'll obviously be a little bit different, but the concept is going to be basically the same. So what we're going to do is we need to somehow get a handle on this div here. We need access to this element so that we can mount the Svelte component there. To do that in React, we use ref equals, and then we need to call use ref. So I'm going to make a variable here, root. Actually, we could call it contact table root. And we'll do use ref, call that. And then we can pass this in to ref here. And then the way it works is now we can call contact table root dot current to get access to that element. It's not as nice as Svelte's bind this, I have to admit, but that's how it works. And we're going to call use effect. And we're going to have a little function in here. that's where we're going to do the exact same thing we did in the PHP code. So we're going to call new contact table, which I haven't imported yet. So let's do that. Import contact table from, and I call this contact table. So we can actually just import it like that. So now we have access to that. We're going to set the target to be the div. So in this case, contact table root dot current. That's how you get access to the actual element. And we can pass some props as well. I'm actually going to copy over the JSON file that we used in our public site. I'm going to paste that into our source folder just for this.

 purpose. And so what we're going to do is import that from that JSON file, contacts from contacts.json, and we can pass that in to our props. Now, the other thing that's important to do here is have some sort of destroy function. We need to be able to unmount our component from the page if this component gets unmounted itself. So to do that with use effect, we need to first have a pointer to this component. So we'll get the return value from instantiating the component. And then what we'll do is return a function from here, where we call contact table dot dollar destroy. So that's our unmounting function that we get from our component. The last thing I need to do for React is pass an empty array here so that it knows it needs to re-render that. All right, so now if I take a look at our blog, we'll see that we have our contact page here. Now you'll notice I have these buttons as well, and that's because even though the functionality is working pretty good, I don't have my CSS. So last thing we need to do is include the CSS. So I going to import it from contacttable slash dist slash bundle dot CSS And I don need the from there So if I switch back and I don even need to refresh it already set up So now I can click these Everything's working great. So to review, you can install your Svelte component as an NPM module to your existing framework. Once you import it, you can instantiate it and you use the same instantiation process that we did with the PHP site. So that works pretty well for most systems if you don't want to add to the existing build process. But the problem with that is now you have two build processes. So what if two build processes are too much? What can you do? Well, if you're using Webpack, you can use Svelte Loader and modify your build process so that any Svelte components in your code base get compiled to JavaScript on the fly. If you're using Rollup, similarly, there's a Rollup plugin for Svelte that is pretty straightforward to use. And if you're using another build process other than Webpack or Rollup, then there are other options available. Or you can use the separate NPM module approach that I've shown you. So let's say one day all your dreams come true. You get to rewrite your entire app with Svelte and SvelteKit. Can it be true Well does that mean that you now have to throw away all your old components Do you have to start from scratch and rewrite every single line of code Or is there some way that you can pull those things into a SvelteKit site Well, if you're using React, then you have the option here of using Svelte React, which is a component I built that is in NPM. So you can do NPM install Svelte-react. And the way it works, it's a simple Svelte component that mounts a React component onto the page. So it actually takes the same approach we just did with Svelte inside React, and it's flipping it around the other way. So you can kind of take the same approach. You can have your React components or view components, whatever else. In a separate NPM module, you can install that into your SvelteKit project and then import those old components into your new site. and we can just take a look at the source code here of Svelte React. Here's how you would use it. You can import a React component like widget in this case, then you import React component from Svelte React. And then this is inside your Svelte code here. You can then instantiate using this equals widget and you can pass some props and you can even pass some children text. So if we look just in the source code for the React component, it's pretty straightforward. And you can use the same approach So it hardly any code at all What I doing is I have a hook after update and then I pulling in all the props that we need And then I calling the React instantiation code, react-dom.render, and I'm mounting it onto this div. So I just have a div placeholder, same thing we did with the Svelte code. I have this container. And then similarly, when the component unmounted when it's destroyed, then we need to unmount our React code in the same way. So you can take a similar approach with any other code, whether it's an old jQuery plugin, or any other old JavaScript code you have, you can use it inside your SvelteKit site. Gradually over time, start rewriting more things in Svelte as you need to add features, or whenever it makes sense. So now that all your dreams have come true, you're using SvelteKit, you are now a full-time Svelte developer. You thought it wouldn't be possible, but you found a way to do it. I hope you've enjoyed this and find some ways to integrate Svelte into your older projects. Maybe you thought it wasn't possible. And maybe you don't have to wait till the day that you can rewrite everything. Although we all look forward to that day, don't we? Well, I hope you've enjoyed this talk. You can find out more about me at codingwithjessie.com. And be sure to check out my video course for Svelte, The Joy of Svelte at joyofsvelte.com. Thanks for watching.