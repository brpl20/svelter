 How to test it with Playwrights? So testing it with Playwrights, you must. We will do the last click, yes. So as a developer, every day we know we take our laptop, we code in different places, sometimes in coffee shops, sometimes in a cool office like this. And then at some point you have to do meetings to review PRs, to actually push your code in production. And anyway, you have to push in production no matter what, right? Because you have to have more and more features because your product owner is asking push to prod. And then emotionally it's going to prod. Everything is there, but sometimes not working fully or you're not 100% sure, but it's there. It's in prod. Cool. And this is what I call the feedback loop. So the feedback loop, it goes to a process, and at some point you get the feedback that something didn't go as expected. So the idea of the talk is to shorten this feedback loop, and we saw already with plugins and everything, we can shorten this to make a great developer experience. And this is why I also love Svelte. So first thing you should write maybe sometime unit tests, and I encourage you to look at this this V-test option because it's really fast and it's running your unit test in a pretty good manner. I don't write unit tests for everything. Don't write a unit test for everything, just for what matters. And then we will talk a bit about playwrite. So playwrite is for end-to-end testing. So it's more like mimicking the user of your application and not because what is not so good in unit testing is like it's component to component. So it's like developer to developer. we are really happy but it's not for users and i prefer to test like a user not like a it to it let's say and then as you can see we are shortening the the feedback loop like this and eventually it will be a better ice cream right at least we will bring more confidence confidence Just before the talk, I asked on Twitter, is it better to do slides or live coding? And the result was exactly this 50 So 80 people voted and it like yeah do slides yeah do live coding So then I'm almost done with the slide and I will go to live coding. I saw that it went pretty well on your side, so I hope it will be good too. Just to explain a bit what we will talk about, of course we will speak about SvelteKit with Playwright. And on the other side we will have the Star Wars API. Maybe some of you played with it already, I don't know. And we'll use something to link the two, something called Houdini. Because of course it's an excuse to speak about Houdini. So teach you I will, or I will try at least. And then we will just run like everyone before me the two commands. So the first command will be to create the app, the Svelte app, and the second command will be to initialize Houdini. So let's just jump into the code. I even created this before. Perfect. So we'll do a skeleton project. We will use TypeScript. Yes to yesLint, yes to this, and yes to the last playwright. We have everything now. So we'll go in the right folder and launch our PS Code Editor. Let's see what do we get here. So first thing, I will add also a Houdini like this. We don't need to npm install anything after. So we do this, init. And the doing this command is asking you where is your you know the stairwise API where is it. So this I don't have it by heart so I copied where is the API this one Just need to paste it no already wrong okay let's start over Yes, paste it. I have no internet. No, no, but I'm not pasting local. Okay. I was pasting local. And then just a little trick to do Don look at this It will be fixed after the talk Okay so now we have everything set up We add Svelte and we add the library Houdini. And just to be a bit clean, I will just do the commit here, tada, new init. Like this, there is nothing in my Git here. And then now if I do pnpmi to install everything, It should be faster because it's pnpm. Okay, maybe it's not faster. I don't know why. 12 seconds. Okay. And then I start dev and I should have everything. It's a normal expected message. My localhost is running with my website. So this is just before we saw the demo application. and here it's the empty project, right? And we have this welcome to Svelkit. And by default, since I said yes to playwright, I can start another console, the second one here, and I can do a PNPM test, and this will launch my playwright test. Okay, so it will run, actually it will compile into a production build, because we want to test the production build and not the local development environment. It will pick up the right, There is one test by default, and apparently it runs well because I have this nice check mark. Now let's see how to break the test. It's pretty easy. I will not show you the test right now. So instead of saying, welcome to Zvelkit, we'll say, welcome to Vienna. Then we'll remove this for now. We run the test again. I should have prepared a few sentences because all the time it runs for five seconds. And now it's telling me that it was expecting welcome to SvelteKit, and now I have welcome to Svienna. So I have to fix my test, right? The test is on the left side here. We have a folder dedicated for this called test. And I'm coming here. We can read pretty easily this message, which is also pretty cool with Playwright. So we go to the page, the root page. We look at H1 and we look at welcome to SvelteKit. So we can say welcome to Siena and this will fix our problem Today with this configuration so I want to show you a few tips that I use in regular basis So today we see just here a list of tests and with the small failure If I go to playwright, I have here all the configuration needed for this playwright. npm run build, what I told you is that it's building the site to test in production environment. And then running the preview. Then you can have a few reporters. One reporter is called... One reporter... So the one we were using right now is called list. And another one is called HTML. So the other one HTML, if I run the test again, it will give me even a report. Oh, I should have failed the test before running it. So as everything is passing, there is no report shown, but when we fail a report, you will see that we will have a new UI for this. Don't worry, I will fail all the tests later. And then there is another nice command that I use. It's called here, trace retain on failure. Like this, when we have a failure, we want to keep it and we want to display in HTML a nice thing. Okay, now we are all good to go. Now let's build something with our Star Wars API. So for this we will create a few files. First one will be here the plus layout.svelte and in here I will just copy the welcome to Vienna here and I will add a slot. For the one who don't know a slot is something that will be rendered inside the layout. Okay so in page here now I have the home actually i will just here it's still running usually of course like every developer i have 20 screens but here it's a bit more difficult so i have my home and now i can come here and add this very nice design and add a link

 to the page where am I? What about? So we are on home. And then after we will do another one called list. So yes, I have my pretty good design. I have home and I have list. List now give a 404. Why? Because there is no list. So let's create our list. So we create a folder called list. And we create this specific file from SvelteKit SvelteKit called plus page dot Svelte and now we are in our list so I will create the h2 list wow no more 404 no refresh coming coming back yeah no refresh we have the home and we have the list and we have navigation no restart no anything yeah I don't emphasize this a lot because I'm very used to actually Svelte but in other places sometimes it's long to get this process right And now I will add another special trick. You remember we have this API, so we just open it to you. The API for Star Wars. And I wrote the query here to get all the people and I will just run it to show you what output of this. So we can see Luke Skywalker and I asked the first 20 characters of Star Wars. Okay. I will copy this query and come here and create a specific file in my system, plus page.gql, to tell him, hey, it's a GraphQL file. And I will paste it here. I save. And just by saving, I go at the bottom. He's telling me, hey, I did the magic. And I will bring to you a list of people. You see the name of the query here. So I go back to the page now and on top, I want to get this list of people. How we get this list of people? Usually we have a script. Yes. Why is he so smart today? And not usually. And so we do export let data, right? Data. And we take page data. And when I save this, I don't know who it was, Dominique who said that page data brings the type of this, right? But if I come to here there is nothing coming on in data of course because Veld doesn know about this specific file page But now if I change the type here by Houdini now data is typed or should be typed. Yes, data. We get the list of people. Just inferring from the file beside, right? And now here, so I will do this small syntax to destructure and have it as a reactive statement. So I will do this and equals data. And what was inside data? It was list of people, right? In the list of people, so if I do $listofpeople.data, I have everything, .allpeople.edges. So this is already fully typed, you see, to get the query. I focus only on getting the query. So I take this and I will actually put it in each loop. So I do like this. Instead, if it's empty, I give an empty array as edge. Then I will finish the each. Is it good like this? No, I don't care about the if. I should have wrote it in the question on Twitter. right? Should I use Copilot or not? Oh, okay. So it was the demo effect because it's coming here, right? And the demo effect with the Beamer because it's coming here. Okay, so I have here, yeah, it's still here. So I have the just the... I don't touch. So I have my list and... So even better, yes, I have my little points. Now it's really annoying. Yes, I type too much here. Yes. So background color, if I put everything red, will it go red? Yeah this is my debugging way of doing things I guess you never did this but Okay so if you remember I was getting another thing from it The name and I was getting something else I don remember the name of it I was getting something like... If I go edge.node.skinColor. So instead of having it red, well, there is a skin color, and some are green and some are gold, okay? The others are different colors that we don't manage in CSS, but we could imagine something, right? So with this, we have already, we did the query, and we got 20 results. What we want to do is to add the test for it, right? So I will add here a new file called n2n.ts, and I will simply copy this over there to see if it's at least working a bit or not. I will grab the h2 and check that we have it like list. I will not write list to have a failing test first. And I need to of course do a little change in my playwright file to say matcher test match. Because actually I'm not sure it's a good idea to have your file in a test folder. Why don't you just put it like all the regular files here? You have a route and you want to test your route, put it there. So if I run again the test, it should break, but let's make it breaking fast. And now that I have my report HTML, it directly opened the HTML page, you see, and we see that we have a timeout. It was expected. By default, it's 30 seconds. That's why I changed it to two seconds. And yeah, I can read my test, which is really good. It's like I go to the homepage, not to the list page. So of course it will never get a H2, so it will never get anything But what is interesting is that at the bottom I already have the trace also I click here and I able to see the different thing that he was doing the website So it was going to slash So I can see the screen of slash and of course he doesn find h2 In debugging mode it's really nice to be able to go again to your test and see where it fell and at which point and at which stage just with few configs. So now I come back here and I will tell this guy go to please the list page. So now I'll fix this already also because we saw that should be working. No, of course, no one told me that there is a capital L. Thank you very much. Then the next step is what? Is to create another route to click on on Yoda to be able to see the the detail page. This is quite common, right? So I will create another route called people and in people I will have probably an id and in this id plus page dot t dot I'm a debugging guy, and that's why you see a lot of hello, console, and red. So I'll put an A here with the href. People, and I want to have this slash the $ID. Of course, I need these other things. No, not like this of course. We grab this and we give here the ID. Save, come back to my website. These are all links now. If I click here I see hello. Okay, I'm in a good track. You can't see but I can see. Hello is there. Still here, okay? So now what trick do we do? We add a new file, .pluspage.gql. And in this pluspage.gql, I come back to my API.

 I don't move. Come back to my API. I go to people. And here I get a people with the ID as a variable, the ID and the name. Okay, I just copy this. I don't know if you know here, but if I come here and I do control space, I get to see every property which is available. Okay? And all the properties available, I want to get them as type safe on my app. Like this, I don't do any mistakes or less mistakes. So I save this again. It's run in the background. You see that we have a new magic people coming And I just come here. I will do a very nice copy paste Because we never do this but sometime you know And it should be people directly is picking up people because we import from Houdini we know the route we know everything So I come here I put people and I I will do simple here, I will do a pre is event dot springify just to display the thing. I will let designer do a better job. Right. Now there is one thing which is missing. Did someone know, do someone know what is missing? He's telling me in the log directly, oh you are requesting a variable ID, but you are not providing the variable. So how I know if it's Yoda or someone else that I want to pick up. So I just pick the name of the variable here and I go to my page.ts and I export the name equals function return and here return, what do I return? I'm a TypeScript guy so I need to have types so I do import and I import types and the type name is the same name as the variable like this it's easy right? we name it v for example from we take it from dot slash dollar Houdini. This was the same as before, nothing so fancy. And we say here it will be of type V which is just defined here And now he knows already what he expecting He expecting an ID And the ID will be filled by the param which is given by the route, right? So if I come here and I do here, and I open the brackets, I have all the parameters coming here. All the available parameters from the load function that you most probably know if you know a bit of the result. So if I do params, Now I'm able to give the id params dot id. Save. And if I come back here, what is this? Oh, no, it's because I did it not good. I don't want to give the whole people, but I want. Ah, okay, very good. Everything went perfectly. So I want to see dollar people because it's a store, the data and boom, I have Yoda. So if I go back now to my list, I can see Luke and I see Luke. I go back to my list and I see Yoda and perfect. Another trick that I want to show you is that if I open the network tab and if I go to the, this is just a, wait. This is just a filtered list of GraphQL, of a network query. So if I go back to list, no query is happening. is happening. If I do F5 here, no query is happening because it's in server-side rendering. Now if I go to Yoda, I have this query to know this query. And if I go back to list, nothing is happening. So we take the best of SSR, of CSR, of getting the cache, not the cache, everything is handled there. We're just adding this plus page.gql. So let's add the test for this. I go to id and I create this file and to n.ts There is another extension maybe to show you which is called testing and it's connected to Playwright. It is actually the Playwright VS Code extension. So if I do a record new it will launch me a tool here which is the browser and we're able to copy here the link, enter, and it will try to create my test for me. So now if I go back to the VS Code and you see it's synchronized. So now if I click on Luke you see the code is coming into VS Code directly So he found that I clicked on the link with the name Luke and I did a click And now I should expect to have this URL So he's looking at the URL and making it as an expected statement. Oof, I showed it to you. One thing cool. So yeah, at least something. And like this, it's really so what is really nice is that it created me this test file here, which is not picked up. know with my my strategy because I want everything in the route and now I can just safely I can just safely copy and paste that in my end-to-end test here no I cannot safely do this I have to grab all the file paste it here and now we don't want our test to be fully dependent on on the localhost right I didn't find how to remove this but okay it's fine enough I just remove it here like this and it's done. So now if I run again this end-to-end testing I have now two tests with two workers. You can configure all these to run faster tests and things like this. And now my two tests are passing. Next stuff I want to show you and it's here that I will pick up this maybe. It's to make sure that the page is working in SSR without any query. So to do this trick, I go to the right people directly with the ID. I picked a random ID. And I do a try. And I want to wait for the API to answer. And actually, I don't want any answer from here. So what I do is that I wait for the answer for two seconds. should come a lot faster anyway and and if it's going here that means that i got an answer so i expect zero to be one and you know what it will never work this so which is good then i want to go in the catch to expect one to be one with a very nice comment saying that no response came perfect i i think that this is a cool trick i'm not sure a lot of people is using this to have this try catch and having this expect on the catch because we expect to have this catch And then we looked for the pre tag and we looked at it containing Yoda So since it live and maybe it diverged quite a lot from what I tested will it work I don know No. No, okay, no problem. It opened the HTML file. I can see why it failed. So he didn't find a pre why? Maybe I need help. Yoda, yes, pre why? Any hints from someone? people page wait oh no this is really people yeah w okay so we we know that it's failing here so at least it's not failing here perfect yeah i should have only one but okay never mind we will fix this later for our production app later it's not it's not a big deal if it's not working now so actually the last step i wanted to show you i'm a if i leave the the breaking and i don't do a test that's keep you know maybe i should not have you that there is a test.skip but the last part i want to show you is actually to say let's push this on github and to push this on github you you create a file here so i don't know if you are familiar with this dot github slash workflow and inside you can create some workflows that will run on each pull request and in here in in the playwright.yaml so this i prepared it sorry and we can go over it a few seconds. It's actually almost this on the Playwright website. So basically on any push or any pull request to main or master, I will check out the code. I will set up the whole environment in Node 16 using PNPM. Okay, why not? Then I will install Playwright. I will run all the Playwright tests and I will store the report. Okay. So with all that, Oh, with all that, I just

 from here. Gitignore, I will add just in the gitignore this guy and this guy. Test result. I should have yes. Almost working. So I will finish the setup like this. I'll go here. I'll create a new one. So slash this. And we make it public so that you will be able to fix it, which is nice. Yes, no. I in direct Yes no Coming directly So the code is here. So the code is pushed with my very nice Git messages. And in actions, just by this one file of workflow, it triggered everything, and it should go along the way. And it should break because we saw that it's breaking, right? But you will fix this. And this will run for about a minute. The longest part is installing Playwright. But I think it's really nice to have this as a gate for your production build. For your production build, I think you can wait a minute to run at least that your homepage is working. Just the homepage. How many times this can break in a smaller environment? It can break. And actually just adding this go to homepage, making sure that it's working and you have your H1. I think it's already a good thing to do. So also just for info, the whole library we are building Houdini is all end testing with Playwright So we run a lot of end testing making sure we don do extra requests and things like this So here I showed just selecting a text and making sure the text is the right text but actually in the background you can check for network call console logs and everything. So for for me, I'm using it as a library developer mode. We do like like uh, so SvelteKit is here. We have a dot SvelteKit that you said before which is right, don't touch it. and we should not touch it. We tried. So in types here, we see the, this is regular belt, right? And then in Houdini, we reproduce the same thing. So we reproduce type source root list, type source root list, and we have our $Houdini. So we reproduce the same, and actually we are in the change so that even, we will not need probably soon to have $Houdini, but we will hook them into the dollar types. Like this, no one has to think about it. But this is even more magic. Oh and I forgot the most important of course I needed to write what is it route people and we had to do this thing here. We have to do this import to get the variable and sending it. We are right now working on a PR. If we have the same matching name between the query param and the variable, you don't even need this file at all. So this file will completely disappear. Yeah, we do everything for you. So the idea is to focus on your business logic. What you want is to display on the page your data. And of course, you have everything in the query program. So let's just get out of it everything. And you can always escape from it if for some reason you have done everything. I'm JoÃ«l. Thank you for your attention. Thank you.