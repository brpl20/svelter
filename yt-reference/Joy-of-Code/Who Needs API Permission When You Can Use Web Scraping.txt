 Hey friends, today we're going to do spy-driven development. And what is spy-driven development? That is when something is so awful that you decide to do it yourself. So for example, this was supposed to be a frailt video where we do this awesome 3D visualization. Don't worry, that's the next video. But what happened? I was using this Kylon GitHub API, which randomly died the day before I decided to record the video, which is really great. And if it worked now, I would be really upset. So yeah. So basically, I discovered from the network type that I had this awesome API, so you could have done your username, year, and then you say JSON, and boom, you just get the data easy peasy like this, but you can see something is broken with the GitHub API, billion dollar company, by the way. So I'm presented with two options. I can use their awful API, which is going to take me hours to figure out to get what I want, or I can just simply do some web scraping and get the exact data I want. So for example, let me show you how easier this would be if you just get JSON. So if you go to any subreddit, and I'm afraid to pronounce the name of this subreddit out loud because I'm going to get destroyed on YouTube. As you can see, it's really harmless. It's RISE desktops, right? So we can look at some really cool RISE desktops. So let's say that you want to maybe make a site that showcases them in the order you want. So if you didn't know on Reddit, if you go to any subreddit and append JSON at the end of the URL, you're going to get the JSON data. Take that Reddit API limitation. So now we can open the developer tools. We can look at the network tab. And this is the first thing I actually do on a site. I look for the fetch response. So we can go to the filters. All right, so let's refresh everything. and I'm curious why is there no JSON? There it is, anyhow. So we can open this data here. You can see here is everything you need, and boom, we can yoink this MyAPI now, how easy peasy this is. Okay, but it's not easy in this case because we're going to struggle a bit, but it's really educational because you're going to use this as an excuse to practice some DOM manipulation and data manipulation because this is most of what you do anyhow as a web developer. So, all right, so first let's look at our mark. So here we go to your username, github.com slash user. And now we kind of look at this thing, how it works. So this is really like some table. It has months here at the top. And then for the days, it seems like it goes from Sunday to Saturday. But actually, let's first see what happens to the URL. So for example, right now, I know that I probably want to use this URL as the API. So I can just scrape this site and do whatever I need. But let's see what happens when we change the date, right? So as you can see here, let me zoom in. You can see in the URL, it uses query string. so we can get the year from the start of the year to the end of the year So that really interesting So we can also use that in our API And how awesome is that But okay that really cool But let examine actually how this works So we can inspect it And now let me just collapse everything. As you can see here, this is a table. So in table head, we can see the table row with table data, which is going to be 12 for all the months in the year, right? And we actually don't care about table head. We care about table body. So you can see we're going to see seven of them because it goes from Sunday to Saturday. so it has all the days in the year for that row. As you can see, it has, let me just zoom in, it has some interesting data here. So as you can see, here is the actual content, no contributions, etc. So we can actually parse this out and do with the data whatever we want. As you can see, here is some interesting things. You always try to look for these patterns, right? For this date thing, maybe I don't care. This is really interesting, data level one. And that really corresponds to the color of this thing. So this is data level zero, one, two, three, four. so now we can scrape that and we can get the exact colors here and what's really great let me show you when we do this so probably well probably already know me in advance because I've done it as the great chef I am so we can query this table rows then we're going to loop over the rows and then we're going to loop over the table data inside that's going to be really simple like this and we're also going to ignore this one so we're going to do a selector like select everything but this contribution calendar label and then we also want to select this empty one and we're going to assign it null when we loop over it. So it's really part of this table. We're going to see how awesome it is. So let me show you how awesome this is going to be. So I can take this text, no contribution, and then we don't really have to use any regex or something silly like that. We can just say split. We can say space and boom, now we get an array. So now we have all these indices that we need. We can say, hey, if this is null, then it's going to be zero. Otherwise we're going to assign the number and et cetera. We can clean this data up. You're going to see how awesome that is. and this is honestly the best way to play around here. So we can say document, query selector all, for example. So now we can say ebody, table rows. Now we're going to get table rows, which is really awesome. So now we can loop over them and do whatever we want. And using the browser console is a really great way to get this instant feedback. All right, but there's some other cool things. So let me just zoom out. I'm going to close this. So if we look at the table here, actually I'm going to inspect it again let's do it like this so we can go above the table right and this is like the most fun part about this so we can see what going on here is some junk we don really care about But here I found something interesting So here we have a data graph URL which is slash users, your username, contributions. So it's like this. Let me just remove this. I'm also going to zoom in so you can see what's going on. Okay, so now I'm just going to go here. I'm going to do users, contributions. so this is going to open only the table HTML but there's something other interesting you can see here are the dates so maybe how we had the date before let me just zoom out of here so you can see this and I'm going to copy this so as you remember when you got this URL like this so this is for the year 2022 so let me just zoom in and now I'm going to remove overview I'm going to actually put a question where we thought this is a start of the query so we can go to GitHub like this. Let me just remove this URL. We go to github.com users, your username contributions, query param from start of the year, end to year. And this should work. Let me just go here. And how awesome is this, friends? As you can see, like maybe we got this lucky, but if we didn't find this URL, that's really not important because we would have used this URL anyhow, but we would get a lot more data, right? And this is really easier to use this URL for scraping the data. Alright, so to get started I already have a SvelteKit project which I expect you to know already how to do that so I'm going to go to the source folder open routes page.svelte and that's basically it I just have some default styles here which we're going to look at later so really nothing fancy here all right so you might be thinking how do we fetch this data first right and we're just going to use some fetch let me just create a script tag here and I'm going to start typing on mount I'm going to press enter this is going to import it I'm going to use an async function like this and now I can say away fetch and let's just do this and let me just open the console here the browser so I can close the network tab all right so that's it now inside my editor I just need to press save and we get a nasty error and this is where people freak out and don't know how to deal with this but basically you get an error about course and basically the resource in question the browser is trying to protect you from any malicious script that can run so the course policy in the browser doesn't allow you to make a request to that resource. As you can see, access to fetch at this URL has been blocked by the course policy. No access control of origin header is present on the requested resource So there two things you can do You can either Google pre proxy and that is going to proxy through some server right And you can access the resource But we already have a server with SwellKit right And course is only enforced by the browser which means we can do whatever we want on the server. So instead of using client-side rendering or fetching the data on the client, we're going to fetch the data on the server. And how are we going to do that? Well, we're going to create a standalone API endpoint in SwellKit. All right, So how do we do that? Let me just remove this code. And I'm going to close this file. So let me go here. I'm going to zoom in so you can see what's going on. So inside of routes, I'm going to create a dynamic file so we can get the parameters. But you can use query params if you want, and it's perfectly fine. So first, I'm going to create the first folder. So I'm going to open the Square Boys. I'm going to say user, not esser, but user. Then I'm going to say slash. So I'm going to create a new folder, which is going to be year, same as the GitHub API, if you remember from before. And then I'm going to create a special file to SvelteKit so it knows this is a standalone endpoint. And why are we creating a standalone endpoint, for example, and not just fetch the data on the server? Well, maybe we want to reuse this. Maybe we want to host somewhere and expose it to the public so others can consume it like any other API, right? And that's basically what the standalone API is. So I'm going to press enter. It's going to create these files. As we can see, user, year, server. So we can get this from the URL, right? The user value and the year value. alright so let me just collapse this and the first thing we're going to do is export a get function so we're going to say export async function get and this is really the same HTTP verb get you have others like post etc if you're not familiar with this so we can destructure the params from this let me just do it like this we can console log out the params which you're going to see on the server so this is going to be inside your terminal not in the browser terminal and we will get an error so we need to return some response and this is just using the web platform so you can say new response and we can say api endpoint all right so let's save this and now we can go here so remember this is the same route we created so now we can enter your username and you can enter the year you want and now we should see and this is just an error for the favicon this drives me crazy vt is insane sometimes okay so as you can see here is the user and the year and everything works fine so you can just ignore this stupid error it really drives me And you can see here is the response that we returned, which is really nothing. So if we go to the network tab, let's just see two or two. And this is literally what we got from the preview. So it's really just text return back. And later when we're done

 We're dealing with the data. We're going to return a JSON response, the same as any other API. You can also return XML. You can return whatever you want. This is the beauty of API endpoints. You might be confused how it's different from page endpoints in your cell case. And basically, page endpoints are only concerned to fetch the data for the page, right? But API endpoints are something more reusable, like your RSS feed, because we can return anything you want. All right, but let's actually implement the fetching so we get some data. We go here and create a new function. So I'm going to say async function, get contributions, just so it's more readable. so we can destructure user year something interesting I learned we can import the route params so we don't have to type it ourselves let's see route params like this and that's really beautiful if you're using TypeScript of course which is optional if I didn't mention it so don't be afraid if you don't want to use TypeScript or you don't know TypeScript just ignore the types alright so now I'm going to say API and we can go here where it was so we can just copy this entire thing and let me put back text because we're going to have variables inside so now we can go here and we can say user and we can also change the year so let's see ctrl d let's select these two at the same time dollar sign year like this and awesome so now we already have an API working almost right and we can say const response and this is going to be await fetch and we're just going to pass the API URL and let's just do some checking so if we see that the response isn't okay we can say throw new error and also going to give it backticks fail to fetch we can say response if I can type response.status or whatever else you want and basically that's it so now we just need to return it it might be used to saying .json right but in this case we're returning HTML or just text in this case because it doesn't know that it's HTML. It just text when it's sent over the wire. We can say return await response.text. And how beautiful is this, friends? So remember, this is on the server, so we can go here. We can say const HTML. Get contributions. And now we can pass it a params, which is already typed, so everything looks great. so now if I open this let just go here we can console log it if you want so let just do that So let refresh this I just going to go here Let refresh Oh, now we get promise. I forgot an await probably. Let's see. Yeah, of course. I'm a genius, by the way. Okay, now let's refresh it again. As you can see here, we get the text or HTML. And want to see something else that is awesome. Let's just pass it here. And now we're going to get the text response if you refresh this route. Let me just close this. Actually, I can do that. Smaller. As you can see, here is the markup. And we have so much less to parse because we're using the specific URL for the table only. So we're really responsible when we're doing scraping. All right, friends, but there's one huge problem. How do we parse this as HTML on the server, right? There is no document object model on the server, which is really a shame. But thankfully, there are some awesome libraries that can fake the DOM on the server and let you query elements like you would in the browser. You might have heard of something like Cheerio, which uses ijquery syntax but the problem I have with most of them is they are tied to Node.js so what if you want to host it on Cloudflare something using workers or etc where there isn't a Node.js environment basically I've learned from this library from Westboss which is called LinkyDom so you can just go to the terminal let me just stop what I have going on here I already have it installed I think but if you don't just use your package manager of choice PNPI LinkyDom I really don't know how to pronounce it it's really not a great name to be honest but yeah basically just install it if you haven't And that's it. I'm just going to run the development server again. And basically that's it. So in our endpoint we already got the HTML so now we're going to create another function which is going to be function parse contributions. We're going to accept a HTML which is going to be of type string. And now we can import our library so we can say const and we're going to destructure document and parse HTML. So this is going to be from linky dom we're going to pass it html and we're going to go at the top so let's just import it we're going to say import rshtml from linky dom all right so now we're cooking let's go back here and now we just want to select the row so we can loop over them right so we can just go here we can say const rows and now we can actually just use document like in the browser you can say document query selector all so same as before we can say tbody table row and if you want to type this out again optional only if you using TypeScript we can say HTML table row element another thing you have to be aware of this isn like regular HTML elements I mean it is regular in the sense that this is some node list but if you want to use methods like map and etc then you should spread this like this or you can say array from but in this case I'm not actually going to use any array method and these are iterable so it's going to work with regular loops but just to keep that in mind this is what drives me crazy about node lists and those other types to be honest. Alright so basically here we're just going to keep track of the contributions so I'm going to say cons contribution which is going to be an empty array so now we're going to loop over the rows and I absolutely love 4 of loops they're absolutely beautiful and easy to read so we can say cons row of rows so now we're going to loop over every row and basically what do the rows have if you remember let's just go to the API and just inspect it so this is just the table without the styles. That's why it looks so weird. So basically we just want the days. So this is going to be the day inside the table row. So as you can see contributions. And again, we only want to select the ones without this label. We can also include the label if you want. So you can use this on your table, but I really don't care about the label. So let's just go here. I'm going to say const days. And now we can say row. Query selector all. So what do we want to select? We want to select table data. And we want to say not. And be careful so you don't mess something up. So it's going to be not. So we want to exclude this class. Contribution. Calendar. Slash label. And that's basically it. And also if I didn't show you. Let me just show you. So we just need to use it. Parse. Let's see. Parse contributions. Instead of here. Let's just say. Parse. Contributions. HTML. so let's just refresh this so you can see it looks really weird this is really hard to parse yourself so if you're doing any manipulation first just do it in your console it's very easy you get instant feedback right because this is like really hard to read like even though it gives you the names and etc but yeah just use the console and let me just close this and get back to our code so now we can keep track of the current row so let me just make space for this you can say cons current row not call that's interesting okay we can loop over the days four columns day of days and how beautiful is a four off loop friends right Awesome so now remember what I said before We can split the days. So we can say, for example, const data equals day. Let's see, inner text. And the reason it has no idea about this TypeScript, that is because we can just give it a type here, which is going to be html table cell element all right so now it doesn't complain how awesome is that so let me just log this out so you can see so this is one of those rare instances where you can actually make sense of the data because you're actually just logging the contents inside of it let me just open the terminal i'm going to save the file we have to reload the endpoint so now you can see ah how awesome is this now we get this array of items because we split it so now we can parse this data however we want. Alright, so let's do that. So remember that empty table data. Well, basically we have to account for it. So we can say if data length spell it properly is higher than 1. So now we can construct the date or contribution. So we can say const contribution. So now this is going to be an object. We're going to say count is data. So this is going to be the first thing from the array. you're going to say hey if this equals no then you're going to say it's zero otherwise you're going to say data zero so just return the count whatever you want and we can also use a plus here or you can wrap it inside of a number so just that it isn't a string alright so next we're going to have name which is going to be the third one and we just want to replace that period right replace we can just do it like this and we just want to replace it with nothing now we can also take the month we can say data 4 we can take the day again we can say plus data 5 and we want to replace it with nothing the same as before for the name alright the year is simple we just have to say data 6 and let's say level we want to get the data attribute so remember how we had this data attribute let me look where it is here if I zoom in data attribute, it's somewhere here I think, just see, data if we open data level 1 okay, so we know what color to use for these things so we can get this by saying data, and to access a data attribute we can say data set, and the name of the data attribute is going to be level

 And then I want to turn it again into a number. So we can just say plus. And then since Tyscript is complaining, so only if you're using Tyscript, we can just slide to the compiler, just give it an exclamation mark, don't bother me Tyscript, and etc. I'm doing a tutorial, don't you know? And awesome, so this is now the if statement, right? If it's higher than one. And we also, don't forget to push. So current row, push, contribution. And now we can say otherwise. So if that's the null table data, we can say current row push null or you can push whatever else you want all right so basically that's it so we can go here and we can say contributions push current row so let me just do it like this all right so we can now push the contributions right here so we are accumulating everything into that. And now when we push over and iterate over every row and push the data at the end from this entire function, right? Sometimes it's easy to lose track of these things, right? So we can just return contributions. Here it is. We can just say return contributions. Awesome. All right. So that wasn't that bad. Let's just log it out and see what we get. So here we have contribution. So let's just say, see, this is my snippet. I can just place it here. so this is what's returned. So let's see if everything looks right. And how beautiful is this, friends? So this is our entire data and we can manipulate this data however you want. You can store it in a database if you want. You can use Reduce or whatever you want to change the shape of it and it's really such a great exercise. So the only thing left to do is to return the JSON, right? So let me just close the terminal and SvelteKit has this useful helper so we don't have to set headers ourselves. instead of returning new response, we can return JSON. If you press enter, it's going to be imported from SvelteKit. So now inside of JSON, we can say parse contributions. We can pass it to HTML and now this will return the JSON just like a regular API. Let's see if everything works. How beautiful is this, Rance? Look at this. This is all of our beautiful contribution data 10x developer by the way So let me just mention something else If you want to host this somewhere again being respectful to scraping and using someone else API you can set a cache control header which is going to depend on the platform you're using and you should read the docs for wherever you're hosting it. So you can say for example set headers and I can go here and say set headers and we give it an object like this. So first if you have a course problem you can allow course by saying access slash control allow origin and you can give it a star so this is going to allow everything if you have that problem and now we can also set the cache control so we're going to set it for a year right because whenever someone visits it for a year it's basically cached forever so I'm going to get updated so I'm going to give it backticks because we're going to use some math I'm going to say public and I'm going to give it a shared cache and again this is why you need to read the docs for wherever you're hosting this. Maybe they have another way how to set cache control headers. And basically we can set a year. So I can say equals. And instead of pulling up the calculator and doing some hard math you can just say so it's 60 seconds right times 60 minutes times 24 hours in a day times 365 days. Alright so let me save this and again let's go to the network tab. Let's just go here. I'm just going to refresh this. so let me just zoom in here is our beautiful JSON if you go to the headers you can see here is our cache control our course for allowing the origin you can see here there is in seconds so here you can see here are the seconds for the entire year so every other subsequent request isn't even going to hit the GitHub servers to be fair they also probably use some cache they also probably don't care but it's really important to be respectful and not abuse scraping alright so let's get the contributions and display them like GitHub. So I'm going to close the API endpoint here. And of course, I can open page Svelte. And if I close everything, so we can use client-side rendering and fetch it here, of course. But let's just keep it consistent how GitHub has it and use server-side rendering. And again, now we're going to understand more the difference between an API endpoint and a page endpoint. So if I go to the sidebar, I can just collapse this so it not confusing Since it in routes where we have the page we can go say new file So now we going to create a page endpoint I going to name it page TS and that's basically going to fetch the data for the page. All right, so now I'm going to close the sidebar, and now let's just fetch the data. So I have this quick snippet, export async function load. So basically, you use the load function to get the data for the page on the server. So it's going to be server-side rendered. So now we can say const contributions, and let me show you something cool. So we can say await. We can say fetch. So now we can just user API. So you can give your username. You can give the year. But what you have to do, you have to import a special fetch because a regular fetch can't resolve this because like what is this to a regular fetch? Like this is not the entire URL. So Swell could basically make this easier by having this fetch, which is a more enhanced fetch. So it's going to be able to resolve this. let me show you something else that is cool so instead of creating another line and doing a response you can do another await like this and put everything inside of parentheses and then you can say JSON and you can do it in one line and then we can return the contributions and that's basically it all right so now inside of the page we can just get the data we can say export export layer data and let's just use a reactive value because the first time when it Actually, it should be on the page. We already have the data from the server. All right, so I'm going to save this. And let's just go to the console. I'm going to save this file. So instead of going to our API endpoint, let's just go here. All right, so now we get the contributions back. So as you can see, here is all our beautiful data. As you can see, it makes sense this is null, null, null here because that's literally the same if you go... Let's just see. I'm just going to close it here. as you can see for the year 2022 if we go here I'm going to zoom in so as you can see here it's nothing and basically this is all we're doing here we don't have to do any fancy sorting and etc just query what we have here these rows right and display them nothing fancy that's basically all we're doing alright so now all we have to do is loop over the data so I can go here below the title I going to create a table I going to autocomplete and now I have this snippet each so I don have to type it out we can say data contributions, as row, so now we're going to loop over the rows, again remember we want, table row, so we're going to create a new table row, seven times, for seven days in the week, now I'm going to use the same snippet again, so now we're going to loop over the days, we can say row, as day, and I'm going to create table data and that's it you can play some content here if you want I'm not going to bother with that I just want to give it a color so I can say data level again I'm using the same data attribute now I can assign it data level which might not exist so we're going to use the nullish operator let's save it and see the moment of truth and awesome we get the exact same contributions as you can see here I have just some simple styles Here I have the table data. I gave it some padding border radius. And I'm also using CSS nesting, which should be available in every browser. So I'm saying data level zero. I'm assigning it all the colors I got from GitHub. So it goes from zero to four. And that's basically it. So now we can request any other year here, make this public API, host it wherever you want, and it works beautifully. One thing I haven't done is, for example, if you want the current year, maybe you can do this as homework. But this is really interesting. If you go to the current year, it's in progress, right? So basically what they do, let me just zoom in. They basically, which is a bit confusing to me, they basically just give you the current month. But as you can see here, it's not just the current month, but it doesn't really matter. It just matters that if someone passes in the current year, you can do this check and you just scrape this thing anyhow and you get the exact same data, right? So it really isn't important. All right, and how awesome is that, friends? Now we have an API we can use. And in the next video, if you're curious, we can create this awesome skyline using github contributions all right friends so thank you for watching don't forget to like and subscribe you can support me by becoming a patron peace