 Yo friends, what's up? Today I'm super excited and it's not because I had a lot of coffee, but because I have a really cool video for you today. So in today's video, we're going to talk about making your own Svelte preprocessors. And what is that? Well, I'm going to show you, we're going to start with this goofy example where we're going to make an emoji preprocessor in Svelte so we can use emojis for variable names. As you can see here, we have let fire equals heading, and then we're using it here for the heading in our template. How cool is that friends? And then in the next example, we're going to make a markdown preprocessor in Svelte inspired by MD Svex, if you're familiar with that. So we can see here we have markdown in our Svelte component, so we're going to learn how to turn that into HTML, right? As you can see here, here we're importing a regular Svelte component as usual, and here we have markdown and Svelte in the same file working together. How beautiful is that, friends? Alright, so if you're excited, in the next part, we're going to talk about what preprocessors are exactly. But before I get started, don't forget to like and subscribe and you can also support me by becoming a patron. Alright, let's get to the Svelte docs to learn about preprocessors. So here is this wonderful section about preprocessors. So here is the definition from the Svelte documentation. Pre-processors transform your .svelte files before passing them to the Svelte compiler. So for example, if you use TypeScript in your component or post CSS in your styles, it must first be transformed into JavaScript and CSS so the Svelte compiler can handle it. and the one you're already using is wheat preprocess so in your svelte.config.js file you can see here you're importing wheat preprocess from the svelte import and then you're just including it in this array of preprocessors and this is the same way how we're going to make and include our own preprocessor so by default the wheat preprocess is able to handle things like typescript post css scss less stylus and sugar ss all right and in the next part we're going to learn how to make our own Svelte preprocessor. So before I get started, I know I'm probably going to get questions about this. I'm using this simple browser extension from Microsoft here, so you can type control P, pointy boy, start typing simple browser, show, boom, you can input your URL, and now you have a simple browser in VS Code, because we don't need anything fancy like developer tools today. Alright, so before we start writing a preprocessor, it's really important to understand how a Svelte component works. So a Svelte component is typically split into three parts. So you have the script tag, of course, then you have your style tag and everything else is here as markup, right? And basically writing a preprocessor allows you to hook into any of these parts and change them as you want. I think one of the most powerful concepts in programming, if you're new to it, once you start understanding how everything is a string and how most of the things you do, your goal or task is to turn one string to another string, right? Of course, at the end of the day, everything is bits and bytes, but that's really how compilers work, how anything works, that is. Of course, that's oversimplified, but I think it's a really powerful concept once you understand that about programming. Programming is just concatenating strings together. So the first thing I'm going to do is open the Svelte config. So I'm going to type Ctrl-P, and then I'm going to type config, and then I can open Svelte.config.js. And as you can see, here is the Vite preprocessor. So what is a preprocessor? well a preprocessor is just a regular javascript function so you can start typing function and you name it whatever you want i'm going to name it banana because why not so i'm going to return the name going to name it banana and the next part is important because these methods have to be in order which is markup script and style so this is the order in which these things are transformed so here we can go and i can do this since their method so we can destructure content from them and file name so these are the arguments you get and that's basically it now you have access to each of these parts in the swell component so for example in the markup we can say console.log content and don't forget to include your preprocessor here so i can go here and then i can type banana invoke it that's it and sometimes when you make a change you need to start the development server but in this case i think it should update let me just save i'm going to open the terminal as you can see here it is but in case you don't let me just press ctrl c i'm going to the terminal ctrl l to clear everything arrow up to get the latest command and you can just quickly rerun everything as you can see here a special thing about the markup method is that it also returns a style tag because some pre-processors might need it so if we scroll up we can actually see our component somewhere here so here it is here is our component and of course this isn't just going to run your plus page.swealth component in rows this is going to run every swelled file that it encounters all right but in our case we actually just want to name our variables using emojis so how can we do that so let's just think what we have to change right so we don't have to change the styles per se so we can just remove the styles the only thing where we have to update this if we look at here because for example let's go to title and then i'm just going to remove it and then i going to use it here and here so we using it in the script tag and in our markup right so if we save this this is going to cause a nasty error because this isn even valid JavaScript right So if we can go here right We just need to replace the content of this. So here you return a special prop code. So you do it like this, and then you can return content. And you can do whatever you want with this content. It's just a string, right? So we can say, for example, content, replace all. And then we can just use the fire emoji here and we can replace it with whatever you want. and of course you can have an object with emojis or whatever else you want you can get really creative with this and it's a lot of fun so we're going to take the same thing we're going to go to the script section and let's just also do this since we don't need the file name let me just remove this and let's just save it but still we're going to get an error and i'm really glad that we ran into this error because this is another important thing to understand how this preprocessor runs so for example why is there an error here because probably we're using typescript here So this thing runs with pre-process and it's like, what is this emoji in our TIE SCREME? What are you doing? Are you crazy, right? So let me just really show you the order sometimes is important. So we can probably move this here and let's just save this. And now for good measure, you can see it already works, but let me just restart for good measure. You can see now everything is fine, right? But in this example, I just want to remove this length ES because we're not even going to use TIE SCREME, so it's not really important. and then let's just go here and then i can just move banana to the right right and we can also even rename this so let's name it svelte moji boom here let me just do this there we go and also let's do a pro gamer move and be professionals about this so for example let me just take this code let me yoink it and now in our project in source lib let's just create a new file emoji js and the other thing is that these files can't be TypeScript because this has to already be pre-processed but I have a video how you can make your own library and publish it using CellKit if you want to check that out so I'm going to create this file emoji and then let me just close this and don't forget to export it awesome so now we have this and we can go here so we can just say import Svelte emoji from now we can give it the relative path source lib emoji and now everything should work as before so now even if you refresh this that's basically how this works so you can create your own processors and share them with the entire world all right how cool is that friends but let's make something more complicated which is a swelth markdown preprocessor so i'm just going to close these files right here and now i can just leave this emoji thing here right but in this case instead of h1 let me just remove the fire emoji for now i'm just going to say found heading that's right so now we can just save it and we don't even need these styles anymore or actually let me just keep them so as you can see so how do we go from here to processing this to html right so let me explain to you what we're actually going to do so here i have xcollegraw so i'm going to look at this example right here so for example let's say that we have this component right here so we can even let me just do it right here i'm going to import counter from counter.svelte which i created right so if i open counter let me just show you nothing special here i have a simple counter and then i'm just going to use the counter and i'm going to say counter like this as a component so we can have this and now we have our heading and a counter and now we just need to transform the markdown here but how can we do that so as we've seen before here is our component in svelte which is split into three parts we have to actually isolate this part which we can do by transforming this component into an abstract syntax tree. And to do that, we can use parse from Svelte so we can turn the entire Svelte component into this abstract syntax tree. So we can get the HTML, the CSS, and et cetera. And the only thing we're interested in here is the HTML because we get the start at the end. And now we can use slice to just isolate this part. Again, it's just a string. So now we can manipulate it however we want. So now we can write a function markdown to HTML so we can use something like unified, which I'm going to explain in a second. So now we can turn this to HTML. And then at the end, we just have this string, which we return. And now this is perfectly fine to go through the Svelte compiler, right? So now we converted Markdown in our Svelte component. And if you aren't familiar with Unified, you don't really have to understand a lot about abstract syntax tree because we're actually going to use these useful plugins that do most of the work for us. But basically, Unified just lets you inspect and transform content with plugins. Unify is basically like an entire ecosystem of these plugins that makes your life easier. You might have even heard of some of these plugins if you try to make a markdown block before. So Unify, there are remark plugins. So these are plugins that work with markdown. And then you have rehype plugins which work with HTML. But yeah, that's basically it. So now let me show you how this looks like in practice right So this is basically what we want to achieve right We just going to take this component then we going to get what we want we can just use a regular regex if you want but this is more sophisticated and easier right then we just yoink it and then we can return it to html right and just replace the content because we actually have to include the other things like the script tag and etc all right so let's do two things first i'm going to go here to the config And another thing we can do besides preprocess, we can specify extensions options. So we can go here to the extensions, and these are just extensions that are going to be treated like Svelte files. So by default, this is .svelte, but you can also include other files like .svx. But in our example, let's just use .md because it has great syntax highlighting, right? So now we can load markdown files as Svelte components. And of course, this is really optional, but this is important because we're going to use this extension to only change this type of files, right? and then let's just save this and here i'm going to again go to lib let me just do it markdown jas boom simple like that right and now inside of our swell config we can just do the same thing again so let me just copy this over and i can just name this markdown you can name this whatever you want and let's just add another preprocessor so how beautiful is that right so we can just say markdown and that's basically it all right so now we don't even need to look at the swell config anymore because we're going to do everything inside of our markdown.js file oh actually before that let's do a quick fix because i realized something because here we have this export function emoji let's just remove that i'm going to rename this to emoji and we need the default export i'm not even sure how this worked before export default emoji cool so now we can save this open the config and now we can rename this to emoji and let's also include the extension here because you sometimes get an error it's really weird right but we just need to save this and that's basically it so now we can continue the same as before all right so let's create a function which is named markdown and let's just say export default markdown that's basically it so now we can just return we can give it a name markdown and the only thing we're interested in is the markup of course so we can go markup and we can say content and we're interested in the file name this time all Alright, so now we can say here if filename ends with MD, this is why we created this extension, which we're going to update in a second. And then in this case, we can return code, which is going to be the content. Alright, so if we save this, everything should work fine the same as before. Let's not forget to change the extension here because this has to be MD. So we can say rename and instead of .svelte, this is going to be .md and that's basically it. all right but instead of code we're actually going to create another function which is going to be html because we're going to turn everything to html and we're going to pass content here all right so let's create this function html which accepts content and that's basically it so now we can actually just go here let's return content so it doesn't complain and we can log out this content let me just restart the development server for good measure and let's see what it's complaining about. And of course, it's not ends with, it's ends with, right? Boom. Now let's restart this. And let me just see this. Let me refresh. So now everything works as expected. So now we get this only component because this is the only thing that has an extension MD. Awesome. So now we can change this string to something else, right? All right. So how can we turn this code into a Svelte abstract syntax tree? Well, for that, we have the parse method from the Svelte compiler so we can say swast parse which should be imported from swell slash compiler and then we can just pass content and that's basically it so now i can go here and let me just console logout swast so you can see what's up here so you're going to see now we're going to get an abstract syntax tree which represents this swell component and again you don't have to understand abstract syntax tree the only thing we care about is this html section so we know where the start and end is right so we can now destructure these values and do whatever we want all right so in this case we're actually going to go here and now we can destructure some values from what we can go fast html right and we can get start end all right so now we can get the string that you're interested in so we can just name it constring like this and now we can say content slice and slice accept a start and end how convenient right what do we have we have a start and end and that's basically how simple that is so now if we log out string for example let me go here and again we have to restart this which is a bit annoying but you can see we're going to get the string here so we just yoinked the html here and here is some warning you can ignore because we're not using styles or whatever i can even go here and just remove it because who cares right so now if we go here okay it already updated awesome so now we don't get this noise we already get what we want so now we just need to somehow transform this all right so how are we going to do that well basically let me just go here so now this is where we going to use Unify because we need to turn this into HTML So we can for example say const HTML, and now we're going to await, and we're going to create a new function called markdown to HTML, and it's going to accept the string. Alright, so let's go up here, and we should make this async, and now we're going to say markdown to HTML, and now we can use our imports. And I already have these packages installed but of course you can pause the video if you're following along and you can just npm or pnpm install them all right so this is going to return a promise which you're going to await so we just have to say let me just turn so now we're going to import unified and now we can start chaining methods on unified and i'm just going to go here to make it clear so you do this by saying use so the first thing that we have to do we have to take the markdown, turn markdown into markdown AST. So we can just say AST, right? So we have to turn that to the AST so we can do something with that markdown. And for that we use remark parse, again, which is just going to be imported for us. And even if we hover over this method, it's going to tell us what this does. So add support for parsing from markdown. So this is going to turn it into an abstract syntax tree for markdown. So now we actually need to turn this tree into a HTML abstract syntax tree. So we can say use and then you can say remark rehype I think turn markdown ast into html ast. So if we hover over it it's going to say turn markdown into html right but it means the abstract syntax tree. And the only thing that we have to do here for both is allow dangerous html otherwise it would strip out things like the script tag which we actually want so you can say allow dangerous html so let me just copy this over do it here and that's basically it and then lastly we can say use and we can import rehype stringify or actually it's going to convert this to a html string that we can use right so we can say rehab stringify and the last thing that we have to say is process so we can pass in the markdown right and it's actually not markdown is just any string right so let's just rename markdown to string all right so we parsed markdown into an ast that unified can work with then we turn that same ast tree into a html ast tree right and then when we have this representation so for example is the same when we have something like this so the svelte abstract syntax tree all right so basically now we have like a blueprint or instructions how you can render this thing out okay so now in this case let's say for example, that we want to return a swell string, this component, right? We want to convert this back to this thing. Well, basically, this is what Rehype Stringify is for HTML, right? So it's going to return that string. So we converted the markdown into a tree that we can work with. We converted it back to a HTML tree, and now we need to serialize it or return it to an actual string that we can use, right? And oh my god, friends, life is hard without TypeScript. We have to invoke Unify first, of course. and this has to be on re-type stringify instead. So we can do it like that. And let me see if that's all. So of course, here we are waiting it. So now we just need to make this async, right? And let me just console log out HTML. So we can do it like that. And I'm going to restart our development server just so we can get the output. And now we're going to see we get this thing, which looks intimidating, but actually here is just our value. So we can say dot value or we can do something else. So for example, let me just go here HTML. So we can say dot value to output that. Or in this case, we can actually also use string. We convert it to a string. We can actually just get the output like this. All right. So let's check it out. And we can see how beautiful is this. Now we converted Markdown to HTML and everything else is preserved. So now we can pass this to the Svelte compiler. All right. But before that, we actually have to stitch things together. And how are we going to do that? well of course we can just say here let's just say content replace what we want to replace we want to replace the string with the html right so let me just save this and i'm going to show you this again let's just restart and now we're going to see we're going to get our entire svelte component how beautiful is this friend so now we can just pass this to the svelte compiler and that's basically it so now let me just take this piece of code and now the same as before here instead of returning content we're going to return code and i'm just going to copy this code that we already wrote so now when i save this and let's just restart the development server again and now this markdown here should update to html and it did awesome so now we also have a working swell components inside our markdown awesome and not only that but now we can also use our other pre processor so we can use this fire emoji and now we can use this or a heading and now everything works the same as before.