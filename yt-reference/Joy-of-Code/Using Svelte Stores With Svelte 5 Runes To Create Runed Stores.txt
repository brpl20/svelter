 Yo friends, what's up? Today I want to show you how you can ruin a Svelte Store. And what do I mean by that? Well, for example, here I made this Motion Library so we can define a tween for values that we wouldn't usually be able to animate such as SVGs, Canvas, and etc. So here I define a camera, circle, text, and etc. And now I can use this nice API to even include sounds. So I can use .2 and I can animate these values over time including any numbers and even strings like colors. So this is really cool, right? And then here is how I use it. so you can just subscribe it because this is a store, right? So I can just say camera.exe, and here is how it looks like in practice. How beautiful is this, friends? And this is also used as a part of my other library, Animotion, which is used to visualize ideas with code using the web technologies that you know and love, right? So here, even if we go to the docs, we can actually see, for example, here we have these simple transitions that work like magic, right? So we can just say Animotion, and then we can animate whatever we want, and it works really beautifully using the View Transitions API. Right, but motion is the missing piece for animating these values over time. So as a part of the Animotion template, I include Animotion slash motion if you want to do that, right? So we can animate values over time like this. And this works beautifully. All right, but what is the actual problem? And the problem is that since I switched this entire project Animotion to Svelte 5, right? Now we have some inconsistencies. People might be confused, like because we're using runes or signals now. Now we have to explain to people what this weird dollar sign means, et cetera. so I really thought it would be really fun to actually go together through how to take a Svelte Store, so something that we don't have control over, because for example, let me just show you. If I go to Tween, you can actually see that under the hood, this is just using Tween from Svelte Motion. I'm going to show you how you can use something you have no control over, such as an external store from a library, and how you can runify it, so you can turn it into a rune store. But before we get started, here's a message from our sponsor. I'd like to thank this video's sponsor, you, the viewer. You can support the channel through Patreon or a YouTube channel membership. Members get early access to videos, help shape the content, and a special Discord role. You can find all of the links in the description. Thank you for your support. Alright, but before we get started, let me give you a quick recap on Svelte 5 Runes if you've been living under a rock. So here we can say let count and then we can say dollar sign state. We can define our state like this. Boom, bam. Thank you, ma'am. we can also say double and we can say derived and now we can pass in a simple expression and that's basically it you don't have to do anything else in swell 5 this is all you need to know and this makes things so much simpler and some people complain for example they lose their goddamn mind when they see effect they're like oh react and this is honestly a really sad state of affairs because people have no idea how the framework works they see some surface level api that reminds them of something else they're like oh this is bad and what do you think in tarnation what was this in Svelte 4. Does this look familiar, right? What do you think you've been using this entire time? They actually almost work the same, but of course, effects have other things like replacing lifecycle methods, so you have to write less things and you only know one thing, and that is the beauty of Svelte 5. It's simpler and more powerful than before. Let me actually show you what you're going to do today, and if you didn't know, let me show you something cool. So for example, so for backwards compatibility, that's also another awesome thing about Svelte 5. It's actually mind-boggling to me that it's completely backwards compatible with all the versions of and it's a completely new rewrite right so for example you might be familiar with good old stores so instead of state here we can actually use a writable let me show you something cool this works with runes incredible boom we can do this let me just console log double open the developer tools and you can see it works let's change it to 10 then we're going to see here it's 20 right and this is absolute magic but how does this actually work well under the hood svelte actually just subscribes to the store and proxies the value through a room right or a signal and this is basically what it does let me show you so let me actually just remove this and this is a writable right so we can for example let's see proxy and this is actually what svelte does under the hood it subscribes to this gets the latest value and then whenever these stores update it's just going to reassign it to this proxy and this is what gets returned this is why this works and this is actually the same technique that we're going to use today to make a ruined svelte store as you can see we can go here and we can console log this proxy we can see we're going to get 10 how beautiful is this friends all right well let me close this for now and then we're going to go to the code right so we can continue all right but before you get started there are actually a couple of things i hate about this library so for example i assume here that this is an mp3 which is completely stupid so i actually want to make this explicit that you have to specify the file type for the audio because you can actually play anything right so this was really silly of me so another thing i hate about this that i using a weight here as a requirement for playing the animation i just want to play the animation by default and if i want to wait for an animation to finish then i can just use a weight and then i also because i did this there are also some mental gymnastics here like using this all to combine this in a promise and play these things both at the same time and this is how things work by default right so i'm actually doing more work for nothing another thing that i was super fixated by was chaining methods so for example you can just chain these methods how many times you want and i was really obsessed with this i was like oh my god i need to have method chaining method training is so cool oh my god i need to have method chaining and it's kind of really useless to be honest so let me actually show you at least it's cool how it works though so let me actually show you so for example if we go back here at tween and let me actually show you all right so a question to you how can you chain promises right so i push this to a task queue but then how do you chain them right how do you play these animations and the trick is to make this object denable if you return then from an object which we're returning here right we're returning this this is a special thing in javascript how you can make things denable right so i'm looping over the task i'm awaiting every task then i'm going to resolve them and then i'm going to clear the task queue and this is something really super interesting in my opinion and this is the reason why we have to await the animations because when you use a denable it's only going to run when you await it because it's a promise right but i actually don't find it that useful so this is something that you're going to remove all right boom gone later okay so now we can also remove it from here and then we're not going to have any tasks so let's just delete this i want to return this from sound effects because we're going to do a sound effect and we're going to chain two and yeah we can just keep this as is nothing bad here right boom all right so we're not going to need task also here in the reset and we also push task here let me just remove this and then i'm going to remove this because we're not going to chain two anymore right so if i save it's going to format and another thing that we can do because twinable from swelth returns the promise we can actually return it so we can say return update and return here and let's just remove this so i'm going to take the set boom just going to move this out of here and that's how easy peasy lemon squeezy that is all right so now we're going to return this so now we can await the animation if we want and it's going to play by default and let's see if i have to do anything else i just remove the task here we don't need this boom now we just delete things beautiful all right so now going back here you can actually see we get some warnings here and that's great so we don't need all here anymore so let's see what we want to do in this animation we just want to await the camera first we're going to play the sound effect we're going to animate this okay so that should be awaited right and we can do this as is and here we can just we don't even need to await here this text we can just put the sound effect right here because we're returning this right boom so we can change sound effect to boom and we can just use text here so much simpler we don't need chaining everything is going to be all right right so let's save this and refresh for good measure and let's see and let me see did i interact the page oh yeah i didn't fix this problem that i wanted to fix with the audio right so we can go here and we can see i just always assume that this is an mp3 boom let's fix this and now this is already a lot better in my opinion all right so let me just go here refresh how beautiful is this friends all Alright, so let's get to the fun part. And the first thing we actually have to do, we have to rename Twin.ts to Twin.Swell.ts. And this is something you have to do when you use runes outside of a Swell component. So the compiler has to do less work. Alright, so let's do that. We can say reveal, this is going to teleport us where we need to be. And now we can rename this through this comically absurd long context menu. What the heck is this? Okay, Swell.ts, boom, that's it. Do we want to update imports? Yes, please. boom easy peasy lemon squeezy like that friends we can just close this and let's actually see we didn't save this boom and now everything works the same as before we just renamed the file but yeah that's basically it and let me just go here and back to our twin.svelte.ts file now okay so how are we going to refactor this i'm using a function here but i'm in a class kind of mood because what can i say i'm a classy kind of guy right so let's just use a class and then later we can actually wrap the class in a twin function just so we don't have to use the new keyword right let say class twin easy peasy lemon squeezy like that so let see what we accept values and options i actually want to rename this to value and option That it boom And we going to have a couple of things here Actually two things I believe So we're going to have value. And this is another beautiful thing about Svelte 5. So you can declare your state here. You can use $state, $derive. It's just going to work. Underhood, Svelte is going to actually compile this to getter and setter. So you don't have to think about this yourself. And if you want more control, you can define the getter and setter yourself, which is really beautiful. But of course, you don't have to use a class. use a function whatever floats your boat right and then we're also going to have a private field store because it doesn't make sense that we can access this outside of the class but it really doesn't matter right all right so now we can go into our constructor we can say this value is going to equal the value that we passed and then we're just going to assign the store here let's just go here and we can yoink this store that's it we don't have to do anything special and let's just also rename these values to value now we can pass in a generic here because this is the type i'm just going to say st here it's going to be t we have an options type boom that's it and if you aren't familiar with typescript t is basically just like an argument function but for types because we have no idea ahead of time what the type is going to be so we're just going to say t and let's also make this optional since we don't have to pass this and that's basically it right so now what we have to do, we actually have to do the same trick we have to subscribe to the store, and then we're going to update the value and we can do this here so we can say this store subscribe now, when we get the latest value we're going to say this value equals value, that's it and now we basically made the ruined store and let's just do some other things here, so we have these two function we have sound effects, reset, and etc so let me actually just take those let's see is that it okay let's just copy them over side of our beautiful class and okay so this is a method we don't need this and this is also a great thing now i don't have to use and type this here this is what i hate about type script that you have to define this as an argument like this but inside of a class you don't have to and let's see what it's complaining about now it's complaining about this too so we have reset okay and now we can say this store set so you don't have to think about this this dot value let's see what is it mad about oh we also have this we can also turn this into a method we can remove this and let's see if anything else here yes so we can also say here where it's update we can say this store dot update just copy this over yeah and that's basically it so now we rewrote this part and i also think that this part is a bit ugly i prefer to have my code more readable yeah so we can just go here let's just return this we can save so we get auto formatting right so i just made this simple beautiful class classes aren't anything spooky right they're just fancy objects on steroids and actually let me just rename values to value and we can also rename two options to just the options that's it this is going to be value all right so now we check if values of type object then we're actually going to use update just so we preserve these values because for example you can pass in something like let's say that you have a value x zero y zero and i actually don't want it to be annoying so you have to do this each time when you want to update it so you have to say this is zero this is 10 no you can just do this you can just pass only the value that you want to update so why 10 and then it's going to just spread the old values that's basically what this is doing nothing special right and this is also going to otherwise just set the value that's it if we have a single digit like a number i think all of this looks great to me and we can actually go here let me just delete this since we don't need all this boom and let's just this is the actual thing we're going to export export function tween again we're going to save the same value so let's just make this t option t or options that's it and then we're just going to return new tween going to pass in the value and options. Alright, and that's basically it for this. And let's also pass the D here. Okay, so let's see if all of this looks right. Yes we have this class tween Okay good So now we going back here Just remove this since we don need this and now we can refresh and then we get this error because we no longer using a store right so let's see what we have here in the code all right this looks great all right so now we can just change this and now we have to say dot value because we're accessing this from value but we're actually going to see i'm going to show you how you can actually make this a nicer user experience cool so let me just refresh for good measures no errors looking good how beautiful is this friends all right so before we improve the user experience let me actually just tell you one more thing and that is for example let me just see where was it oh also we don't have to return else here there's no point since you're already returning we can just say return boom easy peasy lemon squeezy all right so another thing we didn't account here so we're subscribing but we never unsubscribe here from the store so if you want for example you can use an effect here let's just return so now we're returning a cleanup function so when the component unmounts is going to also unsubscribe from this because a swell store returns an unsubscribe function so you can actually see everything works the same as before and also what you can do because effects run last you can use effect.pre to subscribe to this store immediately right and basically this works the same. Alright, so how can we improve the user experience? And the current problem that we have, if we define course, for example, newTwin, and then we pass x0 and y0, we can set x to 10, but the problem right now, first we have to say course and then we have to access value on the class and then we can get to our crashes property, right? But what I want to do, I just want to be able to say course.x or whatever property I want and even optionally we can also say cores x and we can assign it like this so how can we do that well we can use getters and setters and to do this it's actually not that complicated right we can actually create dynamic getters and setters based on our values so here we get the value we can check if this is an object so let's do this right now we can say if type of this value equals object you can do a better check because this can also be an array but for right now let's just loop over those values. So we're going to say key in value and we're going to use object and we're going to define the property on this object. And it accepts three values. So the target, the key that you want to set, and then we can create an object on it with a getter and a setter. So in this case, the object that you want to change is our class. So we just have to say this. That's it. So now the key that you want to create is the key that you're looping over. That's how easy peasy lemon squeezy this is friends so now we can define a getter and optionally you can also define a setter here so you get the newest value and now you can update whatever you want right but in this case i just want to make these values read only cool so now we can do this and now we're going to return we're going to say this value and we're going to return the property on the object that's how easy peasy lemon squeezy this is friends and we can also abstract this a bit further we can say set properties pass in a value which is t and then we're going to do the same thing and here we're just going to say this set properties this value boom let's save everything okay nothing broke and we can also enhance our types so we can say as let's pass in the generic but there's one problem here is that we won't get the types for the values that we pass so we can actually just do this so we can say and and then we can just say t so it's going to include all of our object properties how easy peasy lemon squeezy is this friends all right so let me save and everything works the same as before right beautiful right but now we can actually create a better user experience we can remove all of this dot value nonsense and we get the same as before right let me just do this in one fell swoop let me see boom let me save this and look how much more beautiful this already looks yeah absolute beauty friends right so we can actually just go here and let's see refresh for good measure how beautiful is this friends okay friends that's it but let me know if you're interested in a follow-up video where we implement tween from scratch and i think it would be really fascinating because we can learn how we can animate values over time we can learn how easing works and etc. And this is basically how it works in Swell. Here we have this interpolate function which interpolates between two values based on the animation progress. But yeah, basically let me know what you think and I'll catch you in the next one. Peace.