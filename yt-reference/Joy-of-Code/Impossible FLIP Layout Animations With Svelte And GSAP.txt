 Hey friends, today I have something really special for you, and that is doing impossible animations with Svelte. So what do I mean by that? Let's take a look at this example. Here we have the same circle in one parent, and we want to animate it going from the left parent to the right parent. And this is impossible using CSS right, but you can use JavaScript, but even JavaScript is computationally expensive if you do something like this on every frame. But thanks to the flip animation technique, you can get buttery smooth 60 frames per second animations. So look what happens when I click on the page. How beautiful is this, friends? I'm going to show you a basic implementation of the flip animation technique so you understand how it works, and then we're going to use the G-SAT flip plugin to make things even easier. And we're going to look at some incredible examples, like this example with the circles. How beautiful is this, friends? And then we can look at how we can animate something like CSS Grid, so we can go from one image to the other, and everything beautifully transitions. And then we're going to look at something which probably most people are excited about, which is using the flip animation technique for page transitions. So if I press on a movie, poster for details is going to animate, including the cover and the title. And how beautiful is this, friends? So you don't even need the view transitions API, and this works in every browser. All right, so I hope you're excited. Let's get started. All right, friends. So as you can see here, I have some basic containers, which I bound the value of the circle element, but you can even use query selector if you want to. But this is nothing special and this is what I want to emphasize before we start. Because the flip animation technique isn't something that you have to change your code around. You can just write code regularly as you want. You just do some change in your DOM, applying a class and etc. And then you use the flip animation technique. So as you can see here is something that you would probably do by default. Here we're going to switch the container first last. But let's first talk about the flip animation technique. The flip animation technique is something that was coined by Paul Lewis in this blog post, Flip Your Animations. And flip basically stands for first last invert play. And let me show you how this works in this example. So how do we achieve this basically what is an illusion? So we're going to take the measurement of the first element using get bound client rect. So we know the position of that element. And then when we make some change to the DOM, we're going to measure the second element. And then we're going to do some basic math to find the difference. So we going to take first dot left and we going to subtract it from last dot left And basically this is going to just create an illusion because they going to use a transform to place this element in the place of the first element like this And then we going to play the animation, which is going to create the illusion like it's animating from this parent. And that's how the flip animation technique works and why it's so performant. And in the blog post, you have some code you can work with. So as you can see here, it's really simple. So we're going to get the first position. Then we're going to do some change. Then we're going to get the second position. We're going to do some basic math, and then we're going to use the web animations API to animate it. All right, so let's see how that looks in Svelte. So we're going to go to this example. So remember, we're going to get the first position. I'm going to say const first. And since we have a reference, we can say circle element, get bounding client rect. Then remember, we do any change. And then after we do this change, we want to measure the DOM again, or the same element, right? So we can say const last, which is going to be circle element, get bound in client rect. And this is a really useful and often used function so you can measure the position of the element in the viewport. So now we only have to do some basic math. So we can say invert and then you can say, hey, first left minus last left. And that's basically it. So now we can use the web animations API, which really is an awesome way to use JavaScript to write CSS animations. So we can pass it some keyframes and options and that's it. And I can say const animation. And now we're going to reference a circle element. We just have to say animate. That's it. And now we can pass it an array of keyframes. So first we're going to do translate. So now we have to do the trickery or the illusion. I'm going to say backticks. And then we're going to use the invert value. So this is going to start the second element as it was in the first position, right? And then we're going to animate and we're going to say translate to 0 pixels. And this is just a shortcut for transform translate x or translate y. And I'm even going to spice it up and animate the background so I want it to be yellow. And then we're going to give it some options. We can pass it an object and then we can say duration 2 seconds and then we can also say fill forwards so it's going to keep the changes after the animation for the background color and we can even specify uneasing. Alright so we can save this and if I click it not going to work And why is that Well this is another interesting thing how Svelte works Because Svelte batches the updates to the DOM we somehow need to wait for this change to happen first when the element changes right and then we have to take these measurements because right now everything is going to get batched and we're not going to see the changes so there's two things you can do you can use requestAnimationFrame which is going to request the next frame and is going to happen on the next tick so after an update or you can use the built-in lifecycle function tick from Svelte which is intended for these sort of things. Alright, so first I want to show you requestAnimationFrame. So the only thing you have to do is requestAnimationFrame. We're going to pass it a callback. So now let's just complete everything. Here is where animation stops. I'm going to save everything. And now let's see. Oh, how beautiful is this friend? It's like magic, right? And basically just so you're not confused, if you only know about requestAnimationFrame for doing infinite loops, this isn't an infinite loop. requestAnimationFrame is just a function that's going to request the next frame, right? So this is going to happen on the next tick in the browser. All right, but let's use the tick from Svelte. So I'm going to remove requestAnimationFrame and I'm just going to say awaitTick and if I press enter, this should auto-import. Let's check it at the top. It importedTick from Svelte and we also need to make this function async and this is going to have the same result. All right, so I'm going to save it and let's try it now. How beautiful is this, friends? and that's a basic implementation of the flip animation technique and of course you can also account for the y-axis here for rotation and scaling i don't know about you but i don't want to maintain a flip animation library and think about the math and edge cases but thankfully i have good news you don't have to because the gsap flip plugin already takes care of everything for you moving forwards we're going to use gsap for all of our animations all right friends so for this animation we're going to use the GCEP plugin which is really awesome. You can go to this link and read more about it. They have an awesome video on this and they also have some cool examples so they show you how the flip animation technique works which is really awesome. They have some highlights and examples. This is really awesome. Animating Flexbox. Here you have an advanced example using this gallery which is super easy to do with flip. And yeah there's a lot of documentation and a lot of things you can do here. There are some caveats and tricks when it comes to using it with SvelteKit because you're using a JavaScript framework, but that's what I'm going to show you. So here they show you how to flip between two different elements, which is also awesome, but yeah, you can spend your entire day reading this if you want But let look at this example that we have And again I want to emphasize that you don build your UIs around Flip You just do what you regularly would So in this case here I have these circles which I have them in this state I have two states, stack and grid. Currently, I set it to stack. And then I'm going to use the flip. But you can name this whatever you want, like change layout. I just named this flip. And then we're going to compare it. Hey, this layout is equal to grid. Then we're going to change the layout to a stack or opposite. And then this just happens. And again, we're really not thinking about flip or changing how we do things. We just have two separate states and we want to animate between them. And I also want to show you how cool it is when you're not using Booleans, but using explicit state like a string here, because you can do something really awesome. Let me show you. So you can go here, you can give it a data attribute, you can say data layout, and you can pass it the current layout, which gives you incredible power using CSS. So here in CSS, for example, I have this attribute that I'm targeting data layout stack. in this case hey just use Flexbox and if it's in the stack layout then we can specify styles for the circle so this is how I'm styling this I'm giving it a negative margin and then you can say hey data layout if this is a grid then you can use it to display a grid and then we can change the styles for the circle and we can change the border radius and you can also do flip animations in Svelte but Svelte is limiting in this regard when you have things like border radius rotations which are incredibly cursed but if you have simple animations in Svelte You can use the built-in animation directive flip and crossfade. And you can watch my other video if you're interested in how that works. Yeah, but let's flip some animations. So first thing you have to do if you haven't already, I'm just going to stop the terminal. So you can just use npm or pnpm to pnpm install gsep. And if you want, you can also install the types for gsep. And that's basically it. The plugins come as part of gsep. So that's all you need. But I'm going to start the development server again. And let me just close it. And that's basically it. So now we need to import GSEP. And you can say import GSEP from GSEP. So now we're going to import the flip plugin. We can say flip from GSEP slash flip. And then we have to register the plugin. And of course, these instructions are available in the documentation for GSEP. So we have to say register plugin flip. And that's basically it. So we're going to see that this works the same way how we implemented our own flip animation technique. So first we get the first position, so we can say call on state, and now we use the flip plugin. Flip get state, and now we need to give it a selector, which is going to be

 circle and you can also pass it props you want to animate between so you can say props and what we want to navigate or change we can say border radius but this can be anything right so again we get the first position and don't forget we also need tick so we can say await tick which we can import from swelt so let me put this at the top and don't forget to make your function async and you can find all of these examples in the post and i even have a link to the github alright now I'm going to show you how simple this is using GSEP so we can say flip from we have to pass it a state and GSEP is going to do everything for us and now we can just pass it the option for the animation so I can say duration 0.6 seconds we can give it a position of absolute so we can say true so this is going to reduce jank during the animation if you want it to be more performant you can use true you don't want to use scale if you have something animating like text because it's going to cause jank because it's going to scale the image instead of animating the width and height. So that really depends on the type of animation you're doing. We can even give it a stagger, so we have a delay. We can give it a negative one. I just want a small amount. And we can also for fun say spin, and this is going to spin it an entire rotation, so 360 degrees. And then we can specify ease. And GSEP is really simple to use. All right, so now we can save this. Oh, and I need to fix the import, because it's not just GSEP. You have to do this. You have to do gsep dist gsep for whatever reason. And then you have to say dist flip. So now let's save this. And now Selkid isn't going to complain. So now let's see if it works. How beautiful is this, friends? So you can see the stagger, how it works. So if we give it a positive stagger, it's going to start from the first one. And if we give it a negative stagger, it's going to start from the last one. And how simple and beautiful is this? I just really want to emphasize that you don't have to change how you work, etc. you just make your transitions and then you flip them. And also you can pass whatever you want here. You can pass a reference to the element if you want. So you can use this in Svelte to pass it. But in this case we can just use this and GSEP is going to use query selector or whatever. And then we also learned that we can pass props to animate other things which would be a problem in Svelte using crossfade. So if you pay attention the border radius is also animating and the rotation works beautifully. How beautiful is this friends? Alright friends, so in this awesome example we are going to animate CSS Grid. And if you been paying attention then you know that we are not really animating CSS Grid we we just using the flip animation technique to animate the transition from one state to another And even though in modern CSS you can animate some values of CSS Grid, it has some limitations, but you don't have any limitations with the flip animation technique. And here I don't have anything special in the template, I just have a grid here, I'm looping over 8 items, then I'm using variables inside each loop so I don't have to create a special component, so I know which detail is active. if I compare the selected to the active ID, which I'm doing right here. So when I click on another image, it's just going to change it to be the active one. And I'm doing this because I have the same class name details. So let's see what happens when you have that class. As you can see, it's nothing special. Here I have a details class. So when this has the details class, it's going to span the rows and columns by two. So if we go here in the developer tools, I can just go here, enable grid. So you can see what's going on. So this spans two rows and two columns, unlike the other images. So that's the only thing we're doing which has nothing to do with flip, right? All right, but let's flip the animation. So I can go up here in our function. So again, we're going to get the first state. We can say flip getState. So what we want to target, the grid item. That's basically it. So now we can go here. We can use awaitTick, just as before. and now we can say flip from pass it the state and give it the options and now I can give it a duration 0.6 seconds let's give it a stagger I'm going to give it a tiny amount let's say absolute true and I'm not going to use scale here because I have some text which would look weird so again as I said it depends on the type of animation you're doing and then I can save this and basically that's it let's see how it works and how beautiful is this friends and let me see if it's visible if I use scale it's basically not going to work here because you can see how the text is weird because it squishes the text when you change the image but yeah that's it so I'm going to remove scale and another thing I want to do I want to use GSEP to animate this text going outside when we're transitioning and then going inside when the image is active so the flip animation technique returns timeline, or actually the flip plugin, and we can use this timeline to animate the element. So you can even go here you can just say 2 so you can chain it or you can just go here and say tl2 and now we can say hey details so it going to target that and then we can say animateOpacity1 0, y, and then we can say duration 0.3 seconds, but if I save this, it's not really going to work because first, we need to clean up the animation at the text, right? So what we can do, we can pass it a callback function, we can say on start. Pass it a callback, and now we can also use GSEP animation here. So what we want to do with the old title, we want to say GSEP 2. So when it doesn't have details, right? And then we can just say hey, opacity 0. Y is going to be 100%, so it's going to go off screen. And then the duration is going to be 0.3 seconds. And let's see how that looks like. So we have it here. And now you can see how it disappeared. But it appears right now when you go to another image. And it's going to appear like magic. And how beautiful is that friends. And of course you don't have to use GSTEP for this animation. You can use Svelte. But you have access to these callbacks and other things you can read from the GSTEP documentation. I also want to show you how you can make this more reusable. So here I'm not using Svelte directly to change the image. But I'm using this Svelte action. So on this item I'm saying use flip. which you can reuse on any item if you have something like this or maybe you can make a more general flip function. So here I have this flip function which takes in the container. So I'm going to query all the grid items which is some cursed nordlist thing. We have to turn it into an array. So we loop over each item then we add a click event listener. We check if it contains details then we return it so we don't change it. Then we get the first state using flip. Then we check for details on the class and remove it. And then we change the state so we show details. and then we do the same thing here using flip. It's a lot more cold, but this is something interesting if you want to do it so you can make it more usable. But if you want to look at that example, all the links are included in the post. All right, friends. So in the last example, we're going to learn how we can use the flip animation technique for page transitions. As you can see here, I have a boring movie site. When I click on a movie, it's going to take me to the details, which is fine, but it's really not exciting. And we can make it more exciting by flipping it. And if you're curious how this works here, I have a plus layout TS, which I'm going to use to return the data for the pages. So I'm returning data from a JSON file, so I can go here to the movies and I just looping over them nothing to do with FlipWrite I didn do anything special since I have this data available to every child so for the ID here I can go here to the movies and I just looping over them nothing to do with Flip right I didn do anything special since I have this data available to every child So for the ID here I can have movies So I can say data movies find movie, and I can filter it based on the movie ID. All right, so you might be asking yourself, how do we flip this? And the biggest problem we have is these are two different elements. So how does Flip know that it should animate this? And where do we even put the Flip animation, right? if we put it in movies, it's not going to work, then this isn't going to know about what's going on. But we can go to the plus layout Svelte file, and here we can put the flip animation. So here I have imported GSEP and the flip plugin, but now there's another problem we have to think about. Okay, how do we know when we transition a page to get the before and after state? And thankfully Svelte has some useful navigation functions, so we can import them. We can say import after navigate and we can say before navigate from the app navigation store. And that's how simple this is. So now we can go here, here we have our plugin, everything looks great, right? And now we can say, hey, before navigate, so remember, we need to get the first state. And then we can specify a variable aside because we need to keep track of the state since we're going to use two functions. So we can say state, and if you're using TypeScript, this is of type flip.flipState, so it doesn't complain about that. And now we can reassign it before a navigation occurs. Selk is going to be kind enough and he's going to say, hey, something is happening before the navigation. Maybe you should do something. And I'm going to say, okay, don't mind if I do. We can just say flip, getState. Again, what do we want to get the state of? We can say cover, and we can do something else. We can specify more than one thing. So here I want to animate not only the cover, but maybe the text is related. And that might look good or not, depending on your opinion, but I just want to show you that you can have more than one element selected. So I can say cover and we can also select title. And that's basically it for this. And now we can say, hey, after it's done navigating, then we're going to measure it again. So let's give it a callback and we can say flip from, we can pass it state and now we can pass it some interesting things. So we can say duration 0.3 seconds. We can say scale true to avoid jank and you can also give it an ease. Alright, so let's save this. And now when we try it, it's not really going to work. It's not going to do anything. And why is that? Well, because how JavaScript frameworks work, first, this isn't the same.

 Same element, right? And then we're doing this sort of thing. We're deleting the old elements and bringing in new elements. So when you're using the flip animation technique with GSEP, you have to specify another property so that GSEP knows to query those elements again after you recreated them or destroyed them. So you can say targets. And again, you can pass one target. So you can say cover, but I have another one, right? Title. And then I'm going to save this. And now this should work in theory, but it's not going to work here. if I try this. And why is that? Because again, since we're creating and deleting the elements, we need to help GSEP out more. So we need to specify a special data flip attributes on the element you want to animate. And this is really easy. So for example, we can go to the movie, and here we have this cover because, again, just ask yourself, what do I want to animate? What is the same? And then you can say data flip ID. So we can give it a unique ID, which can be anything. so you can do it like this. I can say cover and then the special ID I'm going to use is going to be the movie title and I'm going to do the same for the title so I'm going to say data flip ID and I'm going to name it title just so they're different another thing that's really interesting about it this is also how you're going to use the view transitions API when that available in browsers It very similar how we do this and look at it This is only a couple of lines of code if you ignore the imports How awesome is this All right So now we need to match this Let me just save this and it not going to work automatically right Because let me just copy this over. We need to go to the individual movie. So we need to find the corresponding element image class hover. Okay. So now we can go here. My formatting is trickery. So I'm just going to create a new line, paste it here. Let's save it. And I'm also going to go back and I'll Let's copy the data flip for the title. Go here. Find the title again. Here it is. So here is what you want to animate. Alright and now the moment of truth. Let's see if this works. How beautiful is this friends. Look at this. This is magic to me. I could do this for hours. And it just works. Alright friends, that's it. As you can see, this is only a couple of lines of code if we ignore the import and it's really Not yet more difficult than using the View Transitions API. All the examples and links are going to be in the post. If you like what you've seen, don't forget to like and subscribe, and you can support me by becoming a patron, and you can also join the Discord server. Thank you for watching and catch you in the next one. Peace. Thank you.