 Hey friends, what's up? In a previous video we made an awesome screen recorder using browser APIs as well, and then we made this video converter to convert WebM files to MP4 files, you can see if I drag this video it's going to start to convert it, so you can watch those videos if you want, but in this video I want to explore how to make a progressive web app, so I want this app to be available offline and I also want to be able to install it. As you can see I'm going to have this icon here to install it, so we're going to get this prompt to install the app and you can install it if you want. But let me show you if I go to the network tab if you refresh the page everything works great but if you put it in offline mode it's also going to work. So I can refresh the entire page. I can load in the video so it's going to start converting it. And how beautiful is that friends. Alright but before I get started don't forget to like and subscribe and you can also support me by becoming a patron. Alright friends so this is going to be specific to SwellKit so you can follow along by creating a SwellKit project if you want but in case you followed along in the previous video I didn't change a lot here to this video converter the only difference I made is I downloaded the fmpeg core and vasm so I included it inside of the static folder just so I don't have to depend on some cdn right and that's basically it so we can get started right and the first thing you're going to do is of course read the documentation so we can go to the swelky documentation and we can read upon service workers all right so what are service workers and if you aren't familiar basically a service worker is a background task that runs in the browser so this makes javascript multi-threaded and there's really a lot of awesome examples of service workers there's even things like cloudware workers so they took the web standard for service workers and they turned it into a javascript runtime it may be heard of things like party kit so they use it to load analytics in the background and etc so service workers are really useful for a lot of things. But in this case, we're going to use service workers to make a progressive web app. And I'm going to share these resources in a description so you can read about progressive web apps on MDN. And they have here guides you can read upon if you want. So that's really awesome. But I highly recommend you read this so you can go to web.dev slash learn PVA. So this is literally an entire course on progressive web apps. So you can learn a lot. So for example, here, if you're not familiar with service workers, we can open it here and here they have this useful diagram how service workers work so this is your client or app right and then a service worker is just like a man in the middle so you can intercept every request maybe you also heard about mock service workers so you can mock things with that and etc you can literally do anything with service workers and swellkit also makes it really simple to use service workers so the only thing we have to do in swellkit we have to include the service-worker.js or ts file in the source directory and swellkit is going to automatically register it. So usually you would have to do something like this where you have to register the service worker yourself but in this case SwellKit is going to do the job for us. And then I'm just going to go over this entire example that they show here how to use a service worker so I'm going to explain these parts and you're going to see how actually simple it is and we don't have to use any third party library to make it in quotes easier because to be honest every third party library I use that helps you with service workers is so complicated and annoying to use, right? And you're going to see how actually simple this is. And I might even talk about VIT PVA. So this is this awesome VIT plugin for making simple PVAs. Again, I don't think it's really ready. It's version 0.2, right? And I had just a bunch of problems trying to use this, but we're actually going to use another part of this, which is the CLI for creating assets for your progressive web app, which is really awesome. So we're going to look into that. but yeah I think that's it for the introduction so we can get started alright friends so let's create this service worker so inside of our SvelteKit project go to source and we can just create this file so I'm going to name it service-worker.ts and that's basically it alright so service workers are intimidating at first but there's actually just three steps to this so first we need to install the service worker and then we need to activate it. So we have to say activate service worker. And then when we do this, we can intercept any traffic so we can listen to fetch events. And then we're going to override the URL with our cache and that's how you're going to get offline mode. So that's really simple like that. And then later, I'm also going to show you how you can communicate from your service worker so you can notify the user that there's an update so they can reload the page. Alright friends, but first I'm going to add some types and all of this code comes from the SvelteKit documentation. So we can say triple slash then let open this tag we can say reference types and the types come from at svelte slash kit then we can close this so if you get this proper syntax highlighting you've done it, right? And for this one, we can say lib web worker. And let me show you this in a doc, so you can go here to the type safety section, here it is, you can see you don't actually need all of these types, but that might depend on your situation right and then they type the service worker here by saying con service worker equals self as a known as service worker global scope but actually there's an easier way to type this so i find this way more convenient we can just say declare let self and we can just say service worker global scope because i actually don't want to reassign sv from service worker and then i have to use sv dot you're going to see it's going to be way easier to use this way and you also get some awesome helpers from SwellKit. So if we go here to their example, at the top you can see we get this build, so this is going to be our build file, so static folder, and the version from $serviceworker. And this is really important, the version for the cache, so next time we update the serviceworker, it's going to have another version, so it's going to know there's an update, right? And let me show you how awesome this is. So you can say import, so build, files, and version from so just so you have this awesome stores like $appenvironment etc you have this awesome service worker store and then we can even console log it out so we can say build files version and we can save it and now our service worker should be automatically registered so now when I go to my app I'm going to open the developer tools and as you can see here there's already an output so we can look at it so you can see here right now the build is empty because we're not building anything right and then we can see our static folder so here's the favicon my ffmpeg and etc and you can see here is the version but the most important tab which we're going to use is going to be applications you can see here is the service worker so here is going to be registered updated and etc so for example if you make any change and update the service worker you can say console.log.hi for example you're going to see in a second this is going to update and it's going to try to activate this one but as you can see it first installs and then it waits on the activation. And the reason it doesn't activate immediately, because you have to be done with this tab. So you actually have to close this tab. As you can see, refresh is not going to work So you can refresh as many times as you want So you have to actually close this tab and open a new one or you can say skip waiting and you going to get the newest service worker And you can, of course, unregister the service worker if you're trying something out, right? And then you can register it again if you reload the page. So that's how awesome that is. And if you want to make things simple for yourself during development, you can say update on reload. So I can put an exclamation mark and you can see the service worker is going to get updated. And you can also see we can enable offline mode. So this is going to make our page offline. Now you can see it's not going to work. If I refresh the page, we're going to get that no internet warning, right? So you can do that if you want. I'm going to disable it for right now. And if you screw things up, right, and want to have a complete refresh or restart, right, you can go here. Let me just scoot this up. You can go to storage and you can unregister your service worker and you can clear the site data. so now you're going to start fresh. And another important thing is your cache storage. So when we add the cache in a bit, it's going to appear here. And I also mentioned that all of the links are going to be included in the description. So really, this is a really awesome resource, debug progressive web apps. So actually, when you look at something like this, this panel, right, it has like a lot of these options which can be overwhelming, right? And you don't have to know what they all do, right? But this is really a useful post which explains all of these options and what to do if you're interested. So I'm going to include that so you can have a read if you want. Awesome. So let's go back to our code. And the first thing we're going to do is install the service worker, which is already done for us, but we actually, we're going to listen when it's installed and then we're going to add the files to the cache. And let me just scroll up and then I'm going to say self. So this is our reference to the service worker, just like you have this or global this right we can say self and then we can add an event listener so going to listen when the service worker is installed and then we're going to get an event and now we're going to create this async function add files to cache and again this is just the same code from the selkie documentation and we can just say cons cache and we can say await so you have this Caches API, which you have to open first. So we have to say Caches open, and then we can pass in the cache. So let's create the cache. So I'm going to say, const cache

 like this and then let's use template tags and then we can say cache and we can give it a version so we're going to use scullersign and let's use the version from the import so that's simple as that and let's also create assets so we can say assets so this is just going to be an array so we can spread our build files and we can spread our static files so you can cache whatever you want here as you can see swelky doesn't have any abstractions for making progressive web apps which is really awesome. I can guarantee you this is way simpler than wasting an hour trying to figure out some other abstraction, which is always a headache, to be honest. And another benefit of this is that you actually understand what's going on because you can actually easily screw things up if you over cache and then you're going to get into a disaster because your user isn't going to get the freshest content and et cetera. But this way, you're actually going to know what you're doing. All right, so when we open the cache, now we can say await cache and we can use this api add all and we can add our assets boom that's how simple that is so now we can use this event wait until and now we can just say add files to cache awesome that's it so now let's save this and let's look at our app so now we if we refresh and now we can see we have something in our cache storage so now we can open the cache and we can see, ah, it cached all of our files, right? And now when you have a build, it's going to cache that and it's going to work beautifully. All right, but we're going to run into a problem. So if we keep adding to this cache, each time we activate, we actually need to make sure that we clear the cache, right? So that is what we're going to do in the activation phase. So here where we activate the service worker, we can say self, add event listener. It's going to be activate. and then again we get this event and we're going to create this async function delete all caches and it's real simple so we're going to loop over the keys so we can say for const key of we can await cache as key so we get all the keys right and the key in this case is the version number right so we can say if key doesn't equal cache so this is a new fresh cache we just going to say await caches delete key And actually it a function delete key like this So we can just pass it the key and we're going to delete this cache. So if I save this and we can go to our service worker, right? So we're going to skip the waiting and we're going to see our cache looks great. And we should also again use this event. wait until and then we can say delete hold caches boom so wait until it's just going to let the service worker know to not do anything until this is done right so that's basically that all right so now is actually the last part so here in our app we actually need to intercept this network traffic right so as you can see here you have a bunch of things and you can intercept anything you want right so if we go to our application here so now we need to intercept those things so where we have this cache and then first we're going to try if there is a network right so we're going to do that first if there is no network we're just going to serve the cache so that's basically what we're going to do and we can go right here so now to do that we just listen to the fetch event and i told you this really isn't that intimidating we can say fetch and we can also pass in an event like here so the first thing you want to do we only want to accept get request because we really don't want to screw up any post request so to do that we can just say if event request method isn't get we're just going to return so we aren't going to do anything and then we're going to create this function which we're going to name async function respond and when we're done with all of this so i don't forget I'm going to say event respond with. So this is a new method. We're just going to say response. So we're going to involve this function here. And let me just see. Okay, this is it. All right, so first we want to get the URL and cache. How can we do that? Well, we can just say const URL. We can create a new URL and we can get all the URLs, right? From the get request. We can say event request URL. And then let's actually, let me just comment this out. and I'm going to show you. So we're going to say URL. And now that we have this registered, so inside this application panel, we're going to press escape. So this is going to open the console. And let me just see we should get this new one Actually let me just activate this one And now you going to see and let me see oh of course I didn invoke it Okay let just do not result pass Let's just say respond. Cool. So now again, we're going to get this updated service worker and now this is updated. So let me just refresh everything. And as you can see now this picks up everything like a vacuum cleaner. So it's just here is all the requests. And you can see here we have some things that is undesirable. so this includes Chrome extensions right so it's going to pick that up also so we actually have to filter that out but yeah let's just continue so I can show you what I mean so we get the URL right and then we also want the cache so we can say cons cache oh wait so we're using this caches API right so this really isn't imported from anything again we can use this API caches open and then we can just pass our cache that's it boom all right so the next thing we're going to do let me just make some space so we're going to serve build files from the cache. So we're going to say if assets includes and we can just pass URL path name. How awesome is this? So we can say const cached response and we can say cache. We can use this API cache match the URL by the path name. Boom. And now we can say if cache response. Then we can say return cache response and that's how simple that is so here is going to be actually our offline mode so again we're in the same function respond so now we're going to include a try cache block here we can just do this we can say cache like this awesome so now we want to try the network first so try the network first right and we can do this by saying const response and we can say await fetch and we can just pass the request that we get. So now we can actually check the status of this. If it's okay then we can continue, right? Otherwise we're going to serve the cached assets. And remember how I told you that we need to filter out those other undesirable URLs like extensions? Well let's just create some variables. We can say const is not extension and we can do this by checking if the URL protocol equals to HTTP that's it, boom, done let me just put this here and then we can also say is success so we going to compare the response status if it equal to 200 So that the OK status And easy. Now we can say if is not extension and is success. So now we can add this to the cache. So the first time the user loads the app, it's going to be online, right? Because we can just put it offline immediately. They need to first download the assets and we need to store them inside the cache. so now we can say cache put and we can say event request and then we can use this interesting api so we just really want to literally clone the response so it's the same so we can say response clone and again i'm not making any of this up this is the same code example as you can read in the swelky documentation cool so now when all of this is done we can just return the response so now when the user opens or hits our app whatever first we're going to download and cache all of the assets that we can, right? And then if they're offline, so we can progressively enhance the app, so we can use a fallback. So we can say fallback to cache. And then we can use actually the same code. Const cache response await cache we can use match and we can pass it the URL. So we're caching all these things by the URL and then we can say, okay, is this URL in the cache? Okay, serve it. if cacheResponse, return cacheResponse. And then at the end, I wrote this just because of TypeScript, because it's going to complain. So again, we're still in this function respond, right? So before this function is done, we actually just want to return another response if none of this is true. So we can say return new response, and we can say not found, and we can pass it something like status 404. so that's just the type 3 doesn't complain because now when we uncomment event respond with if you didn't have this line it would complain to say okay this returns undefined or whatever so we're just going to give it what it expects alright so let's see I'm going to update all of this and you're going to see let me just refresh everything so for good measure and now we're going to see our cash is expected so all of our assets are cash here let me just see sometimes it disappears I don't know why just refresh That doesn't matter. But let me just go here and you're going to see it might not work because for service workers to work regularly they usually just

 work in production, right? But in this case, we're just using some magic under the hood to make this possible in development. So don't be surprised if you hit, for example, offline and it doesn't work because that's kind of expected, right? But as you can see, in this case, it works, but we have some issue here. But the best way to fix something like this, let me just go to our app, open your terminal, so build your app so in my case I can use PNPM I'm going to say PNPM run build so now give this a second also when that is done just run your preview so in this place I'm going to say PNPM run preview and this should start your app at another port which is 4173 and this is going to register again the service worker and again we're not offline so we're going to cache all of this you're going to see it's going to install it let's just do it like this you can see here is our cache so here is our entire build our files right so it's going to cache this as you can see this really isn't small because i'm using ffmpeg so if i go to the storage here we loaded 32 megs right and then when you go here now we can say offline and let's see if this works and you also get sometimes this weird thing so what i found out is you just need to have to refresh and it has to load these things in the network tab right and then when you go here press offline we're going to see it works so don't panic just refresh things sometimes things take to initialize download and etc it can be a lot of things so actually how cool is this we're offline friends right how awesome is this so let me actually just open this and let's see if it works the same as before boom i can drop in my video and i can start converting how beautiful is this but actually let me just cancel that alright friends how awesome is this but how do you notify the user that there's an update in your app and you've probably seen those messages where they ask you to reload the app because there's a new update and that's what you're going to do so if you go here to this course you can go to update and to be honest it's really not that straightforward there's really no simple explanation online when it looks something simple like this but the simplest thing you can do is detect an update so you can do this inside your Svelte app and then you can do here whatever you want. You can also use push notifications, but that's really a lot more involved. So let me just really show you the simplest thing you can do. So inside of our code here I just going to kill this and I going to start the development server so let me just close this and then I going to press ctrl p in my editor I'm going to open layout, and inside of here, I'm just going to include this detect service worker update code, so I'm going to make some space here, and I'm going to create a function, async function, detect service worker update, so we're going to say first registration, so we're going to see if it's registered, we can say await, we can use the navigator browser api service worker ready so we're going to see if the service worker is ready also so now we can use this registration to add an event listener which is going to be update found and then we're going to pass a callback here and inside of here we can just create a variable new service worker so new sv and then we can say registration installing and then for that new service worker when it's installing so we can notify the user we're going to say add event listener and then we can also listen for state change and we're going to pass another callback it's starting to look like a pyramid so we can say if new service worker state so we can compare the state we're going to say okay is this thing installed and it's probably ready right and there we go so now you can include whatever logic you need, you can make a pop-up and etc. I'm just going to use the confirm API. So I'm just going to say if confirm and I'm going to say new update available reload to update? And then if the answer is positive then we can say window, not local storage, location reload. So we're just going to reload the tab. But you're going to see there's going to be a problem with this but for right now it works so we actually need to invoke this function so I'm going to import on mount from Swell so you can see it's imported here at the top and then we can just say detect service worker update. Cool so let me just save everything and remember here is the build so we have to go through development also let me just reload everything I'm just going to turn off offline as you can see there an update so let do that awesome so now when we refresh this now we can go to our service worker and let just say OnzoLogHi So now you're going to see, it's going to ask us if we want to reload to update. And that's the simplest way you can do it. But you're going to see there's going to be a problem. So if you remember at the start, I told you about the conditions that are required to activate the service worker. So if you just reload the tab, it's not going to work, right? Because that's not how it works. You have to actually close the tab so the service worker has to be done with everything that's going on and then it's going to work if you create a new tab. So let me just close this tab. I'm going to drag it back over here and then I'm just going to open the network tab application and as you can see our service worker is installed. Well, that's inconvenient. So how can we fix that? And the fix is actually really simple. So we can go back here to our layout and we can just modify this code slightly so we can post a message to the service worker. So we can say new service worker post message and then you can give it a type so you can name this banana i'm going to name it skip waiting so that's how we're going to do that all right so if i save this and now back to the service worker i'm just going to say self add event listener we're going to listen to a message we get back the event and now we're going to say if event data and event data type so this is the type that you gave it if it's skip waiting then we can use this api we can say self skip waiting so that's the same thing in the gui that we clicked on just we can use it here using code all right so now we can save this and now let's see if we do this and if we refresh you're going to see our service worker is activated how beautiful is that friends all right so in the last part let's look at how we can make our app installable and again we can just look at this beautiful guide what we need first is a web app manifest so this is going to give the information to the browser how to display your content or how it's going to look inside of an app so you're going to see it's just a JSON file and then you have all of these options so you can see what they do you can provide an icon they show you here how to do that using mass icons and we're going to use the VIT PVA asset generator so So we're going to generate this icon, so you don't have to think about this. And let me just really show you how this looks like. So we can go here to the code. I actually going to close these tabs because we done with this And I going to collapse source And now you add a manifest file so to add the manifest file go to your static folder you going to say new file and then let's just add manifest json this is going to get picked up so that's really it and there's really a bunch of fields that you can include but let's just keep it simple i'm just going to say name and this is json so we have to do name so i'll keep pva so there's also going to be a short name so this is all going to show inside your app and then we can give it the start url so this tells where your app starts our app starts at the root so really nothing different here now for the display you can say standalone and again if you look at this beautiful course here they explain all of these things. So I think it's in app design. Let's look here. So you can see here display modes and they explain all of these things. So this is the standalone so it's going to open this window. Then you have also the full screen experience and the minimal user experience. So you can look into that and you can do what suits your needs, right? And you can include some things like the background color. So this is going to show, this is going to be the splash before your CSS loads I think. So we can give it a color like this and say 17191c so this is just going to be a cool gray and then you can also give it a theme color so this is going to be the border of this so when you look at this it's also going to show on your phone when you look at the navigation bar at the top is going to change the color so that looks really cool all right so i can say theme color and i can also give with a hex value, so I can say, FF3F20, and you can also include, a description of course, and I'm going to say, WebM2, MP4, video converter, that's it, and there's a bunch of fields, you can add, you can look into that, but the last field, I just want to add, are going to be icons, and that's going to be it, alright, so that's really tedious, to generate yourself, so we can use the CLI, from the VTVA, and I'm going to include, this link in the description, as always, you can see here, you can install it. I don't want to install it actually, I just want to use the CLI so you can use npx. You can even add it here to your scripts, so you can add this generatePVA assets, and then you can say npx whatever. But let me show you actually what I'm going to do. So here inside, I just put this icon.

 actually just downloaded the Svelte SVG icon because SVGs are really awesome and flexible so you can create any icon from this and you can use SVGs, PNGs for your icons but yeah so you can do a lot with that. As you can see here I have this logo.svg which is really just the Svelte icon and then I'm going to open the terminal we can say npx and now I'm going to say npx at wheat-pva slash assets generator and then we can pass it this preset minimal and then you can pass it the path to your logo or whatever else you have. In this case my logo lives in static slash logo dot svg. Boom is going to ask me if it wants to be installed which already done is because I used this before and boom that's how simple that is. So now it's going to generate all of these files. So I'm just going to run the development server and we can just populate these icons here. So if I go here to the icons, you can just pass whatever you want. I'm just going to say source. We can say PVA 64 by 64 It a PNG right And then you can say type here Image slash PNG And then you have sizes So I can say 64 by 64. And then I can just copy this two times more. Because I'm just going to use two icons. It's not important. Just do this. And then I'm going to have. 192. And that's going to be it. And for the last one, I'm going to use 512. Just copy this. And beautiful. So now we actually need to open app.html as well. So you can press Ctrl P in your editor. You can say app.html. So we have to include it here in the head. And now we can go here and we can include another link. So this is going to be link rel manifest. and we can use the same type of thing here. So you can use this percent sign where the SwellKit assets are SwellKit assets so this is your static folder And then we can say slash manifest json And now when you go to your app so I started the development server, right? And let me just refresh for good measure. So now let me just make this wider, and now you can go to your manifest here, which is also reload, and this is going to be all of your information. So if you do something wrong, you're going to see it here. Let me just collapse this. So as you can see, here is our name, SwellKit PVA, short name, and etc. our description. We can see here is our theme color, background color, start URL, orientation, and you can see all of our icons look great. So you can change this however you want. And that's basically it. So now your app is installable. If you didn't see it already, here is this icon for installing it. So you can install the SwellKit PVA. But in my case, first, remember as before, first I'm going to build the app. I'm going to say build and let me just say and PMTM run preview. cool so now this is going to start and if I go here to my page 4173 you can see everything works this thing is registered so now we can just install this if we go here with this button we can say install apps felt kit pva you can say install boom and now this is going to open like a regular app right how beautiful is this so now i can drag my file etc do whatever i want and then if you want to get rid of it here depending on how your ui looks like you can just go here and say uninstall Svelte PVA and it's going to remove it. But yeah that's basically it right friends and how beautiful is this. So that's basically how you make a progressive web app with Svelte. Of course you can do a lot more but I'm going to leave these resources to you so you can learn more how to achieve what you want. Alright if you like what you're seeing don't forget to like and subscribe and you can also support me by becoming a patron. Thank you for watching and catch you in the next one. Peace.