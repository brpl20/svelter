 Hey friends, what's up? Today we're going to learn how to use Svelte to Sveltefy any JavaScript library. In a previous video, we learned how simple it is to use regular JavaScript libraries in Svelte because Svelte gives you easy, direct access to the DOM. So in this example, we're going to do the opposite. We're going to look at two libraries. We can Sveltefy floating UI. We're going to make an awesome tooltip. And then we're going to look at leaflet for creating interactive maps. So here I have an example. Here I have a tooltip. Then you hover. This is a component. This is an action. you might be wondering what is the difference if you aren't familiar with this. Well basically this is a regular component and then this is a swelled action so we can use this use colon tooltip so we can reuse this across any component. And then you're going to learn more about component composition using the context API to make something awesome like this so this is a far better developer experience and maybe if you want you can also publish this as a library. As you can see here if you look at the map here we have this gorgeous map and then we're going to place some markers. Alright, but before I get started, don't forget to like and subscribe, and you can also support me by becoming a patron. Alright, so let's look at FloatingUI. And FloatingUI is just a JavaScript library for positioning floating elements, so you can do anything from tooltips to drop-down menus. And maybe this is going to be redundant when the popover API becomes available in every browser, but for now, let's just use this library. So what is the first thing you do? You go to Get Started, and it already has a React and Vue wrapper, but no Svelte wrapper, unfortunately. so if you want to follow along you can just install it by using npm or pnpm you can say install at floatingui slash dom and of course use a javascript library in Svelte you don't have to Svelteify it and there's probably already 10 people who already did that so for example we can go and search floatingui Svelte and you're probably going to find a link like this let me just zoom out as you can see already someone did the work for you but that's really besides the point you do this to learn and to make something specific to you so for example this code if you look at the source code looks intimidating and it's a lot of code because they're trying to port the entire library over to Svelte right but maybe your specific use case is something like a tooltip and you're not interested in anything else in which case you can just write a couple of lines of code and move on so you don't need the library for everything right and that being said when you go here to the tutorial so this is what I looked at so here it shows you how to set up everything which I'm going to show you in a second so you have a lot of interesting things here and etc you You can just look how they do it in vanilla. And then you can go here to Svelte. And here I importing this tooltip from here This is just a component So it easier to see So here is nothing special It vanilla as it gets minus that I using the bind directive So I binding the button and the tooltip So you can see here button bind this And then I'm also binding the reference to the tooltip element. And here I have some event listeners on mouse center and mouse sleep. So we can show and hide the tooltip. As you can see, nothing special is here. It's the same as their example. Here I change some styles. I'm using CSS variables. So when I go to my app CSS, you can see at the root, I have it set up like this, which is what I prefer a lot more than just hard coding values. And this way, if you're making a library for someone else to consume, they don't have to pass all of these values, right? To the function or whatever in JavaScript, they can just override them using CSS variables. But going back to the tooltip, here, as you can see, there is nothing special. So here I have this update tooltip position because we need to rerun this when the tooltip is going to hide and show. So we're going to use their API. I'm using the async await syntax here. So I'm just going to get the X and Y values. Nothing special here. They're using this interesting syntax here, but it just means basically like this tooltip. Element style. Left and then you assign it a value and then you can also do this for top or whatever. But you're using object assign because you have to type less, right? This is really an awesome way also to create DOM elements if you ever use vanilla JavaScript. And basically that being explained, there's like really nothing special here. as you can see, we didn't have to write any special Svelte glue code. The only special thing here about Svelte is I'm using our reactive declaration. So whenever showTooltip changes, we're going to run updateTooltipPosition, which we can honestly just run inside of a function. This is nothing special or required by Svelte to make this library work. And then here where I have this element, and here I also have this class that I conditionally toggle based on if showTooltip is true or not. So basically here we're going to use displayBlock or none to show and hide the tooltip. and that's basically it. Alright cool, so instead of using this component let's make a reusable Svelte action. And if you aren't familiar, a Svelte action is basically just a regular JavaScript function which gives you a reference to the element and you can use it to attach some behavior to any element. So let me just close this and only thing from here I'm going to copy over these tiles and that's basically it. So inside of my sidebar I'm going to go inside the tooltip page and if you're wondering all of these links with the REPL is going to be in the blog so you can read the post if you want and play around with the example Alright so here I just going to remove everything so let start from the beginning and then I going to create this script tag And creating a cell to action is as simple as saying function And I give it any name you want So you usually see node like this. But I never liked that name. So we can give it something more descriptive like target element. Let's give it a type. Like HTML element for example. And then we're also going to pass in some options. Which I'm going to name tooltip options like this. and this is basically it. So now let's just create this type so I can say tooltip options and the tooltip options are going to be simple. We're going to have text which is going to be optional. Otherwise, we're going to use a default value and then we're also going to have an option for the placement which we're going to import from floating UI DOM so that's really convenient for us. All right, so when we go back here we're going to see when we say console.log.hi for example and then we can create a button. So you can use an action by saying use tooltip. We can say hover. So let's save this. And now when we go back here to our example, let's go to the tooltip. Now when I open the console log, let me just zoom in so you can see what's going on. So now if I refresh the page, you can see hi. So you can see we hook into the lifecycle methods of the elements themselves. So now we have a reference to the element itself and we can do whatever we want. So here's what I'm going to do. I'm going to go back here. Let's just delete this. And first we're going to create the tooltip element. So we're just going to do everything by hand using good old JavaScript. So we can say const tooltip element. We're going to create this function createTooltip and you don't have to pass it a value here but I prefer to be explicit. So you can just say target element which is the target element of the node that we have a reference to. And let's just name this createToolTip. And awesome. So now let's just go here. I'm going to create a function, createToolTip. It's going to accept the target element, which is going to be of type HTML element. If you're not using TypeScript, you can just ignore the types. So now I'm going to use that trick for creating a DOM element using object assign I told you about, but you can just use the regular old method if you want. So you can say const, ToolTipElement. and now we can say object, assign. So the first thing we can pass it the element we want to create we can say document create element which is going to be a div So basically we creating the tooltip on the fly and then we going to append it after the button All right, so now we can create some options. So here inside of our options, we're going to assign our role, which is going to be tooltip. And then for the inner HTML, we're going to say options. You have to use question mark if it doesn't exist. So you can use knowledge coalescing and then we can set the default text to be tooltip. And now for the styles, we can just give it backticks. And remember, I copied over the style, so we can just do it like this. Let me just fix the formatting. And how beautiful is this? So we can just bake the styles right in. And again, we're using CSS variables, so it's very easy to change the styles. Awesome. So now we can save and Prettier is going to format it. So we created this element, so now we just need to append it. so we can go here we can say target element we can use the after API so after the button we're going to insert the tooltip element and then we can also return the tooltip element and that's basically it alright so we're going to create again the function that you've seen before I'm going to say async function update tooltip position. So now we're going to pass it the target element, it's going to be HTML element. And then the tooltip element is also going to be HTML element. Awesome, so that's basically it. So now we're just going to reuse the API so that I don't have to type all of this. Let's just go back to the tooltip here. And we're just going to steal this code. Don't mind if I do yoink. So now we're going to go here. And basically that's it. So now we do the same thing, right? But we also have to import these things. So let's import compute position. And then we can also import the offset middleware. So as you can see, go to the top. This is all going to be imported. And instead of button element, this is going to be target element. So we're just repurposing our old code. Nothing special. So let's check if everything is okay. So we have the placement. and we're going to use our options here. So for placement, I'm going to say options. Yes, it doesn't exist. Placement by default is going to be bottom. So this is fine if it's undefined. Then you have this

 offset here. You can also pass an option for this if you want to specify the gap. And everything else looks fine to me. Alright, so let's save everything. And now we're also going to create two functions to show and hide the tooltip. So remember, this is just vanilla JavaScript. We're not even writing swell. How awesome is this? So function, scroll tooltip. And then you can say tooltip element. You can say style display. We can set it to block. And then we want to update the tooltip position we can say target element and tooltip element awesome and then let's just copy over this function so this is show tooltip and this is going to be high tooltip so we're going to set this to none and we don't have to update anything here so let's just add the event listeners for the target element so let me just scroll down we can say target element add event listener on mouse enter so we can say show tooltip so let's just copy this over this is going to be mouse leave and we're going to hide the tooltip and one last thing that is important we have to return a cleanup function which for an action is going to be the destroy function so inside of here let me just copy over these two lines instead of adding an event listener i'm going to ctrl d select both of them remove event listener and basically that's it so now when the cleanup runs it's going to remove the event listener all right so now let's check if everything works so i always want to refresh for good measure so as you can see everything works fine and now we can pass anything we want here and thanks to tie screen we also have a great auto completion so if i press control space bar here we have text and placement so you can say whatever you want here like action then when i go back here to the example you can see when you hover over it says action so this might seem like a bit more code than usual right but remember you write this once and now you can reuse this anywhere so let's take all of this code you can publish this as a library whatever right so let's take all of this code i'm going to go to the sidebar inside my lib folder I'm going to create a new file tooltip.ts and let paste all of the code here don forget to export your function so you can use it So we have this function here export Awesome so now I inside of here Let's just start typing tooltip here, and we get great auto import. Actually, not tooltip from Liblet. Lib tooltip. There we go. That wasn't that bad, right? So let's see if it still works. How beautiful is this, friends? So now you can copy this over. you can say action 1, 2, 3, 4, whatever. So now you can see how awesome this is and reusable. So let's see how this works. And what if you want to change the placement on the last one? We have great autocompletion. We can say right. And again, because we're using the types from the library itself, we get this awesome autocompletion. So now the hover is going to work the same. But now if we hover over the last one, it's going to be on the right. How beautiful is this, friends? So using a Svelte action, we abstracted the tooltip logic into a tooltip action, which is just a regular JavaScript function with a reference to the element. And you can import this action from anywhere and use it with the use action directive. All right, so let's look at the next example, which is going to be using Leaflet. And Leaflet is really great for interactive maps. But not only that, Leaflet has every possible problem you're going to run into when using SvelteKit, including server-side rendering, right? because this is an older library. It assumes you're just going to run this in the context of some browser and it has really a lot of problem, but the library itself is really awesome actually. So the first thing we do, we go to the tutorial, right? So a quick start guide and the first problem you run into, it doesn't even have instructions for NPM. So if you look NPM, there is like nothing here. It tells you to use this over a CDN, which I highly discourage. You should always use NPM unless you're trying something out and don't really care. but just go to npm if you search for leaflet all of these libraries are on npm you can find it easily here and it tells you right here how to install it so you can say npm i leaflet or whatever and if you're using TypeScript and wondering how to get types for a library that wasn't written in TypeScript well usually every library has type definitions made by someone and how can you know where those types are? well look at the name here and then when you hover over this dt symbol it says this package has type declarations provided by at types leaflet so you just install this as any normal package and now you have types how easy is that so basically that the first problem solved and then you just look at their docs they have a really simple example here really great api as i already said another great thing is that it uses OpenStreetMaps You don need any API keys or any of the junk It just works So you can try this example out yourself. Don't have to input any API key or that other garbage. All right, so let's look how this looks like in Svelte. So here I'm just importing this leaflet map from Maps Svelte that I created. Basically, that's just it. So let me just close this so we can look at the code. As you can see, this is really simple. So I see a lot of people are confused by this. when a library has some styles like this, where you import it, they don't even have NPM instructions, right? Well, basically everything that gets packaged with this library is available from somewhere, right? So you can see here is this URL. It's slash this. So there's a this folder, and then here is the CSS. And basically replace this URL with the name of the package, right? So let me show you something. So when you go to your node modules, open your node modules, let me just zoom in. So you can see here where it is. Leaflet. You can see it's the same structure here. you can find your CSS and etc. And whatever is inside of here, you can access over an import. Basically, that's how you solve that problem. Let me just close this. You can see here is how I import CSS. So we go leaflet slash this slash whatever you want. And here I'm using on mount. And you can see here is something interesting. We already did this in the previous video. We covered every possible problem you can run using a JavaScript library in SvelteKit because of server-side rendering. So let me show you what the problem here is. You might be thinking if you import... leaflet from leaflet you're going to see there's going to be a nasty error. So if we go back here even in the terminal or the console you won't see anything useful. Now we get an error and this is because this happens on your server. So if you go to the console window is not defined. So this library is a bit older so we're going to give it slack but this is absolutely insane that the library does something like this. So basically let me show you what the problem is. Again we're inside the node modules. you can open the source code itself and now let me just oh this is some minify junk let's see uh esm source all right so ctrl f window so let's see there is a function let's just see so you can see here is some random variable whatever really doesn't matter it happens all the place the problem is that they call this window browser api directly when you import the library instead of like a normal person having to use a constructor to create the library or whatever right you know what i mean So basically this is the insanity you have to deal with and now you have to use a dynamic import which really isn bad but I wish you didn have to do this thing so we using a dynamic import because leaflet runs code on the window object during initialization and basically how you fix that you just use a dynamic import await import leaflet no problem when the component mounts beautiful so now let me just remove this line of code and now we're just using their api so we create a beautiful map of croatia god bless so now we can add a map tile here using open street maps so leaflet is going to do everything for us now we're going to add two markers, you're going to add one marker for Zagreb, so if you don't know, you can get coordinates for your city or whatever, just go here, and you can say coordinates, or whatever place you live in, right? And now you can get the latitude and longitude here, and you can just copy paste this over, and easy peasy, lemon squeezy, that's how we do it. Let me just refresh this, and everything should work if I remember to save, which I didn't, right? So as you can see, everything is beautiful, and here we have our markers. And then if you go back, this is basically it. Here again I just use bind this element and I made this map position absolute inside but let's look at how we can maybe reuse this. So maybe you don't want to copy paste this code for every project maybe you have multiple maps across your app or whatever. So basically we're going to use component composition so we can use this map in a nicer way. All right so what am I talking about? Well let me just collapse this so we can go here where we have our map and inside of our page here. Here we're going to import something else. So let's just keep this open like this. Let me just remove everything. So here is what I have in vision. This is my ideal dream API. So we can say import. We can import a map and marker from lib map. And now we can use composition instead of using imperative JavaScript. We can use the declarative nature of Svelte. So we can say map for example and then we can pass it latitude and longitude and then we can also pass it other values such as a zoom or whatever else we want so this is going to be like that and then we can also pass it a marker this is going to be let long and then we can also pass it a label you can name this whatever you want let's do it like this awesome now let's just copy this over that's it so now let me just go over here I'm going to move this let me just copy over these coordinates so I don't have to do this anymore so here we can do it for the map this is going to be the same

 values, like this. Just copy this over. And the last coordinates, that's basically it. Of course, you can put this in an object or whatever else you want, but I'm going to do it quickly like this. And that's basically it. So this is basically the API that I want. And of course, right now it doesn't exist, but that's what you're going to create next. so just so you're not confused I'm going to close this and now inside of the lib folder let me just zoom in I'm going to create a new folder I'm going to name this map and I'm going to create a map.swell component and then I'm also going to create a marker component and then I'm going to use an index file so we can export everything and use a single line import I'm going to do it like this index.ts and basically that's it so I can close this let me close the sidebar and then inside of here we can get started so let me open this by saying script and now we can just define export let so we have latitude which is going to be a number let's copy it over so we have longitude which is also a number and then we also have zoom right going to be a number and then we're going to have some states so we're going to have leaflet so this is going to be the leaflet instance which is going to be type of L so we can import this like this we can say import type L from leaflet if you want the type so basically that's how we can type this value and you can always look at the type definition for this so if you open the type definitions using alt you can see here it's exported as a namespace L and these types are made by someone else so the library isn't written in TypeScript but as you can see here we can find every other value you can and then I'm going to also show you how you can figure out some other values so we can also create leaflet map itself and this is going to be l.map and then we also need to bind the map element like before so we can say html div element awesome so now we can import on mount which should be auto imported for us at the top so let's just move this to the top and we can also make this async in before since you going to do the same thing so right now we going to say leaflet equals await import so now you just say leaflet which is the npm import right and now we can say leaflet map we can reassign we can say leaflet dot map so we're going to pass it the map element and we're just going to set the view so we're already passing the latitude and longitude and then we can also pass the zoom so we parameterize this and now another thing i want to show you is for example how do we know the type of this leaflet map well whenever you use an api that's already typed you can just cover over it you can see what type it is and again you can follow it to this type so you can see it returns map so basically you can type it as that and you can start typing the api if it matches to what you expect okay great now you found the type basically that's it it's a bit dirty but yeah works as again things aren't always perfect you're always going to run into some weird things all right so now we can say leaflet tile layer so we can pass it the url and let me just open that other map let's see source lit map route map let's just copy over this entire thing so we can go here let's see leaflet tile layer and then instead of map we pass it the leaflet map and basically that's it all right cool so now let's create the element so again it's just a div we're going to say bind this map element and it also has class map and again let me steal so we can open this and let's just yoing the styles here we could have yoinged a lot more but I want to show you what's going on. So let me just copy this over. Alright, so now we save this. And of course, nothing works yet because we need to finish this API. So basically, the problem we have here, we have this component map, right? And we created this reference to the leaflet instance because, as you've seen before, maybe I should have this permanently open. Let me just open map. As you can see here, we have this reference to the leaflet and etc. and we're creating the marker. so we need somehow a way to pass it to the children right and to do this we can use Svelte's context API so we can just send this instance or whatever else we need down the component chain to the child alright so how do we do this well we can use set context so I just going to find a cozy spot right here and then it simple as saying set context which should get imported from svelte as you can see set context so now for the set context you can give it a key right now i'm just going to give it a key map and now you can pass it anything so i'll be thinking okay i'm going to pass it leaflet and map but there's going to be a problem when you do this basically when you try to use this in the component later it's going to be undefined and that's because that's the initial value. So instead of passing a value like this we just want to pass a mechanism to always get the freshest value. And how do you do that? Well you use a function right? That's how simple that is. Alright so now I can do this. I can say get leaflet which is just a function right? And now we can return leaflet. We can also say get map which is a function and we can return the leaflet map. And that's how simple that is. Another thing we want to prevent the values from being undefined, we can do this by using an if block. So we can say, hey, let's just do it like this, which I didn't mention. So we need to pass somehow these other components, right? This marker, which we can do by using a slot. And now we can also say if. So now we say, hey, only show this when this thing is ready, right? So you can say if leaflet is present and leaflet map and this is going to avoid some weird problems. Alright cool so basically we can take all of this and we can copy it for the marker. So let's go to the marker and now we have latitude longitude there's no zoom but we have a label which is going to be a string and awesome so now we can use the context from self. So now we can say const we can destructure get leaflet and remember this is only going to be available when this thing is ready so you're not going to get undefined. you can say get leaflet get map how do you do that? well we use another API get context boom and the only thing you need to pass is a key so we named it map it can be banana or anything and that's basically it so now it's complaining about types but we're going to fix that in a second for people who are interested in TypeScript alright so now we just need to use the API right? how do we do that? well we can say const leaflet so now you can get the instance to the leaflet we can say get leaflet and we can get the map that's how simple that is cool and now we can add the marker so we can say const marker this leaflet marker and now we can pass it latitude longitude and we can say add to the map that's why we needed to pass leaflet and map this is basically how simple this is you just need to look at what you need to pass down and you just pass it down that's it and of course instead of saying long it's long did I say here long too let me just see what did I use let long okay well this is a mistake this should be long awesome so now let's go here and the last thing for the marker if you look at their API so you go to the leaflet right you just see docs marker they literally tell you everything you have to know and also they have examples and you have to go here and then you can say marker bind popup as you can see here we don't have any types because we haven't typed the context and you can also pass the label and now this one complained at us and this is still yelling at us alright cool so let's export all of these things so here's something that we can do first we're going to import map from map.svelte then we're going to import the marker and let's just also create the context type so we're going to export type map context so it has a function get leaflet is going to be type of L. So remember again, we have to import this. Import type L from leaflet. And again, you won't run into those weird problems with window because you're just importing a type. You're not importing the actual module. And now we have get map, which is going to be L.map. Cool. So now we can say export map marker. We can just import the type as a generic. So we can do this. And we can say map context. So this should auto import for us. So let's see. This should be lip map. Awesome. So now we also get the types. So now as you can see, when you use this API, you're going to get a great type completion. All right. So another thing I want to do is to create a better key. So we can go here to our map folder. And I'm going to create new file. So I can name this key. So we really want something unique when you have multiple instances of the same component. So you can use something like an object or most frequently used, you can use a symbol. So you can just say export

 const key symbol, like this. And why is this unique? Well, let me just go to the developer tools. Let me show you. So for example, let's look at an object. So we have const a, and we have const b. If you compare them, they're always going to be false. And same as a symbol. So you can say symbol. As you can see, it's false. So basically, that's why we use a symbol. Let me just close this. go back so now we can import the key here just so we can export it and now we can say map marker key so let's go here to the marker let's see if it's going to auto import it for us awesome so now we have the key and the type and again here where our map is and since i goofed up here and named it long i'm just going to rename this and boom beautiful so now where we use this we can also import the key and let's just rename this to the import that is lib map and i also forgot to import the css here so i can say import again boom you also get auto completion right so you can see leaflet this boom you can find the css leaflet css easy peasy like that friends all right so let's save everything so this might look intimidating, right, if you never use context or etc, but once you try it a couple of times, try an example, right pass some basic values, right, instead of creating a library at first or something, right but you're going to see how simple this is, so basically we just created this context we just need to pass things to the children and we know that because we look at this here otherwise we would have to do something like that we would have to pass the instance here then we would need to pass it here and etc and that would be really annoying so we can use beautiful component composition like this all right but the moment of truth does this even work okay i'm going to save everything and now let's look at our map always no tricks let's refresh how beautiful is this friends everything works as intended all right friends i have one last cool thing to show you and that is dispatching custom events. So for example, let's say when someone uses this marker and uses a pop-up, maybe we want to do something custom, right? So how can we dispatch a custom event? And that's really simple to do as well. So let's say for example that we want to do it on a marker and how do you know these custom events right? Of course always consult the documentation. So let's just see when you go to the docs, you can see here they have events. So they list every possible events here, which is really nice but for example maybe you're interested in a marker and again if you go to this section of documentation it's going to tell you all the possible events so they have here events where it is here you go so when you move the marker so you have dragging events then it inherits other events from other things so you can see the pop-up here which i want to use so here you can use the event pop-up open and pop-up close so let's do that so i'm going to go here in our code and how do we do this well basically first we need to import the create dispatch function so we need to create a dispatcher. So you say const dispatch, and this is a Svelte API. So you can say create event dispatcher. As you can see at the top, it gets imported for us, and that's basically it. So now, you can use the leaflet API. You can say for example, marker on, so we already know the name of the event popup open and you can already see how beautiful it is when we have types right And how can we catch this Well we can just pass a function and we can use dispatch We can say dispatch and you can name this whatever you want Like this can be banana or whatever, whatever you enjoy, right? So you can say open and let's also do one when the pop-up closes. So we can say pop-up close and that's basically it. Let me just put it like this. All right, so how do we use this? Well, where we use the API, it's really simple. so we can go here and let's just make some room here so we can listen for the event we can say on what was the name that you gave it open how beautiful is this friends so we can pass a callback you can send data whatever you want i can say console log open and now let's say on close we're going to send this event close and this is how beautiful composition is itself so let's try out here we go let me open the developer tools so i'm going to click on this and you can see the open event triggered and when it closes another event triggers how beautiful is this friends and by the way this also works for svelte actions but you can't use the svelte api directly so let's actually go to the svelte repel this is really cool something i want to show you so let's just open that and let me just full screen it don't need to zoom in so for example let's just create an action here I'm going to name it function action again we have the node or element and let's just say element add event listener but this can be triggered by anything so the difference here is that we have to use JavaScript itself so if you go on MDN MDN custom event you can use the swell dispatcher inside so you have to use actual JavaScript So you go to custom event you can see here is how we use it new custom event, here they have an example. So let's look at this in the REPL. So you can say add event listener. So for example, let's say that we click on it. Now we're going to pass it a callback like this. Awesome. So now we can use custom dispatch. And basically that's how it works under the hood, even for the Swell Dispatcher. So we can say element dispatch event. So that's the API. And now we can create a custom event. You can put this inside of a variable or whatever else you want. So you can say custom event. And we can name it banana. It's really not important. Awesome. So now here let's create a button. And now we can say click. So now we can use the action. And now you can listen to anything. So you can say on banana. Let's pass it a callback. you can say console log like this and I also forgot to close the parenthesis here I think, yeah okay so now let me open the console here so you can see what's going on so keep in mind here we have this custom event listener just using regular vanilla javascript, boom and now we log a beautiful banana. Alright friends so basically that's it, I hope you learned how to Sveltefy and in javascript library if you like what you've seen don't forget to like and subscribe and you can support me by becoming a Patreon. Thank you for watching and catch you in the next one. Peace!