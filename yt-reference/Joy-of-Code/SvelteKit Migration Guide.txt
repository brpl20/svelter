 Hey friends, in this one I'm going to show you how to migrate your SvelteKit site to the newest version of SvelteKit after all the breaking changes. But first I want to answer the question when I'm going to update other SvelteKit content and why I'm hesitant on doing it. The reason is that things are changing a lot recently and with my luck when I release a video it's going to get outdated the next day. So for example if I go to routing and now when you have, let me just see, page server TS. So you have now actions inside page server TS. You have your post patch boot delete. And if I made a new video for example on routing. It would already be outdated. Because they're going to remove this in the future. For another thing. Which is going to be an enhanced form like Remix has. So they want to remove the HTTP words from the file. And you're going to export actions for your forms and etc. Which is going to be awesome right. But again if I made this video right now. It's going to be immediately outdated. and then you have some other things like for example why i'm not updating the svelte kit authentication yet they do random things like they remove session from pages so i'm not really sure if that's staying or not so i'm really just waiting for things to settle down before i do anything right and because of these small changes one thing depends on another and that thing changes and then the entire thing is invalidated right so that's the major reason why i'm waiting those changes out But yeah, I'm going to show you how to migrate. You're going to use the docs and it's going to be fun. Here is also the migration guide, which I'm going to link in the description. So we're going to see how that looks. And let's just recap quickly. I didn't make a post on this because it's fleeting, right? These breaking changes are always happening, but I'm going to also link this post. So let's recap. So file-based routing is gone. Now you define a folder and then you can create a page. So from this you have a plus page, which I covered in one of my videos covering the Svelte changes. If you want to watch that, it's like a 10 minute video. And then layout is also changed. So name layouts were removed for group layouts. And you can read about that. It's a bit confusing, but once you start using it, it makes sense. You don't have to use it if you don't need it. But yeah, you can also read through this post if you want to get up to speed. And if you haven't updated yet, there was also a breaking change recently where Vite has its own configuration file so maybe you also want to update that. So if I show you for example in my project on the side Vite now has a separate config project and cell config so maybe you didn upgrade to this path yet So yeah you should also be aware of that But this post is really awesome showing you that, and it also shows you how to start migration. But yeah, it's really awesome. Great post. But yeah, let me just close this. And first let's do a sanity check, right? So do things even run before we start upgrading, right? So you can say localhost 3000 and give it a second and yeah everything works fine so we can start the migration and here's the migration guide from the selkie discussions so before you upgrade you should run npx or pnpx svelte migrate routes and this is honestly going to do like 80 of the work for you so this script is really amazing and props to everyone who made it and you also have here a reference, how you should update the load function, and other things, right? So you can just look at this, look at the documentation, and then judging by that, you can easily upgrade your SvelteKit project. But yeah, here is a lot of read, but I also like this at the end. So you can really see how the old things map to the new ones. So you can see that the index Svelte, which was previously this, is now plus page Svelte, load functions, and etc, page endpoints. But if you really want a recap of this, I have a video you can watch. And let's start by creating a new branch. Yeah, so I can say git checkout b, and then I can say soil git migration, because what I prefer to do, I like to create a new branch, then I push the branch to the main repository, and then I create a pull request from that, which is great. But yeah, so let's listen to my own advice. So we can say pnpx svelte migrate routes and you can see most of your project is going to be transformed so you can just answer yes and this is really awesome so if you look here it is going to be a lot of changes and it's also interesting to contrast this how things looked before so you can look here routes and then we can look at this but now if I go to package.json we should see my version of CellKit, which is 398. So we can update that. I think it's pnpm update. And then we can say CellJSKit latest So this is going to get updated And remember to run your migration script before you do this So yeah this version is now updated which is great And now if I run the project it's on port 3000 because I have it configured in package.json. Like that. If I go here, and here is the port. So I have it like it was before, but I might change that. Yeah, so let's just pnpm run dev like before. And now nothing should work, right? I should get an error. Also, here is another breaking change. So appenv has been renamed to app environment. Yeah, so we can just copy that string over. And all of these breaking changes are going to be always a surprise, but we can just stay calm, right, and fix them. But yeah. So we can go to the search feature in VS Code. And now I can look where this is referenced. So this is the blog post. I really don't care about this. So here I can say app environment. And let me just copy this over. so I don't make mistakes, right? And yeah, just close that one. We can also do it here. Yeah, just read the error messages and you're going to be fine. App environment. Let's see. Inside views. And there's also going to be another one, I think, with SwellKit prefetching, so we're going to get to that one later. But now if I refresh this, we should get another error, which is awesome because errors are really a way of moving forward, right? Okay, so let's see what happened in this project. So I can just close all of this file. Let me just click search. I'm going to open the site. So let's start with the low-hanging fruit, right? And that's going to be the, let me see, the RSS. So you can see how we changed. So now everything is a folder and then inside you have your endpoints and pages. If I can contrast this to how it looked before. And we're mostly going to be deleting code, which is always a great feeling. But yeah, let's just go first to RSS. So if I open this file, and then you might see a lot of squigglies and freakout, but everything is fine. Since this is just a regular endpoint, we just need to return the response from here. So here in the past, I had this code. So always consult the documentation. So if we look at server, here is server, and this is your normal route. So here we have the return type. This is how we figured the types in TypeScript because you can see the JS doc one and then you like okay get request handler In this case it great things request handler yeah that fine but now this is complaining because we just need to return a raw response so let me just comment out this error and we can go here and now we don't need to include all of this junk let me just say you return new response so i'm just going to copy over this part that i returned in the body. So if you read the documentation right, it's going to tell you what you should do, which is really awesome. Yeah, and then I can just also return the headers if I write. Yeah, headers. So I can just literally copy this part over and I'm done. Yeah, which is great. And now we don't need to return all these other props. As I told you, we're going to be mostly deleting code. I don't need this. And let me just give it a look. Now we don't have any errors. And let me just check here. So we can go to the RSS. Let me just see RSS. And great, it works. That's all. And we can see if my caching works, which is really important to me, right? So I can go to the developer tools, just refresh. And if I open it here, just bump it up. And we can see it sets it to public, max age to this and for the CDN. So it's going to get cached by the CDN so it doesn't always generated, right? And that's really awesome. Yes, I'm going to go here and just close this. So let's solve another problem. This is done. So where the sitemap, right, which is going to be similar. So this just has a JSON. And I also apparently left console log here because I'm a professional. Yeah, but let's just do this. Then we can say, return new response. So we can say sitemap. Then we can do the same thing. Just copy over the headers. Yeah, then we can yeet this code. Fantastic. Fantastic. Just see... Is there anything else? I'm not sure why it imports this. Remove this. Yeah, let me just do that. Yeah, I'm going to save everything, give it a good look. So if I go here... And I think it's sitemap.xml. And awesome! The sitemap also has a good look.

 works and let's just check if the cache control headers are set which they seem to be so yeah that's great just close this and now let's start with the landing page right so you can go here always like consult your terminal it's really going to tell you where the error is but i tested it out before and I was really surprised I was like what is this? It like created this random file for whatever reason because I probably had some code in a load function for the maxh cache but now it's really awesome because you can set your cache inside your endpoints you don't have to pass it to load anymore so I think that's what got him confused because if I go here let me just see index.swealth yeah here it is so probably it was like oh you had the load function before, let's create a new file, but really it's unnecessary. So yeah, you just look at the files and it's going to make sense. Yeah, but I'm going to delete it because I don't need it anymore, I think. Actually, let me just leave it so I can check. But yeah, let's start first with the page server and the page itself. And before that, I can also show the error and layout, which really didn't change much. So I have a simple error page here. I really don't have to do anything here. Layout, the same story, nothing to do here, it's already a migration script doing the work. So I already see a mistake here, which also the script messes up, so the types always come from .slash types for the page server load. So now we have this load function inside, and now instead of returning all of these props, you just return the posts, so you can say return post. And we can also set the cache here. So interestingly, this is how I was setting the cache for the endpoint, but I also want to set it for the page. So maybe that's something I'm going to revisit later, but let me just show you quickly how you can do it. So you can press control spacebar if you have the power of TypeScript or if you're using JSDoc, of course. And now you have set headers, which is also going to set the headers for your page. So you can cache your HTML document, right? And then you can set headers, give it an object, and now you can just pass the headers, whatever you have, right? And it's going to work. Yeah, let me just go here, and I told you we going to be mostly deleting code So yeah I going to revisit this I can even maybe set to do cache control headers Yeah let just save this And this isn going to work because now we have to export this props as data So now we're going to be deleting even more code. So now if I go here and let me just see, we're not going to need posts because we're going to get everything from data. So now this is removed. Now we can say export let data. And now we say page, page server data, I think. And sometimes you're going to be, if you're using TypeScript, you're going to be refreshing a lot. So if your types are wrong, just restart the language server. Or if it comes to the worst scenario, just restart your editor. But yeah, it's kind of buggy, to be honest. And also make sure you read on your server so the types get generated because you sometimes might get weird types, right? page server data and now we can import those from let me just go here why not import from so it's always going to be this then you can press control spacebar and now we can get page server data so sometimes this is weird so remember we're returning posts but sometimes this is going to give you something weird like this and just give it some time or purge the dots felt it folder or etc but yeah I know for a fact this works because I migrated some other projects so we can remove this we can delete this and we can say import type yeah so this is going to be nice so now we have data and now we can follow the other squiggly line so we can say this is data post this is going to be data post data post and of course it's squiggling because TypeScript is confused about the types but yeah let's see what else and data posts and this is really awesome because now you know for 100% where this comes from so you know this is from your page endpoint or whatever you have we have the data page server data so let me just check page server load this is for your load function inside your server endpoint if this was in server you would just have page load which you can find if you the documentation so you can go here you can just see when you're using our regular endpoint it's page load but for the page server is going to be page server load and that's how you figure out the type if you're curious you can see the error messages in the terminal so this is going to really tell you what you need to change But it like awkward for me right now in this format where I have everything so small But yeah migrate this return statement I didn't mention it, but for your script, it's going to create migrate comments. So you can just search for migrate and it gives you helpful advice that you can do next. But thankfully, this is a small project. So I really don't have to search for a lot of them. Yeah, let's see what it's complaining about. Oh, this is the page TS. this is exactly what I mentioned before, so you can rename this to whatever, or actually I'm going to delete it since I had a comment, yeah, let's delete it, and now if we refresh it, it works, great, so yeah, that's the random one that got generated, but yeah, let's just stay calm, we can read through the errors, read the documentation, watch some videos, make a drink, etc, and yeah, you can see, and even my endpoints work from before, so I don't really have a lot of work, because let me just close this and show you. So for the views, I have this API. I have subscribe. And here it creates a JSON, which I might just change. I don't know why it imports is like this JSON and it's JSON $1. But yeah, for the API endpoint, I really don't have to change a lot of this here, but yeah, just so you're cognizant about it. And let me just see. So this is the subscribe views server. And yeah, this is also the same and really just a renaming thing. and here as you can see before where you had views.json or whatever again you just know it's a folder and then you have this endpoint and I also have to migrate this here so let me just see this json is json yeah so now just return new response and then we can save views and again boom we can just copy paste over and I think this is it let me just see oh no it's not this is awesome so I can show you what this is so I can yeah this is so we're not doing we don't have to do a new response because if you did a new response here then you would have to type this as JSON but SvelteKit gives you a nice helper so if you go to the search just look for JSON yeah so it basically gives you this JSON function you can export this to JSON so you don't have to set these things yourself So if I go here then you can say return JSON views and now we can also give it headers right Yeah because all the same things So I can paste this over And let me just delete this This is another weird one. I can just keep this. Might check later what's going on here. Let me just check the type. Sometimes it imports from the wrong place. But yeah, this seems right. And yeah, if I go here and refresh for good measure. Now the views work. And yeah, that's really great. But yeah, as you can see, this really wasn't that bad. We just need to stay calm and go through the documentation. But yeah, we basically solved this API. So let's just go one by one. We just go here. And for example, if I go to articles, this should be broken. And now let's go under articles. So again, look at this culprit. Let's just delete this right now so we don't get trolled. And now let's open these files. And this is an instance where the migration script gets this wrong, so remember these types always come from here. Types, and let me just see, put this here. And now we just have to return data, which is the beautiful part about these changes. So I can just return posts, and here I can set the headers. So I can import this, set headers. Set the headers, and I can just copy this over. Let me just remove this. And as I told you, we're going to be mostly deleting code. But yeah, now we have to import data. Export let data. Sometimes TypeScript completion page data is weird. What is this type again? It was page server load, right? So it's page server data. And now let's see if it got the import right. Oh, amazing. sometimes it like completely imports something so weird I can't even describe it right so we don't really need this and also when I'm done later I'm going to collocate some components where the routes are and I'm going to see some of the extra code I have so I can delete it which is going to be sweet but now we can just say data post and I have to say post here because I have it like this so I can say data post we have data post link and yeah that's pretty much it so now we can see it's here

 Let me just see if I hover. Okay, so you can see when it refreshed, it basically generated the types inside this .cellkit folder. So it's really hard to see. Yeah, but if you go here, we're in the articles, right? So you can go under articles, and you can see here is the type that gets generated. So basically, this is what you're importing. And yeah, it's really awesome. If you go, for example, data, and you can import post, banana, or whatever you have. And in this case, it works flawlessly, but sometimes you have issues, so restart it or whatever. And great. now this works and we can go back to the main page so i have articles so this is what we were before and then i have series i think let's see series this shouldn't work right and yeah this is basically it for that and now we can just calmly proceed to the next item on the agenda so you can go to routes and what was it series right series series series and again this random file that generated yeah so let's just open this and again it got this import wrong so we already start to develop a flow and feeling of how we should structure things here and how it works so basically i probably just copy this over but yeah so basically i'm returning a post here which is the series and let's also get the headers set headers yeah and then we have to export let data what's the page server data i always forget this thing this is a bit confusing right yeah now we can remove this and this just save this and now we need to do this again so it's post now is data.post so it's really clear where it's coming from data post and yeah that's pretty much it so if I refresh it now and also let's make sure our cache control headers are working as expected so I set it here right and then if I go here here we can see public max age etc. Yeah, so let me just close this. What is the next thing we should be working on? Yeah, we've got the series. That great I don have anything here So the categories are probably going to be broken Let me just see The other pages are working fine so we don really have to even think about this But this is going to be broken 100%. So for example, if I go to Svelte, and now we can just find this here, just Collapse Series. So where is it? Categories, Folder, Category. Again, page TS. Let me delete it. And let me think about the caching later. so again the same mistake need to fix types and this is an interesting one I guess we can just return an error here there's also a new error that you can throw I think but let's see so you can say error which you can import from Svelte where is it? here it is so you can do it like this error and then you can say 404 and then you can give it whatever error message you have So yeah, I think I'm going to do that. Just delete code. Again, you'll learn this from the docs. And yeah, again, same as before. Instead of returning these props, we just return data. So let's make sure we return the right thing. And let's set the headers. Let's set headers. And I just need to copy this over. And sweet. Now I can delete this. And now we should get the data props. I can export let data. Page server data. Yeah, I've done this a couple of times and still I'm not sure what I should import sometimes. But yeah, you get used to it over time. So let's see app store. So we don't really need posts. And now I can remove this. So this is page server data. so if this was a regular endpoint set of page server data this would just be page data if you want to get the types but yeah we can do this and now we have to do the same thing we did before we can say post data post say data post length again if we save it the types are going to get generated and then it's going to update everything so don't restart your server in advance or etc. But yeah, we can see this works. We get the views. If I go to other categories to our ArchNemesis or Frenemy React But yeah most of these things should work so I don really have any doubts here but yeah let me just go to the page let see if the menus work nothing else changed but yeah i think we need to change the prefetching it's going to warn us here let me just see so if it prefetch attribute has been replaced but yeah i think we mostly migrated everything let me just have a look so as i said before i'm going to look into these components and then I'm going to collocate them to the routes because before I didn't do that because there was that ugly underscore thing you had to do but now they won't act as routes so things are going to be so much cleaner when I update this right so that's what I'm going to look at next and some other things right but let's look for the route so basically oh yeah we need to of course the most important thing the we need to fix the post because right now if I go to a post it won't work. But before we do that, let's just quickly fix this WellKit prefetch problem. We can just look for it, and let me just literally paste over data. So now we can look, this is some markdown post. And I can go here, just replace this. Simple as that. Now I can go here, and press Ctrl D to select another similar one. Let me just see. And I can just replace that here. So, prefetch. What do you think about this change? I'm really not sure. This is the first time I'm seeing this, so really I didn't even know about this. But yeah, makes sense because it's a valid HTML attribute, but I don't know, the old one was a bit cleaner. But, I mean, who cares? You just do it and boom, that's right. Yeah, so now that's done. And now if I refresh everything, No errors. Yeah, it's really awesome. So we can just close this and now we can make the post work, all right? So people don't leave the site immediately. Imagine that. Yeah, but let's just collapse everything and let me just make a sanity check so we really fix the front page. We didn't really have to change anything about the uses because there wasn't really anything. It just created this page TS, pre-renders the page because it doesn't need to be server-side rendered all the time. We fixed the sitemap series the RSS The newsletter really didn have to do anything This is a page also right that I pre I don know if you see to the newsletter really didn have to do anything this is a page also right that I pre if you see to the newsletter yeah that works fine and let me just see categories that works right with fixed articles the API didn't even have to touch that about yeah so we can look at this and again this sneaky little boy so I can remove this and yeah let me just do this and again same old song and dance we can just this is a bit involved nothing regarding SvelteKit basically what I'm doing here with the cache control headers if the post is fresh give it like a week so it updates frequently if I need to make a typo or something and then after a week has passed it's safe to assume I'm not going to frequently be updating it so we can basically cache it forever or until Vercel decides it doesn't want to cache anymore which is like a couple of hours and it makes me really sad. But yeah, here we can just return the content front matter and I don't really need this max edge anymore because this is what I had to pass before to the page itself so I can cache the HTML document but I really don't need this anymore and also let's import set headers. And then I can just copy over this part. And let's delete this. Just make sure everything is fine. And again, simplification, right? And things are looking great. So we can go here and then, oh, we need to change this. It was environment, right? Yeah, so this isn't going to be mad anymore. we can remove this error warning from the migration. And here I was importing, so you can say export let data, page server data. Again, you can see me, I've done this like five times in this video and I still can't remember what the name of the damn thing is. But yeah, you're not alone, right? Let's see, where is the type? Okay, import type page server data from types. We can remove this type. So I can see the red squiggly. Now I can say data front matter, data front matter. And if I go here, yeah, data front matter. So now I can update this. Just select with control D.

 And now I can select all these. Now I can go to the start. I can say data front matter. Ooh, hacker man. Okay, so we have data content, right? You can see the auto-completion is awesome because since we generated content, this is how we generate this. So now I can just save this. And if we go to a post, it should work. So again, the migration isn't that bad. If we go here and compare it, we just close these things. it's a lot cleaner right now if you look at the before and after we can go to routes basically easier to read easier to write code easier to update easier to maintain oh yeah basically that's it so i can migrate it and then if i go here and then i can do git push so origin and then swell git migration and then i might do some changes later if i need to do so so this is just pushed as a branch and if I was logged in it would ask me here if I want to make a pull request and I'm going to create a pull request and that's how I like to merge it. I hope this gave you more confidence how to migrate your own SwellKit project and of course good luck migrating. Thank you for watching and catch you in the next one.