 Hey friends, today I want to talk about the upcoming SvelteKit changes that are going to be significant but for the better and I'm super excited about it because it's going to make things so much simpler. These changes should be coming in by the end of this week so I can't wait to get started and to cover them. But if you're not aware of it there's been a recent discussion that's been started by Rich Carys, fix, load and tightening up SvelteKit's design before 1.0. These proposed changes are going to close all of these issues which is incredible and this looks like a lot of changes, but it's really not that bad. It's just here explaining the reason why and you can scroll this yourself. I'm going to link it if you want, but yeah, you can go forever here and there's even a migration guide and they're working even on a script you can run so it can help you move your projects. But yeah, well, let's get into it. So what are the upcoming SvelteKit changes? Basically, it boils down to three things. So first one, it replaces the file-based routing for directory-based routing. And this is because there's a lot of issues where you start by creating a file-based route, and then you realize that you always want to end up with the folder because the routes get more complicated. Then it's really harder to collocate components and et cetera. So the answer to this is, instead of using file-based routing, is going to use directory-based routing. So directories are going to dictate which routes are created. You're going to have a plus page.svelth that's dictate how these routes behave. and now load is moved from the component into a separate plus page.js file along with page options and this is because in the past it was really confusing how your data and your rendering logic is in the same file so people were like confused why can't I use load in a regular function etc and this simplifies things you also have page level SSR control which is incredible and then it replaces the page props with a single data prop and an extra error prop for validation errors from HTTP request handlers we're going to look into an example of that. Since this isn't implemented yet, of course, I don't have any code to show, but I have some screenshots I'm going to look over it. And the TypeScript story is going to be so much better. If you don't care about TypeScript, that's great. Even if you don't use TypeScript, you're going to benefit from this because you can use JS doc and you can reap the benefits of the types yourself. So the routes are only defined by folders and the layout and page components are defined with plus layout.svelte and plus page.svelte files. And there's been a lot of bike-shedding around the naming conventions of it. There's many reasons why they're not using a dollar sign. You can read the discussion on GitHub if you want to get inside into that. But basically the plus prefix marks the file as being a route file. So you can find your files in your editor way simpler than having a bunch of index files. Of course you're going to have a bunch of page files but for example if you have blog or something you can just look up plus blog or whatever and it's going to give you everything related to that. So files without a prefix are ignored, making collocation easy without workarounds. So before you could use an underscore to mark a component private so you can collocate it in the same folder but now you don have to So that really great not having to explain that to people And if a page uses a named layout it can be expressed as plus page at layout name So that really isn that much difficult So let talk about load which is amazing the changes here So load has moved to plus page.js. Instead of returning an object with some combination of status, error, redirect, cache stuff, and dependencies, which was really convoluted, And props, your load function should just return the data that the component needs. So this is much simpler. So now all these endpoints just return data. And Sveltec will generate a types module for each route. So the TypeScript story is amazing because before when you had an endpoint, you had to define types there. And when you imported the props, it was like, what is this? And you have to create the type somewhere and import them twice. Right. But now we generate those types for you and you can just use them as is. And it also has improved error handling. Instead of returning status error object, you can just throw an error and redirect. And now this is the best part. You can now set your cache control headers inside load, which is, oh, I love it so much. You're also able to receive data from parent load functions, which is going to make it way easier to pass your title information for SEO and et cetera down to your components or whatever else you can imagine. So here I have some images. So we can look here that load now only returns data, before you would have all these nonsense objects and confusing properties and now it just returns data and now for a typescript support of course you can rely on js doc if you want but you can just import the generated type for you and that's it like awesome improved error handling I love this so you can just import the error from cell js kit data that's really just a helper so instead of this convoluted thing that you had to do before you can just throw an error and say not found and etc. Then you have import redirects. So now you can throw a redirect wherever you want. And that's really nice. So now you're able to set cache control headers, which is amazing because previously you were constrained by that awkward cache object that had a couple of properties, but now you can do whatever you want as you should, in my opinion. So yeah, that's really awesome. And I'm excited about this. And this one is also interesting because data from all load functions is merged into page data so now you don't have to use stuff anymore to be honest I never use stuff but maybe I'm going to look into this now I always thought how stuff was awkward named and I was like what would you ever use this for unless it was some title for SEO but yeah now you have this data prop that you can use anywhere that's come from your parents so it exposes also a couple of functions which is a weight parent so data from all your load functions going to get merged into and I also think I have an example on the side. Yeah, so you can use the data anywhere you want. So it doesn't matter when the app this component is, you can just import page from app stores and you can access that information page data title. And this is how the object looks. So your load functions can run in parallel, which is another benefit of these changes. But yeah, let's really zoom out and let's talk about endpoints, which are even more interesting So if a page has an endpoint it lives in the route as plus page And now you know something runs on the server because literally the file is named So I just love it. It's going to be so much easier and make a lot more sense. And this also pertains to layout. So you can have plus layout.server.js. So let's take a look at an example. So currently, let's say you have a block slash index.svelte and you have a block index.js. has a page endpoint. So this doesn't translate like this. It's not index.js that turns into plus page.svelte or index.js doesn't turn to, oh, I have a mistake here, but I ignored it. It doesn't turn into page.js. It's like this. So index.js becomes plus page.svelte and index.js turns into plus page.server.js. I also want to make a migration guide so it's easier for people, but yeah, basically this is awesome. So standalone endpoints are expressed as plus server.js. So your old route would be blog slash index.json.js, but that doesn't translate to slash blog.json blog slash index.json.js now translates. If you want to create it, you would have to create a folder blog.json slash plus server.js. And this is a bit awkward looking if you're doing it like that I'm going to admit it right but the other benefits outweigh it and it's going to be so much more readable and awesome right? So let's talk about the page server JS. So previously referred to as a page endpoint this file exists to provide your page with data from the server. As before it exports handlers corresponding to HTTP methods so get post put patch and delete and now get Handlers just return data instead of that object status headers body so it's way simpler. Post Put Patch Handlers should not return data but can return an errors object so error handle is going to be much improved. Post Handlers can return optional location pointing to the new resource of course. Delete Handlers should not have a return value. Errors can be thrown using the error helper. Redirects are also thrown and you can now even set headers inside your HTTP request handlers because before it would get ignored unless you were setting the cookie but now I think you can set it even for your page. So that is awesome and something I really wanted. So yeah, so handlers only return data. Again, this is our HTTP handler. So we, instead of returning that awkward object, it's just concerned about data. And you have post put patch, don't return data. So again, very simplified. Again, the TypeScript support. So we can just import the generated type if you want. This is how you throw errors. So you would import the error and you would just throw it instead of this awkward thing, right? And you can also throw a redirect, which is awesome. And, ah, I love it. You can now simply set a header for everything. And how awesome is this? So if you want your thing to get cached by a CDN, if you're using server-side rendering, you can just set headers here for everything. And this is going to make things so much simpler. But yeah, let's talk about server.js. So server was previously referred to as a standalone endpoint and it gives you low control over how SvelteKit responds to requests because now you just return a response object Instead of having multiple props corresponding to the props returned from a load function, you now have a single data prop which is automatically typed, and we're going to look into that example in a second. And also a page that has a page server.js file with a postput patch handler can also receive an errors probe containing validation errors. As you can see in this example, server.js handler should return a response object, and this is really only if you want fine-grained control. So instead of that confusing object before where you didn't know what relied on what to use it, you had to specify a status for this, to use this, and etc. Now you just return a response if you want a more fine-grained control. Again the TypeScript story is great. Now we have a single type prop. So remember before, when you return something from a load function, your props, and now you have to specify each one in your script, and you also don't have types for it, right? But now it's just a single data prop, and it's already typed for you. So that is just incredible. And also the error handling is way simpler because you also have an errors prop, which you can export, and now we can show your form validation errors or whatever else you want using progressive enhancement, because you have a page endpoint for your forms, right? is awesome. But yeah that's it. Also the double underscore error files have been renamed which isn't really that important but if we look here at the migration guide as it says here the writer is now folder-based not file-based. This means there's now only one way to describe a route. Here's how you define that there's a route about and it's going to the same example I showed you here. Where routes about index turns into routes about plus page swell. So now it's really obvious this is a page and where your data lives instead of before. The naming of the routes file has changed the correspondence as follows, so we can see the page UI, before it was index.js now it's plus page.swelt. The load function before where you had your script context module in index.swelt now lives inside plus page.js. Your page endpoint which was before index.js with index.swelt next to it for example is now plus page.server.js. Your standalone endpoint which was before index.js without index.swelt next to it is now plus server.js. Now your layout UI instead of this ugly double underscore layout svelte is plus layout svelte. Load functions etc just the same where you had your loader in your layout. It's now just plus layout.js and it has a simple loader that can just get data and that's it. Server get for layout didn't exist previously which is also now. And the error UI double underscore error svelte is now plus error svelte and your load functions inside error svelte no longer exist because it was causing a lot of problems. And if this all sounds overwhelming or like you're adding 100 files, it's really the opposite. There's only one new file and now everything is more clear and easier to read. So yeah, that was basically it for the changes. And I'm so excited for them to come out, but I also want to hear your opinions. So let me know and catch you in the next one.