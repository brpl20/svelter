 The amount of JavaScript you ship to your users is one of the most important metrics when it comes to your site's performance. It can be the difference between a site that feels snappy and fast versus sluggish and slow, which directly impacts your users. Today I'm going to show an approach you can use in your SvelteKit projects to reduce the amount of JavaScript you use, and I will show you a tool that can visualize all the JavaScript libraries that you're shipping to your client so that you can figure out what you should keep and what you should optimize away. Let's get on with the video. So just a few days ago Svelte 5 was released so we have this like brand new beautiful site and we're of course gonna use the new CLI tool called SV to create our SvelteKit project to play around it. Let's go ahead and do that now. I'm just gonna paste the command here to create a new project. We're gonna call it SvelteKit Bundles. It's gonna ask me what kind of template I want. Let's go with minimal. Yes, let's use TypeScript. Let's not install any of this stuff here and I'm going to be using npm for this. And this new tool is so beautiful and it also installs the dependencies for you. That's just fantastic. This is actually the first time I'm trying it. Alright, so let's go ahead and do the steps that it's asking me for. To go into the folder, init the project with git, and then I'm gonna go ahead and open it with my terminal with VS Code. Alright, so now we've got a new project, the first thing that we are going to do is we're going to install this tool that visualizes the bundles for us. So we can start by looking into the default sort of bundles you get. So the tool that I use for this is this tool called Rollup Plugin Visualizer. Now it says Rollup and the Vite uses Rollup under the hood so that's why it works. So in your brand new project we're gonna go ahead and install it. There we go and then we are going to configure it as it is instructed. So the way we do it is we go the vit.config and we import it like that and then in the plugins array we just go ahead and add the visualizer and I think we can add it either before or after SvelteKit, I don't think it matters. And then we also need to add just a little bit of config so I'm gonna go ahead and add this config here. There's actually a specific section here which says usage with SvelteKit and what it's telling you to do is add this little config object with emit file true and file name should be stats.html. Alright, now that I've done that let's go ahead and run it or rather let's go ahead and build the project and let's see what we get. So by default if you don't use any specific adapter so using like adapter auto which you get out of the box right you get this like .sveltekit folder. If you use adapter node you get this build folder and for other adapters it kind of depends on the adapter what you get So the way it works is that you have to go into the SvelteKit folder which represents your built file and then you go to output client And here you have this stats.html file. So let's go ahead and take a look at that file. And this is what it looks like. So here you can see all the different JavaScript bundles that make up your site. These are all like default kind of SvelteKit things. So this is not something that is abnormal, which is why I wanted to show it first before we start adding our own stuff into here. And because I opened this from the client folder this is obviously only gonna be the client stuff which is what we're interested in because we want to reduce the amount of JavaScript we are sending to the client. And just to kind of finish it off let's just go ahead and open the site up and see what we get. And what we got was the default template. So everything's looking great. Alright, now let's assume that we're using a library on this site. So I'm gonna pick a library that is known to be like a little bit heavy and that is also quite commonly used on many sites and that library that I picked for this demo is Moment.js. So Moment.js is a date library and we're basically gonna use it like you would maybe normally use it in a project. So I'm gonna first go ahead and install it. Alright, that's installed and I'm gonna... let's start with using it on our pluspage.svelte. This is the most basic sort of usage where you just import it into a component. Let's go ahead and see how the API looks for that. So I guess you import moment for moment and then you do something like on mount. We're just gonna keep it simple and just do it on mount. We're gonna set a variable to the current date according to moment and we're gonna print it. There we go. All right, now let's see how that looks. All right, and we got our date and the date will not refresh by default, but it will refresh whenever we reload the page. So that looks great. Now, let's see how that has impacted our bundles. So I'm gonna build again and and I'm gonna open the stats file again and there we have it. So we got this extra big bundle here and if we, it's maybe a little bit small, sorry for that, but like you can see here that this huge kind of greenish box here represents moments. So now moments represents basically like three-fourths of our project bundle size. That's not great, right? So let see what we can do about that So you know normally you don load data like this usually you don do it in a plus page right You would do it in a load function typically So there two types of load functions. We're going to start by using the plus page.ts function. Now this function runs both on the client and on the server. So we're going to see how that impacts the bundle size. So let me me go ahead and look up the load function in the brand new docs and I'm just gonna borrow an example here. I'm basically gonna move the date setup into here. So I'm gonna go ahead and do this. So I'm gonna say I'm gonna return date is gonna be the date and then I'm gonna move the import statement as well. And we're gonna remove all this on mount stuff and we are going to instead be using, since we're using Svelte 5 now, not export let data, but we're gonna use const props, sorry, const data is props. There we go. And then this should be data.date and the moment import goes here and let's see here what we get. Yes, it took a second there but it it figured everything out. All right, let's see how that works out. Whoa, we got this error. All right, let's have a look here at what's going on. I think I messed up the syntax. Happens to the best of us. All right, there we go. So we got the same thing now and we've moved the data loading into a load function. We use the universal load function. Now let's build and see what happens. And you can think about it while it's building. What do you think is going to happen? Opening the client build again here. Alright, nothing happened, right? And if you suspected this then the congratulations. And the reason that nothing happens is because as I mentioned the universal load function runs on both the client and on the server. So since it reruns on the client that necessitates it to actually include all of the libraries using it in the client-side bundle. That's not great. So what we could try instead is to use the server function. So I'm gonna go ahead I want to just rename this to page.server.ts because the format is the same. The type is I think page server load instead. There we go. And we run mpm run dev, which is very important when you work with these generated types and then eventually it clears up. Alright, so ideally everything should be just the same now, right? We don't need to change anything here because the data will just come from the server instead. Alright, and it still works. Now we try to build again and let's see what happened with the bundle Alright it disappeared right The reason for this is because when you have a server function it actually only as the name implies it only executes on the server So instead of getting the whole library sent over to the user, then the user's browser has to download it, parse it, execute it. What happens instead is that we only just literally send that one string, which represents the date, from the server to the client, and the client renders it. So we can even actually look at how that looks because if we look in the page source for this page and then in the output, so we get the server output here which we would have gotten with the universal function as well. But then if we scroll down here a little bit we have this const data array and here you see this date and you see just the string. So, as we saw, we managed to completely eliminate Moment.js from the client bundle, which is great. And the way I usually basically do this is when I am in the ending stages of a project and I'm sort of doing a little bit of polish, I basically use this rollup plugin visualizer, and I hunt for these libraries that they ideally don't want to ship to the client. So any kind of box that is big and imposing is an opportunity to refactor. And usually you can actually refactor it in a way so that the data comes from the server instead, which as we see here makes a huge difference in bundle size. So just for a little bit of a comparison, let's also compare the actual bundle size, like how big do the bundles get. So I'm going to go ahead and build the site. and we're gonna see here we have this we're gonna look at the client we have this one main entry bundle that is 28 kilobytes we have the runtime that is 11 we have the app itself that is 10 kilobytes so that's kind of like what we're working with here now let me go back again and change this to the universal function where we would ship this to the client go gonna just change the types again There, and then let's build again and kind of compare. All right, so now we got this brand new bundle. So before we had the entry 28k, runtime 11k and the app which is 10k. Now we got this additional nodes bundle that was generated by SvelteKit. SvelteKit does this internally, it kind of like tries to move all the bundles into correct places so that you can optimize so you don't load anything unnecessary when you're going to a specific rank. But basically we got this extra bundle of about 61 kilobytes and that's not so huge in itself, but you have one library and then you add another one and then at the end, with all these different libraries you're using, you have a bunch of them and then that's when you have a problem. So I hope you liked this video. I would love to hear if you've already been doing this in your projects or if you haven't, if you try this and if you find any libraries that you could optimize in in this way to make them not be shipped to the client. Thanks so much for watching, and I'll see you in the next video.