 Hey friends, what's up? So yesterday the version 2.0 of SvelteKit was released, so I want to go over the release notes and want to show you some cool features. Also don't worry because there are no major breaking API changes, the major reason for the version bump to SvelteKit 2 is because they upgraded their wheat version to 5. And if you don't know, wheat is one of the backbones of every frontend JavaScript framework today. It's behind all your popular frontend frameworks, so it's used by Astro, Nux, SvelteKit, Solistar, QuickCity, Redwood.js, and even Remix recently switched to using Veet. So Veet is just an incredible ecosystem that allowed us to have all of these nice things. But that being said, there are also some cool features I want to go over, like shallow routing so you can make Instagram with Swellkid. You're going to see what I mean by that in a bit. But before I get started, don't forget to like and subscribe, and you can also support me by becoming a patron. Alright friends, so let's look at the release notes, and all of these links are going to be included in the description. For most of you that are using SvelteKit, this is going to be really painless because there are actually no major breaking API changes, but of course, there is always someone that is using one of these features that got changed in some way, so I encourage you to go through these release notes. So the first thing you can do, you can run the automatic migration script by saying npx svelte-migrate, svelte-2, and this is going to try to run a migration automatically for you. So So let's look at the first breaking change, which is redirect and error are no longer thrown by you. So in the past, when you use this error, you would have to say throw error, which was kind of confusing to remember this, right? So now it's actually an improvement in my opinion. So now we can just say error and you have these two helpers ishtp error and is redirect. If the error or redirect is thrown inside the try catch block, even though they say here that you shouldn't do this, but it's your code base. You can do whatever you want. So if you need that, you can use it from at Swell.js slash kit. So the next change is path is required when setting cookies. So now in a set of cookies, you always need to set the path. So that's basically it. And this is an interesting one. Top level promises are no longer awaited. I don't even know if you were aware of this before, unless you use streaming. So in SwellKit 1, if the top level properties of the object returned from a load function were promises, they were automatically awaited. So now, as a SwellKit 2, it no longer differentiates between top level and non-top level promises. So now you can use the blocking fetch by using await if you have a single promise, or you can use await promise.all. So yeah, that's it. And let's also look at some other changes. So goto has this change. It no longer accepts external URLs. So if you want to pass an external URL to goto, use the window.location API. That's basically it. So there is just these other change paths are now relative by default. so if you change something with this maybe you should look into that right and basically all of these other changes aren't that relevant server features are not trackable anymore preload code arguments must be prefixed with base resolve path has been removed so if you use this maybe you should look into this there is some improved error handling dynamic environment variables cannot be used during pre-rendering so it says here that if you're pre-rendering instead of using the dynamic environment variables use the static modules instead so the renamed form and data in use enhance callback so if you read it here they just rename form to form element and they rename data to form data and i actually like this change it's a lot more consistent and clear so here is something about forms containing file inputs must use multi-part form data something up this config get request no longer throws errors with pre-processing no longer exported from this thing and here they just list what dependencies got upgraded and that basically it As you can see there are no major breaking API changes There really just a lot of improvements and one of those improvements is shallow routing which we going to look at next Alright friends, so let's talk about shallow routing. So what is shallow routing? It sounds more intimidating than it is. Basically, shallow routing just means that you can now create Instagram-like experiences in your app. So what do I mean by that? Well, for example, when I go here, let's imagine this is some Instagram feed, right? and now when I click on this image it's going to go to this photos slash tan route which is the idea of the image but this really isn't that convenient so now I have to go back and on Instagram the experience is a lot nicer when you click on an image it's actually going to change the URL in the browser and it's going to open it in a model here where you have all of those comments likes and etc and now when you're done and you close the model it's just going to go back to where you were before without doing a navigation. That's basically all there is to shallow routing. So if you look at the shallow routing docs, sometimes it's useful to create history entries without navigating. For example, you might want to show a model dialog that the user can dismiss by navigating back. This is particularly available on mobile devices where swipe gestures are often more natural than interacting directly with the UI. And now SvelteKit makes this possible using the push state and replace state functions so here is the most simplest example we can look at so now when you open a model in this example you can use push state so when you pass it an empty string that means the root and now you can pass it whatever data you want like show model true or banana right and now this is going to become part of your page store so this is going to become available under page.state and now you can check if this exists and then you can use the history api you can say history.back. Now when you close the model, the user is going to be returned where they started. And basically that's it. So I'm going to actually show you next a simple demo how all of this works. But again, all of these links are going to be in the description if you want to read more about it. Alright friends, so let's try to make this simple as possible. So here is the feed here. I'm just using a regular SvelteKit app using the newest SvelteKit 2.0. So I just have a simple and basic loop here over some images that i made an api for so i'm using this pixel api i'm just looping over 20 times so i get this unique url and then i return it as json so now if i go to localhost 5173 i can say api images and then i get this json back and that's basically it so now i can use this in my other routes so for example to fetch and loop over the posts here inside the plus page server ts inside of routes i just fetch from this api slash api slash images and return the thumbnails as json and also when i navigate to this image using this unique id in the url i can do this inside my other route so here where i have this id and a plus page dot server ts file i can just get the id from params dot id now i can again fetch my images i can get the response and i can filter the image that i want basically this is the most basic swelkin app and i'm also going to include a link to the REPL in the description if you want to play around with it. Alright friends, so the first thing we have to do if we go back to our feed, we need to prevent the default behavior when you click on this link because we actually don't want to navigate. We just want to do something else. In this case, we want to show the model. So back to our code here where my A-link is, I can just use an onclick function. Actually, I can just say prevent default here and now we can make a show model function. So we can go here back our code let's make an async function for a model and that's basically it all right so inside of here we have to do a couple of things so first we have to get the url and then we have to get the result of the load function So we have to return the data from it right And then we're going to create a new history entry. And that's basically it. So let's get the URL first. We can destructure href from E current target. And I can just say s html anchor element. And let's pass the event here. which should be of type event and that's basically it all right so now we have the url so now let's get the result of the load function so i can say const result equals await so now we can use this function reload data so we can programmatically get the data from the load function in svelte and now we just need to pass it graph cool and let's actually log this out so we can say result and then let's open the developer tools so now when we click on it we get this interesting object so here is type loaded we get the status and we get the data here so here is our image with the id source and the alt so this is the same thing as what would happen when we navigate to that route so now back in our code we have to create a new history entry so now we can say if result type is loaded and result status is okay so 200 and then we're going to use this other api we can say push state and then we can pass it the ref this time and then you can pass whatever data you need so i'm going to say selected and then we want to use the data from the result so we can say result.data and in case something goes wrong let's try navigating so to do that we can say go to and then we can pass the link to which it should navigate and that's basically it so let's actually log this out and as you can see we already automatically imported go to preload data and push state from dollar sign app navigation but now we can actually look at this data in the store so here is one of my favorite snippets that i always love to use and i also have an entire video on how i made these snippets i can use pre and i can start typing page again i'm going to auto import it so this is a store as you can see at the top it's imported from dollar sign app stores and to use this as a store you have to use dollar sign so we can now actually see whatever we get here as the output so in this case here if i zoom in at a route we can see that we have this empty state here but let's actually go to something else and now we can see that this state selected should be updated so now here we have any information that you need which is the image with the id alt and the source all right friends so let's actually show the model so back in our code i'm going to use this model component let me first comment this out so now if i start typing model it should be auto imported so let me just do this and we can see at the top here it's imported from routes all right cool so now i can also bind the value of the model i can say bind model and we can also use the close event listener so you can say on close and this is something specific to the dialog element and then we can say close model and now we can create two things first we can create a function and say function close model and then let's just create a reference to the model here so we can say let model html dialog element if you're using typescript which is optional of course and then this is it so now this is something really interesting so we can actually pass this plus page.12 component here so from photo slash id plus page.12 we can actually use this component here as is because we not actually using it for navigation but we just want to use it as a regular swell component here and this is so cool because this is something I actually never thought about before that you could do which makes complete sense because pages in SvelteKit are just Svelte components right so this maybe opens a lot of possibilities for you so let me just go here and what we're going to do actually let's go first to the top so we can import this just like a regular Svelte component we can say import you name this whatever you want it's really important i'm going to name this image and i'm going to say from so we can go to photos id and then we can say plus page.svelte all right so now back here in our code we can now actually use it but first we actually have to check if we have something in our page.state right so we can use this if block we can use the page store so we can say page state selected and then we can use our component so if we go here i can say image and now we can just pass it props because it's just a component right how awesome is that right so you are aware how we have this export late data right in our components right well basically that's that's it that's it right how cool is this so you can say data equals dollar sign so this is where having this data in our page store comes in so we can say page dot state dot selected that's it friends how simple is that all right but now we actually need to pop open the model so now here we push the state we can just use this api so we have a reference to the model i can say model throw model and that's it and now when i close the model remember i need to use the history api so the only thing i have to do is history dot back all right so let's save everything and everything should now work i'm even going to close this so now if i refresh this for good measure so remember now when i click on this this should prevent the default action of navigating right and it should open a model and that's it so let's see if this works how beautiful is this friends all right so how do i exit this well by default if you're using the dialog element and the model you can just press escape so now this should return us to our previous url if you remember so let's see the moment of truth if you press escape how beautiful is this friends so now we can go to any other image see if it works photos 13 now i'm gonna press escape i'm done with this and you can imagine this being like on instagram you have likes comments and etc anything you want here right now we're gonna press escape boom we're back where you were how beautiful is this friends all right friends so the last thing i want to cover is the types if you're following along and using typescript you're probably going to have some errors here regarding this page store because you actually have to include these types and if we look at the shell routing docs here in the api section they actually tell you that you can make page state type safe by declaring an app page of state interface in source slash app.dts so let me actually show you how i've done that so here is that file you can of course use ctrl p in your vs code as you should and you can just start typing app.dts boom now we can open this and here i just have this simple interface defined so i said interface page state selected image id all source and boom done that's how you do it really simple so if you like what you've seen don't forget to like and subscribe and you can also support me by becoming a patron thank you for watching and catch you in the next one peace Thank you.