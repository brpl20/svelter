 Hey friends, what's up? I thought a fun topic for today's video will be making a custom MarkDoc renderer for Svelte. And you probably have two questions. First, what is MarkDoc? And second, what is a renderer? So let me answer the first question. MarkDoc is a powerful, flexible, markdown-based authoring framework. This is something that came out of Stripe based on their documentation. It's a lot more powerful than the base markdowns. For example, here we can take the title from our front matter here. You can also have functions, you can have partials and etc. and you can also include svelte components and etc so for example here if we inspect this element you can see this thingy here let me just see it here so here is h1 so you can see how this is overview here we can even change or add attributes this way we can say for example banana and going to see is going to update this to banana so this makes markdown more powerful but today's video isn't actually going to be on how to use the markdog but it's just going to be on how to make a custom renderer all right so for example if we go to the mark doc docs you can see you can do a bunch of things so you can specify custom notes or write these custom elements custom tags attributes you can use variables you can use functions and this is the part i'm interested in so for example we can create a custom svelte renderer so this gives us a great opportunity or excuse to use some special svelte elements so here they walk you through an example and in this case they have our react example so for example here markdog has this thing renderers dot react in this case usually we're going to use dot html but in our case we actually going to return the children which is just a function so now we can use swell to loop over those elements we can output things so whatever we want including custom elements right so i'm going to show you how to do that which is really cool and let me just see is it here yeah so we can see here at the html so this is the default thing that you're going to use so basically doing that you can have custom widgets on your side for For example, like MDN has the strepdle, so you can include something like this on your site maybe, which is a really awesome use case for that. And also what I really love about Marto, so this was actually even before I knew about Marto, you can see how it uses these like template strings. This is actually the same thing I use on my blog, but of course I'm not using a custom render. I just have these things that I search and replace. So let me just show you. So for example, I have an embed video image and for YouTube because I don't want to type those things out. And I also don't want to create a snippet. I just want to find this in the blog post and I want to replace them. So you can see it's going to replace them bad with an iframe. And I just pass whatever I have from the regex, right? And this is something really cool that I use on my site. And it's really awesome. And then I just use unified. So I just raw dog the markdown. No problem. Easy peasy, lemon squeezy. And yeah, that's basically it. All right. So I know there's going to be at least one person that's going to be like, why are you doing all of this work where you can just use Astro? Listen, some of us don't want to be framework andies, and they actually want to learn how things work, right? Okay, so that's great. But in case if you just want something get working, you already have all of these packages done for you. Here is a package, MarkDoc renderer for Svelte. You can install this, boom, get started. Now you can use MarkDoc, easy peasy, lemon squeezy. Here is an even better one. So here is a MarkDoc preprocessor, boom. So now you can install this, you can import it, you can use this as MD-SWACKS, right? Maybe you're familiar with that. So now you can create a plus page.MarkDoc file. And now inside of here, you can include MarkDoc and even Svelte components, I think. So yeah, these are options that are always available to you, but the purpose of this channel is to learn, right? So let's learn something. All right, cool beans, man. So we can just close this and here I have a simple markdown post and here is just a simple SwellCriP project I have set up. So if you want to set up some packages that I already have installed, you can do that if you want to follow along. But of course, all of the links are going to be in the description, as I said. All right, cool. So here is just a simple post, the same thing they have on their site here. I'm just using frontmatter title. I'm going to show you how I got that. And here I have this callout component and counter component which we're going to look at in a second right so this is basically where the custom renderer comes in we cannot only change these elements like headings and etc we can use a custom renderer to render custom components and here i have just this endpoint page server so here i have the slug right and nothing special just like a regular markdown blog i just using node to read the file then i extracting the front matter so here i get the post then we use markdoc so we get this ast from markdoc then we just pass it to the transform so we get the content so here I have this variable inside front matter so I say get front matter then I just pull the front matter and now I can use this as variables inside my markdown right so that's how that works and here I have this tag so here you can include your components again if you want to learn more how that works you can just read the markdown documentation but yeah here just this callout so we can render call out this has some attributes type string by default it's note and here for the counter i'm just simply including this counter component which i'm going to show you in a minute when you get to that part and basically that's really how simple that is so now we have all of that and now we just return markdoc.renderers.html right and then we get the content we pass the content right and then in our load function we're just going to say hey html await markdown to html boom bam thank you ma'am now we're going to get it here over the props that's basically it so now we can just use at html and we can render this post and that's basically it it works beautifully but in the next step we're actually going to look how we can return the children loop over them and render custom elements okay so let's go back to our code and in this case let me just remove this since you're not going to need this and now let me just go back to our endpoint instead of returning the html we can return the content so let me actually show you you what this is so basically there are a couple of things on this content so let me just console log content and you're going to see what i'm talking about of course the output is going to be in our terminal because this is the back end part of circuit so now we can save it and we're going to see the output so if i scroll to the top you're going to see here is this tag the first one is article right so let me show it to you and now we have attributes and then you have some children here and now you can see how we can render whatever we want so we get these things back so we get h1 p tags and etc and the other things which are just a string and we can say oh okay if this thing is that for example for example if the title is h1 then we can render a h1 element and so on and then we also get back the attributes and some other things so you can see here is the callout component here is the counter component so this is just a string and we're going to recognize this in the cell component and just render whatever we want now let me also show you a pro tip you might be used to using console there and you might wonder okay what is changing you can see how we have some objects that aren't unfolded here so here is the actual pro tip so you can pass another parameter here to the options and let me just say we can pass it what was it i forgot the name i think it was def and you can just specify a def just say eight for fun so we can just say save and now we're going to see when this logs out you're going to see you're going to get a lot more information so you don't have to drill yourself in these objects and etc you can just specify the defs using console.dir and you can just log more things so we're going to see here we have some more things we have children so now we can see this is just text node so we're going to do something based on that if that's a text node but you're going to see we're going to run into one problem if we do this right now so let me just collapse the terminal so we actually just want to return instead of the html we just want to return the children and then we're going to take over and do whatever we want right we're the boss here right so we're going to say return content children and then here we can just say children but we're going to see if we save this and we should also probably rename this component because it doesn't make sense markdown to html anymore but whatever we can just say mark doc let's just be consistent cool like that but you're going to see when we save this and we go here we get an internal error so now when we open our terminal again this happens in a cell kit oh and this always look nasty and it says data return from load while rendering slug is not serializable cannot stringify arbitrary non-plane old objects and basically this is just a lot saying hey you're returning this some weird thing when i'm expecting a string and i really don't know how to deal with this so basically to circumvent that we can just json stringify this so now we Now we can just take this and let's say, je son, stringify, now we can just pass whatever we had before. And I don't want to type this, so I'm just going to say, type ignore so it leaves me alone Boom now we get this now we can return children So this is a string and then we can parse it back here so if we go back to our component let me just use my favorite snippet of all time i can just say pre and now we can log out this data right and we're going to see this data children so let's just say data children because there's a prop that we return and even if i log this out you're going to see we're going to get this curious thing right so that's basically the same thing that we got before right we can say json parse let's take the children boom now we can see we get back the same thing so the exact same thing that we saw in our terminal so now we can pass this to another component and then we can do whatever we want right okay so next let's create the mark doc renderer component so i'm going to go inside source lib here i have this markdown folder with some components which are going to collapse right now so inside mark doc I'm going to create renderer.svelte. And that's basically it. So now let's see if this works. We're going to output high. And let's import this component back here. So I'm going to say import markdoc renderer from. We're going to say lib markdoc renderer. That's basically it. So now we can delete all of that. Let's use our component markdoc renderer. The only thing we have to do is pass children. We're going to say children equal. We have to use json parse. data.children. All right, cool. Let's save this, and now we output high here, so let's see if that works. Okay, no errors. Beautiful. Let's create a script tag, and then we're going to get the children. Let's see children. Props. That's it. Cool. So now let's log out the children, and then you're going to see we have everything that we need. So let's open the developer tools, and here I can open this array of our children, and here you can see all of our children are here, and how beautiful is this friends all right so now we can loop over these children and conditionally render our elements okay but before we do that i'm actually going to create a components object and you can use a map whatever you want i'm going to say const components and we're going to have two components here we're going to have callout and counter so callout and counter and of course you should spell this properly callout and let's just import this so we can say import call out from components fallout and then i'm going to copy this line over going to say counter and that's basically it so now we have these components that we can check for and render them and of course you might do something like this for example let's create an each loop so now we can say children as child and i might be thinking okay we're going to say if here and then we're going to say again we need to look at the shape of our object we're going to see it has name so you might be thinking okay if child name equals h1 then do something but doing this is very tedious instead of doing that you're going to use special svelte elements so let me just remove this i'm going to show you what i'm talking about i'm going to also say this should be any so i'm not bothered and let me just actually show you in the svelte tutorial so the first one we're going to use actually one of them is going to be svelte self so when you need to do something recursively like call the function again which is going to be really useful we're going to see why in a second so basically if i reset this right you're going to see here in this folder here we can't really loop over these folders but we can invoke this component again if we solve it so again you can see so itself and now we can pass it the file you can pass it its own properties and etc so now inside of here we're going to recursively use this special svelte element and another one that we're going to use is going to be svelte element so here in this example this is basically what i showed you a second ago here if we say reset we can say if selected equals h1 then we can do something but this is really tedious so instead of doing that if i solve this we're going to get svelte element this equals selected so now this is going to be really simple so now when we have a h1 it's going to be a h1 h2 outputs h2 h3 and so on paragraph and the best element in my opinion marquee okay so how cool is this friends we can go back to our example here so now we can do something special here and let me just make space so we can see what's going on so the first thing we going to check if this is a special swell component we should render so let just say if and now we can say components and we can check for it by saying child name okay so we going to look into this object if this exists then we going to render this and how can we do that well now we're going to use the special svelte component and let's just complete it like this so we can pass this and what is the component going to be in this case well it's really simple it's going to be the same components we're going to access using child name and that should be easy like that and then we can also spread the other attributes if it has it so now we can pass it an object we can say child attributes and then in this case if it has more children so if we go here to call it for example it has some other children that it has to render so now we can recursively call this function and do the same thing again right so let me just really show you so we can go here and let's use another special svelte element so we can use svelte self cool let's just self close it and then we're going to pass it the same prop which is going to be children and that is child dot children all right cool so let's save this and we should get no error so we're going to see we get this call out and we get our counter component which we can already use and how cool is that friends and the reason we're not seeing anything here because we're actually not rendering any text so we need to handle that case which we're going to do in a second right if we look here okay so let's go back here and here this is just a type repair you can ignore it actually it's really obnoxious so let's just quickly type this we can say record which is the utility type and let's just say the key is going to be a string and component type which we can import from self okay cool so now it's not going to complain easy peasy lemon squeezy like that friends okay so if this isn't a special cell component that we want to render actually let's just continue with else and then we can close it like this okay so now we're talking about our p tags h1s and etc so now we can just use a regular svelte element so now let's say swell colon element like this and now we can just pass what we want to render so now we can say this what child name easy peasy lemon squeezy like that friends and of course we're also going to spread the attributes child attributes that's basically it and now we're actually going to do the same thing inside of here if this has more children we're going to recursively call this component cool so now let's say self self let's auto close this and we're going to pass it the children again child dot children so let's save this and we should see we have more things but again we're not actually taking into account the text so actually this is really something cool that i i want to show you so here we're logging out these children so we're going to actually see how this component reruns right so let me actually just refresh this so we can understand what's going on so as you can see here it runs the first time again we get all of these things and now we're recursively calling this function so now we get what is mark doc so now we can check okay does this have more children etc and then we have some other nodes which are text and etc and then we just loop over this calling it recursively and doing everything that we need right so we can actually finish this off very easily we can just go here and we just need to include the last case so we're going to say if type of child equals a string and then we're just going to render a child nothing to it boom let's just save this and now we're going to see everything works so let me just hide this now we're going to see we get a special component here because now we're actually taking into account the text so now everything works as expected right all right friends so that's it and And I hope you learned a lot of things because the focus wasn't on learning how to use Marduk, but we actually took this just as an excuse to learn about these awesome custom Svelte elements and how to recurse over components in Svelte and etc. So now you have a bigger arsenal you can use in your day-to-day work. And of course, you learned what a custom renderer is, which is really a term that applies to anything in web development. You're going to see a bunch of Marduk libraries have this concept of a custom renderer and etc. And now you actually know what it means and how you can implement one yourself. Alright, so if you like what you've seen, don't forget to like and subscribe, and you can also support me by becoming a patron. Thank you for watching, and catch you in the next one. Peace!