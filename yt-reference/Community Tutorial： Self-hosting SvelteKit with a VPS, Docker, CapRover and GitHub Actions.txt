 Hello, welcome to this video. We're going to be talking about self-hosting SvelteKit with a virtual private server, Docker, CapRover and GitHub Actions. My name is Stanislav. Let's get into it. So first of all, why would you do self-hosting? There are several reasons. One of those is privacy and data sovereignty. So when you use cloud platforms, you're not never quite sure where that your data might be ending up. And if you self-host, then you do it on your own server, which you can put in a specific region of the world and be sure that your data doesn't go anywhere other than that place. Another reason is that you're less reliant on third-party tools. So once you've started self-hosting and you're self-hosting your application, the next step is self-hosting your analytics, your observability, even your CMS. So that opens the door for those type of things. Another reason is portability. So when you use a cloud platform, then you might be using their database, their key key value store, some specific functions like imagery sizing that they provide. And by building your application to be self-hosted from the ground up, you can easily move it between different servers without worrying about any vendor-specific things that you might be using. Another reason is to avoid the cold starts. I think many people who use serverless platforms are familiar with this concept. And the difference when you self-host is that you pay for a server and you pay it upfront for a whole month and then you have access to that performance. So even if your app hasn't been used for hours or even days, once a request comes in, it's going to be answered right away. So you're not going to be paying any cold start penalty. So the last reason why you might want to self-host is because of cost control. So when you're using cloud platforms, you're usually paying on metrics that can be kind of obtuse and hard to calculate. Maybe you're paying by gigabyte hour or something along those lines. but with a virtual private server, you know that you're going to be paying, for example, $5 a month and then you know that that's what you're going to be paying. No more, no less. But of course, self also has some drawbacks So when you self you have a single point of failure which means that if your server crashes your application stops working I think this is less of a big deal than it was back in the day So nowadays, if you use modern web technologies like a service worker, then you can make it so that your app can gracefully handle being down for a little bit. And this is good anyway, because you might have clients that are on unreliable connections. For example, people might be on the subway and that would have the same effect as your app being down if they lose connection. Another drawback is responsibility for maintenance and upgrades. So on a cloud platform, they typically, for example, update the Node.js runtime. And when you self-host, that responsibility falls on you. And the last drawback is time investment. So it's very easy to download a cool CLI tool and just be up and running in a few minutes with a few commands. But if you want to self-host, it's going to take a little bit of time investment, but you're going to be able to reap the benefits of that for months and months and years to come. All right. So why would we specifically want to use Docker and CapRover for this? Well, we developers, we are familiar with the CLI tools and we don't mind them. But sometimes it's quite nice to have just a nice admin panel that you can go into and see the status of your apps, see logs, add environment variables, those types of things. and CapRover provides that. And why we use Docker for all this is because Docker lets us containerize apps. So that means that each of your apps is packaged in a container and it works independently of all the other apps and it also is protected so that even if something were to happen inside the container, it wouldn't be able to access other apps running on the same machine. Another great feature of CapRover is one-click apps and if you use something like cPanel, you're going to know what this is about. So they have a catalog of hundreds of different apps. And with just a few clicks, you can install Redis or Postgres or MySQL or any number of applications, including more complex ones like WordPress. CapRover also has continuous integration support. And we're going to show that in the demo, how we will connect it to GitHub CI, GitHub Actions to have a full CI flow. Another great feature of CapRover is automatic SSL certificates. So it going to use Luts Grip and you going to get free SSL for all of your apps CapRover is also free and open source so it actually written in TypeScript so you can even contribute to it if you'd like and the last reason is that CapRover can actually build images for you instead of using GitHub CI so even if you don't want to use GitHub CI you can also use this stack without any other tools. And so why would we use GitHub? GitHub is the most popular code hosting platform right now, and they have a very generous free tier for public repositories when it comes to GitHub Actions. And the lock-in that you can experience is pretty limited. If you really want to, you can still build your images on CapRover, but you would still need somewhere to put your code. And even though you can self-host even that part with something like Gitea or GOGS, it's way outside the scope of this tutorial. All right so before we start let's look a little bit of a high-level overview of what CapRover actually does on your server. So you have this box here which represents your virtual private server and CapRover essentially functions inside of Docker. So you're going to have your Docker inside your virtual private server and CapRover is going to spin up some images for you once you install it. So one of those images is NGINX and that will be used to route all the different applications you install as well as route the CapRover admin panel. And this runs as a Docker image. Then CapRover also sets up a Docker image for its admin panel as well as CertBot for automatic certificate management and a few other images to make everything work. So that's kind of the CapRover part which I've denoted here by putting little CapRover logos on the images. But that's just one of the parts, right? So the second part is your applications. And those also run inside Docker. Each of your apps is going to run as a Docker container. So you can have as many apps as you want, as many as can fit on the server, giving the CPU and the memory constraints that the server has. And you can also run databases and really any other images that you want in here. All right, so let's do a little checklist. What do we need to install CapRover? So we're going to need a domain and it doesn't have to be the full domain If you already have a domain that you use for something you can use a subdomain of that I going to explain how that works You need a virtual private server to install CapRover on and you need SSH access to that server and then you need a GitHub account So the steps that we're going to do, we're going to create a brand new virtual private server. I'm going to use DigitalOcean for this but you can use any server host that you want. We're going to point a domain to our server, install CapRover and then we're going to create a brand new SvelteKit project, publish it to GitHub. We're going to set up GitHub continuous integration through GitHub actions and deploy the whole thing. And then just at the end, I'm going to demonstrate how you can easily add a database to your project. All right, it's time for the demo. All right, now I'm in the DigitalOcean control panel, and I'm going to go ahead and create a new server that I'm going to use together with Caprover. So to do that, I go to create, and then I choose a droplet, which is what DigitalOcean calls a virtual private server. And here I get to pick the region and you should pick something that is close to your users basically so that the latency is as low as possible. So I'm going to pick Frankfurt and then I get to choose the operating system. And for this, I recommend that you use the latest Ubuntu LTS version, the long-term stable version, because that's going to get support for the longest time. And then here I select which type of server I want. And so what you're going to need, the cheapest server usually has, on most platforms usually has about half a gig of RAM. If you're going to be running maybe just one app, I think that is fine. But if you're going to want to be running multiple apps on your server, I would recommend the Spring for one gigabyte. And that's what I'm going to do here. Then we're going to choose which authentication method we want to use. And in this case, I'm going to choose password. And I'm just going to make a very simple password here. There you go. And I'm going to save this for use later. All right. And then here they also have some extra options. So you can add metrics to your server, which is very good. You can add automatic backups, which is very nice to have in case something goes wrong or your server crashes for some reason. And they also offer you a managed database, which they charge 15 bucks for, but we're gonna do it for free by launching a database on our server. So here you get to pick a name. I'm gonna just call my server CapRover and then I press create.

 So as you can see, the server is creating. It is going to take a little bit of time, but soon we are going to have our server and our IP address for the server as well. All right. So as you can see, we have our server now. It's running and we got the IP address. And I'm going to right away go ahead and SSH into our server. So I have a terminal here. I'm going to type ssh root at the server IP. All right. So there we go. And it's going to ask me for the password. And I've saved the password here. So I'm going to put that in. And now I'm into the server. So from here, we're just going to go ahead and install CapRover. So if we follow this guide that CapRover has, the getting started guide, they're going to advise you to start with installing Docker first. So we're going to go ahead and do that. And I'm going to go to this page, which explains how to install Docker on Ubuntu. So first it asks me to run this cleanup command. And I'm going to go ahead and do that to make sure we don't have any old version of Docker or anything like that running. Great. Then it's going to ask us to set up the Docker-specific apt repository. So I'm just going to paste these commands in. and this is going to install some prerequisites. And then here I'm going to be adding the apt package source for Docker. So I'm just putting in one command at a time here. And then here I have the actual command that I think is going to install Docker for us. No, not yet. Okay. One command down. Okay. So we added the new source and now we're updating it to make sure all these packages are fetched and now we're going to install docker right as you can see it takes a little bit of time but not not too long all right if you get the screen i think you can just say okay here great it's done and then they have this command where you can check if the installation went okay and it's going to print just hello world let's see if it works it says hello from docker so now we have the prerequisite all done and we can continue to install link up rover so to do that we run a a Docker command because if you recall all of Caprover actually runs inside of Docker. So I just going to take the command I going to paste it and now it going to install a Caprover for us All And now the installation finished So if we keep reading it says that we should go to HTTP the IP of our server on port 3000 Let's go ahead and try that. So I'm going to go back here, get the IP. I'm going to paste it in like this. All right. So now we have the login screen. And let's see what they say. so you should use the default password captain42 and then I can change it later all right let's go ahead and log in all right so it says you have successfully installed the cap rover but you still need to assign a domain and finish the https setup all right and then it's telling us to do it through the terminal so let's go ahead and do that so I'm gonna cancel out of the server now I'm going to run this actually on my machine, so not on the server. So first I'm going to install the CapRover CLI. All right. And then I'm going to run this CapRover server setup. Have you already started CapRover? Yes. It's going to ask for the IP address again. Let's give it that. All right. And then it's going to ask us for the root domain. So here is where you're going to need a domain. So I have a domain here that I'm going to use that is not in use right now. And I'm using Google domains here, but the settings should be more or less the same, regardless of which DNS hosting you use. So you go to the DNS settings, and then here is where you need to add some records. So there's two records you need to add. One record is for the kind of root domain that you want to use. So in our case, we're going to use all of this domain and it's going to be an A record and it's going to point to our server. And then we're going to add another record for a wildcard. So anything.mydomain. And it's also going to be an A record and it's also going to point to our server. And the reason for this is that just like on Heroku, apps are going to have an automatic domain, which is going to be like yourappname.yourdomain.com. All right. So this is all you need. So I'm going to save this and it's here. It's going to take a little bit of time to propagate it. So it might not work right away, but we're going to try it in just a second. Just want to explain how you would do it if you want to use a subdomain So in this case let say you wanted to use not the root but you wanted something like caprover So in this case, it works exactly the same. You would put the IP in like this, and then you would add the wildcard as well. So in this case, if you don't want to use the full domain, this is how you would do it. But in our case, we're going to be using the full domain. All right. So now we have everything we need since we did the pointers. I'm going to put in the name of my domain here and then I'm going to set a password. Again, I'm just going to make something up and save that. I'm going to enter it again. All right. I'm going to enter a valid email address here. This is for Let's Encrypt so that they can notify you if domains are expiring or not working properly. If the certificates is about to expire and is not being renewed correctly. All right. And now CapRover is actually going to go out and figure out the SSL certificates that are needed to make the server work. And at this stage, if you didn't wait long enough with the DNS record, you might get some sort of error. But in this case, it did seem to work okay. It's going to suggest a machine name. Let's just continue there. All right. and now we're ready to use our brand new instance. So I'm going to copy the domain from here and paste it in here. And now Captain42 is not going to work anymore because we changed the name. We changed the password. So I'm going to put in the new password and now we're in. So this is the admin panel and now we can continue by creating our self-git app. So to start with that, let's go ahead and create an app. Maybe we're going to call it just SvelteKit. And we're going to press create. And now the app is going to be created for us. So it's going to spin up kind of like just a simple container. So we can see here that we got an automatic domain here, SvelteKit.the domain I picked for the installation. and if I go to this page I just get like a welcome screen that tells me that my app is going to be here when I deploy it and now is a great time to actually set up our app in VS Code So let go ahead and do that So I going to just follow the guide here from Celtkit on how to create a new app So all right And yeah let's do the demo app just to have something to show. And I'm not going to use TypeScript and I'm going to add any of these other packages just to kind of keep it brief all right so I'm going to follow the guides here I'm going to install the packages let's see I need to use the correct version of node I'm gonna use node 18 here let's try it again okay and then just following the commands here that are given to me and then I'm gonna go ahead and open this in VS code all right Now we're ready to continue and the first thing that we need to do is to actually pack our SvelteKit app in a Docker container. So first of all, let's make sure that it runs correctly. All right. So that seems to work okay. So how do we pack this in a Docker container so we can run it in Caprover? So writing containers from scratch takes a while. So I have a finished container here, a container configuration that we're just going to copy in. But we can briefly mention some of the things that go on here. So basically we are starting with a node image, node 19. And then we basically run npm install and npm build. So it's like kind of normal stuff. And the one thing we need to do to make this work is we also need to switch to adapter node. instead of adapter auto. So I'm going to go ahead and do that, install it. And I'm not sure if this is actually required, but I am going to set also the build folder to write to build so that now when we run npm run build, it's going to create a build folder here for us. So there it is. And what I'm also going to do is I'm going to add that to gitignore. It looks like it's already added there. Great. So now we have the Dockerfile that's gonna package the app and then we need to create a GitHub Actions workflow for it. And you do that by creating a folder called GitHub Workflows. So it's two folders, first dot GitHub, then Workflows, and then inside here,

 You create the YAML file. And again, building a workflow from scratch, it takes a little bit of time. So I have prepared one here that I'm going to share with you. And what this workflow will do is basically it's going to build the image. It's going to publish it to the GitHub container registry. And then it's going to deploy it on CapRover. So let's first, let's start with some things that we need to configure here. specifically the deploy and cap rover part. So it's asking us for our server, which we have that, that's our domain. It's asking us for the app name. It's asking us for this token. What is this token? I will show you. So if you go back to the app in cap rover and you go to the deployment tab and you scroll down, there is this official CLI deploy method. And to use it, we need to use this app token. We need to generate an app token. There we go. So this token is what's going to let us actually deploy. And if we look at the configuration, it's coming from secrets. And secrets is something that you configure on your app. So in GitHub. So let's go ahead and and then publish this repository to GitHub and then configure the secret. So I'm going to go ahead and publish this just to a public repository. All right. And I should be able to see that if I go here. Yes. So this is the package that I just published. Sorry, this project that I just published. And then now I can go to settings for this project secrets, which you can find here. actions and then I'm going to add a new secret and if we look what the name of that secret is supposed to be it's app underscore token and the actual value is going to be the value here that we got from CapRover. All right so now it's configured and we're going to be able to access it here. Then it's asking us which image to deploy, and that's going to be this ghcr slash your username slash the name of the repository. All right, there we go. So I have some file changes here So this is specifically the changes we been making I gonna go ahead and stage those changes and Thank you. Thank you. Thank you. Thank you. Thank you Thank you. Thank you. Thank you. Thank you. Thank you Thank you. Thank you. Thank you. Thank you. Thank you.

 Thank you. Thank you. Thank you. Thank you.