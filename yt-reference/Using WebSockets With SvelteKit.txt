 Hey friends, welcome! In this one we're going to learn how we can use WebSockets with SvelteKit. This isn't a tutorial on using WebSockets and how they work, but how to get it working in SvelteKit so you can work on your project like if you have a multiplayer game and etc. In my use case, I was working on an editor for JorofCode and here on the right I'm using WebSockets to have a live preview because what you see on the left gets sent to the server and it gets crunched some markdown processing chain and then I get an output on the right so I get a live update preview. So that's my use case but I ran into a problem. I couldn't figure out how to get Websoc is working so I started digging around and I figured it out. So let me share that with you. So here I'm only using a normal set of project, nothing special. Here I'm running the development server and on the side is the project. And then let's go back to the post and I mentioned here this might change in the future and SvelteKit might have support for Websockets natively so it might be something like this if you're watching this in the future but this doesn't exist yet unfortunately. So you can read more about this in the discussion here that I'm going to link in the post and then if you go here you can see all this interesting discussion. Also thanks to Bob Fanger for giving me this helpful tip here how to make this work in development. So let me go back here I'm going to close this so another solution is to create a separate server but then you have to run two things on separate ports so let me show you how we can use SvelteKit instead so first we're going to explore how to do it in development which is simple we're going to write a simple vid plugin and hook into its development server it sounds complicated but it's really not if you can see here this is the example call this is the entire plugin almost right and yeah that's it there's more socket.io code than VIT to be honest with you so the only other thing you're going to need because this is not tutorial websockets I'm using socket.io as an example which is a really awesome library so you don't have to worry about websockets and you're going to need the Svelte adapter node because this doesn't work without the Svelte adapter node and you're going to learn why so we can close this so the first thing to make this work in development is go to the Swell config. And as I show this in this code you have to change this from adapter auto to node and then we can import server from socket and then we're going to create our plugin. So we can say export const websocketserver, which is an object. Let's give it the name, websocketserver, and then let's use configure server it gives us a server and we can say const io new server we're going to use the server and we're going to get the http server from it and if you're unsure where this is from this is from wheat and you can learn that from the wheat documentation so yeah so we can use our web sockets we can say on connection so in connects say socket and then we can say socket emit event from server because we're going to catch it on the client you can say hello world let me just copy over this emoji oops yeah and that's almost it so we just need to use the plugin so here you can see kit let me just close the terminal because you don't need it yeah so we can save it you should get auto completion plugins and then we can say web socket server yeah and then we can save it but don't remember you have to read on your server but first let me just include the client code and also if this gets out of hand you can just abstract this into a separate file and that's it so let me just go to source routes here is our index file i just want to show you how it would look like on the client yeah so we can go here we can say script language style script and then we can import socket io on the client we can say io from socket io client const socket io let's invoke it and then we're going to say event from server again this isn't a web socket tutorial but i just want to give you some helpful information and then we can log this out so if you're unsure with web sockets here is where we emitted this event from and our clients should catch this so one thing we have to do is restart our development server so let me go here and you know me I always paranoid so let me just start this up in pnpr and dev and we should see the message here when we restart this and here it is hello world and that awesome so now you have websockets working in development but the problem is how do you get it working in production which is the second step so if i go here in the post also before i go here let me just show you something awesome so if you have some reactive value and you need to emit it when a value changes you can just use a reactive block in SvelteKit which is really awesome so you can send a message to the server this way so just letting you know and let's go to the production so we're going to need express let me see if I already installed it yeah have express which is awesome yes I think I can close this so let me explain why we need the node adapter so let me just stop the development server let me run pnpm run build if you're using npm the commands are the same so let me just show you the side here so you can see what's going on i'm going to collapse this pnpm run build and this should work so here you can see it created a build folder and here is the index and a handler js so we can create our own custom express server and we can pass it the handler as an express middleware so SvelteKit is going to take care of everything rest like the routing etc so we don't really have to run two servers right so that's what i explained here in the post so let's see how this works in practice so at the root of the project just because it's easier to include it in the script in a moment i've created a folder server so let's create server index js let me just collapse everything so again we're in the root server index.js but you can place it whatever you want or whatever your build step is right yeah so let me just close the terminal and let's just make our own little cute custom server right so we can see import express from express and don't worry if you don't understand back and i'm not a back-end expert i just made this work and i'm showing it to you now right so create server from http this is our server that we previously passed from vtrite and then we're basically doing the same thing so we're saying server from socket io and here is the handler so we need to say from then we need to go to the build we need to get the handler and then we define port 3000 then we say app express then we create the server create server pass the app and again same as before we say io new server server and then we can say io on connection and then again we have the socket and we say socket emit event from server you can say hello world let me copy our emoji i actually have an emoji picker but if i would use it here it would mess with the recording so that's why i always copy the emojis if you're curious so here i even commented for you how this works and i link to the github repository where this code is concerned so yeah so we can use the middleware app use and middleware in express is basically it intercepts the response and request object and it changes it so basically swell kit is here like jesus it takes the wheel and we don't have to worry about anything else and then we say server listen port and then we save this and for the last step go to your package json we're going to add a script so if we scroll down here you can see your scripts we can include a start script and say node yes we're just invoking it with node right this is going to start the swelky development server and our web socket yeah so we can save this so let me just recap so we created a custom server by creating a custom express server that you're going to create a script here and start it so this starts instead of the one in the build because usually SvelteKit would run this so here it describes the same thing and it shows you here how it works yeah so let me just close this and i'm going to close the sidebar and for the moment of truth don't forget we have to run our server so you don't run npm round dev but now we have to execute our script which if you remember just start and we can just do that by saying start you don't even have to say run so everything should work we're now in production and if i refresh this it works and also if you need to pass environment variables i have a post on using environment variables in SvelteKit. So that's it, thanks for watching and catch you later!