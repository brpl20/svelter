 Hello, everybody. Welcome to This Week in Svelte. My name is Enrico. Today is Friday, May 19th, and I'm here co-hosted with Karim. Welcome, Karim. Hello, everyone. Welcome back. Yes, and since it's Friday, let's all deploy to production. Don't actually do that. The agenda, as usual, is the changelog, a few quick facts, not too many, and no community showcase, probably no discussions, and probably no Q&A either. But if you have any suggestions for these meetups, you can fill them in and we'll get you on the show. So this one might be a quick one. The change log begins. Alrighty. So with the chat open, let's go over some few changes with SvelteKit. First of all, spellkit has version 1.17.0 way up here and then 1.17.1 and then finally 1.18.0 let's go from bottom to top in 1.17 that is a feature release according to sember we've got unshadowing data and form in enhance. So unshadowing, I think, refers to this name change convention. So let's talk about use enhance. Let's go to the docs. I'll show you what that means. Go to progressive enhancement under the form actions section. And then down here, there is a... I don't think these docs are totally up to date, but what you'll notice is use enhance has some parameters. I'll zoom in a lot more. There we go. So there's form, there's data, and these parameters give you the form h2o element, the data passed in, but these are going through a name change. So instead of data, it's going to be called form data. Instead of form, it's going to be called form element. If you use these current old names, you will get a deprecation warning. It'll still work, but you'll get a deprecation warning in dev mode, but not in production mode. soon trademark the docs will be up to date. But not to worry, you'll see the deprecation warnings. I did test this. It does work pretty well. Next is... So by shattering do you mean the export form and export data variables Yeah That gets shattered I never heard this term before unshadow But yes it to prevent a conflict with the form variable and the data-exported variable. I guess that's bad when it comes to most JavaScript linters will wave your finger at you and say, hey, even though this is a nested scope variable, it has the same name as a outer scope variable. So I guess to prevent that scope conflict, they're going to change these names from form to form element and data to form data. Shadowing predates JavaScript, but yeah, it maybe predates my first lessons in JavaScript. I haven't known it for very long, but now I know. unshadowing shadow the hedgehog featuring crawl urls in meta tags this was an interesting one meta tags can sometimes have urls to generate images so sometimes you have an open graph image and those are procedurally generated and spelt kit wasn't pre-crawling those which would cause some issues with procedurally generated open graph images with this feature now it will do that it will crawl meta tags and add their respective URLs to help with those open graph images. But there's also some related stuff, not just Twitter open graph, but general open graph and other cool stuff too. Next is patches. So I'll go over these because they're fairly self-explanatory. Avoid trying to inline raw or URL CSS imports. This was a strange bug when you use the question mark URL parameter. So in ViteJS, there is a, I guess, an import parameter, this one. There we go. So in Vite, since Svelkid uses Vite, Svelkid has this feature. You can import practically anything, and then you can append a search parameter, question mark URL. And this will return the URL of the asset and not the asset itself. It will return the URL of a JavaScript module and not the module itself. And there was an issue that's been patched related to that. For some reason they were inlining either too aggressively or too harshly I forget the exact intricacies but now the behavior should work as documented There a feature Pre-render in worker rather than subprocess to support Deno. I know the pronunciation of this changed over the years. I can't remember the current one. But yes, pre-rendering in workers are a thing. Performance improvement. Add script to pre-rendered redirects for faster redirects. This was interesting to me because there is a meta tag that can redirect pages, and apparently, if you use JavaScript, you can redirect even faster. So if JavaScript is present, this script redirect will be perceivably quicker. It'll also fall back to the meta redirect in case JavaScript is unavailable or disabled. Add typing for Vite plugin to config. Typing fixes, always welcome. Stop setting kit cookie defaults on cookies parsed from headers. Okay. I haven't read into this too deeply. Wait, stop saying. Yeah, maybe, Karib, if you have an input, feel free to interrupt. Only skip hydration with Vite Overlay if current page is an error. I need to zoom in more. the Vite overlay I think is the error modal that shows up and if the current page is only related to development must be because the Vite overlay only appears in development usually when you have like a JavaScript error you'll see a black modal with some red text and there was a hydration issue but that's been resolved too I'm sure the chat will fill me in I'll go back to that after I go forward to 1.17.1 in Svelkit. Cirilla writes 9.8.9.2 down here. Doesn't usually affect users unless you're opening multiple tabs with errors. Makes sense. Kind of brings me back to the days of BrowserSync and other multi-tab, multi-user development servers. So I guess this is an edge case for multi-tab development, which is patched now. So I never noticed it, and it probably never will because it's patched. Ensure styles are loaded in dev mode for routes containing special characters. Special characters like accents and other lettering I not sure if that includes AsianScript but it special characters in CSS files should load correctly in dev mode now Next is ward users when enhancing forms with files but no multi form data Lovely. Another enhancement thanks to compilers. So if a form is accepting input, file inputs, and you don't have this encoded type attribute, SvelteKit will nudge you and say, hey, you probably wanted this. Always nice to see. Some users have issues with this. They try to upload files and get, if you don't change the enc type attribute, you just get the file name, but no file contents on the server. Ooh, that must be really nebulous. People running into that thinking, what? I only get the file name. I haven't had the pleasure of working with files yet, but now I think I'm going to have a nice time. Now here's a really interesting one. 1.18.0, that's a semantic feature. However, there's a security change to stop implicitly tracking URLs as dependencies in server-side loads. I did double check the behavior of this, and I forgot, but I know the documentation is here. So you go to manual invalidation. In Svelkit, whenever you use server-side fetch, any URL or API passed into fetch will become tracked as a dependency. This way you can perform manual invalidation against these URLs called in the fetch. But due to security issues with things like secrets being passed in as get parameters, Svelkit no longer tracks URLs. I think it's all URLs or external URLs that don't match the domain of the Svelkit server. I forget which, but I'll get a hint in a few seconds. But this is an interesting change because it's technically breaking, but it's also kind of necessary due to the security impact. So the SvelteKit team opted for a feature release. And maybe the impact is low. Maybe 1% of users will be impacted by this. And as a workaround, there's a new config to dangerously allow this behavior. So if I go to danger zone, here it is. So if you want to fly

 into the danger zone, you can do this in the SvelteKit config by setting track server fetches to true. So this way, you'll get the old behavior back, but you need to be extremely careful about what you pass into those fetches. If there are any secrets passed in as get parameters, then you're in for a perilous journey. So now this is opt-in behavior. And that's the changelog. What do you think? sounds good yeah and the docs update is universal load only yes so there are there is a docs update to how this works there we go when do load functions rerun this is on the the load documentation page so i'll zoom out slightly here under core concepts loading data there is a section about universal versus non-universal. And if you have any endpoint called in a server-side fetch only in the universal load, which is the plus page.js or plus page.ts, then you can mark it as invalid with the invalidate function client-side. So server-side fetch by default does not track these, but Clydeside-ish fetch using the universal load will track it. If you want to track it with server-side, go use that config I showed you a moment ago. There's another interesting changelog, adapterverse cell 3. Take a look at this. Or use depends. Yeah, Cirilla rightfully pointed out that depends is a feature worth remembering. So if you have the load event and you destructure your methods from there, fetch is one of them. Another one is depends. You can make use of depends to manually set any string you want as long as it's a valid URI and you can manually invalidate a URI you describe. If there's a previous This Week in Svelte where I go over that, I'll be sure to link it in the description below. Adapter for Cell 3. It has the number 3 in front, so I thought I'd bring this up. there a breaking change to remove obsolete environment variables in use option So if you are a Vercel user and you familiar with this just know that this is no longer an option and there you go we have a new adapter a breaking change and that it for the change log moving on to quick facts let's see how quick i can make these facts the first one is on YouTube or Twitch, there is a character named Learn with Jason. Jason is a personality on Twitch, and he interviewed Rich Harris recently. You can check that out on YouTube. I'll share the link in the description below and here in the chat. And Rich Harris covers how to use Svelte, a lot of rudimentary and basic stuff, but also some topical stuff, like what's headed for Svelte 4, what's this buzz about JS doc and TypeScript. I feel like it's an endless conversation, but it is handled eloquently. Go check that out as well if you want to learn yet again the differences. Moving on, we have another quick fact. Endless conversation indeed. Indeed, yes. So I was going to go for Svelte tables. I was thinking, oh yeah, maybe on Friday I can show everyone accessible tables. That would be fun, right? But I'm pleasantly surprised that tables work better than I expected them to. And I'll show you what I mean. So let's get the laboratory running, Svelte Lab. And what I was trying to share today is accessible tables and how they can break semantically. But I think modern browsers no longer have this issue. So back in 2019, 2020, I was making a website with an HTML table, and I wanted to use a sticky header, or I wanted to use some kind of custom CSS to the table. And historically, let's zoom in a lot. Historically, if you override any CSS in a table, it would break the table semantics, and they would no longer be accessible. You can no longer use a screen reader to identify the columns or the rows. But that's no longer the case. So if you see on the right side I have this table with two columns And if I scroll down the header is sticky and it good And it also accessible because the semantics of the table is described ordinarily I have my t-head, my tr, my th, everything is in their correct place. And despite using this CSS, position sticky on the t-head, not only does the CSS work, but the semantics are still valid. So if I inspect this, using Chrome DevTools, you can use your favorite DevTools. There is a accessibility panel near the bottom. And here, if I highlight table, you'll see that row group, row, everything is where they should be. I think two or three years ago, this would break horribly. If you have a sticky header, then none of these rows would show up and screen readers would not be able to navigate this. and the workaround to that would be to explicitly add a role attribute to everything. Like tr would have to be role equals row or something, and you'd have to manually add these roles to everything just to bring back the semantics. But I'm pleasantly surprised to see that I no longer have to do that. Even if I do some really ridiculous things like change the display CSS to block or flex or something else, it will still work. Screen readers will still work. And there's some details about that here. So if I go to sticky in can I use, I came across it pretty much right here. So there was a bug formerly. Footnote number five, do not appear to support sticky table headers. This is a really old Safari stuff. But yeah, roughly two or three years ago, some browsers had these nuances where the sticky CSS specifically would break tables. But as a version 91 of Chromium and Firefox 59 and up, it all seems to work really well. So you can use sticky in a table and practically anywhere. And if you're not familiar with sticky, it's pretty much two CSS rules. You say position sticky, and then you say a top value. So in here I do top zero. So as soon as I scroll down, as soon as I scroll down the table, this will stick to the top zero value. I You can set it to top 10 pixels or something else, and that's when it'll set up the stick. If I scroll past the table, it'll no longer stick. It's a cool CSS useful thing. And that it There no bugs to report here That was a quick fact Next is CSS nesting So I think Karim you wanted to talk about that right Yeah just very quickly Let me try to share my screen. I think you need to give me permission. Yep, one moment, please. Okay, so yeah, last quick fact is that CSS nesting is not supporting WebKit since I think, yeah, yesterday. So there are two browsers now that support CSS nesting, Chrome-based browsers and Safari. You probably still have to wait to get the update, but it's good to see that it's not available. Firefox is also working on it. I think it's behind a flag in the nightly version, and they said they still have a few bugs that they need to fix, but it probably won't be long until this is out too. Yeah, so let's take a look at a quick example. because there is one special rule that has been highly debated before the spec was finalized. And I tried this in the Shrek repo. So, okay, CS nesting works pretty much like you would expect. So you have a rule, and you can nest other rules inside them. And in some cases, per the spec, you have to prefix a rule by this ampersand symbol. Let me check here. In this Chrome article, if you scroll down to understanding the nesting parser, there is this diagram where you can see if your nested selector starts with one of these symbols, you can leave out this ampersand. So if you have a selector inside another selector, and that selector is a class, for example, or one of these children's selectors, you generally don't need to prefix it with this ampersand. They debated whether they should do this or they should just make it always mandatory to include an ampersand, and some people were against it and some in favor. Some people say it would just know that it isn't mandatory including their style guide and say that every rule always has to have an ampersand. But yeah, this is a rule. The thing is, I tried this in the Stripe REPL and all the CSS here,

 is part inside a component. Inside a swap component is parsed by a CSS parser. I forgot what the name of it is, but it's an external library. And yeah, so we have here, we have a div and h1. We give the div a background. And here we give the heading a color. In this case, it doesn't work without an ampersand symbol because it doesn't start with one of these characters. So I think this only happens really if you have an element selector. Here it starts with an H. However, per the spec, it should be possible to do something like this. Use an is selector because it starts with a double column. This doesn't work in the REPL, however, not in Svelte. I tried it in SvelteKit. I think it's, I'm not sure, but I think my assumption is that I left a comment here on GitHub that this is because it's just easier to parse for the CSS parser. But if you try this actually inside plain HTML and CSS this would work too It just doesn work in REPL You have to use another ampersand symbol here and then you see it works again. So that's the only issue I found. If you go back to, I think, the, what was it, container queries, which wasn't supported in Svelte for also a few weeks or months because the CSS password didn't support it, I think the developer who implemented support for Meteor Craze, container craze in Svelte was here on stream once. I don't remember. Yeah, but one case where CSS nesting is very useful is if you have these states that you want to start because you can then just nest them. So you have a button here and you can see that When I hover over it, the background color is black. When I click it, it turns to blue. And in this case, you have to actually, there cannot be no space between the ampersand symbol and the pseudo class here, because what this basically translates to is this If we would do this that would be similar to this And yeah, we show the repo and the links, but that's pretty much it. So it works in Svelte if you use the ampersand for every selector, and it works in Chrome and Safari. yeah I think that's it for today very cool thanks for sharing CSS nesting and in the chat I see Cyril pointed out that the module is called CSS dash tree that should be the parser for Svelte's CSS yeah it looks like it works in part but you did find a couple of nuances which is alright Right. Does everyone here use nesting? Enter one in the chat if you are a very passionate user of nesting CSS, perhaps using SAS or LESS. But it looks like the syntax you just shared is identical to SAS. It's the same ampersand usage. Yeah. I think the reason why they didn't remove why they didn make this what is the name the ampersand symbol mandatory is because they wanted to make this compatible as much as possible with other CSS preprocessors All righty. Yep, I am also, well, what's funny about SAS is I used to use it a lot, but since using Svelte, I don't really reach for it by default as much as I used to. I don't rely on nesting as much anymore because usually my styles are scoped and my styles are small. So I usually just repeat myself and write the same selector over and over again, like A, hover, A, active. But if I do have SAS at my disposal, I will make use of it. Maybe I'll use native CSS nesting now that it's a thing. Post CSS. Yeah, I should really look deeper into post CSS. But with that said, I'll wrap things up and then we'll move on to some water cooler chat. Let me just share my screen one last time. If I disconnect from Discord, don't panic. I'm still here. Okay. It worked. Okay, one moment. This is a repo. Thanks for the repo. Well, those were quick facts. Community showcase. Discussions. And Q&A. All at the same time. Thank you for attending this week in Svelte, and I'll see you next Friday. Bye!