 Okay, hi there. So in this video we're going to be talking about auth in Supabase. So we're going to look at sign up, sign in, sign out, session, and on auth state change. We're also going to look at the magic link here. So basically users can just put in their email and then they get a magic link in their email and they sign in like that. And just so you know, there's also third-party providers. So OAuth, like here you can see GitHub, Google, GitLab, but we're not going to get into that in this video. Okay, so let's go to my, let's start a little app. I added Tailwind CSS and some routes. So basically sign up, sign in, and the magic link. Here you can see it just linking to different ones. I mean, it's a little confusing, but okay. So here we are on our signup page. Let's start with that. So here in Supabase, it's pretty simple. So basically, I'm binding to email and password up here, and then when I submit the form, prevent default, and run this function right here from Supabase. Okay, so it's just auth.signup. You pass in the email and password, and that will sign the user up. then you get returned here, user session and error. Okay, so if there's an error, I just alert error.message like that. Okay, but let's see what we want to do with session and user. So they sign up, and now we have a session and a user. So let's look at that. Let's see what that looks like. So console.log user session and error just for good measure. Okay, so let me just put in some gibberish, and let's see what comes out of here. Sign up. Okay, so first one right here we have user, but then you'll notice here we've got null and null, which is session and error. And just so you can see the error, let me sign up again. Error sending confirmation mail. Okay, so the reason that session is null is because the default is that the user has to confirm their email address. Okay, so if we come into our console right here, go to authentication, and then settings, you can see here, I guess you can disable sign up. But what we want to do is disable email confirmations. Unless you want them, you can do that. But for simplicity, I'm going to disable this. So I'm going to save it. And then let's try that again. Once it's saved, should be saved soon. Okay, come back here and refresh this. We're going to put in a different gibberish something and sign up. Okay, cool. So now we have this is the user, and then right here we've got the session. And notice that the session contains the user. So in general, we can probably just ignore this user and just deal with the session. Okay, that's what we care about is the session. So I'm going to ignore a user, and we're just going to take session here. Now, SvelteKit also has something called session, which is like the session, and it is from app stores. So this session is a writable store, and it just contains the session. So after we've signed up, we want to set this session to our session. Yeah. Okay, but they have the same name, so we're going to have to convert this session here to something else called Sesh. Maybe you can think of a better name. But here, once they've signed up, let's set our session equals Sesh. Okay, so you see what we're doing there? So we get the session back from this, and then we set it to our Svelte store. so we can access it in different components. So for example here in layout, let me uncomment these and we'll be able to see the session here, what the object looks like. Okay, so let try that Gonna put in another gibberish name right here and sign up Okay cool So I guess I didn quite okay this is really long so I didn quite put that there Let me see Let me add this class here just width 96 so we can actually see it. Overflow. Scroll. Okay, there it is. Okay, basically the access token is really long. So this is the session, and we can access this now from anywhere in our Svelte app, just by importing session from app stores like that. What do we want to do next? So let's see if I refresh it if it's still there. Oh no, it's gone. Okay, and the reason for that is because it's refreshing and there's nothing in session just by default and we're only setting it after we've signed up. So we want to fix that. What can we do about that? So let's come here and look at onAuthStateChange. So I'll get back to sign in. It's basically the same in Magic Link later, but let's look at auth onStateChange. So let's copy this right here into our code. So basically when we go from being logged out to logged in, this function will run and vice versa. So here in layout, let's put it here. Supabase.auth, oh we got import, import Supabase from lib slash DB. Okay, so Supabase.auth on, a state change console log this so let's see what that looks like so for example we're logged out right now and now I'm signed up and we see signed in and the session which contains the user so event session so the event was signed in and this is the session okay great so the only thing is that this doesn't run on load okay so for example we have the session right here so we could just set the session, our SvelteStore session, to, again, let's call this something different, sesh equals sesh. Okay, and now we don't need to manually set it right here because this will trigger an auth state change, which will trigger this function, and it'll set the session for us. Okay, and then if we log out, it'll also trigger this function and set the session back to null. Okay, so that handles all of that for us. The only issue is that unexpected token, yes, that is one issue. This is maybe because SvelteKit wants us to do this in the browser only and not on the server side. So import browser from I think it's app slash and I guess this will tell us if we're in the browser or not so if we're in the browser then oops run this function there we go okay so let's come back to the browser yeah so we'll see so we should have a session from Superbase but it wasn't actually populated here so we're gonna do another thing so we are going to use auth dot session okay so here we're going to do super base dot off dot session this will return the session and we can set it here okay so it's kind of a bummer that this doesn't run right away when you like instantiate it but it doesn't so basically when the user comes we get the session and we set the session it's either null or someone there and then from there on out if it ever changes we'll set it there again so that's what we're doing right here and that should take care of it for us so let me see there we go so okay yeah and I did start getting this error fortunately I can I don know why but mmm let me know if you know what this is about But it doesn seem to affect anything so fingers crossed Okay, but anyway, you see that the session is now automatically here. Okay, and that means we probably want to figure out our sign-in and magic link. Okay, so basically sign-in is basically the same. and actually we don't even have to touch sign in because it's almost literally the exact same but signing in with the sign in function and then setting session gets taken care of automatically and then let's look at magic link so let's go to magic link now for example let's go back to Svelte dummy, one of my email addresses, .com, magic. Sign up requires a valid password. Okay, it's because I'm putting sign up here instead of sign in. So with the magic link, it's a sign in, even if this person doesn't exist yet. So let's come to users and notice Svelte dummy isn't here yet. So now we come back. Svelte dummy at gmail.com magic. Okay. And I didn't handle any UI logic, but oh, you see it just went up. Cool. Your magic link and log in. Cool. So now I'm logged in like this here and I'm on the index. Cool. So this logged me in. I now have a session with my email Svelte dummy and I didn't have to put in a password or anything. And if we come here and refresh, you'll see, so dummy, there I am. This was before when I needed email verification, but we turned that off. Okay, come back to settings and notice site URL, localhost 3000. I don't know if this is the default or if I set it like that. I can't remember, but that's what brought me back to this page after my, when I clicked my magic link. Okay, cool. So we did all that. Basically, we just need to figure out logging out and we might want to kind of figure out how to do protected routes, but I don't have a great answer for it, but I'll show you something anyway. Okay, so here we have index and we have something, something here, index, index here. Okay, so basically here we can implement the sign out. So it's pretty simple, sign out. Okay, so there's not much to do here, but yeah, basically you don't pass anything in and it'll just return back to you an error if there is one. So you could do like I did here and just if error, alert. By the way, what does everyone think about alert? Before I was told it's terrible, but now I'm told it's not so bad anymore. So if this were something in production, I'd probably turn this into some kind of modal or something instead, but it's not too bad for now. Okay, so anyway, that's the sign out button. So now if I come to index like this, I can sign up. And now it's null. You'll see it like that. Okay, but we want it to redirect us. So that's the last part of this here, is how do we get it to redirect us back to the signup page here like that? And that is the tricky question because I'm not 100% sure. So I wanted you to take a look here at Tumblr and Twitter. So just to see that even Tumblr and Twitter don't have this quite perfect. So like ideally when I come to sign up it would check on the back end if I'm signed in or not and if I am signed in it would just redirect me to my home page and vice versa Like if I try to go to the home page but I not signed in it would just automatically return to me the signup page but if you come to Twitter here and say like if I want to try to go to I think it's called home you'll notice it flashes for a second and then redirects me to log in so it's actually doing it on the client the redirection so look at again boop you can see up there similar with tumblr so it's a little bit different but it's like a different strategy Let's say I want to sign up. Just put in some gibberish. And sign up. Let's say I'm 33. I'm not. And I say next. Getting to know Tumblr. Skip this. And I'm at dashboard. Okay, so I'm signed in on dashboard. And so, you know, if I'm not signed in, I probably shouldn't have access to this page. But if I log out. Log out. Yes. then I go back to dashboard you'll notice that I'm still here but I'm not actually I mean everything looks the same but if I try to do anything like text it's just it's not working because I'm not signed in okay but it still shows me this page so and I'm trying to convey to you that's not such a big deal if you know some of your routes aren't redirected based on if they're protected or not but I'm signed out here I just can't do anything okay that's how it would be in Supabase 2 if, you know, maybe you let them go to the main page, even if they're not signed in, they just can't do anything. Okay, but I mean, most people aren't trying to, like, hack around the URLs, so it's not a big deal. But anyway, let's see what we can do. So let's come to layout, and one thing we can do is if browser, so when we load the page, we can basically just say, okay, is there a session? Okay, is there a session? question mark? If there is, then go to the home page. Otherwise, go to the signup page. Okay, so that's one thing we could do. And the go to comes from app slash navigation. Okay, just so we go from one to, like programmatically go from one to the other. Does it not like we'll see okay so for example right now we're not signed in so like let's say I try to go to the oh okay so this is one issue look at that I don't know why it's doing that if you do let me know but um I for whatever reason need to set this time out okay so this does feel kind of hacky which it is but um this seems to work so okay remember I'm not signed in I try to go to the homepage, it redirects me to sign up. Okay, and then vice versa. So let's say I sign up, and now I have this here, and I try to refresh to sign up, it redirects me to index. Okay, this is like the app. The reason I didn't immediately do that is because we need to put that same logic in here. So on auth state change. Okay, so now it works. Now when I sign up, it'll redirect me to sign up. And then here, when I sign up, it'll redirect me into the app index here, where I can sign up. Okay, so that's one way to do it. So I'll try to cover the other ways to do this in a different video. But basically, you have to set up something with cookies and set the session in the cookie and then read the cookie from the back end and then do a redirect in the load function based on if the user signed in or not. Okay, but we'll do that in a different video. Let me know what you thought of this one and have a wonderful day. Bye